<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SMDM Europe 2023 - Signs of Trouble</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      SMDM Europe 2023
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">SMDM Europe 2023</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What They Didnâ€™t Teach You About Decision Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../slides/00_welcome-and-intros.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../slides/01_mortality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mortality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../slides/02_competing-events.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Embedding the Transition Matrix</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../slides/03_advanced-bookkeeping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Bookkeeping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../slides/04_incorporating-new-evidence-and-uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Incorporating New Evidence</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../blog/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop Blog</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../roster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructors</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#parameterize" id="toc-parameterize" class="nav-link active" data-scroll-target="#parameterize">Parameterize</a></li>
  <li><a href="#transition-probability-matrices" id="toc-transition-probability-matrices" class="nav-link" data-scroll-target="#transition-probability-matrices">Transition Probability Matrices</a>
  <ul class="collapse">
  <li><a href="#using-conversion-formulas" id="toc-using-conversion-formulas" class="nav-link" data-scroll-target="#using-conversion-formulas">1. Using Conversion Formulas</a></li>
  <li><a href="#using-transition-rate-matrix-embedding" id="toc-using-transition-rate-matrix-embedding" class="nav-link" data-scroll-target="#using-transition-rate-matrix-embedding">2. Using Transition Rate Matrix Embedding</a></li>
  </ul></li>
  <li><a href="#simulate-a-cohort-of-1000-individuals" id="toc-simulate-a-cohort-of-1000-individuals" class="nav-link" data-scroll-target="#simulate-a-cohort-of-1000-individuals">Simulate a Cohort of 1,000 Individuals</a>
  <ul class="collapse">
  <li><a href="#using-conversion-formulas-1" id="toc-using-conversion-formulas-1" class="nav-link" data-scroll-target="#using-conversion-formulas-1">1. Using Conversion Formulas</a></li>
  <li><a href="#using-embedding" id="toc-using-embedding" class="nav-link" data-scroll-target="#using-embedding">2. Using Embedding</a></li>
  </ul></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="CHEMlogo_white.png" class="img-fluid"></p>
</div></div></div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Signs of Trouble</h1>
<p class="subtitle lead">Changing Cycle Lengths</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The objective of this blog post is to demonstrate how state occupancy will differ over different cycle lengths when using standard conversion formulas in the presence of competing risks. In the embedded version, however, changing the cycle length does not affect state occupancy estimates.</p>
<section id="parameterize" class="level1">
<h1>Parameterize</h1>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">t_names =</span> <span class="fu">c</span>(<span class="st">"without_drug"</span>, <span class="st">"with_drug"</span>),   <span class="co"># Treatment names</span></span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_treatments =</span><span class="dv">2</span>, <span class="co"># Number of treatments</span></span>
<span id="annotated-cell-1-4"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">s_names  =</span> <span class="fu">c</span>(<span class="st">"Asympt"</span>, <span class="st">"Progressive"</span>, <span class="st">"DeadCause"</span>,<span class="st">"Dead"</span>), <span class="co"># State names</span></span>
<span id="annotated-cell-1-5"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_states =</span> <span class="dv">4</span>, <span class="co"># Number of states</span></span>
<span id="annotated-cell-1-6"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-7" class="code-annotation-target"><a href="#annotated-cell-1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">a_names =</span> <span class="fu">c</span>(<span class="st">"accProgressive"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-8" class="code-annotation-target"><a href="#annotated-cell-1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">tunnel_names =</span> <span class="fu">c</span>(<span class="st">"trProgressive"</span>,<span class="st">"trDeadCause"</span>),</span>
<span id="annotated-cell-1-9"><a href="#annotated-cell-1-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-1-10"><a href="#annotated-cell-1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_cohort =</span><span class="dv">1000</span>, <span class="co"># Cohort size</span></span>
<span id="annotated-cell-1-11"><a href="#annotated-cell-1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cycle =</span> <span class="dv">1</span>, <span class="co"># Cycle length</span></span>
<span id="annotated-cell-1-12"><a href="#annotated-cell-1-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-1-13"><a href="#annotated-cell-1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-1-14"><a href="#annotated-cell-1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Initial_age =</span> <span class="dv">55</span>,  <span class="co"># Cohort starting age</span></span>
<span id="annotated-cell-1-15"><a href="#annotated-cell-1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fl">0.5</span>,  <span class="co"># Treatment Effect (drug) </span></span>
<span id="annotated-cell-1-16"><a href="#annotated-cell-1-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-1-17"><a href="#annotated-cell-1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cAsymp =</span><span class="dv">500</span>,   <span class="co"># Cost of asympomatic state</span></span>
<span id="annotated-cell-1-18"><a href="#annotated-cell-1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">cDeath =</span><span class="dv">1000</span>,  <span class="co"># cost of death (progressive disease state only)</span></span>
<span id="annotated-cell-1-19"><a href="#annotated-cell-1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">cDrug =</span><span class="dv">1000</span>,   <span class="co"># Cost of drug</span></span>
<span id="annotated-cell-1-20"><a href="#annotated-cell-1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">cProg =</span><span class="dv">3000</span>,   <span class="co"># Cycle cost of progressive disease</span></span>
<span id="annotated-cell-1-21"><a href="#annotated-cell-1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">uAsymp =</span><span class="fl">0.95</span>, <span class="co"># Asymptomatic state utility</span></span>
<span id="annotated-cell-1-22"><a href="#annotated-cell-1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">uProg =</span><span class="fl">0.75</span>,  <span class="co"># Progressive disease state utility</span></span>
<span id="annotated-cell-1-23"><a href="#annotated-cell-1-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">oDr =</span> <span class="fl">0.06</span>,  <span class="co"># Discount rate (QALYs)</span></span>
<span id="annotated-cell-1-24"><a href="#annotated-cell-1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cDr =</span> <span class="fl">0.06</span>,  <span class="co"># Discount rate (costs)</span></span>
<span id="annotated-cell-1-25"><a href="#annotated-cell-1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpDcm =</span><span class="fl">0.15</span>,  <span class="co"># Death from progressive disease trans prob</span></span>
<span id="annotated-cell-1-26"><a href="#annotated-cell-1-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpProg =</span><span class="fl">0.01</span>, <span class="co"># Transition prob: progressive disease</span></span>
<span id="annotated-cell-1-27"><a href="#annotated-cell-1-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">tpDn =</span><span class="fl">0.0379</span>  <span class="co"># Background mortality transition prob</span></span>
<span id="annotated-cell-1-28"><a href="#annotated-cell-1-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-1-29"><a href="#annotated-cell-1-29" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="co"># Yearly cycle</span></span>
<span id="annotated-cell-1-30"><a href="#annotated-cell-1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modifyList</span>(params,<span class="fu">list</span>(    <span class="at">n_cycles =</span> <span class="dv">46</span><span class="sc">/</span>params<span class="sc">$</span>cycle))</span>
<span id="annotated-cell-1-31"><a href="#annotated-cell-1-31" aria-hidden="true" tabindex="-1"></a>params12 <span class="ot">&lt;-</span>  <span class="co"># Monthly cycle</span></span>
<span id="annotated-cell-1-32"><a href="#annotated-cell-1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modifyList</span>(params, <span class="fu">list</span>(<span class="at">n_cycles =</span> <span class="dv">46</span> <span class="sc">*</span> <span class="dv">12</span>, <span class="at">cycle =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>))</span>
<span id="annotated-cell-1-33"><a href="#annotated-cell-1-33" aria-hidden="true" tabindex="-1"></a>params365 <span class="ot">&lt;-</span>  <span class="co"># Daily cycle</span></span>
<span id="annotated-cell-1-34"><a href="#annotated-cell-1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modifyList</span>(params, <span class="fu">list</span>(<span class="at">n_cycles =</span> <span class="dv">46</span> <span class="sc">*</span> <span class="dv">365</span>, <span class="at">cycle =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-annotation="1" data-code-cell="annotated-cell-1" data-code-lines="7">Accumulators</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-annotation="2" data-code-cell="annotated-cell-1" data-code-lines="8">Transition tracker</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="transition-probability-matrices" class="level1">
<h1>Transition Probability Matrices</h1>
<p>Our next objective is to define a function that constructs the time-dependent transition probability matrices.</p>
<section id="using-conversion-formulas" class="level2">
<h2 class="anchored" data-anchor-id="using-conversion-formulas">1. Using Conversion Formulas</h2>
<ol type="1">
<li>Convert each annual transition probability to a rate using <span class="math inline">\(r = -ln(1 - p)\)</span>.</li>
<li>Convert the rate to the model timestep using <span class="math inline">\(1 - exp(-rt)\)</span>, where <span class="math inline">\(t\)</span> is the timestep (e.g., <span class="math inline">\(t = \frac{1}{12}\)</span> for a monthly cycle)</li>
<li>Construct the transition probability matrix using the converted probabilities.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mPt <span class="ot">&lt;-</span> <span class="cf">function</span>(t, params) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(t, <span class="cf">function</span>(tt){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        current_age <span class="ot">&lt;-</span> params<span class="sc">$</span>Initial_age  <span class="sc">+</span>  (tt)<span class="sc">*</span>params<span class="sc">$</span>cycle <span class="sc">-</span> <span class="dv">1</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        tpDn_lookup <span class="ot">&lt;-</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"(34,44]"</span> <span class="ot">=</span> <span class="fl">0.0017</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(44,54]"</span> <span class="ot">=</span> <span class="fl">0.0044</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(54,64]"</span> <span class="ot">=</span> <span class="fl">0.0138</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(64,74]"</span> <span class="ot">=</span> <span class="fl">0.0379</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(74,84]"</span> <span class="ot">=</span> <span class="fl">0.0912</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(84,100]"</span> <span class="ot">=</span> <span class="fl">0.1958</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        age_grp <span class="ot">&lt;-</span> <span class="fu">cut</span>(current_age, </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">44</span>,<span class="dv">54</span>,<span class="dv">64</span>,<span class="dv">74</span>,<span class="dv">84</span>,<span class="dv">100</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        tpDn <span class="ot">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        tpProg_ <span class="ot">&lt;-</span> params<span class="sc">$</span>tpProg <span class="sc">*</span> (tt <span class="sc">*</span> params<span class="sc">$</span>cycle )</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        tpDcm_ <span class="ot">&lt;-</span> params<span class="sc">$</span>tpDcm </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        rDn <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDn)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        rProg_ <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpProg_)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        rDcm_ <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDcm_)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        tpDn <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>rDn <span class="sc">*</span> params<span class="sc">$</span>cycle)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        tpProg_ <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>rProg_ <span class="sc">*</span> params<span class="sc">$</span>cycle)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        tpDcm_ <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>rDcm_ <span class="sc">*</span> params<span class="sc">$</span>cycle)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        effect_ <span class="ot">&lt;-</span> params<span class="sc">$</span>effect</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        n_states_ <span class="ot">&lt;-</span> params<span class="sc">$</span>n_states</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        s_names_ <span class="ot">&lt;-</span> params<span class="sc">$</span>s_names</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        t_names_ <span class="ot">&lt;-</span> params<span class="sc">$</span>t_names</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        n_treatments_ <span class="ot">&lt;-</span> params<span class="sc">$</span>n_treatments</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        mP_ <span class="ot">&lt;-</span> </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">array</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                           tpProg_, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">0</span>,tpDcm_,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                           tpDn , tpDn, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                           </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                           tpProg_<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>effect_), <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                           <span class="dv">0</span>,tpDcm_,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                           tpDn, tpDn,<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dim =</span> <span class="fu">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">from =</span> s_names_,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">to =</span> s_names_,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                                  t_names_))</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(mP_[,,<span class="dv">1</span>]) <span class="ot">&lt;-</span>  <span class="co"># Diagonal of transition probability matrix is 1 minus off-diagonal sum</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span> <span class="sc">-</span> <span class="fu">rowSums</span>(mP_[,,<span class="dv">1</span>])</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(mP_[,,<span class="dv">2</span>]) <span class="ot">&lt;-</span> </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1</span> <span class="sc">-</span> <span class="fu">rowSums</span>(mP_[,,<span class="dv">2</span>])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        mP <span class="ot">&lt;-</span> <span class="co"># This turns the named array into a simpler list object</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">apply</span>(mP_,<span class="dv">3</span>,<span class="cf">function</span>(x) x, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(mP)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="using-transition-rate-matrix-embedding" class="level2">
<h2 class="anchored" data-anchor-id="using-transition-rate-matrix-embedding">2. Using Transition Rate Matrix Embedding</h2>
<ol type="1">
<li>Convert each annual transition probability to a rate using <span class="math inline">\(r = -ln(1 - p)\)</span>.</li>
<li>Use these rates to fill out the Markovian transition rate matrix <code>mR</code>
<ul>
<li>Diagonal of <code>mR</code> is the negative row sum of off-diagonal elements.</li>
</ul></li>
<li>Augment the transition rate matrix with non-Markovian accumulators and transition/tunnel states.</li>
<li>Embed the transition rate matrix into the time step using <span class="math inline">\(mP = exp(mR*t)\)</span>, where <span class="math inline">\(t\)</span> is the timestep (e.g., <span class="math inline">\(t = \frac{1}{12}\)</span> for a monthly cycle).</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mPt_embedded <span class="ot">&lt;-</span> <span class="cf">function</span>(t,params) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(t, <span class="cf">function</span>(tt){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        current_age <span class="ot">&lt;-</span> params<span class="sc">$</span>Initial_age  <span class="sc">+</span> (tt)<span class="sc">*</span>params<span class="sc">$</span>cycle <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        cycle <span class="ot">=</span> tt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        cycle_years <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(tt <span class="sc">*</span> params<span class="sc">$</span>cycle)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        tpDn_lookup <span class="ot">&lt;-</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"(34,44]"</span> <span class="ot">=</span> <span class="fl">0.0017</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(44,54]"</span> <span class="ot">=</span> <span class="fl">0.0044</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(54,64]"</span> <span class="ot">=</span> <span class="fl">0.0138</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(64,74]"</span> <span class="ot">=</span> <span class="fl">0.0379</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(74,84]"</span> <span class="ot">=</span> <span class="fl">0.0912</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"(84,100]"</span> <span class="ot">=</span> <span class="fl">0.1958</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        age_grp <span class="ot">&lt;-</span> <span class="fu">cut</span>(current_age, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">44</span>,<span class="dv">54</span>,<span class="dv">64</span>,<span class="dv">74</span>,<span class="dv">84</span>,<span class="dv">100</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        tpDn <span class="ot">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        tpProg_ <span class="ot">&lt;-</span> params<span class="sc">$</span>tpProg <span class="sc">*</span> (cycle_years)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        tpDcm_ <span class="ot">&lt;-</span> params<span class="sc">$</span>tpDcm </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        effect_ <span class="ot">&lt;-</span> params<span class="sc">$</span>effect</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        n_states_ <span class="ot">&lt;-</span> params<span class="sc">$</span>n_states</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        s_names_ <span class="ot">&lt;-</span> params<span class="sc">$</span>s_names</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        t_names_ <span class="ot">&lt;-</span> params<span class="sc">$</span>t_names</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        n_treatments_ <span class="ot">&lt;-</span> params<span class="sc">$</span>n_treatments</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        mR_ <span class="ot">&lt;-</span> </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">array</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>tpProg_), <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>,<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>tpDcm_),<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDn),  <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDn), <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                           </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>(tpProg_<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>effect_))), <span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                                   <span class="dv">0</span>,<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>tpDcm_),<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDn),  <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> tpDn),<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                          <span class="at">dim =</span> <span class="fu">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                          <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">from =</span> s_names_,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">to =</span> s_names_,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                                          t_names_))</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        mR_ <span class="ot">&lt;-</span> <span class="fu">apply</span>(mR_,<span class="dv">3</span>,<span class="cf">function</span>(x){</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">diag</span>(x) <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">rowSums</span>(x)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>            x</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        },<span class="at">simplify=</span><span class="cn">FALSE</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="do">###############################</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add Non-Markovian Components</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        <span class="do">###############################</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        mR <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mR_,<span class="cf">function</span>(x){</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>            r_ <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>            add_ <span class="ot">&lt;-</span> <span class="fu">length</span>(params<span class="sc">$</span>a_names)   <span class="sc">+</span> <span class="fu">length</span>(params<span class="sc">$</span>tunnel_names) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>            new_row_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rownames</span>(x), params<span class="sc">$</span>a_names,params<span class="sc">$</span>tunnel_names,<span class="st">"XX"</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>            new_col_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">colnames</span>(x), params<span class="sc">$</span>a_names,params<span class="sc">$</span>tunnel_names,<span class="st">"XX"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Expand matrix</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x,  <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, r_ <span class="sc">*</span> add_), <span class="at">nrow=</span>r_))</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>            x  <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x, <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, add_ <span class="sc">*</span> (r_<span class="sc">+</span>add_)), <span class="at">nrow=</span>add_))</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rownames</span>(x) <span class="ot">&lt;-</span> new_row_names</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> new_col_names</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"Asympt"</span>,<span class="st">"accProgressive"</span>] <span class="ot">=</span> x[<span class="st">"Asympt"</span>,<span class="st">"Progressive"</span>]</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"Asympt"</span>,<span class="st">"trProgressive"</span>] <span class="ot">=</span> x[<span class="st">"Asympt"</span>,<span class="st">"Progressive"</span>]</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"Progressive"</span>,<span class="st">"trDeadCause"</span>] <span class="ot">=</span> x[<span class="st">"Progressive"</span>,<span class="st">"DeadCause"</span>] </span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>            x</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        mP_ <span class="ot">&lt;-</span> <span class="co"># Embed the transition probability matrix</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>            <span class="fu">lapply</span>(mR,<span class="cf">function</span>(x) <span class="fu">expm</span>(x <span class="sc">*</span> params<span class="sc">$</span>cycle))</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        mP <span class="ot">&lt;-</span> <span class="fu">lapply</span>(mP_,<span class="cf">function</span>(x){</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Don't allow the transition columns to remain...</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"trDeadCause"</span>,<span class="st">"trDeadCause"</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            x[<span class="st">"trProgressive"</span>,<span class="st">"trProgressive"</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The receiving bucket was required for embedding, but is no longer needed</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>            x[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">rownames</span>(x)<span class="sc">==</span><span class="st">"XX"</span>),<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(x)<span class="sc">==</span><span class="st">"XX"</span>)]    </span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        }) </span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-a-cohort-of-1000-individuals" class="level1 page-columns page-full">
<h1>Simulate a Cohort of 1,000 Individuals</h1>
<ul>
<li>Construct a Markov trace and plot state occupancy over the simulation time horizon.</li>
<li>Note that with different cycle lengths, the traditional approach yields different state occupancies!</li>
</ul>
<section id="using-conversion-formulas-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-conversion-formulas-1">1. Using Conversion Formulas</h2>
<div class="cell page-columns page-full" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>sim_cohort <span class="ot">&lt;-</span> <span class="cf">function</span>(params) {</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>    mP <span class="ot">&lt;-</span> <span class="fu">mPt</span>(<span class="dv">1</span><span class="sc">:</span>(params<span class="sc">$</span>n_cycles<span class="dv">-1</span>),params)</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>    tr <span class="ot">&lt;-</span></span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a>        mP <span class="sc">%&gt;%</span> <span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>            tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"Asympt"</span> <span class="ot">=</span> params<span class="sc">$</span>n_cohort, <span class="st">"Progressive"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"DeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Dead"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">do.call</span>(rbind,<span class="fu">lapply</span>(.x, <span class="cf">function</span>(tp) {</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>                tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>            }))</span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-4-13"><a href="#annotated-cell-4-13" aria-hidden="true" tabindex="-1"></a>    tr <span class="ot">&lt;-</span>  </span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14" aria-hidden="true" tabindex="-1"></a>        tr <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-15"><a href="#annotated-cell-4-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-4-16"><a href="#annotated-cell-4-16" aria-hidden="true" tabindex="-1"></a>            .x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">t</span>(<span class="fu">c</span>(params<span class="sc">$</span>n_cohort,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),.x)</span>
<span id="annotated-cell-4-17"><a href="#annotated-cell-4-17" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-4-18"><a href="#annotated-cell-4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-4-19"><a href="#annotated-cell-4-19" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span></span>
<span id="annotated-cell-4-20"><a href="#annotated-cell-4-20" aria-hidden="true" tabindex="-1"></a>        mP <span class="sc">%&gt;%</span> <span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-21"><a href="#annotated-cell-4-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-4-22"><a href="#annotated-cell-4-22" aria-hidden="true" tabindex="-1"></a>            tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"Asymptomatic_disease"</span> <span class="ot">=</span> params<span class="sc">$</span>n_cohort, <span class="st">"Progressive_disease"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"DeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Dead"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-4-23"><a href="#annotated-cell-4-23" aria-hidden="true" tabindex="-1"></a>            arr_ <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(tr_))</span>
<span id="annotated-cell-4-24"><a href="#annotated-cell-4-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">do.call</span>(rbind,<span class="fu">lapply</span>(.x, <span class="cf">function</span>(tp) {</span>
<span id="annotated-cell-4-25"><a href="#annotated-cell-4-25" aria-hidden="true" tabindex="-1"></a>                tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-4-26"><a href="#annotated-cell-4-26" aria-hidden="true" tabindex="-1"></a>                arr_ <span class="ot">&lt;&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(tr_)) <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-4-27"><a href="#annotated-cell-4-27" aria-hidden="true" tabindex="-1"></a>                arr_</span>
<span id="annotated-cell-4-28"><a href="#annotated-cell-4-28" aria-hidden="true" tabindex="-1"></a>            }))</span>
<span id="annotated-cell-4-29"><a href="#annotated-cell-4-29" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-4-30"><a href="#annotated-cell-4-30" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-4-31"><a href="#annotated-cell-4-31" aria-hidden="true" tabindex="-1"></a>        arr <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-32"><a href="#annotated-cell-4-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-4-33"><a href="#annotated-cell-4-33" aria-hidden="true" tabindex="-1"></a>            .x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">diag</span>(<span class="fu">c</span>(params<span class="sc">$</span>n_cohort,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)),.x)</span>
<span id="annotated-cell-4-34"><a href="#annotated-cell-4-34" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-4-35"><a href="#annotated-cell-4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-4-36"><a href="#annotated-cell-4-36" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span> arr <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-4-37"><a href="#annotated-cell-4-37" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-38"><a href="#annotated-cell-4-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">cycle =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>params<span class="sc">$</span>n_cycles,params<span class="sc">$</span>n_states))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-39"><a href="#annotated-cell-4-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-40"><a href="#annotated-cell-4-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">nest</span>()</span>
<span id="annotated-cell-4-41"><a href="#annotated-cell-4-41" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="annotated-cell-4-42"><a href="#annotated-cell-4-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-4-43"><a href="#annotated-cell-4-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">trace =</span> tr, <span class="at">array =</span> arr))</span>
<span id="annotated-cell-4-44"><a href="#annotated-cell-4-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-4-45"><a href="#annotated-cell-4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-46"><a href="#annotated-cell-4-46" aria-hidden="true" tabindex="-1"></a>markov_result <span class="ot">&lt;-</span></span>
<span id="annotated-cell-4-47"><a href="#annotated-cell-4-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort</span>(params)</span>
<span id="annotated-cell-4-48"><a href="#annotated-cell-4-48" aria-hidden="true" tabindex="-1"></a>markov_result12 <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-4-49"><a href="#annotated-cell-4-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort</span>(params12)</span>
<span id="annotated-cell-4-50"><a href="#annotated-cell-4-50" aria-hidden="true" tabindex="-1"></a>markov_result365 <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-4-51"><a href="#annotated-cell-4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort</span>(params365)</span>
<span id="annotated-cell-4-52"><a href="#annotated-cell-4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-53"><a href="#annotated-cell-4-53" aria-hidden="true" tabindex="-1"></a>markov_result<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-54"><a href="#annotated-cell-4-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-55"><a href="#annotated-cell-4-55" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-56"><a href="#annotated-cell-4-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-57"><a href="#annotated-cell-4-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-58"><a href="#annotated-cell-4-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params<span class="sc">$</span>cycle))  <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-59"><a href="#annotated-cell-4-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="annotated-cell-4-60"><a href="#annotated-cell-4-60" aria-hidden="true" tabindex="-1"></a>        markov_result12<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-61"><a href="#annotated-cell-4-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-62"><a href="#annotated-cell-4-62" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-63"><a href="#annotated-cell-4-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-64"><a href="#annotated-cell-4-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params12<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-65"><a href="#annotated-cell-4-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params12<span class="sc">$</span>cycle))</span>
<span id="annotated-cell-4-66"><a href="#annotated-cell-4-66" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-67"><a href="#annotated-cell-4-67" aria-hidden="true" tabindex="-1"></a>     <span class="fu">bind_rows</span>(</span>
<span id="annotated-cell-4-68"><a href="#annotated-cell-4-68" aria-hidden="true" tabindex="-1"></a>        markov_result365<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-69"><a href="#annotated-cell-4-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-70"><a href="#annotated-cell-4-70" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-71"><a href="#annotated-cell-4-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-72"><a href="#annotated-cell-4-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params365<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-73"><a href="#annotated-cell-4-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params365<span class="sc">$</span>cycle))</span>
<span id="annotated-cell-4-74"><a href="#annotated-cell-4-74" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-4-75"><a href="#annotated-cell-4-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">factor</span>(<span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(cycle_length)),<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Month"</span>,<span class="st">"Year"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-76"><a href="#annotated-cell-4-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(state,value,<span class="sc">-</span>strategy,<span class="sc">-</span>cycle,<span class="sc">-</span>cycle_length) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-4-77"><a href="#annotated-cell-4-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cycle, <span class="at">y =</span> value, <span class="at">colour =</span> state ,<span class="at">lty=</span>cycle_length)) <span class="sc">+</span> </span>
<span id="annotated-cell-4-78"><a href="#annotated-cell-4-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="annotated-cell-4-79"><a href="#annotated-cell-4-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>strategy) <span class="sc">+</span></span>
<span id="annotated-cell-4-80"><a href="#annotated-cell-4-80" aria-hidden="true" tabindex="-1"></a>    hrbrthemes<span class="sc">::</span><span class="fu">theme_ipsum</span>(<span class="at">base_family =</span> <span class="st">"Arial"</span>) <span class="sc">+</span> </span>
<span id="annotated-cell-4-81"><a href="#annotated-cell-4-81" aria-hidden="true" tabindex="-1"></a>    ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>(<span class="at">name=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="annotated-cell-4-82"><a href="#annotated-cell-4-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-4-83"><a href="#annotated-cell-4-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">method =</span> <span class="fu">list</span>(<span class="st">"last.bumpup"</span>,<span class="at">hjust=</span><span class="dv">1</span>,<span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>),<span class="fu">aes</span>(<span class="at">label =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-4-84"><a href="#annotated-cell-4-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">method =</span> <span class="fu">list</span>(<span class="st">"first.bumpup"</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>),<span class="fu">aes</span>(<span class="at">label =</span> state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-page">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="signs-of-trouble_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>As the figure shows, state occupancy differs across the various cycle lengths.</p>
</section>
<section id="using-embedding" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-embedding">2. Using Embedding</h2>
<div class="cell page-columns page-full" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a>sim_cohort_emb <span class="ot">&lt;-</span> <span class="cf">function</span>(params) {</span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a>    mP <span class="ot">&lt;-</span> <span class="fu">mPt_embedded</span>(<span class="dv">1</span><span class="sc">:</span>(params<span class="sc">$</span>n_cycles<span class="dv">-1</span>),params)</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>    tr <span class="ot">&lt;-</span></span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a>        mP <span class="sc">%&gt;%</span> <span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-7"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-5-8"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a>            tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"Asymptomatic_disease"</span> <span class="ot">=</span> params<span class="sc">$</span>n_cohort, <span class="st">"Progressive_disease"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"DeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Dead"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"accProgressive"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"trProgressive"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"trDeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-5-10"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">do.call</span>(rbind,<span class="fu">lapply</span>(.x, <span class="cf">function</span>(tp) {</span>
<span id="annotated-cell-5-11"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a>                tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-5-12"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a>            }))</span>
<span id="annotated-cell-5-13"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-5-14"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a>    tr <span class="ot">&lt;-</span>  </span>
<span id="annotated-cell-5-15"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a>        tr <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-16"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-5-17"><a href="#annotated-cell-5-17" aria-hidden="true" tabindex="-1"></a>            .x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">t</span>(<span class="fu">c</span>(params<span class="sc">$</span>n_cohort,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(<span class="fu">c</span>(params<span class="sc">$</span>a_names,params<span class="sc">$</span>t_names))))),.x)</span>
<span id="annotated-cell-5-18"><a href="#annotated-cell-5-18" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-5-19"><a href="#annotated-cell-5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-5-20"><a href="#annotated-cell-5-20" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span></span>
<span id="annotated-cell-5-21"><a href="#annotated-cell-5-21" aria-hidden="true" tabindex="-1"></a>        mP <span class="sc">%&gt;%</span> <span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-22"><a href="#annotated-cell-5-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-5-23"><a href="#annotated-cell-5-23" aria-hidden="true" tabindex="-1"></a>            tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"Asymptomatic_disease"</span> <span class="ot">=</span> params<span class="sc">$</span>n_cohort, <span class="st">"Progressive_disease"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"DeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Dead"</span> <span class="ot">=</span> <span class="dv">0</span>, </span>
<span id="annotated-cell-5-24"><a href="#annotated-cell-5-24" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"accProgressive"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"trProgressive"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"trDeadCause"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-5-25"><a href="#annotated-cell-5-25" aria-hidden="true" tabindex="-1"></a>            arr_ <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(tr_))</span>
<span id="annotated-cell-5-26"><a href="#annotated-cell-5-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">do.call</span>(rbind,<span class="fu">lapply</span>(.x, <span class="cf">function</span>(tp) {</span>
<span id="annotated-cell-5-27"><a href="#annotated-cell-5-27" aria-hidden="true" tabindex="-1"></a>                tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-5-28"><a href="#annotated-cell-5-28" aria-hidden="true" tabindex="-1"></a>                arr_ <span class="ot">&lt;&lt;-</span> <span class="fu">diag</span>(<span class="fu">as.vector</span>(tr_)) <span class="sc">%*%</span> tp</span>
<span id="annotated-cell-5-29"><a href="#annotated-cell-5-29" aria-hidden="true" tabindex="-1"></a>                arr_</span>
<span id="annotated-cell-5-30"><a href="#annotated-cell-5-30" aria-hidden="true" tabindex="-1"></a>            }))</span>
<span id="annotated-cell-5-31"><a href="#annotated-cell-5-31" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-5-32"><a href="#annotated-cell-5-32" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-5-33"><a href="#annotated-cell-5-33" aria-hidden="true" tabindex="-1"></a>        arr <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-34"><a href="#annotated-cell-5-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-5-35"><a href="#annotated-cell-5-35" aria-hidden="true" tabindex="-1"></a>            .x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">diag</span>(<span class="fu">c</span>(params<span class="sc">$</span>n_cohort,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(<span class="fu">c</span>(params<span class="sc">$</span>a_names,params<span class="sc">$</span>t_names))))),.x)</span>
<span id="annotated-cell-5-36"><a href="#annotated-cell-5-36" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="annotated-cell-5-37"><a href="#annotated-cell-5-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-5-38"><a href="#annotated-cell-5-38" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="annotated-cell-5-39"><a href="#annotated-cell-5-39" aria-hidden="true" tabindex="-1"></a>    arr <span class="ot">&lt;-</span> arr <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span>({</span>
<span id="annotated-cell-5-40"><a href="#annotated-cell-5-40" aria-hidden="true" tabindex="-1"></a>        .x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-41"><a href="#annotated-cell-5-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">cycle =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>params<span class="sc">$</span>n_cycles,params<span class="sc">$</span>n_states<span class="sc">+</span><span class="fu">length</span>(<span class="fu">c</span>(params<span class="sc">$</span>a_names,params<span class="sc">$</span>t_names))))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-42"><a href="#annotated-cell-5-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-43"><a href="#annotated-cell-5-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">nest</span>()</span>
<span id="annotated-cell-5-44"><a href="#annotated-cell-5-44" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="annotated-cell-5-45"><a href="#annotated-cell-5-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-5-46"><a href="#annotated-cell-5-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">trace =</span> tr, <span class="at">array =</span> arr))</span>
<span id="annotated-cell-5-47"><a href="#annotated-cell-5-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-5-48"><a href="#annotated-cell-5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-49"><a href="#annotated-cell-5-49" aria-hidden="true" tabindex="-1"></a>markov_result_emb <span class="ot">&lt;-</span></span>
<span id="annotated-cell-5-50"><a href="#annotated-cell-5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort_emb</span>(params)</span>
<span id="annotated-cell-5-51"><a href="#annotated-cell-5-51" aria-hidden="true" tabindex="-1"></a>markov_result_emb12 <span class="ot">&lt;-</span></span>
<span id="annotated-cell-5-52"><a href="#annotated-cell-5-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort_emb</span>(params12)</span>
<span id="annotated-cell-5-53"><a href="#annotated-cell-5-53" aria-hidden="true" tabindex="-1"></a>markov_result_emb365 <span class="ot">&lt;-</span></span>
<span id="annotated-cell-5-54"><a href="#annotated-cell-5-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sim_cohort_emb</span>(params365)</span>
<span id="annotated-cell-5-55"><a href="#annotated-cell-5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-5-56"><a href="#annotated-cell-5-56" aria-hidden="true" tabindex="-1"></a>markov_result_emb<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-57"><a href="#annotated-cell-5-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-58"><a href="#annotated-cell-5-58" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-59"><a href="#annotated-cell-5-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-60"><a href="#annotated-cell-5-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-61"><a href="#annotated-cell-5-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params<span class="sc">$</span>cycle))  <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-62"><a href="#annotated-cell-5-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="annotated-cell-5-63"><a href="#annotated-cell-5-63" aria-hidden="true" tabindex="-1"></a>        markov_result_emb12<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-64"><a href="#annotated-cell-5-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-65"><a href="#annotated-cell-5-65" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-66"><a href="#annotated-cell-5-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-67"><a href="#annotated-cell-5-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params12<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-68"><a href="#annotated-cell-5-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params12<span class="sc">$</span>cycle))</span>
<span id="annotated-cell-5-69"><a href="#annotated-cell-5-69" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-70"><a href="#annotated-cell-5-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="annotated-cell-5-71"><a href="#annotated-cell-5-71" aria-hidden="true" tabindex="-1"></a>        markov_result_emb365<span class="sc">$</span>trace <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-72"><a href="#annotated-cell-5-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-73"><a href="#annotated-cell-5-73" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cycle =</span> (<span class="fu">row_number</span>()<span class="sc">-</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-74"><a href="#annotated-cell-5-74" aria-hidden="true" tabindex="-1"></a>        <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"strategy"</span>) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-75"><a href="#annotated-cell-5-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle =</span> cycle <span class="sc">*</span> params365<span class="sc">$</span>cycle) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-76"><a href="#annotated-cell-5-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">paste0</span>(params365<span class="sc">$</span>cycle))</span>
<span id="annotated-cell-5-77"><a href="#annotated-cell-5-77" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span>   </span>
<span id="annotated-cell-5-78"><a href="#annotated-cell-5-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"tr"</span>),<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"acc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-79"><a href="#annotated-cell-5-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cycle_length =</span> <span class="fu">factor</span>(<span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(cycle_length)),<span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Day"</span>,<span class="st">"Month"</span>,<span class="st">"Year"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-80"><a href="#annotated-cell-5-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(state,value,<span class="sc">-</span>strategy,<span class="sc">-</span>cycle,<span class="sc">-</span>cycle_length) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-5-81"><a href="#annotated-cell-5-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cycle, <span class="at">y =</span> value, <span class="at">colour =</span> state ,<span class="at">lty=</span>cycle_length)) <span class="sc">+</span> </span>
<span id="annotated-cell-5-82"><a href="#annotated-cell-5-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="annotated-cell-5-83"><a href="#annotated-cell-5-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>strategy) <span class="sc">+</span></span>
<span id="annotated-cell-5-84"><a href="#annotated-cell-5-84" aria-hidden="true" tabindex="-1"></a>    hrbrthemes<span class="sc">::</span><span class="fu">theme_ipsum</span>(<span class="at">base_family =</span> <span class="st">"Arial"</span>) <span class="sc">+</span> </span>
<span id="annotated-cell-5-85"><a href="#annotated-cell-5-85" aria-hidden="true" tabindex="-1"></a>    ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>(<span class="at">name=</span><span class="st">""</span>) <span class="sc">+</span> </span>
<span id="annotated-cell-5-86"><a href="#annotated-cell-5-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-5-87"><a href="#annotated-cell-5-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">method =</span> <span class="fu">list</span>(<span class="st">"last.bumpup"</span>,<span class="at">hjust=</span><span class="dv">1</span>,<span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>),<span class="fu">aes</span>(<span class="at">label =</span> state)) <span class="sc">+</span></span>
<span id="annotated-cell-5-88"><a href="#annotated-cell-5-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">method =</span> <span class="fu">list</span>(<span class="st">"first.bumpup"</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>),<span class="fu">aes</span>(<span class="at">label =</span> state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-page">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="signs-of-trouble_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The figure clearly shows that changing the cycle length does not affect the state occupancy estimates.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>