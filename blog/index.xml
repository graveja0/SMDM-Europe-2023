<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>SMDM Europe 2023</title>
<link>https://graveja0.github.io/SMDM-Europe-2023/blog/index.html</link>
<atom:link href="https://graveja0.github.io/SMDM-Europe-2023/blog/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.340</generator>
<lastBuildDate>Thu, 18 May 2023 18:55:37 GMT</lastBuildDate>
<item>
  <title>Basic Markov Modeling in R</title>
  <link>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/green-et-al-replication/green-et-al-replication.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>The objective of this posting is to provide R code that replicates the model and results in <span class="citation" data-cites="green2023health">Green et al. (2023)</span>.</p>
<div class="page-columns page-full"><p><span class="citation" data-cites="green2023health">Green et al. (2023)</span> provide a <a href="https://github.com/Excel-R-tutorials/Markov-model-introduction/blob/ea65640a064d9d01f56295cbbab90ab4865c38fc/original_Excel_files/Media_343196_smxx.xlsm">link to the Excel file</a> as well as <a href="https://github.com/Excel-R-tutorials/Markov-model-introduction/blob/main/Markov_model_realworld.R">code to execute the same model in R</a>. The R code is written in base R, meaning that it does not require any loaded packages to execute. However, the model structure is somewhat complicated–requiring, for example, both state occupancy and transitions out of certain states to be tracked.</p><div class="no-row-height column-margin column-container"><span class="">More specifically, in the <span class="citation" data-cites="green2023health">Green et al. (2023)</span> model there is an additional cost from transitioning from Progressive disease to death, but this cost does not apply if the cause of death was background mortality. This is straighforward to track when the calculations are done cycle-by-cycle, as in the original Excel file and R code. However, this type of dynamic is not easily captured in a generalized approach to modeling—as we aim to build here—unless the specific health states are separately defined in the model. Our adaptation to the code generalizes the modeling process but does not change the results.</span></div></div>
<p>The code provided below replicates the original model, but draws on various capabilities within the (now ubiquitous) <code>tidyverse</code> universe to both simplify and generalize the execution process; this will become useful in the workshop when we augment the model with additional health states, new evidence, etc.</p>
<p>The original model is structured as follows:</p>
<div>
<p><a href="//sketchviz.com/@graveja0/87115c93ff6ac666674b88e1b30aec15"><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/green-et-al-replication/https:/sketchviz.com/@graveja0/87115c93ff6ac666674b88e1b30aec15/696391f92d96cd0be0fe09157ba6247d0dd84cc9.sketchy.png" style="max-width: 100%;"></a><br><span style="font-size: 80%;color:#555;">Created on <a href="//sketchviz.com/" style="color:#555;">Sketchviz</a></span></p>
</div>
<p>In this model, individuals can cycle into the death state in one of two ways:</p>
<ul>
<li>From the Asymptomatic state, in which case the probability of death is goverened by age-dependent mortality probabilities.</li>
<li>From the Progressive Disease state, in which case the probability of death is govered both by age-dependent mortality, as well as a heightened probability of death from the disease.</li>
</ul>
<p>To simplify and generalize the code required to execute the model we will make a slight adaptation to the model structure and seaprate out death from Progressive disease and death from background causes. The adapted model diagram is provided below.</p>
<div>
<p><a href="//sketchviz.com/@graveja0/27cb6a8afd59496135e83cd52894349a"><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/green-et-al-replication/https:/sketchviz.com/@graveja0/27cb6a8afd59496135e83cd52894349a/9a3873291c108c030b908711a4c353aa9deb0a38.sketchy.png" style="max-width: 100%;"></a><br><span style="font-size: 80%;color:#555;">Hosted on <a href="//sketchviz.com/" style="color:#555;">Sketchviz</a></span></p>
</div>
<p>The only other adaptation to the model we will make is to set the discount rates to 0.</p>
</section>
<section id="parameterize" class="level1">
<h1>Parameterize</h1>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-1-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="annotated-cell-1-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"without_drug"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"with_drug"</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment names</span></span>
<span id="annotated-cell-1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_treatments =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of treatments</span></span>
<span id="annotated-cell-1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s_names  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># State names</span></span>
<span id="annotated-cell-1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_states =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of states</span></span>
<span id="annotated-cell-1-6">    </span>
<span id="annotated-cell-1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span>),</span>
<span id="annotated-cell-1-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tunnel_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>),</span>
<span id="annotated-cell-1-9">    </span>
<span id="annotated-cell-1-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cohort =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort size</span></span>
<span id="annotated-cell-1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle length</span></span>
<span id="annotated-cell-1-12">    </span>
<span id="annotated-cell-1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Initial_age =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort starting age</span></span>
<span id="annotated-cell-1-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">effect =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment Effect (drug) </span></span>
<span id="annotated-cell-1-15">    </span>
<span id="annotated-cell-1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cAsymp =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of asympomatic state</span></span>
<span id="annotated-cell-1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDeath =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cost of death (progressive disease state only)</span></span>
<span id="annotated-cell-1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDrug =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of drug</span></span>
<span id="annotated-cell-1-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cProg =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle cost of progressive disease</span></span>
<span id="annotated-cell-1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uAsymp =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Asymptomatic state utility</span></span>
<span id="annotated-cell-1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Progressive disease state utility</span></span>
<span id="annotated-cell-1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">oDr =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0.06,  # Discount rate (QALYs)</span></span>
<span id="annotated-cell-1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDr =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0.06,  # Discount rate (costs)</span></span>
<span id="annotated-cell-1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDcm =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Death from progressive disease trans prob</span></span>
<span id="annotated-cell-1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transition prob: progressive disease</span></span>
<span id="annotated-cell-1-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDn =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Background mortality transition prob</span></span>
<span id="annotated-cell-1-27">)</span>
<span id="annotated-cell-1-28">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modifyList</span>(params,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cycles =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span></code></pre></div>
</div>
<p>Our next objective is to define a function that constructs the time-dependent transition probability matrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">mPt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, params) {</span>
<span id="cb1-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(t, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tt){</span>
<span id="cb1-3">        </span>
<span id="cb1-4">        current_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Initial_age  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  (tt)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb1-5"></span>
<span id="cb1-6">        tpDn_lookup <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-7">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(34,44]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0017</span>,</span>
<span id="cb1-8">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(44,54]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0044</span>,</span>
<span id="cb1-9">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(54,64]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0138</span>,</span>
<span id="cb1-10">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(64,74]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>,</span>
<span id="cb1-11">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(74,84]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0912</span>,</span>
<span id="cb1-12">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(84,100]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1958</span>)</span>
<span id="cb1-13">        </span>
<span id="cb1-14">        age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(current_age, </span>
<span id="cb1-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb1-16">        </span>
<span id="cb1-17">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb1-18">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpProg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (tt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle )</span>
<span id="cb1-19">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpDcm </span>
<span id="cb1-20">        </span>
<span id="cb1-21">        rDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn)</span>
<span id="cb1-22">        rProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpProg_)</span>
<span id="cb1-23">        rDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDcm_)</span>
<span id="cb1-24">        </span>
<span id="cb1-25">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rDn <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-26">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rProg_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-27">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rDcm_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-28">        </span>
<span id="cb1-29">        </span>
<span id="cb1-30">        effect_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>effect</span>
<span id="cb1-31">        n_states_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states</span>
<span id="cb1-32">        s_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_names</span>
<span id="cb1-33">        t_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names</span>
<span id="cb1-34">        n_treatments_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_treatments</span>
<span id="cb1-35">        </span>
<span id="cb1-36">        mP_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-37">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-38">                           tpProg_, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-39">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,tpDcm_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-40">                           tpDn , tpDn, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-41">                           </span>
<span id="cb1-42">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-43">                           tpProg_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>effect_), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-44">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,tpDcm_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-45">                           tpDn, tpDn,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-46">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb1-47">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> s_names_,</span>
<span id="cb1-48">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> s_names_,</span>
<span id="cb1-49">                                  t_names_))</span>
<span id="cb1-50">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Diagonal of transition probability matrix is 1 minus off-diagonal sum</span></span>
<span id="cb1-51">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb1-52">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-53">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-54">        </span>
<span id="cb1-55">        mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This turns the named array into a simpler list object</span></span>
<span id="cb1-56">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mP_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-57"></span>
<span id="cb1-58">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(mP)</span>
<span id="cb1-59">    })</span>
<span id="cb1-60">}</span></code></pre></div>
</div>
</section>
<section id="cohort-simulation-function" class="level1">
<h1>Cohort Simulation Function</h1>
<p>We next define a function that takes as its input the parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1">sim_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="annotated-cell-3-2">    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-3" class="code-annotation-target">    mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mPt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>),params)</span>
<span id="annotated-cell-3-4">    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-5" class="code-annotation-target">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-6">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-8">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-3-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-3-10">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-11">            }))</span>
<span id="annotated-cell-3-12">        }))</span>
<span id="annotated-cell-3-13">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  </span>
<span id="annotated-cell-3-14">        tr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-15">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-16">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),.x)</span>
<span id="annotated-cell-3-17">        }))</span>
<span id="annotated-cell-3-18">    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-19" class="code-annotation-target">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-20">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-21">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-22">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-3-23">            arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_))</span>
<span id="annotated-cell-3-24">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-3-25">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-26">                arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-27">                arr_</span>
<span id="annotated-cell-3-28">            }))</span>
<span id="annotated-cell-3-29">        }))</span>
<span id="annotated-cell-3-30">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-3-31">        arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-32">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-33">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),.x)</span>
<span id="annotated-cell-3-34">        }))</span>
<span id="annotated-cell-3-35">    </span>
<span id="annotated-cell-3-36">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-37">        .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-38">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-39">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-40">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="annotated-cell-3-41">    }))</span>
<span id="annotated-cell-3-42">    </span>
<span id="annotated-cell-3-43">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> tr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">array =</span> arr))</span>
<span id="annotated-cell-3-44">}</span>
<span id="annotated-cell-3-45"></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-3-46" class="code-annotation-target">markov_result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort</span>(params)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="1" data-code-lines="3">Calculate the transition probability matrices.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="2" data-code-lines="5">Construct the Markov trace</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="3" data-code-lines="19">Construct a multidimensional transition array (see <span class="citation" data-cites="krijkamp2020multidimensional">Krijkamp et al. (2020)</span> for more). The transition array result isn’t used in this particular example, but can provide useful information on transition dynamics for each cycle.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-annotation="4" data-code-lines="46">Execute the function to simulate the cohort for the given parameters.</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace , <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
        Asympt Progressive DeadCause    Dead
 [1,] 1000.000       0.000     0.000   0.000
 [2,]  976.200      10.000     0.000  13.800
 [3,]  943.204      27.886     1.500  27.410
 [4,]  901.892      51.614     5.683  40.811
 [5,]  853.370      79.236    13.425  53.969
 [6,]  798.925     108.925    25.310  66.839
 [7,]  739.965     139.019    41.649  79.367
 [8,]  677.956     168.045    62.502  91.497
 [9,]  614.363     194.756    87.709 103.172
[10,]  550.592     218.147   116.922 114.338
[11,]  487.935     237.474   149.644 124.947
[12,]  415.769     246.526   185.265 152.440
[13,]  350.119     250.096   222.244 177.541
[14,]  291.334     248.618   259.759 200.289
[15,]  239.506     242.690   297.051 220.753
[16,]  194.503     233.014   333.455 239.028
[17,]  156.011     220.351   368.407 255.231
[18,]  123.576     205.469   401.460 269.495
[19,]   96.649     189.105   432.280 281.966
[20,]   74.623     171.936   460.646 292.796
[21,]   56.870     154.553   486.436 302.141
[22,]   39.741     129.218   509.619 321.422
[23,]   27.373     106.793   529.002 336.831
[24,]   18.581      87.331   545.021 349.067
[25,]   12.427      70.726   558.120 358.727
[26,]    8.187      56.774   568.729 366.310
[27,]    5.312      45.208   577.245 372.234
[28,]    3.393      35.738   584.027 376.842
[29,]    2.134      28.068   589.387 380.411
[30,]    1.320      21.917   593.598 383.165
[31,]    0.804      17.027   596.885 385.284
[32,]    0.397      11.388   599.439 388.776
[33,]    0.192       7.577   601.147 391.083
[34,]    0.091       5.020   602.284 392.604
[35,]    0.042       3.315   603.037 393.605
[36,]    0.019       2.184   603.534 394.263
[37,]    0.009       1.436   603.862 394.694
[38,]    0.004       0.942   604.077 394.977
[39,]    0.002       0.618   604.219 395.162
[40,]    0.001       0.405   604.311 395.283
[41,]    0.000       0.265   604.372 395.363
[42,]    0.000       0.174   604.412 395.415
[43,]    0.000       0.114   604.438 395.449
[44,]    0.000       0.074   604.455 395.471
[45,]    0.000       0.049   604.466 395.485
[46,]    0.000       0.032   604.473 395.495

$with_drug
        Asympt Progressive DeadCause    Dead
 [1,] 1000.000       0.000     0.000   0.000
 [2,]  981.200       5.000     0.000  13.800
 [3,]  957.847      13.993     0.750  27.410
 [4,]  930.261      26.069     2.849  40.821
 [5,]  898.819      40.404     6.759  54.018
 [6,]  863.944      56.256    12.820  66.980
 [7,]  826.104      72.960    21.258  79.678
 [8,]  785.790      89.923    32.202  92.085
 [9,]  743.514     106.625    45.691 104.170
[10,]  699.796     122.618    61.684 115.902
[11,]  655.149     137.523    80.077 127.251
[12,]  594.285     147.715   100.705 157.294
[13,]  536.105     155.617   122.863 185.416
[14,]  480.940     161.223   146.205 211.632
[15,]  429.046     164.595   170.389 235.970
[16,]  380.607     165.846   195.078 258.469
[17,]  335.733     165.132   219.955 279.179
[18,]  294.472     162.641   244.725 298.162
[19,]  256.809     158.583   269.121 315.487
[20,]  222.679     153.182   292.908 331.230
[21,]  191.972     146.667   315.886 345.475
[22,]  154.307     131.448   337.886 376.359
[23,]  123.260     116.717   357.603 402.420
[24,]   97.844     102.739   375.111 424.306
[25,]   77.179      89.700   390.522 442.599
[26,]   60.493      77.712   403.977 457.818
[27,]   47.112      66.832   415.633 470.423
[28,]   36.455      57.072   425.658 480.814
[29,]   28.027      48.410   434.219 489.344
[30,]   21.407      40.797   441.480 496.315
[31,]   16.244      34.168   447.600 501.988
[32,]   10.545      24.871   452.725 511.859
[33,]    6.793      17.958   456.456 518.793
[34,]    4.342      12.869   459.150 523.639
[35,]    2.754       9.157   461.080 527.009
[36,]    1.733       6.472   462.453 529.342
[37,]    1.082       4.546   463.424 530.948
[38,]    0.670       3.174   464.106 532.050
[39,]    0.411       2.204   464.582 532.803
[40,]    0.251       1.522   464.913 533.315
[41,]    0.151       1.046   465.141 533.662
[42,]    0.091       0.715   465.298 533.896
[43,]    0.054       0.487   465.405 534.054
[44,]    0.032       0.330   465.478 534.160
[45,]    0.019       0.223   465.528 534.231
[46,]    0.011       0.150   465.561 534.278</code></pre>
</div>
</div>
<section id="define-payoffs" class="level2">
<h2 class="anchored" data-anchor-id="define-payoffs">Define Payoffs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">u_payoff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb4-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb4-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uProg,  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> ),</span>
<span id="cb4-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_states, n_treatments),</span>
<span id="cb4-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qaly"</span>,</span>
<span id="cb4-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(s_names),</span>
<span id="cb4-7">                          t_names))</span>
<span id="cb4-8">    }) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-9">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb4-10">u_payoff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
             from
to            qaly
  Asympt      0.95
  Progressive 0.75
  DeadCause   0.00
  Dead        0.00

$with_drug
             from
to            qaly
  Asympt      0.95
  Progressive 0.75
  DeadCause   0.00
  Dead        0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">c_state_payoff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb6-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb6-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cAsymp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>cDrug, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> ),</span>
<span id="cb6-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_states, n_treatments),</span>
<span id="cb6-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cost"</span>,</span>
<span id="cb6-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(s_names),</span>
<span id="cb6-7">                          t_names))</span>
<span id="cb6-8">    }) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb6-10">c_state_payoff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
             from
to            cost
  Asympt       500
  Progressive 3000
  DeadCause      0
  Dead           0

$with_drug
             from
to            cost
  Asympt      1500
  Progressive 3000
  DeadCause      0
  Dead           0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">c_transition_payoff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb8-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cDeath , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb8-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cDeath , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> ),</span>
<span id="cb8-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_states, n_treatments),</span>
<span id="cb8-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transition_cost"</span>,</span>
<span id="cb8-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(s_names),</span>
<span id="cb8-7">                          t_names))</span>
<span id="cb8-8">    }) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-10">c_transition_payoff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
             from
to            transition_cost
  Asympt                    0
  Progressive               0
  DeadCause              1000
  Dead                      0

$with_drug
             from
to            transition_cost
  Asympt                    0
  Progressive               0
  DeadCause              1000
  Dead                      0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">qaly_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .x[-1,] because we don't count the cycle with the full cohort in asymptomatic</span></span>
<span id="cb10-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace, u_payoff,  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ({</span>
<span id="cb10-3">        .x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> .y</span>
<span id="cb10-4">    })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb10-6"></span>
<span id="cb10-7">cost_state_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace, c_state_payoff, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="cb10-9">        .x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> .y</span>
<span id="cb10-10">    })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb10-12"></span>
<span id="cb10-13">cost_transition_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace, c_state_payoff, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="cb10-15">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(.x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>]))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cDeath</span>
<span id="cb10-16">    })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb10-18">    </span>
<span id="cb10-19">cost_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(cost_state_unadj, cost_transition_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> .y))</span></code></pre></div>
</div>
</section>
</section>
<section id="summarize" class="level1">
<h1>Summarize</h1>
<section id="discounting" class="level2">
<h2 class="anchored" data-anchor-id="discounting">Discounting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">discounting_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb11-2">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cDr)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-2</span>))</span>
<span id="cb11-3">discounting_outcome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb11-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>oDr)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-2</span>))</span></code></pre></div>
</div>
</section>
<section id="total-cost-and-qaly-calculation-no-cycle-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="total-cost-and-qaly-calculation-no-cycle-adjustment">Total Cost and QALY Calculation (No Cycle Adjustment)</h2>
<div class="cell tbl-cap-location-bottom">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">tot_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(cost_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_cost )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb12-4">tot_qaly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(qaly_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_outcome )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb12-7"></span>
<span id="cb12-8">diff_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-9">    tot_cost<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_cost<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb12-10">diff_qaly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-11">    tot_qaly<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_qaly<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_qaly),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_cost))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eff"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cost"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind.data.frame</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"difference"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_qaly,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cost =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ICER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> diff_qaly,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>R Model Results </caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Eff</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Cost</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ICER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">without_drug</td>
<td style="text-align: left;">12.203</td>
<td style="text-align: left;">17526</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">with_drug</td>
<td style="text-align: left;">14.446</td>
<td style="text-align: left;">28912</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">difference</td>
<td style="text-align: left;">2.24</td>
<td style="text-align: left;">11386</td>
<td style="text-align: left;">5074</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/green-et-al-replication/attr/images/excel-icer.png" height="200" class="figure-img"></p>
<figcaption class="figure-caption">Excel Model Results</figcaption>
</figure>
</div>
</section>
<section id="total-cost-and-qaly-calculation-with-cycle-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="total-cost-and-qaly-calculation-with-cycle-adjustment">Total Cost and QALY Calculation (With Cycle Adjustment)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-11" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-11-1" class="code-annotation-target">alt_simp_coef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>, i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-8</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="annotated-cell-11-2">cycle_adj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp_coef</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-annotation="1" data-code-lines="1">Alternative Simpson’s method coefficients</span>
</dd>
</dl>
</div>
</div>
<div class="cell tbl-cap-location-bottom">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">tot_cost_cadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(cost_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle_adj )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb13-4">tot_qaly_cadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(qaly_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle_adj )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb13-7"></span>
<span id="cb13-8">diff_cost_cadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-9">    tot_cost_cadj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_cost_cadj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb13-10">diff_qaly_cadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-11">    tot_qaly_cadj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_qaly_cadj<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_qaly_cadj),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_cost_cadj))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eff"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cost"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind.data.frame</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"difference"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_qaly_cadj,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cost =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost_cadj,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ICER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> diff_qaly,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>R Model Results </caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Eff</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Cost</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ICER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">without_drug</td>
<td style="text-align: left;">11.734</td>
<td style="text-align: left;">17269</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">with_drug</td>
<td style="text-align: left;">13.977</td>
<td style="text-align: left;">28167</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">difference</td>
<td style="text-align: left;">2.24</td>
<td style="text-align: left;">10898</td>
<td style="text-align: left;">5074</td>
</tr>
</tbody>
</table>


</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-green2023health" class="csl-entry">
Green, Nathan, Felicity Lamrock, Nichola Naylor, Jack Williams, and Andrew Briggs. 2023. <span>“Health Economic Evaluation Using Markov Models in r for Microsoft Excel Users: A Tutorial.”</span> <em>PharmacoEconomics</em> 41 (1): 5–19.
</div>
<div id="ref-krijkamp2020multidimensional" class="csl-entry">
Krijkamp, Eline M, Fernando Alarid-Escudero, Eva A Enns, Petros Pechlivanoglou, MG Myriam Hunink, Alan Yang, and Hawre J Jalal. 2020. <span>“A Multidimensional Array Representation of State-Transition Model Dynamics.”</span> <em>Medical Decision Making</em> 40 (2): 242–48.
</div>
</div></section></div> ]]></description>
  <guid>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/green-et-al-replication/green-et-al-replication.html</guid>
  <pubDate>Thu, 18 May 2023 18:55:37 GMT</pubDate>
</item>
<item>
  <title>Backwards Conversion</title>
  <link>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/backwards-conversion/backwards-conversion.html</link>
  <description><![CDATA[ 



<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(knitr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(kableExtra)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(survival)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(flexsurv)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(haven)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dampack)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Matrix)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(demography)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MortalityLaws)</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(demography)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MASS)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(directlabels)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(markovchain)</span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(expm)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scipen"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"digits"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-21"></span>
<span id="cb1-22">select <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>select</span>
<span id="cb1-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>))</span></code></pre></div>
</div>
<p>What if a given source of data provides observed transition probabilities and these are exclusionary states, i.e., competing? How could one reverse these probabilities and embed other competing events into the model?</p>
<p>To do this, one must solve for the generator matrix of the transition probability matrix using eigenvalue decomposition. Note that this is not always possible, as it is trivial to construct a transition probability matrix that has no generator.</p>
<p>Consider the following, which builds on the example provided in the main text. We wish to approximate a continuous time process using a discrete-time Markov model with three distinct states: A (healthy), B (sick/intervention), and C (complication from intervention). Moreover, in continuous time, this process proceeds sequentially, i.e., A-&gt;B-&gt;C.</p>
<p>A (naively) specified model has transitions from A-&gt;B and from B-&gt;C specified as probabilities within the selected time step. As noted in the main text, this model cannot truly approximate continuous time process, as within a given time step there is a non-zero probability of transitioning from healthy to complication (i.e., A-&gt;C, with an implied sojourn through B). That is, during a timestep it is possible to transition from A-&gt;C.</p>
<p>By incorrectly specifying all transitions, it makes it impossible to find a proper generator—though eigenvalue decomposition can be used to get as close as possible. If negative rates of transition are found using eigenvalue decomposition, then probabilities inconsistent with continuous rates have been specified.</p>
<p>In mathematical terms, the generator matrix is the matrix logarithm of the transition probability matrix. A matrix has a logarithm <em>if and only if</em> if it is invertible.</p>
<p><img src="https://latex.codecogs.com/png.latex?%20A%20=%20%5Clog%20T_%7Bprob%7D%20"></p>
<p>The <img src="https://latex.codecogs.com/png.latex?%5Clog"> can be found using spectral or eigenvalue decomposition. If <img src="https://latex.codecogs.com/png.latex?V"> is a matrix where equal column is an eigenvector of <img src="https://latex.codecogs.com/png.latex?T_%7Bprob%7D">, then,</p>
<p><img src="https://latex.codecogs.com/png.latex?A'%20=%20V%5E%7B-1%7D%20A%20V"> <img src="https://latex.codecogs.com/png.latex?%5Clog%20T_%7Bprob%7D%20=%20V%20(%5Clog%20A')%20V%5E%7B-1%7D"></p>
<section id="can-i-work-backwards-from-transition-probabilities-an-example." class="level3">
<h3 class="anchored" data-anchor-id="can-i-work-backwards-from-transition-probabilities-an-example.">Can I Work Backwards from Transition Probabilities? An Example.</h3>
<p>As an example, we’ll consider a model from “Decision Modelling for Heath Economic Evaluation” by Briggs, Clatxon, and Sculpher. In Table 2.2, they define a transition probability matrix for HIV monotherapy that was derived from observed percent transitions in a patient cohort.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.721</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.202</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.067</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.010</span>,</span>
<span id="cb2-2">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.581</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.407</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.012</span>,</span>
<span id="cb2-3">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.750</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.250</span>,</span>
<span id="cb2-4">                <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.000</span>), </span>
<span id="cb2-5">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb2-6">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>),</span>
<span id="cb2-7">                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>)))</span>
<span id="cb2-8">mP </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     B     C     D
A 0.721 0.202 0.067 0.010
B 0.000 0.581 0.407 0.012
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>The bottom diagonal was corrected to be a Markov absorbing state by having 1 on the diagonal. For the purposes of example, we’ll assume we wish to add an additional state “E”, which has a continuous rate of 0.2 that competes with other transitions.</p>
<p>To accomplish this we must find the continuous generator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">V  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eigen</span>(mP)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vectors</span>
<span id="cb4-2">iV <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(V)</span>
<span id="cb4-3">Ap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> iV <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> V</span>
<span id="cb4-4"></span>
<span id="cb4-5">Ap</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         [,1]                     [,2]
[1,]  1.000000000000000000000 -0.000000000000000011388
[2,]  0.000000000000000172422  0.750000000000000111022
[3,] -0.000000000000001054209 -0.000000000000000197747
[4,] -0.000000000000000062574 -0.000000000000000018793
                          [,3]                     [,4]
[1,]  0.0000000000000000000000  0.000000000000000016253
[2,]  0.0000000000000000000000 -0.000000000000000156542
[3,]  0.7209999999999999742428  0.000000000000000036544
[4,] -0.0000000000000000059637  0.580999999999999960920</code></pre>
</div>
</div>
<p>Due to the numeric probabilities not being exactly correct, the off-diagonal elements of <img src="https://latex.codecogs.com/png.latex?A'"> are not zero, but they are quite close. We will zero these off diagonal elements and assume that the non-zero elements are numerical error. Then continue by taking the log of the diagonal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">lAp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(Ap)), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(Ap), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(Ap))</span>
<span id="cb6-2"></span>
<span id="cb6-3">R  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> V <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> lAp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> iV</span>
<span id="cb6-4"></span>
<span id="cb6-5">R </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          [,1]                      [,2]       [,3]      [,4]
[1,] -0.3271161416971880009363  0.3114960917676688478828  0.0024395  0.013181
[2,]  0.0000000000000000025585 -0.5430045221302257640872  0.6148890 -0.071884
[3,]  0.0000000000000000000000  0.0000000000000000070641 -0.2876821  0.287682
[4,]  0.0000000000000000000000  0.0000000000000000000000  0.0000000  0.000000</code></pre>
</div>
</div>
<p>An now we have the continuous time rate generator for the Markov Model. There is still some numerical error—for example the bottom row, has values very near to zero, and the diagonal is not exactly the negative sum of the rest of the row. We can clean this up by tweaking the numbers numerical towards their constraints.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">R[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(R) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span> ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(R, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A      B      C      D
A -0.327  0.311  0.002  0.013
B  0.000 -0.543  0.615 -0.072
C  0.000  0.000 -0.288  0.288
D  0.000  0.000  0.000  0.000</code></pre>
</div>
</div>
<p>Some numerical error is inevitable in this process and cannot be avoided. However, even cleaning up the small and obvious errors, the transition from B -&gt; D is impossible since it’s negative. Rates are relative to the occupancy of the source state, in this case B. Having a negative rate implies that B would have some transitions in which the dead come alive into B based upon the occupancy of B. Obviously, this is not possible. The problem now is how to adjust the model’s rates to be physically possible, while as faithful to the original data as possible. B is a sicker state, so it should have a higher death rate.</p>
<p>First, let’s double check it recapitulates the original rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(R)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     B     C     D
A 0.721 0.202 0.067 0.010
B 0.000 0.581 0.407 0.012
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>Which exactly matches the original transition probability table given.</p>
</section>
<section id="alternative-approach" class="level2">
<h2 class="anchored" data-anchor-id="alternative-approach">Alternative Approach</h2>
<p>The theoretical approach requires computation of the eigenvalues of the matrix, and then correction along the way for various numerical errors to derive the generator matrix of rates. The observed statistical error from a stochastic process in general create a situation in which the Q-matrix is not derivable theoretically resulting in negative probabilities. Finding the closest generator matrix can be done using Higham’s 2008 method from `Functions of Matrices: Theory and Computation’ with extra balancing options from Stadelmann’s thesis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">R <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition2Generator</span>(mP)</span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>)</span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(R) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span>)</span>
<span id="cb12-4">R</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         A       B          C         D
A -0.32712  0.3115  0.0024395  0.013181
B  0.00000 -0.5430  0.6148890 -0.071884
C  0.00000  0.0000 -0.2876821  0.287682
D  0.00000  0.0000  0.0000000  0.000000</code></pre>
</div>
</div>
<p>Note: this is the closest Markov model allowing any transition. There are still transitions from A-&gt;C and A-&gt;D. Notably B-&gt;D occurs at a negative rate. If D were representing an absorbing state, e.g.&nbsp;Death, then this would represent a physical impossibility, as this negative rate represents D -&gt; B.</p>
</section>
<section id="demonstrate-that-the-embedded-new-transition-probability-matrix-successfully-recreates-the-original-transition-probability-matrix-and-results." class="level2">
<h2 class="anchored" data-anchor-id="demonstrate-that-the-embedded-new-transition-probability-matrix-successfully-recreates-the-original-transition-probability-matrix-and-results.">Demonstrate that the embedded (new) transition probability matrix successfully recreates the original transition probability matrix and results.</h2>
<p>Let’s double check it recapitulates the original rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(R),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     B     C     D
A 0.721 0.202 0.067 0.010
B 0.000 0.581 0.407 0.012
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
</section>
<section id="an-assumed-model" class="level2">
<h2 class="anchored" data-anchor-id="an-assumed-model">An assumed model</h2>
<p>If one were to assume that all transitions were forward , i.e.&nbsp;A-&gt;B-&gt;C-&gt;D the best approach would be to fit the generator matrix directly from raw data (there are many statistical Markov and ordinal data fitting models). Without the raw data available, an ad-hoc method to minimize squared error against the original under the 3 rate constraint does a decent job of recapitulating the original transition probabilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">init  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-2">step1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> init <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> mP</span>
<span id="cb16-3">m_3r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r)</span>
<span id="cb16-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]),  r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],      r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>],    r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>],</span>
<span id="cb16-5">                 <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]),   r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],    r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>],</span>
<span id="cb16-6">                 <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], r[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb16-7">                 <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb16-8">r.est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>((<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(R))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>],</span>
<span id="cb16-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>),</span>
<span id="cb16-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L-BFGS-B"</span>,</span>
<span id="cb16-11">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r) {</span>
<span id="cb16-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>( ((init <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m_3r</span>(r))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> step1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> )</span>
<span id="cb16-13">})<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par</span>
<span id="cb16-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m_3r</span>(r.est)</span>
<span id="cb16-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m_3r</span>(r.est)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">mP_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mP</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mP_) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb17-3">mR_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mP_,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x))</span>
<span id="cb17-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mR_) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(mR_)</span>
<span id="cb17-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(mR_)</span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eigen"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> R,</span>
<span id="cb17-8">     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"m_3r"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">m_3r</span>(r.est),</span>
<span id="cb17-9">     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"form"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> mR_)</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/backwards-conversion/backwards-conversion.html</guid>
  <pubDate>Thu, 18 May 2023 18:55:37 GMT</pubDate>
</item>
<item>
  <title>Extending the Transition Matrix</title>
  <link>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/extending-the-matrix/extending-the-transition-matrix.html</link>
  <description><![CDATA[ 



<section id="introduction" class="level1">
<h1>Introduction</h1>
<div>
<p><a href="//sketchviz.com/@graveja0/27cb6a8afd59496135e83cd52894349a"><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/extending-the-matrix/https:/sketchviz.com/@graveja0/27cb6a8afd59496135e83cd52894349a/295cccb1b92d82caab9838e779475eaff93e7461.sketchy.png" style="max-width: 200%;"></a><br><span style="font-size: 80%;color:#555;">Hosted on <a href="//sketchviz.com/" style="color:#555;">Sketchviz</a></span></p>
</div>
</section>
<section id="parameterize" class="level1">
<h1>Parameterize</h1>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="annotated-cell-1-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"without_drug"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"with_drug"</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment names</span></span>
<span id="annotated-cell-1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_treatments =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of treatments</span></span>
<span id="annotated-cell-1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s_names  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># State names</span></span>
<span id="annotated-cell-1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_states =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of states</span></span>
<span id="annotated-cell-1-6">    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-7" class="code-annotation-target">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-8" class="code-annotation-target">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tunnel_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>),</span>
<span id="annotated-cell-1-9">    </span>
<span id="annotated-cell-1-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cohort =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort size</span></span>
<span id="annotated-cell-1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle length</span></span>
<span id="annotated-cell-1-12">    </span>
<span id="annotated-cell-1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cycles =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total number of cycles</span></span>
<span id="annotated-cell-1-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Initial_age =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort starting age</span></span>
<span id="annotated-cell-1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">effect =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment Effect (drug) </span></span>
<span id="annotated-cell-1-16">    </span>
<span id="annotated-cell-1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cAsymp =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of asympomatic state</span></span>
<span id="annotated-cell-1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDeath =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cost of death (progressive disease state only)</span></span>
<span id="annotated-cell-1-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDrug =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of drug</span></span>
<span id="annotated-cell-1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cProg =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle cost of progressive disease</span></span>
<span id="annotated-cell-1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uAsymp =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Asymptomatic state utility</span></span>
<span id="annotated-cell-1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Progressive disease state utility</span></span>
<span id="annotated-cell-1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">oDr =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0.06,  # Discount rate (QALYs)</span></span>
<span id="annotated-cell-1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDr =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0.06,  # Discount rate (costs)</span></span>
<span id="annotated-cell-1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDcm =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Death from progressive disease trans prob</span></span>
<span id="annotated-cell-1-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transition prob: progressive disease</span></span>
<span id="annotated-cell-1-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDn =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Background mortality transition prob</span></span>
<span id="annotated-cell-1-28">)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="1" data-code-lines="7">Accumulators</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="2" data-code-lines="8">Transition tracker</span>
</dd>
</dl>
</div>
</div>
<p>Our next objective is to define a function that constructs the time-dependent transition probability matrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles</span>
<span id="cb1-2">tt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles</span>
<span id="cb1-3"></span>
<span id="cb1-4">mPt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t,params) {</span>
<span id="cb1-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(t, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tt){</span>
<span id="cb1-6">        </span>
<span id="cb1-7">        current_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Initial_age  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (tt)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-8">        cycle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (tt)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle</span>
<span id="cb1-9">        </span>
<span id="cb1-10">        tpDn_lookup <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(34,44]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0017</span>,</span>
<span id="cb1-12">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(44,54]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0044</span>,</span>
<span id="cb1-13">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(54,64]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0138</span>,</span>
<span id="cb1-14">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(64,74]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>,</span>
<span id="cb1-15">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(74,84]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0912</span>,</span>
<span id="cb1-16">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(84,100]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1958</span>)</span>
<span id="cb1-17">        </span>
<span id="cb1-18">        age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(current_age, </span>
<span id="cb1-19">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb1-20">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb1-21">        </span>
<span id="cb1-22">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpProg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (cycle)</span>
<span id="cb1-23">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpDcm </span>
<span id="cb1-24">        effect_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>effect</span>
<span id="cb1-25">        n_states_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states</span>
<span id="cb1-26">        s_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_names</span>
<span id="cb1-27">        t_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names</span>
<span id="cb1-28">        n_treatments_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_treatments</span>
<span id="cb1-29">        </span>
<span id="cb1-30">        mR_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-31">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-32">                                   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpProg_), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-33">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpDcm_),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-34">                           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-35">                           </span>
<span id="cb1-36">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-37">                                   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(tpProg_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>effect_))), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-38">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpDcm_),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-39">                           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-40">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb1-41">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> s_names_,</span>
<span id="cb1-42">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> s_names_,</span>
<span id="cb1-43">                                          t_names_))</span>
<span id="cb1-44"></span>
<span id="cb1-45">        mR_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mR_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb1-46">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(x)</span>
<span id="cb1-47">            x</span>
<span id="cb1-48">        },<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-49">        </span>
<span id="cb1-50">        <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############################</span></span>
<span id="cb1-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add Non-Markovian Components</span></span>
<span id="cb1-52">        <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############################</span></span>
<span id="cb1-53">        </span>
<span id="cb1-54">        mR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mR_,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb1-55">            r_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(x)</span>
<span id="cb1-56">            add_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names)   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-57">            </span>
<span id="cb1-58">            new_row_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x), params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)</span>
<span id="cb1-59">            new_col_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x), params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)</span>
<span id="cb1-60">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expand matrix</span></span>
<span id="cb1-61">            x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(x,  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, r_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> add_), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>r_))</span>
<span id="cb1-62">            x  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, add_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (r_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>add_)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>add_))</span>
<span id="cb1-63">            </span>
<span id="cb1-64">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_row_names</span>
<span id="cb1-65">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_col_names</span>
<span id="cb1-66">            </span>
<span id="cb1-67">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>]</span>
<span id="cb1-68">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>]</span>
<span id="cb1-69">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>] </span>
<span id="cb1-70">            x</span>
<span id="cb1-71">        })</span>
<span id="cb1-72">        </span>
<span id="cb1-73">        mP_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embed the transition probability matrix</span></span>
<span id="cb1-74">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mR,expm)</span>
<span id="cb1-75">                </span>
<span id="cb1-76">        mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mP_,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb1-77">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't allow the transition columns to remain...</span></span>
<span id="cb1-78">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-79">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-80">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The receiving bucket was required for embedding, but is no longer needed</span></span>
<span id="cb1-81">            x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>),<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)]    </span>
<span id="cb1-82">        }) </span>
<span id="cb1-83">        </span>
<span id="cb1-84">        </span>
<span id="cb1-85">    })</span>
<span id="cb1-86">}</span></code></pre></div>
</div>
</section>
<section id="cohort-simulation-function" class="level1">
<h1>Cohort Simulation Function</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace , <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
       Asympt Progressive DeadCause   Dead accProgressive trProgressive
 [1,] 1000.00        0.00      0.00   0.00           0.00          0.00
 [2,]  976.34        9.10      0.76  13.80           9.93          9.93
 [3,]  943.61       25.40      3.62  27.38          29.32         19.39
 [4,]  902.67       47.05      9.57  40.71          57.44         28.11
 [5,]  854.60       72.29     19.35  53.76          93.30         35.86
 [6,]  800.67       99.46     33.41  66.46         135.73         42.44
 [7,]  742.24      127.07     51.94  78.75         183.44         47.71
 [8,]  680.76      153.76     74.88  90.60         235.05         51.60
 [9,]  617.66      178.41    102.00 101.93         289.13         54.09
[10,]  554.31      200.09    132.89 112.71         344.35         55.21
[11,]  491.99      218.11    167.01 122.89         399.40         55.05
[12,]  421.28      226.35    203.26 149.11         452.51         53.11
[13,]  356.68      229.92    240.46 172.95         502.12         49.61
[14,]  298.55      229.12    277.86 194.47         547.62         45.50
[15,]  247.02      224.41    314.81 213.76         588.64         41.02
[16,]  202.01      216.35    350.70 230.94         625.01         36.37
[17,]  163.26      205.56    385.05 246.13         656.73         31.72
[18,]  130.37      192.69    417.46 259.49         683.97         27.24
[19,]  102.85      178.36    447.64 271.15         707.00         23.03
[20,]   80.15      163.16    475.42 281.27         726.18         19.18
[21,]   61.69      147.62    500.69 290.00         741.92         15.74
[22,]   44.29      124.87    522.81 308.04         754.30         12.38
[23,]   31.40      104.60    541.43 322.57         763.61          9.31
[24,]   21.97       86.84    556.95 334.24         770.51          6.90
[25,]   15.17       71.49    569.79 343.55         775.55          5.04
[26,]   10.34       58.39    580.32 350.95         779.18          3.63
[27,]    6.96       47.35    588.89 356.80         781.75          2.57
[28,]    4.61       38.15    595.81 361.43         783.54          1.80
[29,]    3.02       30.55    601.37 365.06         784.78          1.24
[30,]    1.95       24.33    605.82 367.91         785.61          0.84
[31,]    1.24       19.28    609.35 370.13         786.17          0.56
[32,]    0.69       13.46    611.98 373.87         786.52          0.35
[33,]    0.38        9.37    613.82 376.44         786.72          0.20
[34,]    0.20        6.49    615.09 378.21         786.83          0.11
[35,]    0.11        4.49    615.97 379.43         786.89          0.06
[36,]    0.06        3.10    616.58 380.26         786.93          0.03
[37,]    0.03        2.13    617.00 380.84         786.95          0.02
[38,]    0.01        1.47    617.29 381.23         786.96          0.01
[39,]    0.01        1.01    617.49 381.50         786.96          0.01
[40,]    0.00        0.69    617.63 381.68         786.96          0.00
[41,]    0.00        0.47    617.72 381.81         786.97          0.00
[42,]    0.00        0.32    617.78 381.89         786.97          0.00
[43,]    0.00        0.22    617.83 381.95         786.97          0.00
[44,]    0.00        0.15    617.86 381.99         786.97          0.00
[45,]    0.00        0.10    617.88 382.02         786.97          0.00
[46,]    0.00        0.07    617.89 382.04         786.97          0.00
      trDeadCause
 [1,]        0.00
 [2,]        0.76
 [3,]        2.85
 [4,]        5.96
 [5,]        9.78
 [6,]       14.06
 [7,]       18.52
 [8,]       22.94
 [9,]       27.12
[10,]       30.89
[11,]       34.11
[12,]       36.25
[13,]       37.20
[14,]       37.41
[15,]       36.95
[16,]       35.89
[17,]       34.35
[18,]       32.41
[19,]       30.19
[20,]       27.78
[21,]       25.27
[22,]       22.12
[23,]       18.62
[24,]       15.53
[25,]       12.84
[26,]       10.53
[27,]        8.57
[28,]        6.93
[29,]        5.56
[30,]        4.44
[31,]        3.53
[32,]        2.63
[33,]        1.84
[34,]        1.27
[35,]        0.88
[36,]        0.61
[37,]        0.42
[38,]        0.29
[39,]        0.20
[40,]        0.14
[41,]        0.09
[42,]        0.06
[43,]        0.04
[44,]        0.03
[45,]        0.02
[46,]        0.01

$with_drug
       Asympt Progressive DeadCause   Dead accProgressive trProgressive
 [1,] 1000.00        0.00      0.00   0.00           0.00          0.00
 [2,]  981.27        4.55      0.38  13.80           4.97          4.97
 [3,]  958.05       12.75      1.81  27.39          14.71          9.74
 [4,]  930.66       23.76      4.81  40.77          28.98         14.27
 [5,]  899.46       36.86      9.77  53.91          47.47         18.48
 [6,]  864.87       51.36     16.99  66.79          69.80         22.33
 [7,]  827.35       66.66     26.63  79.37          95.57         25.77
 [8,]  787.37       82.22     38.79  91.62         124.32         28.76
 [9,]  745.44       97.58     53.46 103.52         155.60         31.28
[10,]  702.08      112.31     70.57 115.04         188.92         33.31
[11,]  657.77      126.08     90.01 126.15         223.78         34.86
[12,]  598.03      135.20    111.31 155.45         259.27         35.49
[13,]  540.84      142.40    133.94 182.82         294.48         35.20
[14,]  486.52      147.64    157.57 208.26         328.97         34.49
[15,]  435.32      150.95    181.89 231.84         362.39         33.41
[16,]  387.41      152.41    206.60 253.59         394.42         32.03
[17,]  342.91      152.13    231.39 273.57         424.83         30.41
[18,]  301.87      150.26    256.01 291.86         453.43         28.60
[19,]  264.29      146.97    280.20 308.54         480.09         26.66
[20,]  230.12      142.46    303.75 323.67         504.72         24.64
[21,]  199.26      136.91    326.48 337.35         527.30         22.58
[22,]  162.07      123.28    347.63 367.02         547.27         19.97
[23,]  131.09      110.16    366.61 392.14         564.29         17.02
[24,]  105.43       97.72    383.50 413.35         578.68         14.39
[25,]   84.32       86.08    398.43 431.17         590.76         12.08
[26,]   67.05       75.32    411.54 446.09         600.82         10.06
[27,]   53.01       65.48    422.97 458.53         609.15          8.32
[28,]   41.67       56.57    432.88 468.87         615.98          6.83
[29,]   32.57       48.59    441.42 477.42         621.55          5.57
[30,]   25.31       41.49    448.73 484.48         626.06          4.51
[31,]   19.55       35.22    454.95 490.27         629.68          3.63
[32,]   13.29       26.32    459.92 500.47         632.42          2.73
[33,]    8.97       19.57    463.63 507.83         634.33          1.92
[34,]    6.03       14.47    466.37 513.13         635.67          1.33
[35,]    4.02       10.65    468.40 516.93         636.59          0.92
[36,]    2.67        7.80    469.89 519.64         637.22          0.63
[37,]    1.76        5.69    470.98 521.58         637.66          0.43
[38,]    1.15        4.13    471.77 522.95         637.95          0.29
[39,]    0.75        2.99    472.34 523.92         638.15          0.20
[40,]    0.49        2.15    472.75 524.61         638.28          0.13
[41,]    0.31        1.54    473.05 525.10         638.37          0.09
[42,]    0.20        1.10    473.26 525.44         638.43          0.06
[43,]    0.13        0.78    473.42 525.67         638.47          0.04
[44,]    0.08        0.56    473.52 525.84         638.49          0.02
[45,]    0.05        0.39    473.60 525.96         638.51          0.02
[46,]    0.03        0.28    473.65 526.04         638.52          0.01
      trDeadCause
 [1,]        0.00
 [2,]        0.38
 [3,]        1.43
 [4,]        3.00
 [5,]        4.97
 [6,]        7.21
 [7,]        9.64
 [8,]       12.15
 [9,]       14.67
[10,]       17.12
[11,]       19.43
[12,]       21.30
[13,]       22.63
[14,]       23.63
[15,]       24.32
[16,]       24.71
[17,]       24.80
[18,]       24.62
[19,]       24.19
[20,]       23.55
[21,]       22.73
[22,]       21.15
[23,]       18.97
[24,]       16.89
[25,]       14.93
[26,]       13.11
[27,]       11.43
[28,]        9.91
[29,]        8.54
[30,]        7.31
[31,]        6.22
[32,]        4.97
[33,]        3.70
[34,]        2.75
[35,]        2.03
[36,]        1.49
[37,]        1.09
[38,]        0.79
[39,]        0.57
[40,]        0.41
[41,]        0.30
[42,]        0.21
[43,]        0.15
[44,]        0.11
[45,]        0.08
[46,]        0.05</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-3-1">sim_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="annotated-cell-3-2">    </span>
<span id="annotated-cell-3-3">    mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mPt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>),params)</span>
<span id="annotated-cell-3-4">    </span>
<span id="annotated-cell-3-5">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-6">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-8">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="annotated-cell-3-9">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-3-10">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-3-11">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-12">            }))</span>
<span id="annotated-cell-3-13">        }))</span>
<span id="annotated-cell-3-14">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  </span>
<span id="annotated-cell-3-15">        tr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-16">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-17">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))),.x)</span>
<span id="annotated-cell-3-18">        }))</span>
<span id="annotated-cell-3-19">    </span>
<span id="annotated-cell-3-20">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-21">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-22">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-23">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="annotated-cell-3-24">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-3-25">            arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_))</span>
<span id="annotated-cell-3-26">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-3-27">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-28">                arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-3-29">                arr_</span>
<span id="annotated-cell-3-30">            }))</span>
<span id="annotated-cell-3-31">        }))</span>
<span id="annotated-cell-3-32">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-3-33">        arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-34">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-35">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))),.x)</span>
<span id="annotated-cell-3-36">        }))</span>
<span id="annotated-cell-3-37">    </span>
<span id="annotated-cell-3-38">   </span>
<span id="annotated-cell-3-39">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-3-40">        .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-41">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-42">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-3-43">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="annotated-cell-3-44">    }))</span>
<span id="annotated-cell-3-45">    </span>
<span id="annotated-cell-3-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> tr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">array =</span> arr))</span>
<span id="annotated-cell-3-47">}</span>
<span id="annotated-cell-3-48"></span>
<span id="annotated-cell-3-49">markov_result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-3-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort</span>(params)</span></code></pre></div>
</div>
<section id="define-payoffs" class="level2">
<h2 class="anchored" data-anchor-id="define-payoffs">Define Payoffs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">u_payoff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb4-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> uProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb4-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_states<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(a_names)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(tunnel_names), n_treatments),</span>
<span id="cb4-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cost"</span>,</span>
<span id="cb4-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(s_names,a_names,tunnel_names),</span>
<span id="cb4-7">                          t_names))</span>
<span id="cb4-8">    </span>
<span id="cb4-9">}) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-10">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb4-11">u_payoff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
                from
to               cost
  Asympt         0.95
  Progressive    0.75
  DeadCause      0.00
  Dead           0.00
  accProgressive 0.00
  trProgressive  0.00
  trDeadCause    0.00

$with_drug
                from
to               cost
  Asympt         0.95
  Progressive    0.75
  DeadCause      0.00
  Dead           0.00
  accProgressive 0.00
  trProgressive  0.00
  trDeadCause    0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">c_payoff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb6-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cAsymp, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cDeath,</span>
<span id="cb6-3">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cAsymp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>cDrug, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cProg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> , <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> cDeath),</span>
<span id="cb6-4">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_states<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(a_names)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(tunnel_names), n_treatments),</span>
<span id="cb6-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cost"</span>,</span>
<span id="cb6-6">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(s_names,a_names,tunnel_names),</span>
<span id="cb6-7">                          t_names))</span>
<span id="cb6-8">    </span>
<span id="cb6-9">    }) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb6-11">c_payoff</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$without_drug
                from
to               cost
  Asympt          500
  Progressive    3000
  DeadCause         0
  Dead              0
  accProgressive    0
  trProgressive     0
  trDeadCause    1000

$with_drug
                from
to               cost
  Asympt         1500
  Progressive    3000
  DeadCause         0
  Dead              0
  accProgressive    0
  trProgressive     0
  trDeadCause    1000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">qaly_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .x[-1,] because we don't count the cycle with the full cohort in asymptomatic</span></span>
<span id="cb8-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace, u_payoff,  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ({</span>
<span id="cb8-3">        .x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> .y</span>
<span id="cb8-4">    })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb8-6"></span>
<span id="cb8-7">cost_unadj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb8-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace, c_payoff, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="cb8-9">        .x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> .y</span>
<span id="cb8-10">    })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span></code></pre></div>
</div>
</section>
</section>
<section id="summarize" class="level1">
<h1>Summarize</h1>
<section id="discounting" class="level2">
<h2 class="anchored" data-anchor-id="discounting">Discounting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">discounting_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-2">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cDr)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-2</span>))</span>
<span id="cb9-3">discounting_outcome <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-4">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>oDr)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-2</span>))</span></code></pre></div>
</div>
</section>
<section id="total-cost-and-qaly-calculation-with-cycle-adjustment" class="level2">
<h2 class="anchored" data-anchor-id="total-cost-and-qaly-calculation-with-cycle-adjustment">Total Cost and QALY Calculation (With Cycle Adjustment)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-9-1" class="code-annotation-target">alt_simp_coef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>, i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-8</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="annotated-cell-9-2">cycle_adj <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp_coef</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-annotation="1" data-code-lines="1">Alternative Simpson’s method coefficients</span>
</dd>
</dl>
</div>
</div>
<div class="cell tbl-cap-location-bottom">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">tot_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(cost_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle_adj )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb10-4">tot_qaly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(qaly_unadj, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> discounting_outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle_adj )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names)</span>
<span id="cb10-7"></span>
<span id="cb10-8">diff_cost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-9">    tot_cost<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_cost<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb10-10">diff_qaly <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-11">    tot_qaly<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>with_drug <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tot_qaly<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>without_drug</span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind.data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_qaly),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(tot_cost))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eff"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cost"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind.data.frame</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"difference"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Eff =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_qaly,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cost =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ICER =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(diff_cost <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> diff_qaly,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>R Model Results </caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Eff</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Cost</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ICER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">without_drug</td>
<td style="text-align: left;">11.659</td>
<td style="text-align: left;">16629</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">with_drug</td>
<td style="text-align: left;">13.971</td>
<td style="text-align: left;">27813</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">difference</td>
<td style="text-align: left;">2.31</td>
<td style="text-align: left;">11184</td>
<td style="text-align: left;">4838</td>
</tr>
</tbody>
</table>


</div>
</div>


</section>
</section>

 ]]></description>
  <guid>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/extending-the-matrix/extending-the-transition-matrix.html</guid>
  <pubDate>Thu, 18 May 2023 18:55:37 GMT</pubDate>
</item>
<item>
  <title>Embedding A Transition Probability Matrix for a Discrete Time Markov Model</title>
  <link>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix.html</link>
  <description><![CDATA[ 



<section id="prologue" class="level1 page-columns page-full">
<h1>Prologue</h1>
<p>Define <img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"> and <img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D"> as the hazard rate of two independent competing risks from a given (Healthy) health state (to Sick and Dead, respectively), and <img src="https://latex.codecogs.com/png.latex?%5CDelta%20t"> the cycle length (e.g., <img src="https://latex.codecogs.com/png.latex?1">=1 year, <img src="https://latex.codecogs.com/png.latex?1/12">=1 month, etc.). We can also define a third rate <img src="https://latex.codecogs.com/png.latex?r_%7BSD%7D%20=%20hr_%7BS%7D*r_%7BHD%7D"> for transitioning from sick to dead, i.e., the standard (healthy-to-dead) rate multiplied by the hazard ratio <img src="https://latex.codecogs.com/png.latex?hr_%7BS%7D">.</p>
<p>The underlying Markov model takes the following form:</p>
<div class="column-page">
<div class="cell" data-fig-width="4" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>
<svg width="384" height="480" viewbox="0.00 0.00 193.94 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 189.94,-184 189.94,4 -4,4"></polygon> <!-- Healthy --> <g id="node1" class="node">
<title>
Healthy
</title>
<ellipse fill="none" stroke="black" cx="41.61" cy="-90" rx="41.71" ry="18"></ellipse> <text text-anchor="middle" x="41.61" y="-85.8" font-family="Times,serif" font-size="14.00">Healthy</text> </g> <!-- Healthy&#45;&gt;Healthy --> <g id="edge1" class="edge">
<title>
Healthy-&gt;Healthy
</title>
<path fill="none" stroke="black" d="M80.3,-96.74C92.04,-96.57 101.21,-94.32 101.21,-90 101.21,-87.03 96.88,-85.04 90.35,-84.03"></path> <polygon fill="black" stroke="black" points="90.54,-80.53 80.3,-83.26 90.01,-87.51 90.54,-80.53"></polygon> </g> <!-- Sick --> <g id="node2" class="node">
<title>
Sick
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-162" rx="28.41" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-157.8" font-family="Times,serif" font-size="14.00">Sick</text> </g> <!-- Healthy&#45;&gt;Sick --> <g id="edge3" class="edge">
<title>
Healthy-&gt;Sick
</title>
<path fill="none" stroke="black" d="M58.31,-106.7C67.93,-116.33 80.17,-128.57 90.69,-139.09"></path> <polygon fill="black" stroke="black" points="88.44,-141.78 97.98,-146.38 93.39,-136.83 88.44,-141.78"></polygon> <text text-anchor="middle" x="59.72" y="-127.09" font-family="Times,serif" font-size="14.00">r_HS</text> </g> <!-- Dead --> <g id="node3" class="node">
<title>
Dead
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-18" rx="31.32" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-13.8" font-family="Times,serif" font-size="14.00">Dead</text> </g> <!-- Healthy&#45;&gt;Dead --> <g id="edge5" class="edge">
<title>
Healthy-&gt;Dead
</title>
<path fill="none" stroke="black" d="M58.31,-73.3C67.93,-63.67 80.17,-51.43 90.69,-40.91"></path> <polygon fill="black" stroke="black" points="93.39,-43.17 97.98,-33.62 88.44,-38.22 93.39,-43.17"></polygon> <text text-anchor="middle" x="58.56" y="-44.51" font-family="Times,serif" font-size="14.00">r_HD</text> </g> <!-- Sick&#45;&gt;Sick --> <g id="edge2" class="edge">
<title>
Sick-&gt;Sick
</title>
<path fill="none" stroke="black" d="M140.2,-168.71C150.86,-169.09 159.81,-166.85 159.81,-162 159.81,-158.82 155.96,-156.76 150.29,-155.83"></path> <polygon fill="black" stroke="black" points="150.37,-152.33 140.2,-155.29 150,-159.32 150.37,-152.33"></polygon> </g> <!-- Sick&#45;&gt;Dead --> <g id="edge4" class="edge">
<title>
Sick-&gt;Dead
</title>
<path fill="none" stroke="black" d="M113.61,-143.76C113.61,-119.2 113.61,-75.25 113.61,-46.35"></path> <polygon fill="black" stroke="black" points="117.11,-46.09 113.61,-36.09 110.11,-46.09 117.11,-46.09"></polygon> <text text-anchor="middle" x="149.77" y="-99.26" font-family="Times,serif" font-size="14.00">hr_S * r_HD</text> </g> <!-- Dead&#45;&gt;Dead --> <g id="edge6" class="edge">
<title>
Dead-&gt;Dead
</title>
<path fill="none" stroke="black" d="M143.03,-24.74C153.99,-24.96 163.02,-22.71 163.02,-18 163.02,-14.91 159.13,-12.88 153.36,-11.91"></path> <polygon fill="black" stroke="black" points="153.23,-8.4 143.03,-11.26 152.79,-15.38 153.23,-8.4"></polygon> </g> </g>
</svg>
</div>
<figcaption class="figure-caption">Figure&nbsp;1: Model Diagram</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(Matrix)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(expm)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(knitr)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gt)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(directlabels)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggsci)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggthemes)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Better accuracy that "life-table" aka trapezoidal method</span></span>
<span id="cb1-12">alt_simp_coef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>, i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-8</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span></span>
<span id="cb1-13">alt_simp      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x,h) h<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp_coef</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x)</span>
<span id="cb1-14"></span>
<span id="cb1-15">r_HS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span></span>
<span id="cb1-16">r_HD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span></span>
<span id="cb1-17">hr_S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb1-18">r_SD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hr_S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>r_HD</span>
<span id="cb1-19">cycle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-20"></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1-exp(-r_HS*cycle)</span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1-exp(-r_HD*cycle)</span></span>
<span id="cb1-23"></span>
<span id="cb1-24">get_P <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r_HS,r_HD,r_SD,cycle) {</span>
<span id="cb1-25">  P_st <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> ,  (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle)) ,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle), </span>
<span id="cb1-28">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle),</span>
<span id="cb1-29">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-30">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb1-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb1-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))</span>
<span id="cb1-34">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-36">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-37">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>)</span>
<span id="cb1-38"></span>
<span id="cb1-39">  P_eQ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb1-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle),r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb1-41">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb1-42">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb1-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))</span>
<span id="cb1-47">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-48">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-49">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_eQ"</span>)</span>
<span id="cb1-51"></span>
<span id="cb1-52"></span>
<span id="cb1-53">  P_cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-54">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb1-55">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle) , (r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle))   ,(r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle))   , </span>
<span id="cb1-56">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle),</span>
<span id="cb1-57">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb1-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, </span>
<span id="cb1-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb1-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))</span>
<span id="cb1-62">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-63">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-64">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>)</span>
<span id="cb1-65">  </span>
<span id="cb1-66">  </span>
<span id="cb1-67">  </span>
<span id="cb1-68">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>( P_st, P_cr , P_eQ)</span>
<span id="cb1-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb1-70">}</span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">check_sens <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(r_HD,r_HS,r_SD,cycle) {</span>
<span id="cb2-2">  </span>
<span id="cb2-3">Q <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb2-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle),r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb2-5">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb2-6">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb2-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb2-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb2-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))</span>
<span id="cb2-11">  ) </span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q_ &lt;- rbind(cbind(Q,c(r_HS*cycle,0,0)),c(0,0,0,0)) </span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q_ &lt;- rbind(cbind(Q_,c(r_HD*cycle,0,0,0)),c(0,0,0,0,0))</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dimnames(Q_) = list(c("Healthy","Sick","Dead","accS","accHD"),</span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                    c("Healthy","Sick","Dead","accS","accHD"))</span></span>
<span id="cb2-17"></span>
<span id="cb2-18">Q_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Q</span>
<span id="cb2-19"></span>
<span id="cb2-20">P <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> Q_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>() </span>
<span id="cb2-21">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>r_HS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>r_HD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>r_SD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span>cycle)</span>
<span id="cb2-22"></span>
<span id="cb2-23">P_cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(from,Healthy,Sick,Dead) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column_to_rownames</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>()</span>
<span id="cb2-27"></span>
<span id="cb2-28">P_st <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(from,Healthy,Sick,Dead) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column_to_rownames</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>()</span>
<span id="cb2-32"></span>
<span id="cb2-33">le1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-34">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> (.x)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> data.frame)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb2-38">  {.[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-40">  {. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span>)</span>
<span id="cb2-43"></span>
<span id="cb2-44">res1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span>.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(le1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_eQ"</span>) </span>
<span id="cb2-51"></span>
<span id="cb2-52">le2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-53">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P_cr[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> (.x)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> data.frame)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-56">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb2-57">  {.[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-59">  {. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span>)</span>
<span id="cb2-62">  </span>
<span id="cb2-63">res2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P_cr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span>.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-64">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-66">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(le2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>)</span>
<span id="cb2-70"></span>
<span id="cb2-71"></span>
<span id="cb2-72">le3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-73"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P_st[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> (.x)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> data.frame)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-76">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>  </span>
<span id="cb2-77">  {.[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-79">  {. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_names</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span>)</span>
<span id="cb2-82"></span>
<span id="cb2-83">res3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P_st <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span>.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-84">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-85">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-86">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-87">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(le3) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-89">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>)</span>
<span id="cb2-90">  </span>
<span id="cb2-91">  out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(res2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(res3)</span>
<span id="cb2-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(out)</span>
<span id="cb2-93"></span>
<span id="cb2-94">}</span></code></pre></div>
</details>
</div>
</section>
<section id="act-1-a-world-without-death" class="level1">
<h1>Act 1: A World Without Death</h1>
<p>It’s useful to begin with a completely unrealistic scenario: there is essentially no death. That is, individuals can either be Healthy or Sick, but they do not die. Furthermore, as shown in Figure&nbsp;1, once someone becomes sick, they are chronically ill and can not transition back to death.</p>
<p>Let’s set the model parameters as follows. Essentially what we’re doing is setting the death rate(<code>r_HD)</code> to an extraordinarily small number (<code>0.00000001)</code></p>
<table class="table">
<thead>
<tr class="header">
<th>param</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>r_HS</td>
<td>0.15</td>
</tr>
<tr class="even">
<td>r_HD</td>
<td>10^{-8}</td>
</tr>
<tr class="odd">
<td>hr_S</td>
<td>10</td>
</tr>
<tr class="even">
<td>r_SD</td>
<td>10^{-7}</td>
</tr>
</tbody>
</table>
<p>It is common to use the following formula to convert rates to probabilities:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHS%7D=%201%20-%20e%5E%7B-r_%7BHS%7D%5CDelta%20t%7D%0A"></p>
<p>Applying this to our example, the probability of transitioning from healthy to sick in a single one-year cycle is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHD%7D%20=%201%20-%20e%5E%7B-0.15%7D%20=%200.139292%0A"></p>
<p>After 2 years (1-year cycle), and assuming there is essentially no death at all in a starting cohort of 1,000 individuals, how many people would we expect to be in the sick state?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb3-2">  (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb3-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>()</span></code></pre></div>
</details>
<div id="fig-nodeath1y" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="wazebdspes" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wazebdspes .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wazebdspes .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wazebdspes .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wazebdspes .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wazebdspes .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wazebdspes .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wazebdspes .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wazebdspes .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wazebdspes .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wazebdspes .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wazebdspes .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wazebdspes .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wazebdspes .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wazebdspes .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wazebdspes .gt_from_md > :first-child {
  margin-top: 0;
}

#wazebdspes .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wazebdspes .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wazebdspes .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wazebdspes .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wazebdspes .gt_row_group_first td {
  border-top-width: 2px;
}

#wazebdspes .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wazebdspes .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wazebdspes .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wazebdspes .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wazebdspes .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wazebdspes .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wazebdspes .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wazebdspes .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wazebdspes .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wazebdspes .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wazebdspes .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wazebdspes .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wazebdspes .gt_left {
  text-align: left;
}

#wazebdspes .gt_center {
  text-align: center;
}

#wazebdspes .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wazebdspes .gt_font_normal {
  font-weight: normal;
}

#wazebdspes .gt_font_bold {
  font-weight: bold;
}

#wazebdspes .gt_font_italic {
  font-style: italic;
}

#wazebdspes .gt_super {
  font-size: 65%;
}

#wazebdspes .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#wazebdspes .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wazebdspes .gt_indent_1 {
  text-indent: 5px;
}

#wazebdspes .gt_indent_2 {
  text-indent: 10px;
}

#wazebdspes .gt_indent_3 {
  text-indent: 15px;
}

#wazebdspes .gt_indent_4 {
  text-indent: 20px;
}

#wazebdspes .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Healthy">740.8182</td>
<td class="gt_row gt_right" headers="Sick">259.1818</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;2: State Occpancy with No Death</figcaption>
</figure>
</div>
</div>
<p>Let’s also calculate total life expectancy to make sure everything is running smoothly. We’ll also ignore any discounting in the life expectancy calculation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb4-4">    (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb4-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> .x) </span>
<span id="cb4-6">  }))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>()</span>
<span id="cb4-9"></span>
<span id="cb4-10">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-11"></span>
<span id="cb4-12"></span>
<span id="cb4-13">life_exp_nodeath  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_exp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(tr) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-15">  {. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cycle} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>} ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-16">  {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)}</span>
<span id="cb4-17"></span>
<span id="cb4-18">life_exp_nodeath <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Life Expectancy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tab_source_note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note that we are ignoring discounting"</span>)</span></code></pre></div>
</details>
<div id="fig-lifeexp-nodeath" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="focpgddztg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#focpgddztg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#focpgddztg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#focpgddztg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#focpgddztg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#focpgddztg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#focpgddztg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#focpgddztg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#focpgddztg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#focpgddztg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#focpgddztg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#focpgddztg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#focpgddztg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#focpgddztg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#focpgddztg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#focpgddztg .gt_from_md > :first-child {
  margin-top: 0;
}

#focpgddztg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#focpgddztg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#focpgddztg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#focpgddztg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#focpgddztg .gt_row_group_first td {
  border-top-width: 2px;
}

#focpgddztg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#focpgddztg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#focpgddztg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#focpgddztg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#focpgddztg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#focpgddztg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#focpgddztg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#focpgddztg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#focpgddztg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#focpgddztg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#focpgddztg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#focpgddztg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#focpgddztg .gt_left {
  text-align: left;
}

#focpgddztg .gt_center {
  text-align: center;
}

#focpgddztg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#focpgddztg .gt_font_normal {
  font-weight: normal;
}

#focpgddztg .gt_font_bold {
  font-weight: bold;
}

#focpgddztg .gt_font_italic {
  font-style: italic;
}

#focpgddztg .gt_super {
  font-size: 65%;
}

#focpgddztg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#focpgddztg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#focpgddztg .gt_indent_1 {
  text-indent: 5px;
}

#focpgddztg .gt_indent_2 {
  text-indent: 10px;
}

#focpgddztg .gt_indent_3 {
  text-indent: 15px;
}

#focpgddztg .gt_indent_4 {
  text-indent: 20px;
}

#focpgddztg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="Total Life Expectancy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total Life Expectancy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="life_exp">60</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td class="gt_sourcenote">Note that we are ignoring discounting</td>
</tr>
</tfoot>

</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;3: Total Life Expectancy in a Scenario with No Death (or Discounting)</figcaption>
</figure>
</div>
</div>
<p>Not surprisingly, when there is no death or discounting, over a 60 year horizon life expectancy is 60.</p>
<p>Finally, let’s make one more tweak and switch from a yearly to a monthly time cycle. Again, we find identical answers for both the total number who become sick (after 2 years), and for life expectancy.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb5-2">  (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb5-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>()</span></code></pre></div>
</details>
<div id="fig-nodeathdaily" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="rsaehysylo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rsaehysylo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rsaehysylo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsaehysylo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rsaehysylo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rsaehysylo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rsaehysylo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsaehysylo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rsaehysylo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rsaehysylo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rsaehysylo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rsaehysylo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rsaehysylo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rsaehysylo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rsaehysylo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rsaehysylo .gt_from_md > :first-child {
  margin-top: 0;
}

#rsaehysylo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rsaehysylo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rsaehysylo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rsaehysylo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rsaehysylo .gt_row_group_first td {
  border-top-width: 2px;
}

#rsaehysylo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsaehysylo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rsaehysylo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rsaehysylo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsaehysylo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsaehysylo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rsaehysylo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rsaehysylo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rsaehysylo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsaehysylo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsaehysylo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rsaehysylo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rsaehysylo .gt_left {
  text-align: left;
}

#rsaehysylo .gt_center {
  text-align: center;
}

#rsaehysylo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rsaehysylo .gt_font_normal {
  font-weight: normal;
}

#rsaehysylo .gt_font_bold {
  font-weight: bold;
}

#rsaehysylo .gt_font_italic {
  font-style: italic;
}

#rsaehysylo .gt_super {
  font-size: 65%;
}

#rsaehysylo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#rsaehysylo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rsaehysylo .gt_indent_1 {
  text-indent: 5px;
}

#rsaehysylo .gt_indent_2 {
  text-indent: 10px;
}

#rsaehysylo .gt_indent_3 {
  text-indent: 15px;
}

#rsaehysylo .gt_indent_4 {
  text-indent: 20px;
}

#rsaehysylo .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Healthy">740.8182</td>
<td class="gt_row gt_right" headers="Sick">259.1818</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;4: State Occpancy with No Death</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb6-4">    (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-5">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> .x) </span>
<span id="cb6-6">  }))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>()</span>
<span id="cb6-9"></span>
<span id="cb6-10">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-11"></span>
<span id="cb6-12">life_exp_nodeath  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_exp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(tr) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alt_simp</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-14">  {. <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)} <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>} ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-15">  {<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)}</span>
<span id="cb6-16"></span>
<span id="cb6-17">life_exp_nodeath <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total Life Expectancy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tab_source_note</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Note that we are ignoring discounting"</span>)</span></code></pre></div>
</details>
<div id="fig-lifeexp-nodeath-monthly" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="vmglikigtq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vmglikigtq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vmglikigtq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vmglikigtq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vmglikigtq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vmglikigtq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vmglikigtq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmglikigtq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vmglikigtq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vmglikigtq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vmglikigtq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vmglikigtq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vmglikigtq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vmglikigtq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vmglikigtq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vmglikigtq .gt_from_md > :first-child {
  margin-top: 0;
}

#vmglikigtq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vmglikigtq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vmglikigtq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vmglikigtq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vmglikigtq .gt_row_group_first td {
  border-top-width: 2px;
}

#vmglikigtq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmglikigtq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vmglikigtq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vmglikigtq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmglikigtq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmglikigtq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vmglikigtq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vmglikigtq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vmglikigtq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vmglikigtq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmglikigtq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vmglikigtq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vmglikigtq .gt_left {
  text-align: left;
}

#vmglikigtq .gt_center {
  text-align: center;
}

#vmglikigtq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vmglikigtq .gt_font_normal {
  font-weight: normal;
}

#vmglikigtq .gt_font_bold {
  font-weight: bold;
}

#vmglikigtq .gt_font_italic {
  font-style: italic;
}

#vmglikigtq .gt_super {
  font-size: 65%;
}

#vmglikigtq .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vmglikigtq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vmglikigtq .gt_indent_1 {
  text-indent: 5px;
}

#vmglikigtq .gt_indent_2 {
  text-indent: 10px;
}

#vmglikigtq .gt_indent_3 {
  text-indent: 15px;
}

#vmglikigtq .gt_indent_4 {
  text-indent: 20px;
}

#vmglikigtq .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="Total Life Expectancy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total Life Expectancy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="life_exp">60</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td class="gt_sourcenote">Note that we are ignoring discounting</td>
</tr>
</tfoot>

</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;5: Monthly Life Cycle - Total Life Expectancy in a Scenario with No Death (or Discounting)</figcaption>
</figure>
</div>
</div>
</section>
<section id="act-2-here-be-competing-risks-dragons" class="level1 page-columns page-full">
<h1>Act 2: Here Be (Competing Risks) Dragons</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> </span>
<span id="cb7-2">  (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-3">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)))</span></code></pre></div>
</details>
</div>
<p>With the knowledge that in a world without death, approximately 259 people would become ill after 2 years, and would expect to live for 60 years on average, what happens when we introduce death as a competing risk?</p>
<p>Let’s now set the background mortality rate <img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D"> to 0.006. Let’s also assume that the hazard rate for death among sick people is 10 times the death rate of healthy people (i.e., <img src="https://latex.codecogs.com/png.latex?r_%7BSD%7D%20=%2010%20%5Ccdot%20r_%7BHD%7D">).</p>
<p>Note that death is only a competing risk for the Healthy state, since if someone is sick, death is the only other state they can transition out to:</p>
<div class="cell" data-fig-width="4" data-layout-align="center">
<div class="cell-output-display">
<div>
<div>
<svg width="384" height="480" viewbox="0.00 0.00 171.02 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 167.02,-184 167.02,4 -4,4"></polygon> <!-- Healthy --> <g id="node1" class="node">
<title>
Healthy
</title>
<ellipse fill="none" stroke="black" cx="41.61" cy="-90" rx="41.71" ry="18"></ellipse> <text text-anchor="middle" x="41.61" y="-85.8" font-family="Times,serif" font-size="14.00">Healthy</text> </g> <!-- Healthy&#45;&gt;Healthy --> <g id="edge1" class="edge">
<title>
Healthy-&gt;Healthy
</title>
<path fill="none" stroke="black" d="M80.3,-96.74C92.04,-96.57 101.21,-94.32 101.21,-90 101.21,-87.03 96.88,-85.04 90.35,-84.03"></path> <polygon fill="black" stroke="black" points="90.54,-80.53 80.3,-83.26 90.01,-87.51 90.54,-80.53"></polygon> </g> <!-- Sick --> <g id="node2" class="node">
<title>
Sick
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-162" rx="28.41" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-157.8" font-family="Times,serif" font-size="14.00">Sick</text> </g> <!-- Healthy&#45;&gt;Sick --> <g id="edge3" class="edge">
<title>
Healthy-&gt;Sick
</title>
<path fill="none" stroke="red" d="M58.31,-106.7C67.93,-116.33 80.17,-128.57 90.69,-139.09"></path> <polygon fill="red" stroke="red" points="88.44,-141.78 97.98,-146.38 93.39,-136.83 88.44,-141.78"></polygon> </g> <!-- Dead --> <g id="node3" class="node">
<title>
Dead
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-18" rx="31.32" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-13.8" font-family="Times,serif" font-size="14.00">Dead</text> </g> <!-- Healthy&#45;&gt;Dead --> <g id="edge5" class="edge">
<title>
Healthy-&gt;Dead
</title>
<path fill="none" stroke="red" d="M58.31,-73.3C67.93,-63.67 80.17,-51.43 90.69,-40.91"></path> <polygon fill="red" stroke="red" points="93.39,-43.17 97.98,-33.62 88.44,-38.22 93.39,-43.17"></polygon> </g> <!-- Sick&#45;&gt;Sick --> <g id="edge2" class="edge">
<title>
Sick-&gt;Sick
</title>
<path fill="none" stroke="black" d="M140.2,-168.71C150.86,-169.09 159.81,-166.85 159.81,-162 159.81,-158.82 155.96,-156.76 150.29,-155.83"></path> <polygon fill="black" stroke="black" points="150.37,-152.33 140.2,-155.29 150,-159.32 150.37,-152.33"></polygon> </g> <!-- Sick&#45;&gt;Dead --> <g id="edge4" class="edge">
<title>
Sick-&gt;Dead
</title>
<path fill="none" stroke="black" d="M113.61,-143.76C113.61,-119.2 113.61,-75.25 113.61,-46.35"></path> <polygon fill="black" stroke="black" points="117.11,-46.09 113.61,-36.09 110.11,-46.09 117.11,-46.09"></polygon> </g> <!-- Dead&#45;&gt;Dead --> <g id="edge6" class="edge">
<title>
Dead-&gt;Dead
</title>
<path fill="none" stroke="black" d="M143.03,-24.74C153.99,-24.96 163.02,-22.71 163.02,-18 163.02,-14.91 159.13,-12.88 153.36,-11.91"></path> <polygon fill="black" stroke="black" points="153.23,-8.4 143.03,-11.26 152.79,-15.38 153.23,-8.4"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<section id="standard-rate-to-transition-conversion" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="standard-rate-to-transition-conversion">Standard Rate-to-Transition Conversion</h2>
<p>Let’s first convert the supplied rates to probabilities using the same standard formulas, as above:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHS%7D=%201%20-%20e%5E%7B-r_%7BHS%7D%5Ccdot%20%5CDelta%20t%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHD%7D%20=%201%20-%20e%5E%7B-r_%7BHD%7D%5Ccdot%20%5CDelta%20t%7D%0A"></p>
<p>We can also define the probability of remaining healthy (i.e., transitioning to <em>neither</em> the sick or dead state) as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHH%7D%20=%201%20-%20p_%7BHS%7D%20-%20p_%7BHD%7D=%20e%5E%7B-r_%7BHS%7D%5CDelta%20t%7D%20%20+%20e%5E%7B-r_%7BHD%7D%5CDelta%20t%7D%20-%201%0A"></p>
<p>And finally the probability of dying among sick people is defined as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BSD%7D%20=%201%20-%20e%5E%7B-hr_%7BHD%7D%5Ccdot%20r_%7BHD%7D%5Ccdot%20%5CDelta%20t%7D%0A"></p>
<p>Figure&nbsp;6 shows the corresponding transition probability matrix:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">r_HD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.006</span></span>
<span id="cb8-2">r_SD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.006</span></span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>r_HS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>r_HD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>r_SD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_to_rownames("from") %&gt;% </span></span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
</details>
<div id="fig-m_P-st" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="aywairtaax" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#aywairtaax .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aywairtaax .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aywairtaax .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#aywairtaax .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#aywairtaax .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#aywairtaax .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aywairtaax .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aywairtaax .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aywairtaax .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aywairtaax .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aywairtaax .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aywairtaax .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aywairtaax .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#aywairtaax .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aywairtaax .gt_from_md > :first-child {
  margin-top: 0;
}

#aywairtaax .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aywairtaax .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aywairtaax .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#aywairtaax .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#aywairtaax .gt_row_group_first td {
  border-top-width: 2px;
}

#aywairtaax .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aywairtaax .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#aywairtaax .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#aywairtaax .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aywairtaax .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aywairtaax .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aywairtaax .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aywairtaax .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aywairtaax .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aywairtaax .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aywairtaax .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aywairtaax .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aywairtaax .gt_left {
  text-align: left;
}

#aywairtaax .gt_center {
  text-align: center;
}

#aywairtaax .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aywairtaax .gt_font_normal {
  font-weight: normal;
}

#aywairtaax .gt_font_bold {
  font-weight: bold;
}

#aywairtaax .gt_font_italic {
  font-style: italic;
}

#aywairtaax .gt_super {
  font-size: 65%;
}

#aywairtaax .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#aywairtaax .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#aywairtaax .gt_indent_1 {
  text-indent: 5px;
}

#aywairtaax .gt_indent_2 {
  text-indent: 10px;
}

#aywairtaax .gt_indent_3 {
  text-indent: 15px;
}

#aywairtaax .gt_indent_4 {
  text-indent: 20px;
}

#aywairtaax .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
<th id="Dead" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Dead</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="from">Healthy</td>
<td class="gt_row gt_right" headers="Healthy">0.8547</td>
<td class="gt_row gt_right" headers="Sick">0.1393</td>
<td class="gt_row gt_right" headers="Dead">0.0060</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="from">Sick</td>
<td class="gt_row gt_right" headers="Healthy">0.0000</td>
<td class="gt_row gt_right" headers="Sick">0.9418</td>
<td class="gt_row gt_right" headers="Dead">0.0582</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="from">Dead</td>
<td class="gt_row gt_right" headers="Healthy">0.0000</td>
<td class="gt_row gt_right" headers="Sick">0.0000</td>
<td class="gt_row gt_right" headers="Dead">1.0000</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;6: Transition Probability Matrix Using Standard Rate-to-Probability Conversion Formulas</figcaption>
</figure>
</div>
</div>
<p>Given this transition probability matrix, how many healthy, sick and dead individuals do we have in our cohort after a 60-year time horizon? Figure&nbsp;7 summarizes state occupancy at the end of 60 years:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">res_60yst <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check_sens</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span> r_HD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS =</span> r_HS, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD =</span> r_SD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>) </span>
<span id="cb9-4">res_60yst <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle,Healthy,Sick,Dead,life_exp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-6">  gt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_missing</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">missing_text=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Healthy,Sick,Dead,life_exp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life Expectancy"</span>)</span></code></pre></div>
</details>
<div id="fig-60y-st" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="xucrniankg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xucrniankg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xucrniankg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xucrniankg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xucrniankg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xucrniankg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xucrniankg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xucrniankg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xucrniankg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xucrniankg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xucrniankg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xucrniankg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xucrniankg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xucrniankg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xucrniankg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xucrniankg .gt_from_md > :first-child {
  margin-top: 0;
}

#xucrniankg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xucrniankg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xucrniankg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xucrniankg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xucrniankg .gt_row_group_first td {
  border-top-width: 2px;
}

#xucrniankg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xucrniankg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xucrniankg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xucrniankg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xucrniankg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xucrniankg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xucrniankg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xucrniankg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xucrniankg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xucrniankg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xucrniankg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xucrniankg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xucrniankg .gt_left {
  text-align: left;
}

#xucrniankg .gt_center {
  text-align: center;
}

#xucrniankg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xucrniankg .gt_font_normal {
  font-weight: normal;
}

#xucrniankg .gt_font_bold {
  font-weight: bold;
}

#xucrniankg .gt_font_italic {
  font-style: italic;
}

#xucrniankg .gt_super {
  font-size: 65%;
}

#xucrniankg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xucrniankg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xucrniankg .gt_indent_1 {
  text-indent: 5px;
}

#xucrniankg .gt_indent_2 {
  text-indent: 10px;
}

#xucrniankg .gt_indent_3 {
  text-indent: 15px;
}

#xucrniankg .gt_indent_4 {
  text-indent: 20px;
}

#xucrniankg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="cycle" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">cycle</th>
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
<th id="Dead" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Dead</th>
<th id="Life Expectancy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Life Expectancy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="cycle">60</td>
<td class="gt_row gt_right" headers="Healthy">0.1</td>
<td class="gt_row gt_right" headers="Sick">43.6</td>
<td class="gt_row gt_right" headers="Dead">956.3</td>
<td class="gt_row gt_right" headers="life_exp">22.1</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;7: 1-Year Cycle</figcaption>
</figure>
</div>
</div>
<p>As Figure&nbsp;7 shows, after 60 years, 43.6 are recorded as being in the sick state and life expectancy has reduced to 22.1 years.</p>
<p>As above, let’s now repeat the same exercise using a <em>daily</em> cycle length:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">res_60yst_daily <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check_sens</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span> r_HD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS =</span> r_HS, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD =</span> r_SD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_st"</span>) </span>
<span id="cb10-4"></span>
<span id="cb10-5">res_60yst_daily <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle,Healthy,Sick,Dead,life_exp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-7">  gt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_missing</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">missing_text=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Healthy,Sick,Dead,life_exp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life Expectancy"</span>)</span></code></pre></div>
</details>
<div id="fig-60y-st-daily" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="gflyieogzt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gflyieogzt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gflyieogzt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gflyieogzt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gflyieogzt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gflyieogzt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gflyieogzt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gflyieogzt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gflyieogzt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gflyieogzt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gflyieogzt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gflyieogzt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gflyieogzt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gflyieogzt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gflyieogzt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gflyieogzt .gt_from_md > :first-child {
  margin-top: 0;
}

#gflyieogzt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gflyieogzt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gflyieogzt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gflyieogzt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gflyieogzt .gt_row_group_first td {
  border-top-width: 2px;
}

#gflyieogzt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gflyieogzt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gflyieogzt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gflyieogzt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gflyieogzt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gflyieogzt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gflyieogzt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gflyieogzt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gflyieogzt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gflyieogzt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gflyieogzt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gflyieogzt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gflyieogzt .gt_left {
  text-align: left;
}

#gflyieogzt .gt_center {
  text-align: center;
}

#gflyieogzt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gflyieogzt .gt_font_normal {
  font-weight: normal;
}

#gflyieogzt .gt_font_bold {
  font-weight: bold;
}

#gflyieogzt .gt_font_italic {
  font-style: italic;
}

#gflyieogzt .gt_super {
  font-size: 65%;
}

#gflyieogzt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gflyieogzt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gflyieogzt .gt_indent_1 {
  text-indent: 5px;
}

#gflyieogzt .gt_indent_2 {
  text-indent: 10px;
}

#gflyieogzt .gt_indent_3 {
  text-indent: 15px;
}

#gflyieogzt .gt_indent_4 {
  text-indent: 20px;
}

#gflyieogzt .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="cycle" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">cycle</th>
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
<th id="Dead" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Dead</th>
<th id="Life Expectancy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Life Expectancy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="cycle">21900</td>
<td class="gt_row gt_right" headers="Healthy">0.1</td>
<td class="gt_row gt_right" headers="Sick">42.6</td>
<td class="gt_row gt_right" headers="Dead">957.4</td>
<td class="gt_row gt_right" headers="life_exp">21.7</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;8: Daily Cycle</figcaption>
</figure>
</div>
</div>
<p>By switching to a daily cycle we now have 42.6 recorded as being in the sick state after 60 years (=21,900 days) and life expectancy is 21.7 years.</p>
<section id="signs-of-trouble" class="level3">
<h3 class="anchored" data-anchor-id="signs-of-trouble">Signs of Trouble</h3>
<p>Let’s recap what we have found after introducing background mortality as a competing risk:</p>
<ul>
<li>Using a <strong>1-year cycle length</strong>, life expectancy is 22.11 years.</li>
<li>Using a <strong>daily cycle length</strong>, life expectancy is 21.73 years.</li>
</ul>
<p>The only difference above is the cycle length used, yet we obtain a 0.38 year difference in life expectancy. What causes this difference?</p>
</section>
<section id="discretizing-a-continuous-time-process" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="discretizing-a-continuous-time-process">Discretizing a Continuous Time Process</h3>
<p>The answer boils down to the fact that with longer cycle lengths we “hide” some deaths that occur because a full healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> dead transition occurs within a single cycle.</p>
<p>When we use the standard rate-to-probability conversion formula (i.e., <img src="https://latex.codecogs.com/png.latex?p_%7BHS%7D=%201%20-%20e%5E%7B-r_%7BHS%7D%5CDelta%20t%7D">) we obtain the <em>marginal</em> probability of transition. This marginal probability reflects the union of <em>all possible transitions</em> that start Healthy and then transition to and from the sick state in the cycle.</p>
<p>That is, <img src="https://latex.codecogs.com/png.latex?p_%7BHS%7D=%201%20-%20e%5E%7B-r_%7BHS%7D%5CDelta%20t%7D"> captures the probability of following scenarios occurring in a cycle:</p>
<ol type="1">
<li>Individual transitions from healthy to sick.</li>
<li>Individual transitions from healthy to sick to dead.</li>
</ol>
<p>By including case 2 in the healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> sick transition probability, we effectively rule out the possibility of becoming sick and dying within the same cycle. This implicit assumption means that we are no longer modeling a continuous time process, since we effectively “hide” some (quick) deaths that occur within a cycle due to the disease:</p>
<div class="cell" data-fig-width="4" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-comp-st" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div>
<svg width="384" height="480" viewbox="0.00 0.00 171.02 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 167.02,-184 167.02,4 -4,4"></polygon> <!-- Healthy --> <g id="node1" class="node">
<title>
Healthy
</title>
<ellipse fill="#81aede" stroke="black" cx="41.61" cy="-90" rx="41.71" ry="18"></ellipse> <text text-anchor="middle" x="41.61" y="-85.8" font-family="Times,serif" font-size="14.00">Healthy</text> </g> <!-- Healthy&#45;&gt;Healthy --> <g id="edge1" class="edge">
<title>
Healthy-&gt;Healthy
</title>
<path fill="none" stroke="#d9d0d0" d="M80.3,-96.74C92.04,-96.57 101.21,-94.32 101.21,-90 101.21,-87.03 96.88,-85.04 90.35,-84.03"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="90.54,-80.53 80.3,-83.26 90.01,-87.51 90.54,-80.53"></polygon> </g> <!-- Sick --> <g id="node2" class="node">
<title>
Sick
</title>
<ellipse fill="#81aede" stroke="black" cx="113.61" cy="-162" rx="28.41" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-157.8" font-family="Times,serif" font-size="14.00">Sick</text> </g> <!-- Healthy&#45;&gt;Sick --> <g id="edge3" class="edge">
<title>
Healthy-&gt;Sick
</title>
<path fill="none" stroke="blue" stroke-width="3" d="M58.31,-106.7C67.93,-116.33 80.17,-128.57 90.69,-139.09"></path> <polygon fill="blue" stroke="blue" stroke-width="3" points="88.44,-141.78 97.98,-146.38 93.39,-136.83 88.44,-141.78"></polygon> </g> <!-- Dead --> <g id="node3" class="node">
<title>
Dead
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-18" rx="31.32" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-13.8" font-family="Times,serif" font-size="14.00">Dead</text> </g> <!-- Healthy&#45;&gt;Dead --> <g id="edge5" class="edge">
<title>
Healthy-&gt;Dead
</title>
<path fill="none" stroke="#d9d0d0" d="M58.31,-73.3C67.93,-63.67 80.17,-51.43 90.69,-40.91"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="93.39,-43.17 97.98,-33.62 88.44,-38.22 93.39,-43.17"></polygon> </g> <!-- Sick&#45;&gt;Sick --> <g id="edge2" class="edge">
<title>
Sick-&gt;Sick
</title>
<path fill="none" stroke="#d9d0d0" d="M140.2,-168.71C150.86,-169.09 159.81,-166.85 159.81,-162 159.81,-158.82 155.96,-156.76 150.29,-155.83"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="150.37,-152.33 140.2,-155.29 150,-159.32 150.37,-152.33"></polygon> </g> <!-- Sick&#45;&gt;Dead --> <g id="edge4" class="edge">
<title>
Sick-&gt;Dead
</title>
<path fill="none" stroke="red" stroke-width="3" stroke-dasharray="1,5" d="M113.61,-143.76C113.61,-119.2 113.61,-75.25 113.61,-46.35"></path> <polygon fill="red" stroke="red" stroke-width="3" points="117.11,-46.09 113.61,-36.09 110.11,-46.09 117.11,-46.09"></polygon> </g> <!-- Dead&#45;&gt;Dead --> <g id="edge6" class="edge">
<title>
Dead-&gt;Dead
</title>
<path fill="none" stroke="#d9d0d0" d="M143.03,-24.74C153.99,-24.96 163.02,-22.71 163.02,-18 163.02,-14.91 159.13,-12.88 153.36,-11.91"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="153.23,-8.4 143.03,-11.26 152.79,-15.38 153.23,-8.4"></polygon> </g> </g>
</svg>
</div>
<figcaption class="figure-caption">Figure&nbsp;9: compound Transition Patterns Using Standard Rate to Probability Conversion Formulas</figcaption>
</figure>
</div>
</div>
</div>
<p>In Figure&nbsp;9, and using standard rate-to-probability conversion formulas, the recorded states of a healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> dead transition are recorded in blue; the “hidden” transition is shown in red.</p>
<section id="alternative-rate-to-probability-conversion" class="level4">
<h4 class="anchored" data-anchor-id="alternative-rate-to-probability-conversion">Alternative Rate-to-Probability Conversion</h4>
<p>Another set of formulas often used to account for competing risks are as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHS%7D=%20%5Cfrac%7Br_%7BHS%7D%7D%7Br_%7BHS%7D+r_%7BHD%7D%7D%5Cbig%20(%201%20-%20e%5E%7B-(r_%7BHS%7D+r_%7BHD%7D)%5CDelta%20t%7D%5Cbig%20)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHD%7D=%20%5Cfrac%7Br_%7BHD%7D%7D%7Br_%7BHS%7D+r_%7BHD%7D%7D%5Cbig%20(%201%20-%20e%5E%7B-(r_%7BHS%7D+r_%7BHD%7D)%5CDelta%20t%7D%5Cbig%20)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7BHH%7D%20=%20e%5E%7B-(r_%7BHS%7D+r_%7BHD%7D)%5CDelta%20t%7D%0A"></p>
<p>Let’s now use these formulas instead.</p>
<p>Figure&nbsp;10 shows the corresponding transition probability matrix:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">r_HD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.006</span></span>
<span id="cb11-2">r_SD <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.006</span></span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>r_HS,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>r_HD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>r_SD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#column_to_rownames("from") %&gt;% </span></span>
<span id="cb11-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"from"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span></code></pre></div>
</details>
<div id="fig-m_P-cr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ehmdjrkitg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ehmdjrkitg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ehmdjrkitg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ehmdjrkitg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ehmdjrkitg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ehmdjrkitg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ehmdjrkitg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ehmdjrkitg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ehmdjrkitg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ehmdjrkitg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ehmdjrkitg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ehmdjrkitg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ehmdjrkitg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ehmdjrkitg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ehmdjrkitg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ehmdjrkitg .gt_from_md > :first-child {
  margin-top: 0;
}

#ehmdjrkitg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ehmdjrkitg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ehmdjrkitg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ehmdjrkitg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ehmdjrkitg .gt_row_group_first td {
  border-top-width: 2px;
}

#ehmdjrkitg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ehmdjrkitg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ehmdjrkitg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ehmdjrkitg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ehmdjrkitg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ehmdjrkitg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ehmdjrkitg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ehmdjrkitg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ehmdjrkitg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ehmdjrkitg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ehmdjrkitg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ehmdjrkitg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ehmdjrkitg .gt_left {
  text-align: left;
}

#ehmdjrkitg .gt_center {
  text-align: center;
}

#ehmdjrkitg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ehmdjrkitg .gt_font_normal {
  font-weight: normal;
}

#ehmdjrkitg .gt_font_bold {
  font-weight: bold;
}

#ehmdjrkitg .gt_font_italic {
  font-style: italic;
}

#ehmdjrkitg .gt_super {
  font-size: 65%;
}

#ehmdjrkitg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ehmdjrkitg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ehmdjrkitg .gt_indent_1 {
  text-indent: 5px;
}

#ehmdjrkitg .gt_indent_2 {
  text-indent: 10px;
}

#ehmdjrkitg .gt_indent_3 {
  text-indent: 15px;
}

#ehmdjrkitg .gt_indent_4 {
  text-indent: 20px;
}

#ehmdjrkitg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
<th id="Dead" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Dead</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="from">Healthy</td>
<td class="gt_row gt_right" headers="Healthy">0.8556</td>
<td class="gt_row gt_right" headers="Sick">0.1389</td>
<td class="gt_row gt_right" headers="Dead">0.0056</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="from">Sick</td>
<td class="gt_row gt_right" headers="Healthy">0.0000</td>
<td class="gt_row gt_right" headers="Sick">0.9418</td>
<td class="gt_row gt_right" headers="Dead">0.0582</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="from">Dead</td>
<td class="gt_row gt_right" headers="Healthy">0.0000</td>
<td class="gt_row gt_right" headers="Sick">0.0000</td>
<td class="gt_row gt_right" headers="Dead">1.0000</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;10: Transition Probability Matrix Using Alternative Rate-to-Probability Conversion Formulas</figcaption>
</figure>
</div>
</div>
<p>Comparing Figure&nbsp;6 and Figure&nbsp;10, notice that a few things have changed. First, the probability of Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transition declined. This would seem to be consistent with a world in which there are fewer alive sick individuals observed at the end of the cycle–which we would expect if acute illness results in a nontrivial number of quick deaths after illness onset in a cycle.</p>
<p>However, look at the Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition probability change; <strong>it went down, too</strong>. If we were recording more acute deaths from the disease, we should see <em>more</em> Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transitions from individuals sojourning through the Sick state on their way to death in a single cycle.</p>
<p>What about state occupancy and life expectancy under different cycle lengths?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">res_60yst_cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check_sens</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span> r_HD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS =</span> r_HS, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD =</span> r_SD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)</span>
<span id="cb12-6"></span>
<span id="cb12-7">res_60yst_daily_cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check_sens</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span> r_HD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS =</span> r_HS, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD =</span> r_SD,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_cr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_t =</span> cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Daily"</span>)</span>
<span id="cb12-12"></span>
<span id="cb12-13">res_60yst_cr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(res_60yst_daily_cr) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(cycle,cycle_t,Healthy,Sick,Dead,life_exp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-16">  gt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sub_missing</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">missing_text=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Healthy,Sick,Dead,life_exp),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_label</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"life_exp"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Life Expectancy"</span>)</span></code></pre></div>
</details>
<div id="fig-st-cr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="bkdgmecdmx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bkdgmecdmx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bkdgmecdmx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bkdgmecdmx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bkdgmecdmx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bkdgmecdmx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bkdgmecdmx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bkdgmecdmx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bkdgmecdmx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bkdgmecdmx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bkdgmecdmx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bkdgmecdmx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bkdgmecdmx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bkdgmecdmx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bkdgmecdmx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bkdgmecdmx .gt_from_md > :first-child {
  margin-top: 0;
}

#bkdgmecdmx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bkdgmecdmx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bkdgmecdmx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bkdgmecdmx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bkdgmecdmx .gt_row_group_first td {
  border-top-width: 2px;
}

#bkdgmecdmx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bkdgmecdmx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bkdgmecdmx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bkdgmecdmx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bkdgmecdmx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bkdgmecdmx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bkdgmecdmx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bkdgmecdmx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bkdgmecdmx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bkdgmecdmx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bkdgmecdmx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bkdgmecdmx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bkdgmecdmx .gt_left {
  text-align: left;
}

#bkdgmecdmx .gt_center {
  text-align: center;
}

#bkdgmecdmx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bkdgmecdmx .gt_font_normal {
  font-weight: normal;
}

#bkdgmecdmx .gt_font_bold {
  font-weight: bold;
}

#bkdgmecdmx .gt_font_italic {
  font-style: italic;
}

#bkdgmecdmx .gt_super {
  font-size: 65%;
}

#bkdgmecdmx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#bkdgmecdmx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bkdgmecdmx .gt_indent_1 {
  text-indent: 5px;
}

#bkdgmecdmx .gt_indent_2 {
  text-indent: 10px;
}

#bkdgmecdmx .gt_indent_3 {
  text-indent: 15px;
}

#bkdgmecdmx .gt_indent_4 {
  text-indent: 20px;
}

#bkdgmecdmx .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true">
<thead class="gt_col_headings">
<tr class="header">
<th id="cycle" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">cycle</th>
<th id="cycle_t" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">cycle_t</th>
<th id="Healthy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Healthy</th>
<th id="Sick" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Sick</th>
<th id="Dead" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Dead</th>
<th id="Life Expectancy" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Life Expectancy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="cycle">1y</td>
<td class="gt_row gt_right" headers="cycle_t">60</td>
<td class="gt_row gt_right" headers="Healthy">0.1</td>
<td class="gt_row gt_right" headers="Sick">43.9</td>
<td class="gt_row gt_right" headers="Dead">956.0</td>
<td class="gt_row gt_right" headers="life_exp">22.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="cycle">Daily</td>
<td class="gt_row gt_right" headers="cycle_t">21900</td>
<td class="gt_row gt_right" headers="Healthy">0.1</td>
<td class="gt_row gt_right" headers="Sick">42.6</td>
<td class="gt_row gt_right" headers="Dead">957.4</td>
<td class="gt_row gt_right" headers="life_exp">21.7</td>
</tr>
</tbody>
</table>

</div>
<figcaption class="figure-caption">Figure&nbsp;11: 1-Year vs.&nbsp;Daily Cycle</figcaption>
</figure>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">diff_st_cr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb13-2">  res_60yst_cr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(res_60yst_daily_cr) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">life_exp =</span> life_exp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lead</span>(life_exp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(life_exp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>()</span></code></pre></div>
</details>
</div>
<p>Again, we have a difference in life expectancy of 0.462 years. <em>So switching to the alternative formulas has not fundamentally solved our problem.</em></p>
</section>
<section id="how-do-transition-probabilities-change-as-the-likelihood-of-disease-related-death-varies" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="how-do-transition-probabilities-change-as-the-likelihood-of-disease-related-death-varies">How do transition probabilities change as the Likelihood of Disease-related death varies?</h4>
<p>Another way to see the issue is to plot how the transition probabilities change (or not) at different levels of disease acuity. Figure&nbsp;12 plots the relevant transition probabilities under a yearly time cycle, and while allowing the underlying hazard rate of death from the disease (<code>hr_S</code>) to vary.</p>
<p>As the hazard rate increases, the likelihood of ending up dead within a given cycle increases. Indeed, in the most extreme case, imagine the disease has a near instantaneous death rate. In that case we should see almost no Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transitions within a yearly cycle, because nearly everyone who became sick within the cycle died within 1 day.</p>
<p>We see in Figure&nbsp;12 that the Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick probabilities remain flat for transitions under which background mortality is a competing event. However, the Sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition probabilities rise as the likelihood of fatal disease increases.</p>
<div class="cell page-columns page-full">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>.x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hr_S=</span>.x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(transition,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(name,value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(method,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_eQ"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(transition), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(from), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>),</span>
<span id="cb14-11">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> hr_S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>method),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>transition, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-18">  ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_base</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-22">  directlabels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"  {method}"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb14-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hr_S (Hazard Ratio for Sick-to-Dead)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display column-page">
<div id="fig-acuity-comparison-1y" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix_files/figure-html/fig-acuity-comparison-1y-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Yearly Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)</figcaption>
</figure>
</div>
</div>
</div>
<p>It is common practice to address these issues using the following guidelines:</p>
<ul>
<li>Select a cycle length where the probability of remaining in a given state is at least 95%.</li>
<li>Pick a cycle length that aligns with the clinical/disease timelines of the decision problem.
<ul>
<li>Treatment schedules.</li>
<li>Acute vs.&nbsp;chronic condition.</li>
</ul></li>
</ul>
<p>But do these actually solve the issue? No. Figure&nbsp;13 shows how the transition probabilities change when we switch to a <em>daily</em> cycle length. Again, we see the problem: as disease acuity increases, the probability of a Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition does not change; <strong>even though we shortened the cycle length, we have not fundamentally addressed the issue.</strong></p>
<div class="cell page-columns page-full">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>.x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hr_S=</span>.x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(transition,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(name,value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(method,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(method<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P_eQ"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(transition), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(from), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>),</span>
<span id="cb15-11">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> hr_S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>method),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>transition, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-18">  ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_base</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-22">  directlabels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"  {method}"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb15-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hr_S (Hazard Ratio for Sick-to-Dead)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display column-page">
<div id="fig-acuity-comparison-daily" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix_files/figure-html/fig-acuity-comparison-daily-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Daily Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)</figcaption>
</figure>
</div>
</div>
</div>
<p>How does this all translate into model outputs, such as life expectancy? Figure&nbsp;14 plots life-expectancy (y-axis) against the underlying disease hazard rate for death. Each line provides the life-expectancy curve under a different cycle length, with everything else in the model held fixed.</p>
<p>Not surprisingly, we see that as the likelihood of fatal disease increases, life expectancy declines.</p>
<p>But the most important takeaway is that the modeled life expectancy differs <em>depending on the cycle length used.</em> For a given hazard rate the underlying disease process is <em>exactly the same</em> – but we get different answers depending on our cycle length.</p>
<p>The pattern of results is instructive, too. Essentially, with longer cycle lengths and incorrect transition probabilities, we will “miss” more compound within-cycle Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transitions and instead record them as Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transitions. This has a net effect of “hiding” more disease-related death in our model – and life-expectancy is inflated as a result.</p>
<div class="cell page-columns page-full" data-meassage="false">
<div class="cell-output-display column-page">
<div id="fig-le-st" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix_files/figure-html/fig-le-st-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length. The left panel uses the formula that accounts for competing risks. The right panel uses standard conversion formula.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="act-iii-embedding-a-transition-matrix-and-recording-events" class="level1 page-columns page-full">
<h1>Act III: Embedding a Transition Matrix and Recording Events</h1>
<p>To properly account for compound transitions that can occur due to competing risks, we need to do the following:</p>
<ol type="1">
<li>Embed the transition probability matrix by exponentiating the underlying transition rate matrix.</li>
<li>Include non-Markovian accumulators in the transition probability matrix. This facilitates accurately calculating model outputs (e.g., total costs, QALYs, etc.).</li>
</ol>
<section id="embed-the-transition-probability-matrix" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="embed-the-transition-probability-matrix">1. Embed the Transition Probability Matrix</h2>
<p>Our rate matrix <code>Q</code> is constructed by including the relevant transition rates in the off-diagonal cells. The diagonal of <code>Q</code> is the negative sum of off-diagonal elements in the same row:</p>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 26%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Healthy</th>
<th>Sick</th>
<th>Dead</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Healthy</td>
<td>-(<img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"> + <img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D">)</td>
<td><img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D"></td>
</tr>
<tr class="even">
<td>Sick</td>
<td>0</td>
<td>-(<img src="https://latex.codecogs.com/png.latex?hr_%7BS%7D%20%5Ccdot%20r_%7BHD%7D">)</td>
<td><img src="https://latex.codecogs.com/png.latex?hr_%7BS%7D%20%5Ccdot%20r_%7BHD%7D"></td>
</tr>
<tr class="odd">
<td>Dead</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Here is the rate matrix for the Healthy-Sick-Dead model:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>,</span>
<span id="cb16-3">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.006</span>,</span>
<span id="cb16-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hr_S =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb16-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-6"></span>
<span id="cb16-7">Q <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(params,{</span>
<span id="cb16-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb16-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle),r_HS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_HD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb16-11">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,r_SD<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>cycle,</span>
<span id="cb16-12">      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb16-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb16-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb16-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb16-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))</span>
<span id="cb16-17">  ) </span>
<span id="cb16-18">  })</span>
<span id="cb16-19">Q</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        Healthy  Sick  Dead
Healthy  -0.156  0.15 0.006
Sick      0.000 -0.06 0.060
Dead      0.000  0.00 0.000</code></pre>
</div>
</div>
<p>We next embed the transition probability matrix <code>P</code> by taking the matrix exponential of <code>Q</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(expm)</span>
<span id="cb18-2">P <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(Q)</span>
<span id="cb18-3">P</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Healthy      Sick        Dead
Healthy 0.8555592 0.1346958 0.009744961
Sick    0.0000000 0.9417645 0.058235466
Dead    0.0000000 0.0000000 1.000000000</code></pre>
</div>
</div>
<p>An alternative way of exponentiating a matrix is to perform a Taylor series expansion:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Identity matrix with same dimensions and names as Q </span></span>
<span id="cb20-2">Q_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dimnames</span>(Q_I) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dimnames</span>(Q)</span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note the %^% operator is in the expm package. </span></span>
<span id="cb20-6"></span>
<span id="cb20-7">Q2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-squared</span></span>
<span id="cb20-8">Q3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-cubed</span></span>
<span id="cb20-9">Q4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># etc.</span></span>
<span id="cb20-10"></span>
<span id="cb20-11">Q_I <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Q <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Q2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Q3 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Q4 </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Healthy      Sick        Dead
Healthy 0.8555599 0.1346947 0.009745373
Sick    0.0000000 0.9417645 0.058235460
Dead    0.0000000 0.0000000 1.000000000</code></pre>
</div>
</div>
<p>How does this approach (<code>P_eQ</code>) perform relative to the other transition probability matrices (<code>P_st</code> and <code>P_cr</code>)? Figure&nbsp;15 shows how the transition probabilities vary by hazard rate.</p>
<p>We can now see we’ve achieved what we need: Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition probabilities that rise as the hazard rate of death from disease increases. Again, this occurs because as the likelihood of death after becoming ill increases, we increase the likelihood of a compound Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition within a cycle. We need these to be recorded (accurately) as Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transitions, rather than Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transitions. Correspondingly, as the probability of a compound transition increases with an increasing hazard rate, the probability of a single Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transition declines; we see this in Figure&nbsp;15 as well.</p>
<div class="cell page-columns page-full">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_P</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HS=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_HD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r_SD=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">006</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>.x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hr_S=</span>.x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(transition,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spread</span>(name,value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> P_cr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(method,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>from,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>hr_S,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter(method!="P_eQ") %&gt;% </span></span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(transition), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(from), <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>),</span>
<span id="cb22-11">                                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sick"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span>transition) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> hr_S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>method, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>method),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_shape_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(from<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>transition, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-17">  ggthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_base</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-22">  directlabels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"  {method}"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hr_S (Hazard Ratio for Sick-to-Dead)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display column-page">
<div id="fig-acuity-comparison-1y-embedded" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix_files/figure-html/fig-acuity-comparison-1y-embedded-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;15: 1-Year Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks, and P_eQ is embedded using the transition rate matrix Q.)</figcaption>
</figure>
</div>
</div>
</div>
<p>We also see that regardless of the cycle length used, we always end up with the same calculated life expectancy:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-le-eQ" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix_files/figure-html/fig-le-eQ-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;16: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length</figcaption>
</figure>
</div>
</div>
</div>
<p>We have thus “fixed” our problem of hidden disease-related deaths!</p>
<section id="why-is-this-important" class="level3">
<h3 class="anchored" data-anchor-id="why-is-this-important">Why is this important?</h3>
<p>The use of an embedded transition probability matrix is important for a number of reasons:</p>
<ol type="1">
<li>The Markov model accurately reflects the underlying continuous time process.</li>
<li>We get an accurate accounting of disease-related deaths.</li>
<li>We can use whatever cycle length we need – this facilitates computationally intensive processes such as probabilistic sensitivity analyses, which may not be feasible with a short (e.g., daily) cycle length.</li>
<li>We also avoid “state explosion” in the event our model has tunnel states. For example, if there is a one-year tunnel state for costs or utilities following disease onset, if we switched to a monthly or daily cycle we’d have to build in dozens or more health states into our Markov model. Beacuse we can stick with a one-year cycle, this makes use of tunnel states much more feasible.</li>
</ol>
<p>The primary “cost” of using this approach over standard rate-to-probability conversion formulas is that we must be a bit more careful in structuring our transition probability matrix to include accumulators used to aggregate model outputs. We will cover this process in the section directly below.</p>
</section>
</section>
<section id="include-non-markovian-accumulators-to-record-event-transitions" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="include-non-markovian-accumulators-to-record-event-transitions">2. Include Non-Markovian Accumulators to Record Event Transitions</h2>
<p>We now have the correct transition probabilities to model the underlying continuous-time process, but how do we account for these compound transitions in our aggregation of model outputs?</p>
<p>Fundamentally, what we have now is a model that will correctly records the “true” number of deaths at the end of the cycle, because all the compound Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transitions are included in the Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Dead transition probability.</p>
<p>To track the total number of transitions to Sick, we must augment our transition probability matrix with non-Markovian accumulators. This accumulator shows up as a purple edge in our model diagram below:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 171.02 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>
G
</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 167.02,-184 167.02,4 -4,4"></polygon> <!-- Healthy --> <g id="node1" class="node">
<title>
Healthy
</title>
<ellipse fill="#81aede" stroke="black" cx="41.61" cy="-90" rx="41.71" ry="18"></ellipse> <text text-anchor="middle" x="41.61" y="-85.8" font-family="Times,serif" font-size="14.00">Healthy</text> </g> <!-- Healthy&#45;&gt;Healthy --> <g id="edge1" class="edge">
<title>
Healthy-&gt;Healthy
</title>
<path fill="none" stroke="#d9d0d0" d="M80.3,-96.74C92.04,-96.57 101.21,-94.32 101.21,-90 101.21,-87.03 96.88,-85.04 90.35,-84.03"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="90.54,-80.53 80.3,-83.26 90.01,-87.51 90.54,-80.53"></polygon> </g> <!-- Sick --> <g id="node2" class="node">
<title>
Sick
</title>
<ellipse fill="none" stroke="black" cx="113.61" cy="-162" rx="28.41" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-157.8" font-family="Times,serif" font-size="14.00">Sick</text> </g> <!-- Healthy&#45;&gt;Sick --> <g id="edge3" class="edge">
<title>
Healthy-&gt;Sick
</title>
<path fill="none" stroke="purple" stroke-width="3" stroke-dasharray="5,2" d="M58.31,-106.7C67.93,-116.33 80.17,-128.57 90.69,-139.09"></path> <polygon fill="purple" stroke="purple" stroke-width="3" points="88.44,-141.78 97.98,-146.38 93.39,-136.83 88.44,-141.78"></polygon> </g> <!-- Dead --> <g id="node3" class="node">
<title>
Dead
</title>
<ellipse fill="#81aede" stroke="black" cx="113.61" cy="-18" rx="31.32" ry="18"></ellipse> <text text-anchor="middle" x="113.61" y="-13.8" font-family="Times,serif" font-size="14.00">Dead</text> </g> <!-- Healthy&#45;&gt;Dead --> <g id="edge5" class="edge">
<title>
Healthy-&gt;Dead
</title>
<path fill="none" stroke="blue" stroke-width="3" d="M58.31,-73.3C67.93,-63.67 80.17,-51.43 90.69,-40.91"></path> <polygon fill="blue" stroke="blue" stroke-width="3" points="93.39,-43.17 97.98,-33.62 88.44,-38.22 93.39,-43.17"></polygon> </g> <!-- Sick&#45;&gt;Sick --> <g id="edge2" class="edge">
<title>
Sick-&gt;Sick
</title>
<path fill="none" stroke="#d9d0d0" d="M140.2,-168.71C150.86,-169.09 159.81,-166.85 159.81,-162 159.81,-158.82 155.96,-156.76 150.29,-155.83"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="150.37,-152.33 140.2,-155.29 150,-159.32 150.37,-152.33"></polygon> </g> <!-- Sick&#45;&gt;Dead --> <g id="edge4" class="edge">
<title>
Sick-&gt;Dead
</title>
<path fill="none" stroke="#d9d0d0" d="M113.61,-143.76C113.61,-119.2 113.61,-75.25 113.61,-46.35"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="117.11,-46.09 113.61,-36.09 110.11,-46.09 117.11,-46.09"></polygon> </g> <!-- Dead&#45;&gt;Dead --> <g id="edge6" class="edge">
<title>
Dead-&gt;Dead
</title>
<path fill="none" stroke="#d9d0d0" d="M143.03,-24.74C153.99,-24.96 163.02,-22.71 163.02,-18 163.02,-14.91 159.13,-12.88 153.36,-11.91"></path> <polygon fill="#d9d0d0" stroke="#d9d0d0" points="153.23,-8.4 143.03,-11.26 152.79,-15.38 153.23,-8.4"></polygon> </g> </g>
</svg>
</div>
</div>
</div>
</div>
<p>Fortunately, accumulators are easy to build in. We simply add the relevant transition rate in a new column in the transition rate matrix <code>Q</code>, <em>while leaving everything else the same.</em></p>
<p>Suppose we want to count up all the Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transitions in the model. To do this we simply add the appropriate transition rate (<img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D">) in as an accumulator column:</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Healthy</th>
<th>Sick</th>
<th>Dead</th>
<th>accHS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Healthy</td>
<td>-(<img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"> + <img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D">)</td>
<td><img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?r_%7BHD%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?r_%7BHS%7D"></td>
</tr>
<tr class="even">
<td>Sick</td>
<td>0</td>
<td>-(<img src="https://latex.codecogs.com/png.latex?hr_%7BS%7D%20%5Ccdot%20r_%7BHD%7D">)</td>
<td><img src="https://latex.codecogs.com/png.latex?hr_%7BS%7D%20%5Ccdot%20r_%7BHD%7D"></td>
<td>0</td>
</tr>
<tr class="odd">
<td>Dead</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>accHS</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>Note the following:</p>
<ul>
<li>An extra row of 0’s was added so that we balance the matrix, and ensure that we do not lose (or create!) anyone who becomes Sick.</li>
<li>We <strong>did not</strong> update the diagonal elements (i.e., the negative sum of transition rates); these stay the same as before.</li>
<li>If we wanted to add additional accumulators, we can just expand the matrix with more columns and rows as needed.</li>
</ul>
<p>Here is the augmented transition rate matrix for our example:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">Q_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(Q)</span>
<span id="cb23-2">Q_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Healthy"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accHS"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>r_HS</span>
<span id="cb23-3">Q_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accHS"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accHS"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb23-4">Q_[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Q_)] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb23-5">Q_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(Q_)</span>
<span id="cb23-6">Q_ </span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        Healthy  Sick  Dead accHS
Healthy  -0.156  0.15 0.006  0.15
Sick      0.000 -0.06 0.060  0.00
Dead      0.000  0.00 0.000  0.00
accHS     0.000  0.00 0.000  0.00</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>We next embed the transition probability matrix, as before:</p><div class="no-row-height column-margin column-container"><span class="">Notice that the accumulator (<code>accHS</code>) value is identical to the Healthy <i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i> Sick transition probability we obtained using the alternative rate-to-probability conversion formula that accounted for competing risks (e.g., see Figure&nbsp;10).</span></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">P_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(Q_)</span>
<span id="cb25-2">P_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Healthy      Sick        Dead     accHS
Healthy 0.8555592 0.1346958 0.009744961 0.1388854
Sick    0.0000000 0.9417645 0.058235466 0.0000000
Dead    0.0000000 0.0000000 1.000000000 0.0000000
accHS   0.0000000 0.0000000 0.000000000 1.0000000</code></pre>
</div>
</div>
<p>Using the accumulator we can accurately count up how many individuals transition to the Sick state over our time horizon:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">m_trace <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb27-2">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(horizon<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb27-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (P_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%^%</span>.x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>()))</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">m_trace[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames_to_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cycle"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb28-6">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>()</span></code></pre></div>
</details>
<div id="fig-state-2y-emb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
Healthy
</th>
<th style="text-align:right;">
Sick
</th>
<th style="text-align:right;">
Dead
</th>
<th style="text-align:right;">
accHS
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
731.98
</td>
<td style="text-align:right;">
242.09
</td>
<td style="text-align:right;">
25.93
</td>
<td style="text-align:right;">
257.71
</td>
</tr>
</tbody>

</table>
<figcaption class="figure-caption">Figure&nbsp;17: State Occupancy after Two Years</figcaption>
</figure>
</div>
</div>
<div class="page-columns page-full"><p>We see in Figure&nbsp;17 that after 2 years, 257.7 people (out of 1,000) have become sick, which is slightly less than the 259 who became sick after 2 years in our world without death as a competing risk. Moreover, we see that state occupancy in the <code>Sick</code> category is lower, at 242.1. This lower value reflects the fact some people had a compound transition <em>through</em> Sick and ended up dead in the same cycle. The difference (15.6) amounts to the total number of individual deaths we “hid” in the model when we used the incorrect rate-to-probability conversion formulas.</p><div class="no-row-height column-margin column-container"><span class="">This, of course, makes sense, since there are a small number of people who die before they could become ill once we add background mortality to the model</span></div></div>


</section>
</section>

 ]]></description>
  <guid>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/embedding/embedding-a-transition-probability-matrix.html</guid>
  <pubDate>Thu, 18 May 2023 18:55:37 GMT</pubDate>
</item>
<item>
  <title>Signs of Trouble</title>
  <link>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/signs-of-trouble/signs-of-trouble.html</link>
  <description><![CDATA[ 



<p>The objective of this blog post is to demonstrate how state occupancy will differ over different cycle lengths when using standard conversion formulas in the presence of competing risks. In the embedded version, however, changing the cycle length does not affect state occupancy estimates.</p>
<section id="parameterize" class="level1">
<h1>Parameterize</h1>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-1-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="annotated-cell-1-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"without_drug"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"with_drug"</span>),   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment names</span></span>
<span id="annotated-cell-1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_treatments =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of treatments</span></span>
<span id="annotated-cell-1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">s_names  =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># State names</span></span>
<span id="annotated-cell-1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_states =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of states</span></span>
<span id="annotated-cell-1-6">    </span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-7" class="code-annotation-target">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span>),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-8" class="code-annotation-target">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tunnel_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>),</span>
<span id="annotated-cell-1-9">    </span>
<span id="annotated-cell-1-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cohort =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort size</span></span>
<span id="annotated-cell-1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle length</span></span>
<span id="annotated-cell-1-12">    </span>
<span id="annotated-cell-1-13"></span>
<span id="annotated-cell-1-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Initial_age =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cohort starting age</span></span>
<span id="annotated-cell-1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">effect =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Treatment Effect (drug) </span></span>
<span id="annotated-cell-1-16">    </span>
<span id="annotated-cell-1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cAsymp =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of asympomatic state</span></span>
<span id="annotated-cell-1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDeath =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cost of death (progressive disease state only)</span></span>
<span id="annotated-cell-1-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDrug =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost of drug</span></span>
<span id="annotated-cell-1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cProg =</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cycle cost of progressive disease</span></span>
<span id="annotated-cell-1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uAsymp =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Asymptomatic state utility</span></span>
<span id="annotated-cell-1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">uProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Progressive disease state utility</span></span>
<span id="annotated-cell-1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">oDr =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Discount rate (QALYs)</span></span>
<span id="annotated-cell-1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cDr =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Discount rate (costs)</span></span>
<span id="annotated-cell-1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDcm =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Death from progressive disease trans prob</span></span>
<span id="annotated-cell-1-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpProg =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transition prob: progressive disease</span></span>
<span id="annotated-cell-1-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tpDn =</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Background mortality transition prob</span></span>
<span id="annotated-cell-1-28">)</span>
<span id="annotated-cell-1-29">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Yearly cycle</span></span>
<span id="annotated-cell-1-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modifyList</span>(params,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cycles =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="annotated-cell-1-31">params12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Monthly cycle</span></span>
<span id="annotated-cell-1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modifyList</span>(params, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cycles =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="annotated-cell-1-33">params365 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Daily cycle</span></span>
<span id="annotated-cell-1-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">modifyList</span>(params, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_cycles =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="1" data-code-lines="7">Accumulators</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-annotation="2" data-code-lines="8">Transition tracker</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="transition-probability-matrices" class="level1">
<h1>Transition Probability Matrices</h1>
<p>Our next objective is to define a function that constructs the time-dependent transition probability matrices.</p>
<section id="using-conversion-formulas" class="level2">
<h2 class="anchored" data-anchor-id="using-conversion-formulas">1. Using Conversion Formulas</h2>
<ol type="1">
<li>Convert each annual transition probability to a rate using <img src="https://latex.codecogs.com/png.latex?r%20=%20-ln(1%20-%20p)">.</li>
<li>Convert the rate to the model timestep using <img src="https://latex.codecogs.com/png.latex?1%20-%20exp(-rt)">, where <img src="https://latex.codecogs.com/png.latex?t"> is the timestep (e.g., <img src="https://latex.codecogs.com/png.latex?t%20=%20%5Cfrac%7B1%7D%7B12%7D"> for a monthly cycle)</li>
<li>Construct the transition probability matrix using the converted probabilities.</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">mPt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, params) {</span>
<span id="cb1-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(t, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tt){</span>
<span id="cb1-3">        </span>
<span id="cb1-4">        current_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Initial_age  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>  (tt)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb1-5"></span>
<span id="cb1-6">        tpDn_lookup <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-7">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(34,44]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0017</span>,</span>
<span id="cb1-8">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(44,54]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0044</span>,</span>
<span id="cb1-9">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(54,64]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0138</span>,</span>
<span id="cb1-10">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(64,74]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>,</span>
<span id="cb1-11">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(74,84]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0912</span>,</span>
<span id="cb1-12">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(84,100]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1958</span>)</span>
<span id="cb1-13">        </span>
<span id="cb1-14">        age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(current_age, </span>
<span id="cb1-15">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb1-16">        </span>
<span id="cb1-17">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb1-18">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpProg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (tt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle )</span>
<span id="cb1-19">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpDcm </span>
<span id="cb1-20">        </span>
<span id="cb1-21">        rDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn)</span>
<span id="cb1-22">        rProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpProg_)</span>
<span id="cb1-23">        rDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDcm_)</span>
<span id="cb1-24">        </span>
<span id="cb1-25">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rDn <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-26">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rProg_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-27">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rDcm_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb1-28">        </span>
<span id="cb1-29">        effect_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>effect</span>
<span id="cb1-30">        n_states_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states</span>
<span id="cb1-31">        s_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_names</span>
<span id="cb1-32">        t_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names</span>
<span id="cb1-33">        n_treatments_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_treatments</span>
<span id="cb1-34">        </span>
<span id="cb1-35">        mP_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-36">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-37">                           tpProg_, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-38">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,tpDcm_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-39">                           tpDn , tpDn, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-40">                           </span>
<span id="cb1-41">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-42">                           tpProg_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>effect_), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-43">                           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,tpDcm_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-44">                           tpDn, tpDn,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb1-45">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb1-46">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> s_names_,</span>
<span id="cb1-47">                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> s_names_,</span>
<span id="cb1-48">                                  t_names_))</span>
<span id="cb1-49">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Diagonal of transition probability matrix is 1 minus off-diagonal sum</span></span>
<span id="cb1-50">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb1-51">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-52">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(mP_[,,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb1-53">        </span>
<span id="cb1-54">        mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This turns the named array into a simpler list object</span></span>
<span id="cb1-55">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mP_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb1-56"></span>
<span id="cb1-57">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(mP)</span>
<span id="cb1-58">    })</span>
<span id="cb1-59">}</span></code></pre></div>
</details>
</div>
</section>
<section id="using-transition-rate-matrix-embedding" class="level2">
<h2 class="anchored" data-anchor-id="using-transition-rate-matrix-embedding">2. Using Transition Rate Matrix Embedding</h2>
<ol type="1">
<li>Convert each annual transition probability to a rate using <img src="https://latex.codecogs.com/png.latex?r%20=%20-ln(1%20-%20p)">.</li>
<li>Use these rates to fill out the Markovian transition rate matrix <code>mR</code>
<ul>
<li>Diagonal of <code>mR</code> is the negative row sum of off-diagonal elements.</li>
</ul></li>
<li>Augment the transition rate matrix with non-Markovian accumulators and transition/tunnel states.</li>
<li>Embed the transition rate matrix into the time step using <img src="https://latex.codecogs.com/png.latex?mP%20=%20exp(mR*t)">, where <img src="https://latex.codecogs.com/png.latex?t"> is the timestep (e.g., <img src="https://latex.codecogs.com/png.latex?t%20=%20%5Cfrac%7B1%7D%7B12%7D"> for a monthly cycle).</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">mPt_embedded <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t,params) {</span>
<span id="cb2-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(t, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tt){</span>
<span id="cb2-3">        </span>
<span id="cb2-4">        current_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Initial_age  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (tt)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-5">        cycle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> tt</span>
<span id="cb2-6">        cycle_years <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ceiling</span>(tt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle)</span>
<span id="cb2-7">            </span>
<span id="cb2-8">        tpDn_lookup <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(34,44]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0017</span>,</span>
<span id="cb2-10">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(44,54]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0044</span>,</span>
<span id="cb2-11">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(54,64]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0138</span>,</span>
<span id="cb2-12">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(64,74]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0379</span>,</span>
<span id="cb2-13">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(74,84]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0912</span>,</span>
<span id="cb2-14">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(84,100]"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1958</span>)</span>
<span id="cb2-15">        </span>
<span id="cb2-16">        age_grp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(current_age, </span>
<span id="cb2-17">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">74</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb2-18">        tpDn <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tpDn_lookup[age_grp]</span>
<span id="cb2-19">        </span>
<span id="cb2-20">        tpProg_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpProg <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (cycle_years)</span>
<span id="cb2-21">        tpDcm_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tpDcm </span>
<span id="cb2-22">        effect_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>effect</span>
<span id="cb2-23">        n_states_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states</span>
<span id="cb2-24">        s_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_names</span>
<span id="cb2-25">        t_names_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names</span>
<span id="cb2-26">        n_treatments_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_treatments</span>
<span id="cb2-27">        </span>
<span id="cb2-28">        mR_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-29">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">array</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-30">                                   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpProg_), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-31">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpDcm_),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-32">                           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-33">                           </span>
<span id="cb2-34">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-35">                                   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(tpProg_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>effect_))), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-36">                                   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>tpDcm_),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-37">                           <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tpDn),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb2-38">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(n_states_, n_states_, n_treatments_),</span>
<span id="cb2-39">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> s_names_,</span>
<span id="cb2-40">                                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> s_names_,</span>
<span id="cb2-41">                                          t_names_))</span>
<span id="cb2-42"></span>
<span id="cb2-43">        mR_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mR_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb2-44">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rowSums</span>(x)</span>
<span id="cb2-45">            x</span>
<span id="cb2-46">        },<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simplify=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb2-47">        </span>
<span id="cb2-48">        <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############################</span></span>
<span id="cb2-49">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add Non-Markovian Components</span></span>
<span id="cb2-50">        <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">###############################</span></span>
<span id="cb2-51">        </span>
<span id="cb2-52">        mR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mR_,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb2-53">            r_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(x)</span>
<span id="cb2-54">            add_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names)   <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-55">            </span>
<span id="cb2-56">            new_row_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x), params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)</span>
<span id="cb2-57">            new_col_names <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x), params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>tunnel_names,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)</span>
<span id="cb2-58">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expand matrix</span></span>
<span id="cb2-59">            x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(x,  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, r_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> add_), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>r_))</span>
<span id="cb2-60">            x  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, add_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (r_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>add_)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span>add_))</span>
<span id="cb2-61">            </span>
<span id="cb2-62">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_row_names</span>
<span id="cb2-63">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> new_col_names</span>
<span id="cb2-64">            </span>
<span id="cb2-65">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>]</span>
<span id="cb2-66">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>]</span>
<span id="cb2-67">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span>] </span>
<span id="cb2-68">            x</span>
<span id="cb2-69">        })</span>
<span id="cb2-70">        </span>
<span id="cb2-71">        mP_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embed the transition probability matrix</span></span>
<span id="cb2-72">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mR,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expm</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="cb2-73">                </span>
<span id="cb2-74">        mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(mP_,<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb2-75">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Don't allow the transition columns to remain...</span></span>
<span id="cb2-76">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-77">            x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-78">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The receiving bucket was required for embedding, but is no longer needed</span></span>
<span id="cb2-79">            x[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rownames</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>),<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XX"</span>)]    </span>
<span id="cb2-80">        }) </span>
<span id="cb2-81">        </span>
<span id="cb2-82">        </span>
<span id="cb2-83">    })</span>
<span id="cb2-84">}</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-a-cohort-of-1000-individuals" class="level1 page-columns page-full">
<h1>Simulate a Cohort of 1,000 Individuals</h1>
<ul>
<li>Construct a Markov trace and plot state occupancy over the simulation time horizon.</li>
<li>Note that with different cycle lengths, the traditional approach yields different state occupancies!</li>
</ul>
<section id="using-conversion-formulas-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-conversion-formulas-1">1. Using Conversion Formulas</h2>
<div class="cell page-columns page-full" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-4" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-4-1">sim_cohort <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="annotated-cell-4-2">    </span>
<span id="annotated-cell-4-3">    mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mPt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>),params)</span>
<span id="annotated-cell-4-4">    </span>
<span id="annotated-cell-4-5">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-4-6">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-4-8">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asympt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-4-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-4-10">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-4-11">            }))</span>
<span id="annotated-cell-4-12">        }))</span>
<span id="annotated-cell-4-13">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  </span>
<span id="annotated-cell-4-14">        tr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-15">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-4-16">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),.x)</span>
<span id="annotated-cell-4-17">        }))</span>
<span id="annotated-cell-4-18">    </span>
<span id="annotated-cell-4-19">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-4-20">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-21">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-4-22">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-4-23">            arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_))</span>
<span id="annotated-cell-4-24">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-4-25">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-4-26">                arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-4-27">                arr_</span>
<span id="annotated-cell-4-28">            }))</span>
<span id="annotated-cell-4-29">        }))</span>
<span id="annotated-cell-4-30">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-4-31">        arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-32">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-4-33">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)),.x)</span>
<span id="annotated-cell-4-34">        }))</span>
<span id="annotated-cell-4-35">    </span>
<span id="annotated-cell-4-36">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-4-37">        .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-38">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-39">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-40">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="annotated-cell-4-41">    }))</span>
<span id="annotated-cell-4-42">    </span>
<span id="annotated-cell-4-43">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> tr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">array =</span> arr))</span>
<span id="annotated-cell-4-44">}</span>
<span id="annotated-cell-4-45"></span>
<span id="annotated-cell-4-46">markov_result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-4-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort</span>(params)</span>
<span id="annotated-cell-4-48">markov_result12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-4-49">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort</span>(params12)</span>
<span id="annotated-cell-4-50">markov_result365 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-4-51">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort</span>(params365)</span>
<span id="annotated-cell-4-52"></span>
<span id="annotated-cell-4-53">markov_result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-54">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-55">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-56">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-57">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-58">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-59">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="annotated-cell-4-60">        markov_result12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-61">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-62">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-63">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-64">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-65">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="annotated-cell-4-66">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-67">     <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="annotated-cell-4-68">        markov_result365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-69">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-70">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-71">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-72">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-73">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="annotated-cell-4-74">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="annotated-cell-4-75">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(cycle_length)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Month"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-76">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(state,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>strategy,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cycle,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cycle_length) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-4-77">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cycle, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> state ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span>cycle_length)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-4-78">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-4-79">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>strategy) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-4-80">    hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-4-81">    ggsci<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_aaas</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-4-82">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-4-83">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> state)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-4-84">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> state))</span></code></pre></div>
</details>
<div class="cell-output-display column-page">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/signs-of-trouble/signs-of-trouble_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>As the figure shows, state occupancy differs across the various cycle lengths.</p>
</section>
<section id="using-embedding" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="using-embedding">2. Using Embedding</h2>
<div class="cell page-columns page-full" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-5" style="background: #f1f3f5;"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-5-1">sim_cohort_emb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(params) {</span>
<span id="annotated-cell-5-2">    </span>
<span id="annotated-cell-5-3">    mP <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mPt_embedded</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>),params)</span>
<span id="annotated-cell-5-4">    </span>
<span id="annotated-cell-5-5">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-5-6">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-7">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-5-8">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="annotated-cell-5-9">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-5-10">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-5-11">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-5-12">            }))</span>
<span id="annotated-cell-5-13">        }))</span>
<span id="annotated-cell-5-14">    tr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  </span>
<span id="annotated-cell-5-15">        tr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-16">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-5-17">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))),.x)</span>
<span id="annotated-cell-5-18">        }))</span>
<span id="annotated-cell-5-19">    </span>
<span id="annotated-cell-5-20">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-5-21">        mP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transpose</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-22">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-5-23">            tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Asymptomatic_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive_disease"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dead"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="annotated-cell-5-24">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trProgressive"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trDeadCause"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="annotated-cell-5-25">            arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_))</span>
<span id="annotated-cell-5-26">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(rbind,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(.x, <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(tp) {</span>
<span id="annotated-cell-5-27">                tr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> tr_ <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-5-28">                arr_ <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(tr_)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> tp</span>
<span id="annotated-cell-5-29">                arr_</span>
<span id="annotated-cell-5-30">            }))</span>
<span id="annotated-cell-5-31">        }))</span>
<span id="annotated-cell-5-32">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="annotated-cell-5-33">        arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-34">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-5-35">            .x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cohort,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))),.x)</span>
<span id="annotated-cell-5-36">        }))</span>
<span id="annotated-cell-5-37">    </span>
<span id="annotated-cell-5-38">   </span>
<span id="annotated-cell-5-39">    arr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> arr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>({</span>
<span id="annotated-cell-5-40">        .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-41">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_cycles,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>n_states<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>a_names,params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t_names))))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-42">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-43">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="annotated-cell-5-44">    }))</span>
<span id="annotated-cell-5-45">    </span>
<span id="annotated-cell-5-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> tr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">array =</span> arr))</span>
<span id="annotated-cell-5-47">}</span>
<span id="annotated-cell-5-48"></span>
<span id="annotated-cell-5-49">markov_result_emb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-5-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort_emb</span>(params)</span>
<span id="annotated-cell-5-51">markov_result_emb12 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-5-52">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort_emb</span>(params12)</span>
<span id="annotated-cell-5-53">markov_result_emb365 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="annotated-cell-5-54">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_cohort_emb</span>(params365)</span>
<span id="annotated-cell-5-55"></span>
<span id="annotated-cell-5-56">markov_result_emb<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-57">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-58">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-59">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-60">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-61">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-62">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="annotated-cell-5-63">        markov_result_emb12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-64">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-65">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-66">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-67">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-68">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="annotated-cell-5-69">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-70">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="annotated-cell-5-71">        markov_result_emb365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>trace <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-72">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(.x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-73">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">row_number</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-74">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"strategy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-75">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle =</span> cycle <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> params365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-76">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(params365<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cycle))</span>
<span id="annotated-cell-5-77">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span>   </span>
<span id="annotated-cell-5-78">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>),<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acc"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-79">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cycle_length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(cycle_length)),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Day"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Month"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-80">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gather</span>(state,value,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>strategy,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cycle,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cycle_length) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="annotated-cell-5-81">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> cycle, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> state ,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span>cycle_length)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-5-82">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-5-83">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>strategy) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-5-84">    hrbrthemes<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arial"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-5-85">    ggsci<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_aaas</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="annotated-cell-5-86">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-5-87">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> state)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="annotated-cell-5-88">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dl</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first.bumpup"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> state))</span></code></pre></div>
</details>
<div class="cell-output-display column-page">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/SMDM-Europe-2023/blog/posts/signs-of-trouble/signs-of-trouble_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The figure clearly shows that changing the cycle length does not affect the state occupancy estimates.</p>


</section>
</section>

 ]]></description>
  <guid>https://graveja0.github.io/SMDM-Europe-2023/blog/posts/signs-of-trouble/signs-of-trouble.html</guid>
  <pubDate>Thu, 18 May 2023 18:55:37 GMT</pubDate>
</item>
</channel>
</rss>
