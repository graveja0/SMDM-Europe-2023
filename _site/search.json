[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "What They Didn’t Teach You About Decision Modeling",
    "section": "",
    "text": "Workshop Schedule\n\n\nStart\nEnd\nTopic\nApplied Case Study\n\n\n\n\n9:00am\n9:20am\nIntroductions and Welcome\n\n\n\n9:20am\n10:30 am\nCause-Specific and Cause-Deleted Mortality\n\nMortality modeling in R\nConstructing an Alive-Dead model\n\n\n\n10:30am\n11:00am\nBREAK\n\n\n\n11:00am\n12:30pm\nEmbedding and Competing Events\n\nNatural History Cardiovascular Disease Model\n\n\n\n12:30pm\n2:00pm\nLUNCH BREAK\n\n\n\n2:00pm\n3:30pm\nAdvanced Bookkeeping: Incorporating Non-Markovian Accumulators and Transition States\n\nAdvanced replication of Green et. al (2023) model.\n\n\n\n3:30pm\n4:00pm\nBREAK\n\n\n\n4:00pm\n5:30pm\nIncorporating New Evidence\n\nExpand Green et. al (2023) model"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "roster.html",
    "href": "roster.html",
    "title": "Instructors, Facilitators and Participants",
    "section": "",
    "text": "Instructors\n\nShawn Garbett (Vanderbilt University Medical Center)\n\n\n\n\n\nShawn Garbett, MS is faculty at Vanderbilt University Medical Center, where he holds an appointment in the Department of Biostatistics. Mr. Garbett is the director for informatics software development.\nGarbett has a diverse career background starting as an engineer for the Tennessee Valley Authority doing load grid optimization and data collection and modeling of the reservoir system. He worked as a consultant for many years, designing high confidence medical and nuclear software systems. He designed the first FDA approved closed loop medical device for Walter Reed with installations in Air Force One.\nHis research career began when he joined Vanderbilt in 2009. He began working with the department of Health Policy at Vanderbilt in 2016 and has participated in research on two publications which got listed in the top 10 papers in genomics. He has coauthored a book chapter on pharmacogenomics.\n\n\nJohn Graves (Vanderbilt University)\n\n\n\n\n\nJohn Graves, Ph.D. is Associate Professor at Vanderbilt University School of Medicine, where he holds appointments in the Department of Health Policy and the Department of Medicine. Dr. Graves directs the Center for Health Economic Modeling at Vanderbilt University Medical Center, and is a faculty affiliate of the Vanderbilt Institute for Global Health (VIGH) and the Vanderbilt Ingram Cancer Center.\nGraves’ career spans nearly 20 years conducting interdisciplinary research at the intersection of health economics and health care policy. The focus of his work is on the use of econometric and decision analytic methodologies to inform the development, implementation and evaluation of health care reforms at the state and federal level. His research contributions include modeling efforts that informed both the 2006 Massachusetts health reform legislation and the 2010 Affordable Care Act, for which he served as lead modeler for the White House Office of Health Reform.\nSince joining Vanderbilt in 2011, Graves has led and published research projects on novel methods for identifying provider shortages, on the returns to hospital spending and quality, and on the value of genetic screening in diverse health system populations. He currently leads two large federally-funded research grants on the health effects of insurance coverage expansion among safety net patients in the South, and on the implications of provider network design for access and competition in health insurance markets.\nGraves earned his BA in Economics and English from The University of the South in Sewanee, Tennessee. He holds a Ph.D. in Health Policy from Harvard University and is the recipient of fellowships and awards from the Agency for Health Care Research and Quality, the National Institute on Aging, the National Bureau of Economic Research, the American Statistical Association, and the National Academy of Social Insurance. He has taught and consulted for the Master’s in Public Administration in International Development at the Harvard Kennedy School, and is an affiliate of the Abdul Latif Jameel Poverty Action Lab at MIT.\n\n\n\nCourse Development\n\nJinyi Zhu (Vanderbilt University)\n\n\n\n\n\nJinyi Zhu is an Assistant Professor in the Department of Health Policy. Her research focuses on applications and methods to inform decision-making for resource allocation in public health and health care. Specifically, her research falls into three main areas: 1) resource prioritization for the prevention and treatment of cardiovascular disease, 2) applied model-based cost-effectiveness analysis in other clinical areas including TB and HIV, and 3) methodological advances in disease simulation modeling (e.g., model calibration and validation).\nDr. Zhu received a Ph.D. in Health Policy from Harvard University. She also holds an MPH from Yale University and a BS in Biology and BA in economics from Peking University.\n\n\nHanxuan Yu (Vanderbilt University Medical Center)\n\n\n\n\n\nHanxuan (Astrid) Yu is a Health Policy Data Analyst in the Department of Health Policy at Vanderbilt University. Working with Dr. Ashley Leech, Prof. John Graves, and Dr. Jinyi Zhu, she applies a range of analytical methods, including discrete event simulation, microsimulation, and Markov model, to address practical questions and support decision-making in the public health field. She also focuses on methodological advances to enhance the accuracy, speed and quality of decision analysis. Her ongoing projects include: 1) applying model-based cost-effectiveness analysis in the healthcare for pregnant women with opioid use disorder and global health questions like childhood epilepsy patients in Nigeria, 2) evaluating the clinical value and application method of polygenic risk scores for atherosclerotic cardiovascular disease based on cost-effectiveness techniques, 3) developing methodology implementations like common random numbers in specific disease simulation models.\n\n\nAshley Leech (Vanderbilt University)\n\n\n\n\n\nAshley Leech is an Assistant Professor in the Department of Health Policy at the Vanderbilt University School of Medicine. Dr. Leech’s research combines health services research and health economic methods to answer questions related to healthcare access, delivery, resource allocation, and use, and outcomes for reproductive-age women and their children. She is the Principal Investigator of an NIH/NIDA-funded career development award on Advancing Treatment Outcomes for Pregnant Women with Opioid Use Disorder where she is using decision science methodology to promote the coverage and adoption of high-value healthcare for pregnant women with opioid use disorder, a population that disproportionately faces major impediments to care.\nDr. Leech completed her post-doctoral training in Health Economics at the Center for the Evaluation of Value and Risk in Health (CEVR) at Tufts University School of Medicine where she focused on decision science methodology and received her Ph.D. in Health Services Research at Boston University School of Public Health."
  },
  {
    "objectID": "blog/posts/embedding-a-transition-probability-matrix.html",
    "href": "blog/posts/embedding-a-transition-probability-matrix.html",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "",
    "text": "Define \\(r_{HS}\\) and \\(r_{HD}\\) as the hazard rate of two independent competing risks from a given (Healthy) health state (to Sick and Dead, respectively), and \\(\\Delta t\\) the cycle length (e.g., \\(1\\)=1 year, \\(1/12\\)=1 month, etc.). We can also define a third rate \\(r_{SD} = hr_{S}*r_{HD}\\) for transitioning from sick to dead, i.e., the standard (healthy-to-dead) rate multiplied by the hazard ratio \\(hr_{S}\\).\nThe underlying Markov model takes the following form:\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD   \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n  hr_S * r_HD   \n\nDead-&gt;Dead\n\n   \n\n\nFigure 1: Model Diagram\n\n\n\n\n\n\n\nCode\nlibrary(Matrix)\nlibrary(tidyverse)\nlibrary(expm)\nlibrary(knitr)\nlibrary(gt)\nlibrary(directlabels)\nlibrary(glue)\nlibrary(ggsci)\nlibrary(ggthemes)\n\n# Better accuracy that \"life-table\" aka trapezoidal method\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\nalt_simp      &lt;- function(x,h) h*sum(alt_simp_coef(length(x)) * x)\n\nr_HS &lt;- 0.15\nr_HD &lt;- .006\nhr_S &lt;- 10\nr_SD &lt;- hr_S*r_HD\ncycle &lt;- 1\n\n# 1-exp(-r_HS*cycle)\n# 1-exp(-r_HD*cycle)\n\nget_P &lt;- function(r_HS,r_HD,r_SD,cycle) {\n  P_st &lt;- \n  matrix(\n  c(exp(-r_HS*cycle) + exp(-r_HD*cycle) -1 ,  (1-exp(-r_HS*cycle)) ,  1-exp(-r_HD*cycle), \n  0, exp(-r_SD*cycle), 1-exp(-r_SD*cycle),\n  0,0,1),\n  nrow = 3, \n  ncol = 3,\n  byrow=TRUE,\n  dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% \n    mutate(name = \"P_st\")\n\n  P_eQ &lt;- matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% expm() %&gt;% as.matrix() %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% \n    mutate(name = \"P_eQ\")\n\n\n  P_cr &lt;- \n    matrix(\n    c(exp(-(r_HS+r_HD)*cycle) , (r_HS/(r_HS+r_HD)) * (1-exp(-(r_HS+r_HD)*cycle))   ,(r_HD/(r_HS+r_HD)) * (1-exp(-(r_HS+r_HD)*cycle))   , \n    0, exp(-r_SD*cycle), 1-exp(-r_SD*cycle),\n    0,0,1),\n    nrow = 3, \n    ncol = 3,\n    byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% mutate(name = \"P_cr\")\n  \n  \n  \n  out &lt;- bind_rows( P_st, P_cr , P_eQ)\n  return(out)\n}\n\n\n\n\nCode\ncheck_sens &lt;- function(r_HD,r_HS,r_SD,cycle) {\n  \nQ &lt;- matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) \n\n# Q_ &lt;- rbind(cbind(Q,c(r_HS*cycle,0,0)),c(0,0,0,0)) \n# Q_ &lt;- rbind(cbind(Q_,c(r_HD*cycle,0,0,0)),c(0,0,0,0,0))\n# dimnames(Q_) = list(c(\"Healthy\",\"Sick\",\"Dead\",\"accS\",\"accHD\"),\n#                    c(\"Healthy\",\"Sick\",\"Dead\",\"accS\",\"accHD\"))\n\nQ_ &lt;- Q\n\nP &lt;- Q_ %&gt;% expm() %&gt;% as.matrix() \nres &lt;- get_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle)\n\nP_cr &lt;- res %&gt;% filter(name==\"P_cr\") %&gt;% select(from,Healthy,Sick,Dead) %&gt;% \n  data.frame() %&gt;% \n  column_to_rownames(var = \"from\") %&gt;% \n  as.matrix()\n\nP_st &lt;- res %&gt;% filter(name==\"P_st\") %&gt;% select(from,Healthy,Sick,Dead) %&gt;% \n  data.frame() %&gt;% \n  column_to_rownames(var = \"from\") %&gt;% \n  as.matrix()\n\nle1 &lt;- \n  0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n  as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n\nres1 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le1) %&gt;% \n  mutate(method = \"P_eQ\") \n\nle2 &lt;- \n  0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P_cr[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n   as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n  \nres2 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P_cr %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le2) %&gt;% \n  mutate(method = \"P_cr\")\n\n\nle3 &lt;- \n 0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P_st[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n   as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n\nres3 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P_st %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le3) %&gt;% \n  mutate(method = \"P_st\")\n  \n  out &lt;- res1 %&gt;% bind_rows(res2) %&gt;% bind_rows(res3)\n  return(out)\n\n}"
  },
  {
    "objectID": "blog/posts/embedding-a-transition-probability-matrix.html#standard-rate-to-transition-conversion",
    "href": "blog/posts/embedding-a-transition-probability-matrix.html#standard-rate-to-transition-conversion",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "Standard Rate-to-Transition Conversion",
    "text": "Standard Rate-to-Transition Conversion\nLet’s first convert the supplied rates to probabilities using the same standard formulas, as above:\n\\[\np_{HS}= 1 - e^{-r_{HS}\\cdot \\Delta t}\n\\]\n\\[\np_{HD} = 1 - e^{-r_{HD}\\cdot \\Delta t}\n\\]\nWe can also define the probability of remaining healthy (i.e., transitioning to neither the sick or dead state) as:\n\\[\np_{HH} = 1 - p_{HS} - p_{HD}= e^{-r_{HS}\\Delta t}  + e^{-r_{HD}\\Delta t} - 1\n\\]\nAnd finally the probability of dying among sick people is defined as\n\\[\np_{SD} = 1 - e^{-hr_{HD}\\cdot r_{HD}\\cdot \\Delta t}\n\\]\nFigure 6 shows the corresponding transition probability matrix:\n\n\nCode\nr_HD &lt;- 0.006\nr_SD &lt;- 10*0.006\n\nget_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle) %&gt;% \nfilter(name==\"P_st\") %&gt;% \nselect(-name) %&gt;% \n#column_to_rownames(\"from\") %&gt;% \nmutate_at(vars(-from), ~round(.,4)) %&gt;% \ngt() %&gt;% \n  cols_label(\"from\"=\"\")\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n0.8547\n0.1393\n0.0060\n\n\nSick\n0.0000\n0.9418\n0.0582\n\n\nDead\n0.0000\n0.0000\n1.0000\n\n\n\n\n\nFigure 6: Transition Probability Matrix Using Standard Rate-to-Probability Conversion Formulas\n\n\n\nGiven this transition probability matrix, how many healthy, sick and dead individuals do we have in our cohort after a 60-year time horizon? Figure 7 summarizes state occupancy at the end of 60 years:\n\n\nCode\nres_60yst &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD, cycle=1) %&gt;% \n  filter(method==\"P_st\") \nres_60yst %&gt;% \n  select(cycle,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n60\n0.1\n43.6\n956.3\n22.1\n\n\n\n\n\nFigure 7: 1-Year Cycle\n\n\n\nAs Figure 7 shows, after 60 years, 43.6 are recorded as being in the sick state and life expectancy has reduced to 22.1 years.\nAs above, let’s now repeat the same exercise using a daily cycle length:\n\n\nCode\nres_60yst_daily &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD,cycle=1/365) %&gt;% \n  filter(method==\"P_st\") \n\nres_60yst_daily %&gt;% \n  select(cycle,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n21900\n0.1\n42.6\n957.4\n21.7\n\n\n\n\n\nFigure 8: Daily Cycle\n\n\n\nBy switching to a daily cycle we now have 42.6 recorded as being in the sick state after 60 years (=21,900 days) and life expectancy is 21.7 years.\n\nSigns of Trouble\nLet’s recap what we have found after introducing background mortality as a competing risk:\n\nUsing a 1-year cycle length, life expectancy is 22.11 years.\nUsing a daily cycle length, life expectancy is 21.73 years.\n\nThe only difference above is the cycle length used, yet we obtain a 0.38 year difference in life expectancy. What causes this difference?\n\n\nDiscretizing a Continuous Time Process\nThe answer boils down to the fact that with longer cycle lengths we “hide” some deaths that occur because a full healthy sick dead transition occurs within a single cycle.\nWhen we use the standard rate-to-probability conversion formula (i.e., \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\)) we obtain the marginal probability of transition. This marginal probability reflects the union of all possible transitions that start Healthy and then transition to and from the sick state in the cycle.\nThat is, \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\) captures the probability of following scenarios occurring in a cycle:\n\nIndividual transitions from healthy to sick.\nIndividual transitions from healthy to sick to dead.\n\nBy including case 2 in the healthy sick transition probability, we effectively rule out the possibility of becoming sick and dying within the same cycle. This implicit assumption means that we are no longer modeling a continuous time process, since we effectively “hide” some (quick) deaths that occur within a cycle due to the disease:\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n    \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n    \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n    \n\nDead-&gt;Dead\n\n   \n\n\nFigure 9: compound Transition Patterns Using Standard Rate to Probability Conversion Formulas\n\n\n\n\nIn Figure 9, and using standard rate-to-probability conversion formulas, the recorded states of a healthy sick dead transition are recorded in blue; the “hidden” transition is shown in red.\n\nAlternative Rate-to-Probability Conversion\nAnother set of formulas often used to account for competing risks are as follows:\n\\[\np_{HS}= \\frac{r_{HS}}{r_{HS}+r_{HD}}\\big ( 1 - e^{-(r_{HS}+r_{HD})\\Delta t}\\big )\n\\]\n\\[\np_{HD}= \\frac{r_{HD}}{r_{HS}+r_{HD}}\\big ( 1 - e^{-(r_{HS}+r_{HD})\\Delta t}\\big )\n\\]\n\\[\np_{HH} = e^{-(r_{HS}+r_{HD})\\Delta t}\n\\]\nLet’s now use these formulas instead.\nFigure 10 shows the corresponding transition probability matrix:\n\n\nCode\nr_HD &lt;- 0.006\nr_SD &lt;- 10*0.006\n\nget_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle) %&gt;% \nfilter(name==\"P_cr\") %&gt;% \nselect(-name) %&gt;% \n#column_to_rownames(\"from\") %&gt;% \nmutate_at(vars(-from), ~round(.,4)) %&gt;% \ngt() %&gt;% \n  cols_label(\"from\"=\"\")\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n0.8556\n0.1389\n0.0056\n\n\nSick\n0.0000\n0.9418\n0.0582\n\n\nDead\n0.0000\n0.0000\n1.0000\n\n\n\n\n\nFigure 10: Transition Probability Matrix Using Alternative Rate-to-Probability Conversion Formulas\n\n\n\nComparing Figure 6 and Figure 10, notice that a few things have changed. First, the probability of Healthy Sick transition declined. This would seem to be consistent with a world in which there are fewer alive sick individuals observed at the end of the cycle–which we would expect if acute illness results in a nontrivial number of quick deaths after illness onset in a cycle.\nHowever, look at the Healthy Dead transition probability change; it went down, too. If we were recording more acute deaths from the disease, we should see more Healthy Dead transitions from individuals sojourning through the Sick state on their way to death in a single cycle.\nWhat about state occupancy and life expectancy under different cycle lengths?\n\n\nCode\nres_60yst_cr &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD, cycle=1) %&gt;% \n  filter(method==\"P_cr\") %&gt;% \n  mutate(cycle = \"1y\") %&gt;% \n  mutate(cycle_t = 60)\n\nres_60yst_daily_cr &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD,cycle=1/365) %&gt;% \n  filter(method==\"P_cr\") %&gt;% \n  mutate(cycle_t = cycle) %&gt;% \n  mutate(cycle = \"Daily\")\n\nres_60yst_cr %&gt;% \n  bind_rows(res_60yst_daily_cr) %&gt;% \n  select(cycle,cycle_t,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\ncycle_t\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n1y\n60\n0.1\n43.9\n956.0\n22.2\n\n\nDaily\n21900\n0.1\n42.6\n957.4\n21.7\n\n\n\n\n\nFigure 11: 1-Year vs. Daily Cycle\n\n\n\nCode\ndiff_st_cr &lt;- \n  res_60yst_cr %&gt;% \n    bind_rows(res_60yst_daily_cr) %&gt;% mutate(life_exp = life_exp-lead(life_exp)) %&gt;% pull(life_exp) %&gt;% na.omit() %&gt;% as.vector()\n\n\nAgain, we have a difference in life expectancy of 0.462 years. So switching to the alternative formulas has not fundamentally solved our problem.\n\n\nHow do transition probabilities change as the Likelihood of Disease-related death varies?\nAnother way to see the issue is to plot how the transition probabilities change (or not) at different levels of disease acuity. Figure 12 plots the relevant transition probabilities under a yearly time cycle, and while allowing the underlying hazard rate of death from the disease (hr_S) to vary.\nAs the hazard rate increases, the likelihood of ending up dead within a given cycle increases. Indeed, in the most extreme case, imagine the disease has a near instantaneous death rate. In that case we should see almost no Healthy Sick transitions within a yearly cycle, because nearly everyone who became sick within the cycle died within 1 day.\nWe see in Figure 12 that the Healthy Sick probabilities remain flat for transitions under which background mortality is a competing event. However, the Sick Dead transition probabilities rise as the likelihood of fatal disease increases.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n    filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n  scale_shape_manual(values = c(19,17)) +\n  scale_color_manual(values= c(\"blue\",\"red\")) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 12: Yearly Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)\n\n\n\n\nIt is common practice to address these issues using the following guidelines:\n\nSelect a cycle length where the probability of remaining in a given state is at least 95%.\nPick a cycle length that aligns with the clinical/disease timelines of the decision problem.\n\nTreatment schedules.\nAcute vs. chronic condition.\n\n\nBut do these actually solve the issue? No. Figure 13 shows how the transition probabilities change when we switch to a daily cycle length. Again, we see the problem: as disease acuity increases, the probability of a Healthy Dead transition does not change; even though we shortened the cycle length, we have not fundamentally addressed the issue.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1/365) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n  filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n    scale_shape_manual(values = c(19,17)) +\n  scale_color_manual(values= c(\"blue\",\"red\")) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 13: Daily Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)\n\n\n\n\nHow does this all translate into model outputs, such as life expectancy? Figure 14 plots life-expectancy (y-axis) against the underlying disease hazard rate for death. Each line provides the life-expectancy curve under a different cycle length, with everything else in the model held fixed.\nNot surprisingly, we see that as the likelihood of fatal disease increases, life expectancy declines.\nBut the most important takeaway is that the modeled life expectancy differs depending on the cycle length used. For a given hazard rate the underlying disease process is exactly the same – but we get different answers depending on our cycle length.\nThe pattern of results is instructive, too. Essentially, with longer cycle lengths and incorrect transition probabilities, we will “miss” more compound within-cycle Healthy Sick Dead transitions and instead record them as Healthy Sick transitions. This has a net effect of “hiding” more disease-related death in our model – and life-expectancy is inflated as a result.\n\n\n\n\n\nFigure 14: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length. The left panel uses the formula that accounts for competing risks. The right panel uses standard conversion formula."
  },
  {
    "objectID": "blog/posts/embedding-a-transition-probability-matrix.html#embed-the-transition-probability-matrix",
    "href": "blog/posts/embedding-a-transition-probability-matrix.html#embed-the-transition-probability-matrix",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "1. Embed the Transition Probability Matrix",
    "text": "1. Embed the Transition Probability Matrix\nOur rate matrix Q is constructed by including the relevant transition rates in the off-diagonal cells. The diagonal of Q is the negative sum of off-diagonal elements in the same row:\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n-(\\(r_{HS}\\) + \\(r_{HD}\\))\n\\(r_{HS}\\)\n\\(r_{HD}\\)\n\n\nSick\n0\n-(\\(hr_{S} \\cdot r_{HD}\\))\n\\(hr_{S} \\cdot r_{HD}\\)\n\n\nDead\n0\n0\n0\n\n\n\nHere is the rate matrix for the Healthy-Sick-Dead model:\n\n\nCode\nparams &lt;- \n  list(r_HS = 0.15,\n       r_HD = 0.006,\n       hr_S = 10,\n       cycle = 1)\n\nQ &lt;- \n  with(params,{\n    matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) \n  })\nQ\n\n\n        Healthy  Sick  Dead\nHealthy  -0.156  0.15 0.006\nSick      0.000 -0.06 0.060\nDead      0.000  0.00 0.000\n\n\nWe next embed the transition probability matrix P by taking the matrix exponential of Q:\n\nlibrary(expm)\nP &lt;- expm(Q)\nP\n\n          Healthy      Sick        Dead\nHealthy 0.8555592 0.1346958 0.009744961\nSick    0.0000000 0.9417645 0.058235466\nDead    0.0000000 0.0000000 1.000000000\n\n\nAn alternative way of exponentiating a matrix is to perform a Taylor series expansion:\n\n# Identity matrix with same dimensions and names as Q \nQ_I &lt;- diag(3)\ndimnames(Q_I) = dimnames(Q)\n\n# Note the %^% operator is in the expm package. \n\nQ2 = Q %^% 2   # Q-squared\nQ3 = Q %^% 3   # Q-cubed\nQ4 = Q %^% 4   # etc.\n\nQ_I + Q + (1/factorial(2))*Q2 + (1/factorial(3))*Q3 + (1/factorial(4))*Q4 \n\n          Healthy      Sick        Dead\nHealthy 0.8555599 0.1346947 0.009745373\nSick    0.0000000 0.9417645 0.058235460\nDead    0.0000000 0.0000000 1.000000000\n\n\nHow does this approach (P_eQ) perform relative to the other transition probability matrices (P_st and P_cr)? Figure 15 shows how the transition probabilities vary by hazard rate.\nWe can now see we’ve achieved what we need: Healthy Dead transition probabilities that rise as the hazard rate of death from disease increases. Again, this occurs because as the likelihood of death after becoming ill increases, we increase the likelihood of a compound Healthy Sick Dead transition within a cycle. We need these to be recorded (accurately) as Healthy Dead transitions, rather than Healthy Sick transitions. Correspondingly, as the probability of a compound transition increases with an increasing hazard rate, the probability of a single Healthy Sick transition declines; we see this in Figure 15 as well.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n  #filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n  scale_shape_manual(values = c(19,17,3)) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  scale_color_manual(values= c(\"blue\",\"darkgreen\",\"red\")) +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 15: 1-Year Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks, and P_eQ is embedded using the transition rate matrix Q.)\n\n\n\n\nWe also see that regardless of the cycle length used, we always end up with the same calculated life expectancy:\n\n\n\n\n\nFigure 16: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length\n\n\n\n\nWe have thus “fixed” our problem of hidden disease-related deaths!\n\nWhy is this important?\nThe use of an embedded transition probability matrix is important for a number of reasons:\n\nThe Markov model accurately reflects the underlying continuous time process.\nWe get an accurate accounting of disease-related deaths.\nWe can use whatever cycle length we need – this facilitates computationally intensive processes such as probabilistic sensitivity analyses, which may not be feasible with a short (e.g., daily) cycle length.\nWe also avoid “state explosion” in the event our model has tunnel states. For example, if there is a one-year tunnel state for costs or utilities following disease onset, if we switched to a monthly or daily cycle we’d have to build in dozens or more health states into our Markov model. Beacuse we can stick with a one-year cycle, this makes use of tunnel states much more feasible.\n\nThe primary “cost” of using this approach over standard rate-to-probability conversion formulas is that we must be a bit more careful in structuring our transition probability matrix to include accumulators used to aggregate model outputs. We will cover this process in the section directly below."
  },
  {
    "objectID": "blog/posts/embedding-a-transition-probability-matrix.html#include-non-markovian-accumulators-to-record-event-transitions",
    "href": "blog/posts/embedding-a-transition-probability-matrix.html#include-non-markovian-accumulators-to-record-event-transitions",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "2. Include Non-Markovian Accumulators to Record Event Transitions",
    "text": "2. Include Non-Markovian Accumulators to Record Event Transitions\nWe now have the correct transition probabilities to model the underlying continuous-time process, but how do we account for these compound transitions in our aggregation of model outputs?\nFundamentally, what we have now is a model that will correctly records the “true” number of deaths at the end of the cycle, because all the compound Healthy Sick Dead transitions are included in the Healthy Dead transition probability.\nTo track the total number of transitions to Sick, we must augment our transition probability matrix with non-Markovian accumulators. This accumulator shows up as a purple edge in our model diagram below:\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n    \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n    \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n    \n\nDead-&gt;Dead\n\n   \n\n\n\n\n\nFortunately, accumulators are easy to build in. We simply add the relevant transition rate in a new column in the transition rate matrix Q, while leaving everything else the same.\nSuppose we want to count up all the Healthy Sick transitions in the model. To do this we simply add the appropriate transition rate (\\(r_{HS}\\)) in as an accumulator column:\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\naccHS\n\n\n\n\nHealthy\n-(\\(r_{HS}\\) + \\(r_{HD}\\))\n\\(r_{HS}\\)\n\\(r_{HD}\\)\n\\(r_{HS}\\)\n\n\nSick\n0\n-(\\(hr_{S} \\cdot r_{HD}\\))\n\\(hr_{S} \\cdot r_{HD}\\)\n0\n\n\nDead\n0\n0\n0\n0\n\n\naccHS\n0\n0\n0\n0\n\n\n\nNote the following:\n\nAn extra row of 0’s was added so that we balance the matrix, and ensure that we do not lose (or create!) anyone who becomes Sick.\nWe did not update the diagonal elements (i.e., the negative sum of transition rates); these stay the same as before.\nIf we wanted to add additional accumulators, we can just expand the matrix with more columns and rows as needed.\n\nHere is the augmented transition rate matrix for our example:\n\n\nCode\nQ_ &lt;- data.frame(Q)\nQ_[\"Healthy\",\"accHS\"] &lt;- params$r_HS\nQ_[\"accHS\",\"accHS\"] &lt;- 0\nQ_[is.na(Q_)] &lt;- 0\nQ_ &lt;- as.matrix(Q_)\nQ_ \n\n\n        Healthy  Sick  Dead accHS\nHealthy  -0.156  0.15 0.006  0.15\nSick      0.000 -0.06 0.060  0.00\nDead      0.000  0.00 0.000  0.00\naccHS     0.000  0.00 0.000  0.00\n\n\nWe next embed the transition probability matrix, as before:Notice that the accumulator (accHS) value is identical to the Healthy Sick transition probability we obtained using the alternative rate-to-probability conversion formula that accounted for competing risks (e.g., see Figure 10).\n\nP_ &lt;- expm(Q_)\nP_\n\n          Healthy      Sick        Dead     accHS\nHealthy 0.8555592 0.1346958 0.009744961 0.1388854\nSick    0.0000000 0.9417645 0.058235466 0.0000000\nDead    0.0000000 0.0000000 1.000000000 0.0000000\naccHS   0.0000000 0.0000000 0.000000000 1.0000000\n\n\nUsing the accumulator we can accurately count up how many individuals transition to the Sick state over our time horizon:\n\nm_trace &lt;- \n  0:(horizon/cycle) %&gt;% \n  map_df(~(c(1000,0,0,0) %*% (P_%^%.x) %&gt;% data.frame()))\n\n\n\nCode\nm_trace[3,] %&gt;% \n  round(.,2) %&gt;% \n  rownames_to_column(var=\"cycle\") %&gt;% \n  select(-cycle) %&gt;% \n  kable() %&gt;% \n  kableExtra::kable_styling()\n\n\n\n\n\n\n\n\nHealthy\n\n\nSick\n\n\nDead\n\n\naccHS\n\n\n\n\n\n\n731.98\n\n\n242.09\n\n\n25.93\n\n\n257.71\n\n\n\n\n\nFigure 17: State Occupancy after Two Years\n\n\n\nWe see in Figure 17 that after 2 years, 257.7 people (out of 1,000) have become sick, which is slightly less than the 259 who became sick after 2 years in our world without death as a competing risk. Moreover, we see that state occupancy in the Sick category is lower, at 242.1. This lower value reflects the fact some people had a compound transition through Sick and ended up dead in the same cycle. The difference (15.6) amounts to the total number of individual deaths we “hid” in the model when we used the incorrect rate-to-probability conversion formulas.This, of course, makes sense, since there are a small number of people who die before they could become ill once we add background mortality to the model"
  },
  {
    "objectID": "blog/index.html",
    "href": "blog/index.html",
    "title": "Health Economics Workshop Blog",
    "section": "",
    "text": "Basic Markov Modeling in R\n\n\nReplication of Green et al (2023) Results\n\n\n\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nBackwards Conversion\n\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nExtending the Transition Matrix\n\n\nIncluding Non-Markovian Accumulators and Transition States\n\n\n\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nEmbedding A Transition Probability Matrix for a Discrete Time Markov Model\n\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n  \n\n\n\n\nSigns of Trouble\n\n\nChanging Cycle Lengths\n\n\n\n\n\n\n\n \n\n\n\n\nNo matching items"
  },
  {
    "objectID": "lectures/lec_welcome.html",
    "href": "lectures/lec_welcome.html",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "https://vchem-vital-workshop-2022.netlify.app\n\n\n\nAll course materials (slides, case studies, capstone exercises) are posted here.\nOur (likely evolving) schedule will also be posted here, and updated regularly.\n\n\n\n\n\n\nAll materials can be translated using the Google Translate Chrome extension!\n\n\n\n\n\n\nPlease introduce yourself!\n\n\n\n\n\nWe’re flexible – if there is a topic that is unclear to you, or that you would like expanded upon, please let us know!\nMixed content\n\n\nLectures\nSmall group case studies\nLarge group case studies and “hands-on” Excel exercises\nCapstone projects (small group or individual)\n\n\nBuilt from “ground up” for this workshop!\n\n\n\n\n\nBasics of decision analysis\n\n\nConcepts and theories (Day 1)\nMarkov modeling (Day 2)\nSummarizing and presenting results and sensitivity analysis (Days 3-4)\nAdvanced modeling techniques\n\n\n\n\n\nCase studies\n\n\nCumulative: each will build on the last\nAnswer keys (.xls and video) will be made available, and we will cover each as a group as well.\nDesigned in Excel, but structured in our (developing) “Pan-Decision-Analysis” (PAN-DA) framework.\n\n\n\n\nWhat does Pan-DA Mean?\n\n\nOur model structure template can be used for both Excel, and also extends into a (developing) R framework.\nThis means you can parameterize & develop your model in Excel, but ultimately run the model in R.\nNote that this is a developing framework—you are a very early “Alpha” tester!"
  },
  {
    "objectID": "lectures/lec_welcome.html#course-website",
    "href": "lectures/lec_welcome.html#course-website",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "https://vchem-vital-workshop-2022.netlify.app\n\n\n\nAll course materials (slides, case studies, capstone exercises) are posted here.\nOur (likely evolving) schedule will also be posted here, and updated regularly."
  },
  {
    "objectID": "lectures/lec_welcome.html#course-website-1",
    "href": "lectures/lec_welcome.html#course-website-1",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "All materials can be translated using the Google Translate Chrome extension!"
  },
  {
    "objectID": "lectures/lec_welcome.html#introductions",
    "href": "lectures/lec_welcome.html#introductions",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "Please introduce yourself!"
  },
  {
    "objectID": "lectures/lec_welcome.html#workshop-format",
    "href": "lectures/lec_welcome.html#workshop-format",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "We’re flexible – if there is a topic that is unclear to you, or that you would like expanded upon, please let us know!\nMixed content\n\n\nLectures\nSmall group case studies\nLarge group case studies and “hands-on” Excel exercises\nCapstone projects (small group or individual)\n\n\nBuilt from “ground up” for this workshop!"
  },
  {
    "objectID": "lectures/lec_welcome.html#workshop-content",
    "href": "lectures/lec_welcome.html#workshop-content",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "Basics of decision analysis\n\n\nConcepts and theories (Day 1)\nMarkov modeling (Day 2)\nSummarizing and presenting results and sensitivity analysis (Days 3-4)\nAdvanced modeling techniques"
  },
  {
    "objectID": "lectures/lec_welcome.html#workshop-content-1",
    "href": "lectures/lec_welcome.html#workshop-content-1",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "Case studies\n\n\nCumulative: each will build on the last\nAnswer keys (.xls and video) will be made available, and we will cover each as a group as well.\nDesigned in Excel, but structured in our (developing) “Pan-Decision-Analysis” (PAN-DA) framework."
  },
  {
    "objectID": "lectures/lec_welcome.html#worskthop-content",
    "href": "lectures/lec_welcome.html#worskthop-content",
    "title": "Welcome and Introductions",
    "section": "",
    "text": "What does Pan-DA Mean?\n\n\nOur model structure template can be used for both Excel, and also extends into a (developing) R framework.\nThis means you can parameterize & develop your model in Excel, but ultimately run the model in R.\nNote that this is a developing framework—you are a very early “Alpha” tester!"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html",
    "href": "lectures/SLIDE_TEMPLATES.html",
    "title": "slide templates",
    "section": "",
    "text": "Block quote\n\n\n– [@neumann2016]\n\n\n\n\nAutomatically animate matching elements across slides with Auto-Animate.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAutomatically animate matching elements across slides with Auto-Animate.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n This list\n Doesn’t have bullets"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#auto-animate",
    "href": "lectures/SLIDE_TEMPLATES.html#auto-animate",
    "title": "slide templates",
    "section": "",
    "text": "Automatically animate matching elements across slides with Auto-Animate."
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#auto-animate-1",
    "href": "lectures/SLIDE_TEMPLATES.html#auto-animate-1",
    "title": "slide templates",
    "section": "",
    "text": "Automatically animate matching elements across slides with Auto-Animate."
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#replace-bullet-points-with-fontawesome",
    "href": "lectures/SLIDE_TEMPLATES.html#replace-bullet-points-with-fontawesome",
    "title": "slide templates",
    "section": "",
    "text": "This list\n Doesn’t have bullets"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#original-image",
    "href": "lectures/SLIDE_TEMPLATES.html#original-image",
    "title": "slide templates",
    "section": "Original Image",
    "text": "Original Image"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#resized-image",
    "href": "lectures/SLIDE_TEMPLATES.html#resized-image",
    "title": "slide templates",
    "section": "Resized Image",
    "text": "Resized Image"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#resized-image2",
    "href": "lectures/SLIDE_TEMPLATES.html#resized-image2",
    "title": "slide templates",
    "section": "Resized Image2",
    "text": "Resized Image2"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#multi-column-list",
    "href": "lectures/SLIDE_TEMPLATES.html#multi-column-list",
    "title": "slide templates",
    "section": "Multi-Column list",
    "text": "Multi-Column list\n\n\n\nOne\nTwo\nThree\nFour\n\n\n\nFive\nSix\nSeven"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-1",
    "href": "lectures/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-1",
    "title": "slide templates",
    "section": "Fade In - Left Column First, Right Column (with image second)",
    "text": "Fade In - Left Column First, Right Column (with image second)\n\n\n\n\nText 1.\nText 2"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-2",
    "href": "lectures/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-2",
    "title": "slide templates",
    "section": "Fade In - Left Column First, Right Column (with image second)",
    "text": "Fade In - Left Column First, Right Column (with image second)\n\n\n\nText 1.\nText 2"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#colored-text",
    "href": "lectures/SLIDE_TEMPLATES.html#colored-text",
    "title": "slide templates",
    "section": "Colored text",
    "text": "Colored text\n\nShow this word in red.\nShow this word in blue.\nShow this word in green."
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#probabilities",
    "href": "lectures/SLIDE_TEMPLATES.html#probabilities",
    "title": "slide templates",
    "section": "Probabilities",
    "text": "Probabilities"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#section-3",
    "href": "lectures/SLIDE_TEMPLATES.html#section-3",
    "title": "slide templates",
    "section": "",
    "text": "Text 1\nText 2\nText 3"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#slide-with-plot-and-padding",
    "href": "lectures/SLIDE_TEMPLATES.html#slide-with-plot-and-padding",
    "title": "slide templates",
    "section": "Slide with Plot and Padding",
    "text": "Slide with Plot and Padding"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#kaiser-health-insurance-quiz",
    "href": "lectures/SLIDE_TEMPLATES.html#kaiser-health-insurance-quiz",
    "title": "slide templates",
    "section": "Kaiser Health Insurance Quiz",
    "text": "Kaiser Health Insurance Quiz"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#embed-a-youtube-video",
    "href": "lectures/SLIDE_TEMPLATES.html#embed-a-youtube-video",
    "title": "slide templates",
    "section": "Embed a Youtube Video",
    "text": "Embed a Youtube Video"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#re-size-tables-before-re-sizing",
    "href": "lectures/SLIDE_TEMPLATES.html#re-size-tables-before-re-sizing",
    "title": "slide templates",
    "section": "Re-size tables – Before re-sizing",
    "text": "Re-size tables – Before re-sizing\n\n\n\n\n\n\n\n\n\nType of study\nMeasurement/Valuation of costs both alternative\nIdentification of consequences\nMeasurement / valuation of consequences\n\n\n\n\nCost analysis\nMonetary units\nNone\nNone\n\n\nCost-effectiveness analysis\nMonetary units\nSingle effect of interest, common to both alternatives, but achieved to different degrees.\nNatural units (e.g., life-years gained, disability days saved, points of blood pressure reduction, etc.)\n\n\nCost-utility analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives.\nHealthy years (typically measured as quality-adjusted life-years)\n\n\nCost-benefit analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives\nMonetary units"
  },
  {
    "objectID": "lectures/SLIDE_TEMPLATES.html#re-size-tables-after-re-sizing",
    "href": "lectures/SLIDE_TEMPLATES.html#re-size-tables-after-re-sizing",
    "title": "slide templates",
    "section": "Re-size tables – After re-sizing",
    "text": "Re-size tables – After re-sizing\n\n\n\n\n\n\n\n\n\n\nType of study\nMeasurement/Valuation of costs both alternative\nIdentification of consequences\nMeasurement / valuation of consequences\n\n\n\n\nCost analysis\nMonetary units\nNone\nNone\n\n\nCost-effectiveness analysis\nMonetary units\nSingle effect of interest, common to both alternatives, but achieved to different degrees.\nNatural units (e.g., life-years gained, disability days saved, points of blood pressure reduction, etc.)\n\n\nCost-utility analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives.\nHealthy years (typically measured as quality-adjusted life-years)\n\n\nCost-benefit analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives\nMonetary units"
  },
  {
    "objectID": "lectures/exercise_structure.html",
    "href": "lectures/exercise_structure.html",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "",
    "text": "H\n\n Asympomatic (A)   \n\nH-&gt;H\n\n    \n\nS\n\n Progressive Disease (P)   \n\nH-&gt;S\n\n    \n\nDb\n\n Death from other causes (Db)   \n\nH-&gt;Db\n\n    \n\nS-&gt;S\n\n    \n\nS-&gt;Db\n\n    \n\nDd\n\n Death from disease (Dd)   \n\nS-&gt;Dd\n\n    \n\nDb-&gt;Db\n\n    \n\nDd-&gt;Dd"
  },
  {
    "objectID": "lectures/exercise_structure.html#model-diagram",
    "href": "lectures/exercise_structure.html#model-diagram",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "",
    "text": "H\n\n Asympomatic (A)   \n\nH-&gt;H\n\n    \n\nS\n\n Progressive Disease (P)   \n\nH-&gt;S\n\n    \n\nDb\n\n Death from other causes (Db)   \n\nH-&gt;Db\n\n    \n\nS-&gt;S\n\n    \n\nS-&gt;Db\n\n    \n\nDd\n\n Death from disease (Dd)   \n\nS-&gt;Dd\n\n    \n\nDb-&gt;Db\n\n    \n\nDd-&gt;Dd"
  },
  {
    "objectID": "lectures/exercise_structure.html#natural-history-parameters",
    "href": "lectures/exercise_structure.html#natural-history-parameters",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Natural History Parameters",
    "text": "Natural History Parameters\n\nProgressive disease incidence rate (r_AP): 0.4 over 10 years\nBackground mortality rate (r_Db): 0.006 per year\nHazard rate of death from progressive disease relative to background mortality (HR_PDd): 3.0"
  },
  {
    "objectID": "lectures/exercise_structure.html#strategy-a-preventive-measure",
    "href": "lectures/exercise_structure.html#strategy-a-preventive-measure",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Strategy A: Preventive Measure",
    "text": "Strategy A: Preventive Measure\n\nRelative risk of developing progressive disease (RR_AP): 0.75"
  },
  {
    "objectID": "lectures/exercise_structure.html#strategy-b-disease-treatment",
    "href": "lectures/exercise_structure.html#strategy-b-disease-treatment",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Strategy B: Disease Treatment",
    "text": "Strategy B: Disease Treatment\n\nOdds-ratio of death from progressive disease (OR_PDd): 0.80\nBaseline annual probability of death in underlying clinical trial (p0_OR_PDd): 0.03"
  },
  {
    "objectID": "lectures/exercise_structure.html#strategy-c-cure",
    "href": "lectures/exercise_structure.html#strategy-c-cure",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Strategy C: Cure",
    "text": "Strategy C: Cure\n\n10-year disease remission rate (i.e., return to asymptomatic state; r_PA_trtC): 0.50"
  },
  {
    "objectID": "lectures/exercise_structure.html#parameter-table",
    "href": "lectures/exercise_structure.html#parameter-table",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Parameter Table",
    "text": "Parameter Table\n\n\n\n\n\n\n\n\n\nParameter\nDescription\nValue\n\n\n\n\nr_AP\n10-year progressive disease incidence rate\n0.40\n\n\nr_Db\nBackground mortality rate\n0.006\n\n\nHR_PDd\nHazard rate of death from progressive disease relative to background mortality\n3.0\n\n\nRR_AP\nRelative risk of developing progressive disease (Strategy A)\n0.75\n\n\nOR_PDd\nOdds-ratio of death from progressive disease (Strategy B)\n0.80\n\n\np0_OR_PDd\nBaseline probability of death in underlying clinical trial (Strategy B)\n0.03\n\n\nr_PA_trtC\n10-year disease remission rate (Strategy C)\n0.50\n\n\n\n\n\nlibrary(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.1      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(Matrix)\n\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nr_AP &lt;- 0.40\nr_Db &lt;- 0.006\nHR_PDd &lt;- 3.0\nRR_AP &lt;- 0.75\nOR_PDd &lt;- 0.80\np0_OR_PDd &lt;- 0.03\nr_PA_trtC &lt;- 0.50\n\nm_R0 &lt;- m_RA &lt;- m_RB &lt;- m_RC &lt;-   \n  matrix(0, nrow=4, ncol = 4, dimnames=list(c(\"Asymptomatic\",\"Progressive Disease\",\"Disease Mortality\", \"Background Mortality\"),\n                                               c(\"Asymptomatic\",\"Progressive Disease\",\"Disease Mortality\", \"Background Mortality\")))\n\n# Step 1: Natural History  (i.e., m_R0 and m_P0)\n\nm_R0[\"Asymptomatic\",\"Asymptomatic\"] &lt;- -(r_AP/10+r_Db)\nm_R0[\"Asymptomatic\",\"Progressive Disease\"] &lt;- r_AP/10\nm_R0[\"Asymptomatic\",\"Background Mortality\"] &lt;- r_Db\n\nm_R0[\"Progressive Disease\",\"Progressive Disease\"] &lt;- -(HR_PDd * r_Db + r_Db)\nm_R0[\"Progressive Disease\",\"Disease Mortality\"] &lt;- HR_PDd * r_Db\nm_R0[\"Progressive Disease\",\"Background Mortality\"] &lt;- r_Db\n\nm_P0 &lt;- expm(m_R0)\nm_P0[is.na(m_P0)] &lt;- 0\n\n# Strategy A\n\nm_PA &lt;- m_P0 \nm_PA[\"Asymptomatic\",\"Progressive Disease\"] &lt;- RR_AP * m_P0[\"Asymptomatic\",\"Progressive Disease\"] \nm_PA[\"Asymptomatic\",\"Asymptomatic\"] &lt;- 1 - m_PA[\"Asymptomatic\",\"Progressive Disease\"]  - m_PA[\"Asymptomatic\",\"Disease Mortality\"] - m_PA[\"Asymptomatic\",\"Background Mortality\"]\n\n# Strategy B\nm_PB &lt;- m_P0 \nm_PB[\"Progressive Disease\",\"Disease Mortality\"] &lt;- (OR_PDd / (1 - p0_OR_PDd + (p0_OR_PDd *OR_PDd  ))) * m_PB[\"Progressive Disease\",\"Disease Mortality\"]\nm_PB[\"Progressive Disease\",\"Progressive Disease\"] &lt;- 1 - m_PB[\"Progressive Disease\",\"Asymptomatic\"] - m_PB[\"Progressive Disease\",\"Disease Mortality\"] - m_PB[\"Progressive Disease\",\"Background Mortality\"]\n\n# Strategy C\n\nm_RC &lt;- m_R0 \nm_RC[\"Progressive Disease\",\"Asymptomatic\"]  &lt;- (r_PA_trtC/10)\nm_RC[\"Progressive Disease\",\"Progressive Disease\"] &lt;- -(m_RC[\"Progressive Disease\",\"Asymptomatic\"] + m_RC[\"Progressive Disease\",\"Disease Mortality\"] + m_RC[\"Progressive Disease\",\"Background Mortality\"])\nm_PC &lt;- expm(m_RC)"
  },
  {
    "objectID": "lectures/exercise_structure.html#key",
    "href": "lectures/exercise_structure.html#key",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Key",
    "text": "Key\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells\n\n\n\n\ncolor_lut &lt;- \n  c(\"rate\" = \"#ff498c\",\n    \"hazard_ratio\" = \"#fcb08a\",\n    \"probability\" = \"#ffc922\",\n    \"relative_risk\" = \"#cdea24\", \n    \"odds_ratio\" = \"#9dd8da\", \n    \"constructed\" = \"#ab59cf\")"
  },
  {
    "objectID": "lectures/exercise_structure.html#goal-natural-history-transition-probability-matrix",
    "href": "lectures/exercise_structure.html#goal-natural-history-transition-probability-matrix",
    "title": "Structuring the Markov Model: Group Exercise",
    "section": "Goal: Natural History Transition Probability Matrix",
    "text": "Goal: Natural History Transition Probability Matrix\nm_P0 =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nProgressive Disease\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/lec_structure.html",
    "href": "lectures/lec_structure.html",
    "title": "5. Structuring the Markov Model",
    "section": "",
    "text": "library(knitr)\nlibrary(kableExtra)\nlibrary(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.1     ✔ purrr   1.0.1\n✔ tibble  3.2.1     ✔ dplyr   1.1.1\n✔ tidyr   1.3.0     ✔ stringr 1.5.0\n✔ readr   2.1.4     ✔ forcats 0.5.2\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter()     masks stats::filter()\n✖ dplyr::group_rows() masks kableExtra::group_rows()\n✖ dplyr::lag()        masks stats::lag()\n\n\n\n\n\n\nUnderstand differences between rates and probabilities, hazard rates, relative risks, and other relevant model inputs.\nUnderstand rate-to-probability conversion formulas and competing rates.\nEmbedding a continuous transition rate matrix into a discrete timestep resulting in a transition probability matrix.\nEmbedding of non-stationary rates as a function of time.\nUnderstand additional non-Markovian components: accumulators, tunnel states."
  },
  {
    "objectID": "lectures/lec_structure.html#learning-objectives",
    "href": "lectures/lec_structure.html#learning-objectives",
    "title": "5. Structuring the Markov Model",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\n\nUnderstand differences between rates and probabilities, hazard rates, relative risks, and other relevant model inputs.\nUnderstand rate-to-probability conversion formulas and competing rates.\nEmbedding a continuous transition rate matrix into a discrete timestep resulting in a transition probability matrix.\nEmbedding of non-stationary rates as a function of time.\nUnderstand additional non-Markovian components: accumulators, tunnel states."
  },
  {
    "objectID": "lectures/lec_structure.html#goal",
    "href": "lectures/lec_structure.html#goal",
    "title": "5. Structuring the Markov Model",
    "section": "Goal",
    "text": "Goal"
  },
  {
    "objectID": "lectures/lec_structure.html#what-never-happens",
    "href": "lectures/lec_structure.html#what-never-happens",
    "title": "5. Structuring the Markov Model",
    "section": "What Never Happens",
    "text": "What Never Happens"
  },
  {
    "objectID": "lectures/lec_structure.html#problem",
    "href": "lectures/lec_structure.html#problem",
    "title": "5. Structuring the Markov Model",
    "section": "Problem",
    "text": "Problem\n\nNeed transition probabilities but literature-based parameters are reported as:\n\n\n\nRates\nHazard ratios\nOdds ratios\nRelative risks\nTransition probabilities (rare!)"
  },
  {
    "objectID": "lectures/lec_structure.html#solution",
    "href": "lectures/lec_structure.html#solution",
    "title": "5. Structuring the Markov Model",
    "section": "Solution",
    "text": "Solution\n\n\nNeed “common ground” where we can combine and transform different model inputs.\nThis “common ground” is often found in a transition rate matrix."
  },
  {
    "objectID": "lectures/lec_structure.html#solution-1",
    "href": "lectures/lec_structure.html#solution-1",
    "title": "5. Structuring the Markov Model",
    "section": "Solution",
    "text": "Solution"
  },
  {
    "objectID": "lectures/lec_structure.html#solution-2",
    "href": "lectures/lec_structure.html#solution-2",
    "title": "5. Structuring the Markov Model",
    "section": "Solution",
    "text": "Solution"
  },
  {
    "objectID": "lectures/lec_structure.html#solution-3",
    "href": "lectures/lec_structure.html#solution-3",
    "title": "5. Structuring the Markov Model",
    "section": "Solution",
    "text": "Solution"
  },
  {
    "objectID": "lectures/lec_structure.html#solution-4",
    "href": "lectures/lec_structure.html#solution-4",
    "title": "5. Structuring the Markov Model",
    "section": "Solution",
    "text": "Solution"
  },
  {
    "objectID": "lectures/lec_structure.html#transition-rate-matrix",
    "href": "lectures/lec_structure.html#transition-rate-matrix",
    "title": "5. Structuring the Markov Model",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\n\nThe central “hub” of a Markov model.\nStraightforward to convert rate matrix into a transition probability matrix.\nCan be used to change the cycle length.\nFacilitates modeling using alternative techniques:\n\nContinuous time Markov\nDiscrete event simulation\nMicrosimulation"
  },
  {
    "objectID": "lectures/lec_structure.html#four-step-process",
    "href": "lectures/lec_structure.html#four-step-process",
    "title": "5. Structuring the Markov Model",
    "section": "Four-Step Process",
    "text": "Four-Step Process\n\n\nUse data inputs/published literature to define a rate matrix \\(\\mathbf{R}\\).\nMake strategy-specific adjustments to \\(\\mathbf{R}\\) as needed.\n“Embed” the transition probability matrix using the rate matrix\nMake further overall or strategy-specific adjustments to \\(\\mathbf{P}\\) as needed."
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities",
    "text": "Rates vs. Probabilities\n\n\nRate: number of occurrences of an event per unit of time. These are additive and subtractive–i.e. simple algebra for manipulation.\nProbability: Likelihood that an event will occur for an in individual over a defined time period.\nMajor difference is in denominator: rates take into account time at risk while probabilities do not."
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-1",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-1",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities",
    "text": "Rates vs. Probabilities"
  },
  {
    "objectID": "lectures/lec_structure.html#rates",
    "href": "lectures/lec_structure.html#rates",
    "title": "5. Structuring the Markov Model",
    "section": "Rates",
    "text": "Rates\n\n\nNumber of events divided by the total time at risk experienced by all people followed.\nRanges from 0 to \\(\\infty\\).\n\\(\\frac{\\# \\text{events in time period}}{\\text{Total time period experienced by all subjects followed}}\\)"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-1",
    "href": "lectures/lec_structure.html#rates-1",
    "title": "5. Structuring the Markov Model",
    "section": "Rates",
    "text": "Rates"
  },
  {
    "objectID": "lectures/lec_structure.html#probabilities",
    "href": "lectures/lec_structure.html#probabilities",
    "title": "5. Structuring the Markov Model",
    "section": "Probabilities",
    "text": "Probabilities"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example1",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example1",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example1",
    "text": "Rates vs. Probabilities: Example1\n\n\nSuppose a study followed 100 people with congestive heart failure for 4 years.\nAt the end of 4 years, 40 had died.\nThe probability of death over 4 years is \\(40/100=0.40\\).\n\n\nSource: Gidwani and Russell (2020)"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example2",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example2",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example1",
    "text": "Rates vs. Probabilities: Example1\n\n\nA rate takes into acccount the time each person was at risk.\nThe 60 who survived were at risk the entire 4 years and contributed \\(60 \\times 4 = 240\\) years at risk.\nOnce a person dies, he/she is no longer at risk.\n\n\nSource: Gidwani and Russell (2020)"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example3",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example3",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example1",
    "text": "Rates vs. Probabilities: Example1\n\n\nWhen a study does not report time at risk, the conventional assumption is that the events were spread evenly over the time period.\nUsing this assumption, the average time at risk for the 40 who died was 2 years, adding 40 × 2 = 80 years at risk.\n\n\nSource: Gidwani and Russell (2020)"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example4",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example4",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example1",
    "text": "Rates vs. Probabilities: Example1\n\n\nTotal time at risk for the cohort of 100 people is 320 person-years (240+80).\nThus, the rate of death from CHF is 40/320 = 0.125 deaths per person-year.\nLet’s now construct a rate matrix with three states: CHF, Death from CHF, and Death from other causes.\n\n\nSource: Gidwani and Russell (2020)"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example",
    "text": "Rates vs. Probabilities: Example\n\n\n0.125 per person year is the rate we’d enter into our rate matrix.\nWe could also think of a separate death rate from background causes (e.g., 0.006 per person-year).1\n\n\nThis often comes from separate vital statistics / life-table data sources."
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example-1",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example-1",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example",
    "text": "Rates vs. Probabilities: Example\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0\n0.125\n0.006\n\n\nD_CHF\n0\n0.000\n0.000\n\n\nD_OTH\n0\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example-2",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example-2",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example",
    "text": "Rates vs. Probabilities: Example\n\n\n\n\nThe diagonal elements in a rate matrix are just the negative sum of the off-diagonal elements. (Markovian)\nIn this example, the diagonal value for the 1st row would be -0.131 = -(0.125+0.006)\nWe can leave all other rate matrix values at 0 because the rate of progression from death to other states is zero.\n\n\n\n\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0\n0.000\n0.000\n\n\nDeath_Other\n0\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#rates-vs.-probabilities-example-3",
    "href": "lectures/lec_structure.html#rates-vs.-probabilities-example-3",
    "title": "5. Structuring the Markov Model",
    "section": "Rates vs. Probabilities: Example",
    "text": "Rates vs. Probabilities: Example\n\n\n\n\nThe diagonal elements in a rate matrix are just the negative sum of the off-diagonal elements.\nIn this example, the diagonal value for the 1st row would be -0.131 = -(0.125+0.006)\nWe can leave all other rate matrix values at 0 because the rate of progression from death to other states is zero.\n\n\n\n\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0\n0.000\n0.000\n\n\nDeath_Other\n0\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#summary-rates-vs.-probabilities",
    "href": "lectures/lec_structure.html#summary-rates-vs.-probabilities",
    "title": "5. Structuring the Markov Model",
    "section": "Summary: Rates vs. Probabilities",
    "text": "Summary: Rates vs. Probabilities\n\n\n\n\n\n\n\n\n\n\nStatistic\nEvaluates\nRange\nApplicable Domain\n\n\n\n\nRate\n\\(\\frac{\\# \\text{events in time period}}{\\text{Total time period experienced by all subjects followed}}\\)\n0 to \\(\\infty\\)\nRate matrix\n\n\nProbability/risk\n\\(\\frac{\\# \\text{events in time period}}{\\# \\text{people followed for time period}}\\)\n0-1\nProbability matrix"
  },
  {
    "objectID": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.",
    "href": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.",
    "title": "5. Structuring the Markov Model",
    "section": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).",
    "text": "1. Place rates in a rate matrix \\(\\mathbf{R}\\)."
  },
  {
    "objectID": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-1",
    "href": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-1",
    "title": "5. Structuring the Markov Model",
    "section": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).",
    "text": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).\n\n\n\n\nCountry/region-specific background mortality rate (0.006)\nDisease mortality rates from existing population-based epidemiological study. (e.g., 0.125 = 40 cases per 320 person-years)\nDiagonal value that is the negative sum of the off-diagonal values in each row (-0.131).\n\n\n\n\n“Natural History” (i.e., “do nothing”) rate matrix:\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0.000\n0.000\n0.000\n\n\nDeath_Other\n0.000\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-2",
    "href": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-2",
    "title": "5. Structuring the Markov Model",
    "section": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).",
    "text": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).\n\n\nWhat we have just done is contruct a rate matrix for a “natural history” model of the disease (CHF).\nThis is a version of the model in which we allow the disease process to play out naturally, with no further intervention.\nSometimes called a “do nothing” strategy."
  },
  {
    "objectID": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-3",
    "href": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-3",
    "title": "5. Structuring the Markov Model",
    "section": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).",
    "text": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).\n\n\nThe “natural history” model is useful because it can help us verify that the model matches what we see in the “real world.”\nThe “natural history” model also can be used to calibrate transition rates to different countries/contexts.\nFor example, we could recalibrate the model so the CHF mortality transition rate matches our country-specific data."
  },
  {
    "objectID": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-4",
    "href": "lectures/lec_structure.html#place-rates-in-a-rate-matrix-mathbfr.-4",
    "title": "5. Structuring the Markov Model",
    "section": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).",
    "text": "1. Place rates in a rate matrix \\(\\mathbf{R}\\).\n\n\nAlternatively, suppose we “borrow” a model developed in another country/context.\nThat model will be based on underlying rates specific to that context.\nThe underlying rate matrix can be used to “swap in” transition rates that apply to our country/context.\n\nExample: change the background mortality rate to match you country’s."
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.",
    "title": "5. Structuring the Markov Model",
    "section": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.",
    "text": "2. Make adjustments to \\(\\mathbf{R}\\) as needed."
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-1",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-1",
    "title": "5. Structuring the Markov Model",
    "section": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.",
    "text": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.\n\n\n\n\nSuppose that a new strategy can reduces the risk of CHF mortality by 20% (i.e., hazard ratio = 0.8).\nWe can simply apply this hazard ratio directly to construct a rate matrix for strategy A.\nFor the Strategy A rate matrix, the rate of CHF death is \\(0.8 * 0.125 = 0.1\\)\nMake sure that the diagonal element is adjusted to account for this change!\n\n\n\n\n“Natural History” rate matrix\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0.000\n0.000\n0.000\n\n\nDeath_Other\n0.000\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-2",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-2",
    "title": "5. Structuring the Markov Model",
    "section": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.",
    "text": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.\n\n\n\n\nSuppose that a new strategy can reduces the risk of CHF mortality by 20% (i.e., hazard ratio = 0.8).\nWe can simply apply this hazard ratio directly to construct a rate matrix for strategy A.\nFor the Strategy A rate matrix, the rate of CHF death is \\(0.8 * 0.125 = 0.1\\)\nMake sure that the diagonal element is adjusted to account for this change!\n\n\n\n\n“Natural History” rate matrix\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0.000\n0.000\n0.000\n\n\nDeath_Other\n0.000\n0.000\n0.000\n\n\n\n\n\n\n\n“Strategy A” rate matrix\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.106\n0.1\n0.006\n\n\nDeath_CHF\n0\n0\n0.000\n\n\nDeath_Other\n0\n0\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-3",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-3",
    "title": "5. Structuring the Markov Model",
    "section": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.",
    "text": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.\n\n\n\n\nAnother adjustment we could make at this stage is the time cycle length.\nSuppose our rate matrix is defined in terms of a one-year time cycle, but we want to convert to a monthly cycle.\nIn that event, we’d simply divide each rate in the matrix by 12, and the resulting matrix would be for a monthly timestep.\n\n\n\n\n“Natural History” rate matrix (one-year timestep)\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0.000\n0.000\n0.000\n\n\nDeath_Other\n0.000\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-4",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfr-as-needed.-4",
    "title": "5. Structuring the Markov Model",
    "section": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.",
    "text": "2. Make adjustments to \\(\\mathbf{R}\\) as needed.\n\n\n\nAnother adjustment we could make at this stage is the time cycle length.\nSuppose our rate matrix is defined in terms of a one-year time cycle, but we want to convert to a monthly cycle.\nIn that event, we’d simply divide each rate in the matrix by 12, and the resulting matrix would be for a monthly timestep.\n\n\n\n“Natural History” rate matrix (one-year timestep)\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nDeath_CHF\n0.000\n0.000\n0.000\n\n\nDeath_Other\n0.000\n0.000\n0.000\n\n\n\n\n\n\n\n“Natural History” rate matrix (one-month timestep)\n\n\n\n\n\n\nCHF\nDeath_CHF\nDeath_Other\n\n\n\n\nCHF\n-0.0109\n0.0104\n5e-04\n\n\nDeath_CHF\n0\n0\n0\n\n\nDeath_Other\n0\n0\n0"
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix"
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-1",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-1",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix\n\n\nOur next step is to convert the transition rate matrix into a transition probability matrix.\nCommon practice is to use rate-to-probability conversion formulas"
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-2",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-2",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix\n\nOur next step is to convert the transition rate matrix into a transition probability matrix.\nCommon practice is to use rate-to-probability conversion formulas\n\n\\[\np = 1 - \\exp(-rt)\n\\] where \\(r\\) is the rate and \\(t\\) is the time-step."
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-3",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-3",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix\n\n\nThis formula works fine when there is only one possible state an individual can transition to.\nThe formula will not calculate the correct transition probability if there are two or more states someone can transition to.\nSee the workshop blog posting for more."
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-4",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-4",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix\n\n\nWe will cover two approaches for constructing a transition probability matrix.\nThe first is technically incorrect, but is widely used and easier to implement because it ignores compound transitions (i.e., multiple transitions within a cycle)."
  },
  {
    "objectID": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-5",
    "href": "lectures/lec_structure.html#embed-the-transition-probability-matrix-using-the-rate-matrix-5",
    "title": "5. Structuring the Markov Model",
    "section": "3. “Embed” the transition probability matrix using the rate matrix",
    "text": "3. “Embed” the transition probability matrix using the rate matrix\nThe two approaches\n\n\n\n3a. Construct a transition probability matrix using rate-to-probability conversion formulas.\n3b. Embed the transition probability matrix using the rate matrix exponential (i.e., \\(\\mathbf{P}=e^{\\mathbf{R}}\\))."
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nThe probability of transitioning from health state \\(A\\) to health state \\(B\\) is:\n\\[\np_{AB}= \\frac{r_{AB}}{\\sum_S r_{AS}}\\big ( 1 - e^{-(\\sum_S r_{AS}) t}\\big )\n\\] where \\(S\\) captures all the health states (i.e., columns) in the transition rate matrix, and \\(t\\) is the time-step (e.g., \\(t=1\\) if 1 year, \\(t=1/12\\) if one month, etc.)."
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-1",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-1",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nLet’s build on our chronic heart failure example from earlier. Here is the transition rate matrix we constructed:\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nD_CHF\n0.000\n0.000\n0.000\n\n\nD_OTH\n0.000\n0.000\n0.000"
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-2",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-2",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nLet’s now calculate the probability of transitioning from the CHF state to D_CHF (death from heart failure)."
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-3",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-3",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nAnnual probability of transitioning from CHF to death from CHF:\n\\[\np_{\\text{CHF,D_CHF}}= \\frac{r_{\\text{CHF,D_CHF}}}{r_{\\text{CHF,D_CHF}} + r_{\\text{CHF,D_OTH}}}\\big ( 1 - e^{-(r_{\\text{CHF,D_CHF}} + r_{\\text{CHF,D_OTH}}) \\times 1}\\big )\n\\]\nWe can find each of these rates in our transition rate matrix…"
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-4",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-4",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nAnnual probability of transitioning from CHF to death from CHF:\n\\[\np_{\\text{CHF,D_CHF}}= \\frac{\\color{red}{0.125}}{\\color{red}{0.125}+\\color{green}{0.006}}\\big ( 1 - e^{-(\\color{red}{0.125}+\\color{green}{0.006}) \\times 1}\\big ) = 0.1172\n\\]\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nD_CHF\n0.000\n0\n0\n\n\nD_OTH\n0.000\n0\n0"
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-5",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-5",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nLet’s now calculate the probability of transitioning from the CHF state to D_OTH (death from other causes)."
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-6",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-6",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nAnnual probability of transitioning from CHF to death from other causes:\n\\[\np_{\\text{CHF,D_CHF}}= \\frac{\\color{green}{0.006}}{\\color{red}{0.125}+\\color{green}{0.006}}\\big ( 1 - e^{-(\\color{red}{0.125}+\\color{green}{0.006}) \\times 1}\\big ) = 0.00562\n\\]\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n-0.131\n0.125\n0.006\n\n\nD_CHF\n0.000\n0\n0\n\n\nD_OTH\n0.000\n0\n0"
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-7",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-7",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\n\n\nWe now have the quantities needed to complete the first row of our transition rate matrix.\nRecall that the diagonal elements of the transition probability matrix are just 1 minus the other transition probabilities."
  },
  {
    "objectID": "lectures/lec_structure.html#a.-rate-to-probability-conversion-8",
    "href": "lectures/lec_structure.html#a.-rate-to-probability-conversion-8",
    "title": "5. Structuring the Markov Model",
    "section": "3a. Rate-to-probability conversion",
    "text": "3a. Rate-to-probability conversion\nCalculated transition probability matrix:\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8772\n0.1172\n0.0056\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000"
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\n\n\nThe most technically correct approach for “embedding” a transition probability matrix is using the rate matrix exponential.\nThis is a matrix analogue to the cellwise rate-to-probability matrix process we just went through."
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-1",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-1",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\n\\[\n\\mathbf{P} = e^{\\mathbf{R}}\n\\]"
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-2",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-2",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\nPros:\n\n\nEmbedding the transition probability matrix in this way ensures that the correct transition probabilities are calculated.\nWithout going into too many details, this approach ensures that some compound transitions are not “hidden” in the Markov cycle.\nThis ensures that our discrete time Markov model accurately represents the underlying continuous time process."
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-3",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-3",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\nCons:\n\n\nA major drawback is that this approach can create some “jumpover” states that are seemingly inconsistent with the underlying model (see blog for more).\nAccounting for “hidden” transitions and jumpover states requires augmenting the transition probability matrix (again, see blog for details)."
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-4",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-4",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\nCons, cont’d:\n\n\nExcel does not easily do matrix exponentiation, however you can use an approximation (we’ll do this in a case study).\nModern (free) statistical software can easily exponentiate a matrix:"
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-5",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-5",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\nCons, cont’d:\n\nExcel does not easily do matrix exponentiation, however you can use an approximation (we’ll do this in a case study).\nModern (free) statistical software can easily exponentiate a matrix:\n\nlibrary(expm)\nm_P = expm(m_R)"
  },
  {
    "objectID": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-6",
    "href": "lectures/lec_structure.html#b.-exponentiate-the-transition-rate-matrix-6",
    "title": "5. Structuring the Markov Model",
    "section": "3b. Exponentiate the transition rate matrix",
    "text": "3b. Exponentiate the transition rate matrix\nFor our chronic heart failure example, the exponentiated matrix yields a very similar answer to the first approach:\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8772\n0.1172\n0.0056\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000"
  },
  {
    "objectID": "lectures/lec_structure.html#so-where-are-we-now",
    "href": "lectures/lec_structure.html#so-where-are-we-now",
    "title": "5. Structuring the Markov Model",
    "section": "So Where Are We Now?",
    "text": "So Where Are We Now?"
  },
  {
    "objectID": "lectures/lec_structure.html#so-where-are-we-now-1",
    "href": "lectures/lec_structure.html#so-where-are-we-now-1",
    "title": "5. Structuring the Markov Model",
    "section": "So Where Are We Now?",
    "text": "So Where Are We Now?\n\n\nBy constructing our model using the “roots” of a transition rate matrix, we can incorporate disparate sources of information.\nFacilitates country/region-specific background mortality.\nFacilitates standardizing inputs measured at different time intervals."
  },
  {
    "objectID": "lectures/lec_structure.html#so-where-are-we-now-2",
    "href": "lectures/lec_structure.html#so-where-are-we-now-2",
    "title": "5. Structuring the Markov Model",
    "section": "So Where Are We Now?",
    "text": "So Where Are We Now?\n\n\nNot all literature-based parameters operate on transition rates.\nYou will often find that the strategies you want to model have inputs based on odds ratios, relative risks, risk differences, etc."
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued",
    "href": "lectures/lec_structure.html#chf-example-continued",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\nRecall from earlier that we constructed two transition rate matrices:\n\n“Natural History” rate matrix\nStrategy A (“New Drug”) rate matrix based on a hazard ratio (for CHF mortality) of 0.8."
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-1",
    "href": "lectures/lec_structure.html#chf-example-continued-1",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\nThese two rate matrices can be used to construct the following transition probability matrices:\n\n\n\nm_P_NH =\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8772\n0.1172\n0.0056\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000\n\n\n\n\n\n\n\n\nm_P_A =\n\n\n\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8994\n0.0949\n0.0057\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-2",
    "href": "lectures/lec_structure.html#chf-example-continued-2",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\nNow suppose we wanted to model a second strategy (“B”) based on a randomized trial of another drug.\nThat trial reports an odds ratio (OR) of CHF death of 0.75.\nThe probability of CHF death in the placebo (control) arm in that trial was 0.15.1\n\n\nNote this is slightly higher than the corresponding probability in our natural history transition probability matrix (0.1172), reflecting the fact that randomized trial participants are not necessarily representative of the entire population!"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-3",
    "href": "lectures/lec_structure.html#chf-example-continued-3",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\nAn odds ratio is based on the odds of an outcome happening, which is directly related to the probability.\nOdds = \\(\\frac{\\text{Probability of Outcome}}{1 - \\text{Probability of Outcome}}\\)\nOdds Ratio = \\(\\frac{\\text{Odds of outcome in exposed}}{\\text{Odds of outcome in unexposed}}\\)"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-4",
    "href": "lectures/lec_structure.html#chf-example-continued-4",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\n\n\n\n\nImportant\n\n\nNot all literature-based parameters operate on the rate scale. Some operate on the probability scale!"
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.",
    "title": "5. Structuring the Markov Model",
    "section": "4. Make adjustments to \\(\\mathbf{P}\\) as needed.",
    "text": "4. Make adjustments to \\(\\mathbf{P}\\) as needed."
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.-1",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.-1",
    "title": "5. Structuring the Markov Model",
    "section": "4. Make adjustments to \\(\\mathbf{P}\\) as needed.",
    "text": "4. Make adjustments to \\(\\mathbf{P}\\) as needed.\n\n\nConstructing our final transition probability matrix—for natural history or more specifically for for a stratgey under consideration–may require further adjustment.\nWe must be careful about the scale on which these parameters apply.\nOdds ratios, relative risks, and risk differences all operate on the probability scale."
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.-2",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfp-as-needed.-2",
    "title": "5. Structuring the Markov Model",
    "section": "4. Make adjustments to \\(\\mathbf{P}\\) as needed.",
    "text": "4. Make adjustments to \\(\\mathbf{P}\\) as needed.\n\n\n\n\n\n\n\n\n\n\nStatistic\nEvaluates\nRange\nApplicable Domain\n\n\n\n\nRate\n\\(\\frac{\\# \\text{events in time period}}{\\text{Total time period experienced by all subjects followed}}\\)\n0 to \\(\\infty\\)\nRate matrix\n\n\nHazard Ratio\n\\(\\frac{\\text{Hazard rate of outcome in exposed}}{\\text{Hazard rate of outcome in unexposed}}\\)\n0 to \\(\\infty\\)\nRate matrix\n\n\nProbability/risk\n\\(\\frac{\\# \\text{events in time period}}{\\# \\text{people followed for time period}}\\)\n0-1\nProbability matrix\n\n\nOdds\n\\(\\frac{\\text{Probability of Outcome}}{1 - \\text{Probability of Outcome}}\\)\n0 to \\(\\infty\\)\nProbability matrix\n\n\nOdds Ratio\n\\(\\frac{\\text{Odds of outcome in exposed}}{\\text{Odds of outcome in unexposed}}\\)\n0 to \\(\\infty\\)\nProbability matrix\n\n\nRelative Risk\n\\(\\frac{\\text{Probability of outcome in exposed}}{\\text{Probablity of outcome in unexposed}}\\)\n0 to \\(\\infty\\)\nProbability matrix\n\n\nRisk Difference\n\\(\\text{Probability of outcome in exposed}-\\text{Probablity of outcome in unexposed}\\)\n-1 to 1\nProbability matrix"
  },
  {
    "objectID": "lectures/lec_structure.html#make-adjustments-to-mathbfp_s-as-needed.",
    "href": "lectures/lec_structure.html#make-adjustments-to-mathbfp_s-as-needed.",
    "title": "5. Structuring the Markov Model",
    "section": "4. Make adjustments to \\(\\mathbf{P_s}\\) as needed.",
    "text": "4. Make adjustments to \\(\\mathbf{P_s}\\) as needed."
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-5",
    "href": "lectures/lec_structure.html#chf-example-continued-5",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\nLet’s turn back to our CHF example.\n\n\nSuppose we wanted to model a second strategy (“B”) based on a randomized trial of another drug.\nThat trial reports an odds ratio (OR) of CHF death of 0.75.\nThe probability of CHF death in the placebo (control) arm in that trial was 0.15."
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-6",
    "href": "lectures/lec_structure.html#chf-example-continued-6",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\nWe can convert an odds ratio to a relative risk (i.e., ratio of probabilities) if we know the baseline (unexposed) probability of the outcome, \\(p_0\\).\nIn this case we were able to find \\(p_0=0.15\\) in the underlying clinical trial.\nIf we didn’t have this information, we might assume its the same (0.1172) as in our underlying natural history probability matrix1\n\n\nThough note this is an assumption, so we should incorporate a lot of uncertainty around it in our model!"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-7",
    "href": "lectures/lec_structure.html#chf-example-continued-7",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\nWe can convert an odds ratio to a relative risk (RR).1\n\\(RR = \\frac{\\text{Probability of outcome in exposed}}{\\text{Probablity of outcome in unexposed}} = \\frac{p_1}{p_0} = \\frac{OR}{(1-p_0+(p_0 \\times OR))}\\)\nA relative risk is the ratio of the probability of the outcome in the exposed group to the probability of the outcome in the unexposed group.\n\n\nIf the incidence of the outcome is fairly rare (\\(p_0&lt;0.10\\)), you will often see people simply use the OR as a RR. Source for conversion formula: Zhang and Yu (1998)"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-8",
    "href": "lectures/lec_structure.html#chf-example-continued-8",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\n\\(RR = \\frac{p_1}{p_0}\\)\n\\(p_1 = RR \\times p_0\\)\n\\(p_{D_{CHF}} = 0.75 \\times .15 = 0.1125\\)"
  },
  {
    "objectID": "lectures/lec_structure.html#chf-example-continued-9",
    "href": "lectures/lec_structure.html#chf-example-continued-9",
    "title": "5. Structuring the Markov Model",
    "section": "CHF Example, Continued",
    "text": "CHF Example, Continued\n\n\n\n\n\n\n\nm_P =\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8772\n0.1172\n0.0056\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000\n\n\n\n\n\n\n\n\n\n\n\n\nm_P_A =\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8994\n0.0949\n0.0057\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nm_P_B =\n\n\n\nCHF\nD_CHF\nD_OTH\n\n\n\n\nCHF\n0.8819\n0.1125\n0.0056\n\n\nD_CHF\n0.0000\n1.0000\n0.0000\n\n\nD_OTH\n0.0000\n0.0000\n1.0000\n\n\n\n\n\n\n\n\n\nFigure 1: Transition probability matrices (NH = Natural History; A = Strategy A; B = Strategy B)"
  },
  {
    "objectID": "lectures/lec_structure.html#full-process",
    "href": "lectures/lec_structure.html#full-process",
    "title": "5. Structuring the Markov Model",
    "section": "Full Process",
    "text": "Full Process"
  },
  {
    "objectID": "lectures/lec_structure.html#transition-dynamics-1",
    "href": "lectures/lec_structure.html#transition-dynamics-1",
    "title": "5. Structuring the Markov Model",
    "section": "Transition Dynamics",
    "text": "Transition Dynamics\n\n\nWe have focused on “static” transition rate/probability matrices.\nOften, transitions vary as a function of time."
  },
  {
    "objectID": "lectures/lec_structure.html#transition-dynamics-2",
    "href": "lectures/lec_structure.html#transition-dynamics-2",
    "title": "5. Structuring the Markov Model",
    "section": "Transition Dynamics",
    "text": "Transition Dynamics\n\n\nNonstationary rates: background mortality rate rises with age.\nNonstationary rates: transition to disease status may vary over different ages.\nTime-dependent event transitions: rate of adverse events after disease onset is higher in first cycle, lower in subsequent cycles."
  },
  {
    "objectID": "lectures/lec_structure.html#age-varying-background-mortality",
    "href": "lectures/lec_structure.html#age-varying-background-mortality",
    "title": "5. Structuring the Markov Model",
    "section": "Age-Varying Background Mortality",
    "text": "Age-Varying Background Mortality\n\n\nUseful data source is life table data.\nMay be available from vital statistics division in your country.\nAlso available (by region) from the UN and other organizations."
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality",
    "href": "lectures/lec_structure.html#background-mortality",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nYou can fit a Gompertz survival model to each age’s life table data.1\nThe Gompertz model will estimate two parameters: a shape (a) and a rate (b) parameter.\nGompertz parameters (by gender) are shown in the table.\n\n\nSee the workshop blog posting for R code!"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-1",
    "href": "lectures/lec_structure.html#background-mortality-1",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nYou can fit a Gompertz survival model to each age’s life table data.\nThe Gompertz model will estimate two parameters: a shape (a) and a rate (b) parameter.\nGompertz parameters (by gender) are shown in the table on next slide."
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-2",
    "href": "lectures/lec_structure.html#background-mortality-2",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\n\n\n\n\nAge\na_shape\nb_rate\n\n\n\n\n0\n0.08386\n8e-05\n\n\n1\n0.08630\n7e-05\n\n\n2\n0.08644\n8e-05\n\n\n3\n0.08653\n8e-05\n\n\n4\n0.08658\n9e-05\n\n\n5\n0.08661\n1e-04"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-3",
    "href": "lectures/lec_structure.html#background-mortality-3",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nGompertz fit to mortality data for two selected ages (40- and 90-year old U.S. males)\n\n\n\n\n\n\n\n\n\n(a) 40-Year Old Men\n\n\n\n\n\n\n\n\n\n(b) 90-Year Old Men\n\n\n\n\n\nFigure 2: Distribution of observed deaths (grey bars) and fitted Gompertz model (red) for two ages."
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-4",
    "href": "lectures/lec_structure.html#background-mortality-4",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nSuppose we have a model of males starting at age 40.\nEach age has its own estimated shape (a) and rate (b) parameter.\nWe can find the values of \\(a\\) and \\(b\\) for our 40 year old male cohort:"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-5",
    "href": "lectures/lec_structure.html#background-mortality-5",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nSuppose we have a model of males starting at age 40.\nEach age has its own estimated shape (a) and rate (b) parameter.\nWe can find the values of \\(a\\) and \\(b\\) for our 40 year old male cohort:\n\n\n\n\n\n\nAge\na_shape\nb_rate\n\n\n\n\n40\n0.0908323\n0.0017132"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-6",
    "href": "lectures/lec_structure.html#background-mortality-6",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nThese shape and rate values are now fixed for our model\nThat is, we only need these two values, as they allow us to model the remaining life expectancy of our 40-year-old male cohort as it ages through our model!"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-7",
    "href": "lectures/lec_structure.html#background-mortality-7",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nAs our cohort ages through the model (40, 41, 42, …), the background death rate at each subsequent age can be calculated using a simple formula.\nGiven the \\(a\\) and \\(b\\) values for a 40-year-old males, we can calcualte the death rate at any subsequent age as \\[r_{e} =  \\frac{b}{a} (e^{at_2} - e^{at_1})\\]"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-8",
    "href": "lectures/lec_structure.html#background-mortality-8",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nThe Gompertz parameters for 40-year old males (US life table data) are:\n\na = 0.0908\nb = 0.0017"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-9",
    "href": "lectures/lec_structure.html#background-mortality-9",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nAt t=0 (i.e., age 40), the mortality rate for the cohort over the next year is:\n\n\n\n\\[r_{t=0} = 0.0017934 =  \\frac{0.0017132}{0.0908323} (e^{0.0908323 \\cdot 1} - e^{0.0908323 \\cdot (0))})\\]\n\n\n\nUsing a rate-to-probability conversion formula, this corresponds to a probability of death in the next year of \\[p = 1-exp(-r) = 1-exp(-0.0017934) = 0.0017918\\]"
  },
  {
    "objectID": "lectures/lec_structure.html#verifying-accuracy",
    "href": "lectures/lec_structure.html#verifying-accuracy",
    "title": "5. Structuring the Markov Model",
    "section": "Verifying Accuracy",
    "text": "Verifying Accuracy\n\n\nUsing this mortality rate, we can (randomly) draw death times (years from age 40) for 1 million 40 year old males.\nThe average life expectancy is the mean of this value.\nIn this example, the life expectancy is 38.3 years."
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-10",
    "href": "lectures/lec_structure.html#background-mortality-10",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nThis life expectancy closely matches other published data"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-11",
    "href": "lectures/lec_structure.html#background-mortality-11",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\n\nWe can now repeat this exercise for every cycle in our model.\nThis gives us a different background mortality rate for every cycle.\n\n\n\n\n\n\n\n\ncycle\nage\na_shape\nb_rate\nr_mort\np_death\n\n\n\n\n0\n40\n0.0908\n0.0017\n0.0018\n0.0018\n\n\n1\n41\n0.0908\n0.0017\n0.0020\n0.0020\n\n\n2\n42\n0.0908\n0.0017\n0.0022\n0.0021\n\n\n3\n43\n0.0908\n0.0017\n0.0024\n0.0024\n\n\n4\n44\n0.0908\n0.0017\n0.0026\n0.0026\n\n\n5\n45\n0.0908\n0.0017\n0.0028\n0.0028"
  },
  {
    "objectID": "lectures/lec_structure.html#background-mortality-12",
    "href": "lectures/lec_structure.html#background-mortality-12",
    "title": "5. Structuring the Markov Model",
    "section": "Background Mortality",
    "text": "Background Mortality\n\nWe can now repeat this exercise for every cycle in our model.\nThis gives us a different background mortality rate for every cycle.\n\n\n\n\n\n\n\ncycle\nage\na_shape\nb_rate\nr_mort\np_death\n\n\n\n\n50\n90\n0.0908\n0.0017\n0.1683\n0.1549\n\n\n51\n91\n0.0908\n0.0017\n0.1843\n0.1683\n\n\n52\n92\n0.0908\n0.0017\n0.2018\n0.1828\n\n\n53\n93\n0.0908\n0.0017\n0.2210\n0.1983\n\n\n54\n94\n0.0908\n0.0017\n0.2420\n0.2150\n\n\n55\n95\n0.0908\n0.0017\n0.2650\n0.2328"
  },
  {
    "objectID": "lectures/lec_structure.html#nonstationary-rates",
    "href": "lectures/lec_structure.html#nonstationary-rates",
    "title": "5. Structuring the Markov Model",
    "section": "Nonstationary Rates",
    "text": "Nonstationary Rates\n\nYou may have other parameters that vary by age.\n\nDisease specific mortality rate:\n\n\n\nSource: Russell et al. (2016)"
  },
  {
    "objectID": "lectures/lec_structure.html#nonstationary-rates-1",
    "href": "lectures/lec_structure.html#nonstationary-rates-1",
    "title": "5. Structuring the Markov Model",
    "section": "Nonstationary Rates",
    "text": "Nonstationary Rates\n\nYou may have other parameters that vary by age.\n\nDisease specific mortality rate:\nAge-specific intervention rates/probabilities\n\n\n\n\n\n\n\nSource: Russell et al. (2016)"
  },
  {
    "objectID": "lectures/lec_structure.html#nonstationary-rates-2",
    "href": "lectures/lec_structure.html#nonstationary-rates-2",
    "title": "5. Structuring the Markov Model",
    "section": "Nonstationary Rates",
    "text": "Nonstationary Rates\n\n\nIt is straightforward to incorporate these dynamics into a Markov model.\nEssentially, you recalculate the transition probability matrix in each cycle.\nThis works long as the underlying rates/probabilities change by age."
  },
  {
    "objectID": "lectures/lec_structure.html#nonstationary-rates-3",
    "href": "lectures/lec_structure.html#nonstationary-rates-3",
    "title": "5. Structuring the Markov Model",
    "section": "Nonstationary Rates",
    "text": "Nonstationary Rates\n\n\nThis makes the Excel a bit more complicated, because you have to incorporate visual basic code to recalculate.\nWe have constructed an optional case study that draws on age-specific background mortality rates – see the workshop website for more!"
  },
  {
    "objectID": "lectures/lec_structure.html#other-transition-dynamics",
    "href": "lectures/lec_structure.html#other-transition-dynamics",
    "title": "5. Structuring the Markov Model",
    "section": "Other Transition Dynamics",
    "text": "Other Transition Dynamics\n\n\nSuppose, instead, that event/transition rates, costs, quality of life vary over the course of a disease or other process in our model.\nExample: cost, quality of life weight, or risk of adverse event (e.g., death) is different in first year after disease onset, and changes thereafter.\nThese types of dynamics are more challenging to implement – but you can often do it!"
  },
  {
    "objectID": "lectures/lec_structure.html#other-transition-dynamics-1",
    "href": "lectures/lec_structure.html#other-transition-dynamics-1",
    "title": "5. Structuring the Markov Model",
    "section": "Other Transition Dynamics",
    "text": "Other Transition Dynamics\n\n\nOne option is to simply build a decision tree around events that occur at higher rates shortly after disease onset, surgery, drug initiation, etc.\nThe decision tree can follow people until they reach a “steady state” — then the Markov model can pick up from there."
  },
  {
    "objectID": "lectures/lec_structure.html#other-transition-dynamics-2",
    "href": "lectures/lec_structure.html#other-transition-dynamics-2",
    "title": "5. Structuring the Markov Model",
    "section": "Other Transition Dynamics",
    "text": "Other Transition Dynamics\n\n\nAnother option is “tunnel states” — simply expand the health state to follow people over the first few cycles of onset.\nTunnel states are “non-markovian,” so they need to be added once you have the transition probability matrix defined."
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\n\n\nLet’s take a simple healthy, sick, dead model.\nIllness onset rate = 0.0314\nBackground mortality rate = 0.0094\nIllness increases the risk of death by a hazard ratio of 5.45."
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-1",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-1",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\nTransition rate matrix: \\(\\mathbf{R}\\)\n\n\n\n\n\n\nH\nS\nD\n\n\n\n\nH\n-0.0408\n0.0314\n0.0094\n\n\nS\n0.0000\n-0.0513\n0.0513\n\n\nD\n0.0000\n0.0000\n0.0000"
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-2",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-2",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\nTransition probability matrix: \\(\\exp(\\mathbf{R})\\)\n\n\n\n\n\n\nH\nS\nD\n\n\n\n\nH\n0.96\n0.03\n0.01\n\n\nS\n0.00\n0.95\n0.05\n\n\nD\n0.00\n0.00\n1.00"
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-3",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-3",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\n\n\nNow suppose that the probability of death from disease varies by time since disease onset.\n\n0.08 in first year\n0.06 in second year\n0.04 in third year onwards\n\nWe can add tunnel states to our transition probability matrix to accomodate this."
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-4",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-4",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\n\nHere is the new transition probability matrix.\nNotice how the tunnel states “force” people to transition either to the next disease state if they do not die of the disease in the cycle.\n\n\n\n\n\n\n\n\nH\nS1\nS2\nS\nD\n\n\n\n\nH\n0.96\n0.03\n0.00\n0.00\n0.01\n\n\nS1\n0.00\n0.00\n0.92\n0.00\n0.08\n\n\nS2\n0.00\n0.00\n0.00\n0.94\n0.06\n\n\nS\n0.00\n0.00\n0.00\n0.96\n0.04\n\n\nD\n0.00\n0.00\n0.00\n0.00\n1.00"
  },
  {
    "objectID": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-5",
    "href": "lectures/lec_structure.html#tunnel-states-healthy-sick-dead-5",
    "title": "5. Structuring the Markov Model",
    "section": "Tunnel States: Healthy, Sick, Dead",
    "text": "Tunnel States: Healthy, Sick, Dead\n\nIf we run out the Markov trace for five cycles, here are the results.\n\n\n\nYou can find a nice discussion of how to incorporate tunnel states into an Excel model here.\n\n\n\n\n\n\n\n\ncycle\nH\nS1\nS2\nS\nS_total\nD\n\n\n\n\n0\n1000\n0\n0\n0\n0\n0\n\n\n1\n960\n30\n0\n0\n30\n10\n\n\n2\n922\n29\n28\n0\n57\n22\n\n\n3\n885\n28\n26\n26\n80\n35\n\n\n4\n849\n27\n25\n50\n102\n49\n\n\n5\n815\n25\n24\n72\n121\n63"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-1",
    "href": "lectures/lec_structure.html#working-backwards-1",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\n\n\nSuppose someone has already constructed a detailed Markov model for the decision problem you are working on.\nHowever, this model was constructed for another country/region/context.\nRather than start from “scratch” with your own model, you might be able to adapt it!"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-2",
    "href": "lectures/lec_structure.html#working-backwards-2",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\nEssentially, this means working backwards!"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-3",
    "href": "lectures/lec_structure.html#working-backwards-3",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\nEssentially, this means working backwards!"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-4",
    "href": "lectures/lec_structure.html#working-backwards-4",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\n\n\nWe won’t go into the (very mathematical) details, but we will show you how to do this!\nEssentially, we will “solve” for what is called the generator matrix for the (existing) transition probability matrix.\nThis is done through a process known as “eigenvalue decomposition.”\nNote that this is not always possible, depending on the matrix!"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-5",
    "href": "lectures/lec_structure.html#working-backwards-5",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\nLet’s start with the example transition probability matrix from earlier:\nm_P =\n\n\n\n\n\n\nH\nS\nD\n\n\n\n\nH\n0.96\n0.03\n0.01\n\n\nS\n0.00\n0.95\n0.05\n\n\nD\n0.00\n0.00\n1.00"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-6",
    "href": "lectures/lec_structure.html#working-backwards-6",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\nTo obtain the rate matrix (m_R) from an existing transition probability matrix (m_P):\nV  &lt;- eigen(m_P)$vectors\niV &lt;- solve(V)\nAp &lt;- iV %*% m_P %*% V\nlAp &lt;- diag(log(diag(Ap)), nrow(Ap), ncol(Ap))\nm_R  &lt;- V %*% lAp %*% iV"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-7",
    "href": "lectures/lec_structure.html#working-backwards-7",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\nTo obtain the rate matrix (m_R) from an existing transition probability matrix (m_P):\nm_R =\n\n\n\n\n\n\nH\nS\nD\n\n\n\n\nH\n-0.040822\n0.0314139\n0.0094081\n\n\nS\n0.000000\n-0.0512933\n0.0512933\n\n\nD\n0.000000\n0.0000000\n0.0000000"
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-8",
    "href": "lectures/lec_structure.html#working-backwards-8",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\n\n\nWe now have the rate matrix that is the “hub” or “root” of the underlying Markov model!\nFrom here, we could adapt rates using country-specific parameters.\nFor example, we could adapt the rate of background mortality to match our country’s/region’s mortality rate.\nWe could also add additional states, or make other changes as needed."
  },
  {
    "objectID": "lectures/lec_structure.html#working-backwards-9",
    "href": "lectures/lec_structure.html#working-backwards-9",
    "title": "5. Structuring the Markov Model",
    "section": "Working Backwards",
    "text": "Working Backwards\n\n\nOnce we make the changes we need, we just go back to our usual process.\n“Embed” the new transition probability matrix using rate-to-probability conversion formulas, or using exponentiation."
  },
  {
    "objectID": "lectures/lec_structure.html#footnotes",
    "href": "lectures/lec_structure.html#footnotes",
    "title": "5. Structuring the Markov Model",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nThis often comes from separate vital statistics / life-table data sources.↩︎\nNote this is slightly higher than the corresponding probability in our natural history transition probability matrix (0.1172), reflecting the fact that randomized trial participants are not necessarily representative of the entire population!↩︎\nThough note this is an assumption, so we should incorporate a lot of uncertainty around it in our model!↩︎\nIf the incidence of the outcome is fairly rare (\\(p_0&lt;0.10\\)), you will often see people simply use the OR as a RR. Source for conversion formula: Zhang and Yu (1998)↩︎\nSee the workshop blog posting for R code!↩︎"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html",
    "href": "lectures/exercise_ANS_structure.html",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "",
    "text": "m_R0 =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n-(r_AP/10+r_Db)\nr_AP/10\n0 \\(\\quad \\quad \\quad\\)\nr_Db\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad\\)\n-(HR_PDd * r_Db + r_Db)\nHR_PDd * r_Db\nr_Db\n\n\nDisease Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-natural-history",
    "href": "lectures/exercise_ANS_structure.html#answer-natural-history",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "",
    "text": "m_R0 =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n-(r_AP/10+r_Db)\nr_AP/10\n0 \\(\\quad \\quad \\quad\\)\nr_Db\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad\\)\n-(HR_PDd * r_Db + r_Db)\nHR_PDd * r_Db\nr_Db\n\n\nDisease Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-natural-history-1",
    "href": "lectures/exercise_ANS_structure.html#answer-natural-history-1",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Natural History",
    "text": "Answer: Natural History\nm_P0 = exp(m_R0) =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n1-p_AP-p_ADb\np_AP \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\np_ADb \\(\\quad \\quad \\quad\\)\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n1-p_PDd-p_PDb\np_PDd\\(\\quad \\quad \\quad \\quad \\quad\\)\np_PDb\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-strategy-a",
    "href": "lectures/exercise_ANS_structure.html#answer-strategy-a",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Strategy A",
    "text": "Answer: Strategy A\nBasis is m_P0\nm_P_A =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n1-RR_AP * p_AP-p_ADb\nRR_AP p_AP \\(\\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\np_ADb \\(\\quad \\quad \\quad\\)\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n1-p_PDd-p_PDb\np_PDd\\(\\quad \\quad \\quad \\quad \\quad\\)\np_PDb\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-strategy-b",
    "href": "lectures/exercise_ANS_structure.html#answer-strategy-b",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Strategy B",
    "text": "Answer: Strategy B\nBasis is m_P0\nm_P_B =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n1-p_AP-p_ADb\np_AP \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\np_ADb \\(\\quad \\quad \\quad\\)\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n1-((OR_PDd / (1 - p0_OR_PDd + (p0_OR_PDd * OR_PDd ))) * p_PDd)-p_PDb\n(OR_PDd / (1 - p0_OR_PDd + (p0_OR_PDd * OR_PDd )))  * p_PDd\np_PDb\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-strategy-b-1",
    "href": "lectures/exercise_ANS_structure.html#answer-strategy-b-1",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Strategy B",
    "text": "Answer: Strategy B\nNote that because p0_OR_PDd is fairly low (i.e., 0.03), you could just use the odds ratio as a relative risk.\nBasis is m_P0\nm_P_B =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n1-p_AP-p_ADb\np_AP \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\np_ADb \\(\\quad \\quad \\quad\\)\n\n\nProgressive Disease\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n1- OR_PDd * p_PDd)-p_PDb\nOR_PDd  * p_PDd\np_PDb\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-strategy-c",
    "href": "lectures/exercise_ANS_structure.html#answer-strategy-c",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Strategy C",
    "text": "Answer: Strategy C\nBasis is m_R0\nm_R_C =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n-(r_AP/10+r_Db)\nr_AP/10\n0 \\(\\quad \\quad \\quad\\)\nr_Db\n\n\nProgressive Disease\nr_PA_trtC/10\n-(r_PA_trtC/10 + HR_PDd * r_Db + r_Db)\nHR_PDd * r_Db\nr_Db\n\n\nDisease Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "lectures/exercise_ANS_structure.html#answer-strategy-c-1",
    "href": "lectures/exercise_ANS_structure.html#answer-strategy-c-1",
    "title": "Answer Key: Structuring the Markov Model Group Exercise",
    "section": "Answer: Strategy C",
    "text": "Answer: Strategy C\nm_P_C = exp(m_R_C) =\n\n\n\n\n\n\n\n\n\n\n\n\nAsymptomatic\nProgressive Disease\nDisease Mortality\nBackground Mortality\n\n\n\n\nAsymptomatic\n1-p_AP-p_ADb\np_AP \\(\\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad\\)\np_ADb \\(\\quad \\quad \\quad\\)\n\n\nProgressive Disease\np_PA \\(\\quad \\quad \\quad \\quad\\)\n1-p_PDd-p_PDb\np_PDd\\(\\quad \\quad \\quad \\quad \\quad\\)\np_PDb\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nDisease Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0 \\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\nBackground Mortality\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n0\\(\\quad \\quad \\quad \\quad \\quad\\)\n1.0\\(\\quad \\quad \\quad \\quad \\quad\\)\n\n\n\n\n\n\n\n\nRate adjusted for timestep\n\n\nHazard Ratio\n\n\nProbability\n\n\nRelative Risk\n\n\nOdds Ratio\n\n\nConstructed from other cells"
  },
  {
    "objectID": "blog/posts/embedding/embedding-a-transition-probability-matrix.html",
    "href": "blog/posts/embedding/embedding-a-transition-probability-matrix.html",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "",
    "text": "Define \\(r_{HS}\\) and \\(r_{HD}\\) as the hazard rate of two independent competing risks from a given (Healthy) health state (to Sick and Dead, respectively), and \\(\\Delta t\\) the cycle length (e.g., \\(1\\)=1 year, \\(1/12\\)=1 month, etc.). We can also define a third rate \\(r_{SD} = hr_{S}*r_{HD}\\) for transitioning from sick to dead, i.e., the standard (healthy-to-dead) rate multiplied by the hazard ratio \\(hr_{S}\\).\nThe underlying Markov model takes the following form:\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD   \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n  hr_S * r_HD   \n\nDead-&gt;Dead\n\n   \n\n\nFigure 1: Model Diagram\n\n\n\n\n\n\n\nCode\nlibrary(Matrix)\nlibrary(tidyverse)\nlibrary(expm)\nlibrary(knitr)\nlibrary(gt)\nlibrary(directlabels)\nlibrary(glue)\nlibrary(ggsci)\nlibrary(ggthemes)\n\n# Better accuracy that \"life-table\" aka trapezoidal method\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\nalt_simp      &lt;- function(x,h) h*sum(alt_simp_coef(length(x)) * x)\n\nr_HS &lt;- 0.15\nr_HD &lt;- .006\nhr_S &lt;- 10\nr_SD &lt;- hr_S*r_HD\ncycle &lt;- 1\n\n# 1-exp(-r_HS*cycle)\n# 1-exp(-r_HD*cycle)\n\nget_P &lt;- function(r_HS,r_HD,r_SD,cycle) {\n  P_st &lt;- \n  matrix(\n  c(exp(-r_HS*cycle) + exp(-r_HD*cycle) -1 ,  (1-exp(-r_HS*cycle)) ,  1-exp(-r_HD*cycle), \n  0, exp(-r_SD*cycle), 1-exp(-r_SD*cycle),\n  0,0,1),\n  nrow = 3, \n  ncol = 3,\n  byrow=TRUE,\n  dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% \n    mutate(name = \"P_st\")\n\n  P_eQ &lt;- matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% expm() %&gt;% as.matrix() %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% \n    mutate(name = \"P_eQ\")\n\n\n  P_cr &lt;- \n    matrix(\n    c(exp(-(r_HS+r_HD)*cycle) , (r_HS/(r_HS+r_HD)) * (1-exp(-(r_HS+r_HD)*cycle))   ,(r_HD/(r_HS+r_HD)) * (1-exp(-(r_HS+r_HD)*cycle))   , \n    0, exp(-r_SD*cycle), 1-exp(-r_SD*cycle),\n    0,0,1),\n    nrow = 3, \n    ncol = 3,\n    byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) %&gt;% \n    data.frame() %&gt;% \n    rownames_to_column(var = \"from\") %&gt;% mutate(name = \"P_cr\")\n  \n  \n  \n  out &lt;- bind_rows( P_st, P_cr , P_eQ)\n  return(out)\n}\n\n\n\n\nCode\ncheck_sens &lt;- function(r_HD,r_HS,r_SD,cycle) {\n  \nQ &lt;- matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) \n\n# Q_ &lt;- rbind(cbind(Q,c(r_HS*cycle,0,0)),c(0,0,0,0)) \n# Q_ &lt;- rbind(cbind(Q_,c(r_HD*cycle,0,0,0)),c(0,0,0,0,0))\n# dimnames(Q_) = list(c(\"Healthy\",\"Sick\",\"Dead\",\"accS\",\"accHD\"),\n#                    c(\"Healthy\",\"Sick\",\"Dead\",\"accS\",\"accHD\"))\n\nQ_ &lt;- Q\n\nP &lt;- Q_ %&gt;% expm() %&gt;% as.matrix() \nres &lt;- get_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle)\n\nP_cr &lt;- res %&gt;% filter(name==\"P_cr\") %&gt;% select(from,Healthy,Sick,Dead) %&gt;% \n  data.frame() %&gt;% \n  column_to_rownames(var = \"from\") %&gt;% \n  as.matrix()\n\nP_st &lt;- res %&gt;% filter(name==\"P_st\") %&gt;% select(from,Healthy,Sick,Dead) %&gt;% \n  data.frame() %&gt;% \n  column_to_rownames(var = \"from\") %&gt;% \n  as.matrix()\n\nle1 &lt;- \n  0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n  as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n\nres1 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le1) %&gt;% \n  mutate(method = \"P_eQ\") \n\nle2 &lt;- \n  0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P_cr[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n   as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n  \nres2 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P_cr %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le2) %&gt;% \n  mutate(method = \"P_cr\")\n\n\nle3 &lt;- \n 0:(60/cycle) %&gt;% map(~(c(1000,0,0) %*% (P_st[1:3,1:3] %^% (.x)))) %&gt;% \n  map(~(.x %&gt;% data.frame)) %&gt;% \n  bind_rows() %&gt;% \n   as.matrix() %&gt;%  \n  {.[,-3]} %&gt;% \n  alt_simp(.,1) %&gt;% \n  {. * cycle} %&gt;% {./1000} %&gt;% \n  data.frame() %&gt;% \n  set_names(\"life_exp\")\n\nres3 &lt;- 0:(60/cycle) %&gt;% map_df(~(c(1000,0,0) %*% (P_st %^%.x) %&gt;% data.frame())) %&gt;% \n  mutate(cycle = 0:(60/cycle)) %&gt;% \n  select(cycle, everything()) %&gt;% \n  tibble() %&gt;% \n  tail(n=1) %&gt;% \n  bind_cols(le3) %&gt;% \n  mutate(method = \"P_st\")\n  \n  out &lt;- res1 %&gt;% bind_rows(res2) %&gt;% bind_rows(res3)\n  return(out)\n\n}"
  },
  {
    "objectID": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#standard-rate-to-transition-conversion",
    "href": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#standard-rate-to-transition-conversion",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "Standard Rate-to-Transition Conversion",
    "text": "Standard Rate-to-Transition Conversion\nLet’s first convert the supplied rates to probabilities using the same standard formulas, as above:\n\\[\np_{HS}= 1 - e^{-r_{HS}\\cdot \\Delta t}\n\\]\n\\[\np_{HD} = 1 - e^{-r_{HD}\\cdot \\Delta t}\n\\]\nWe can also define the probability of remaining healthy (i.e., transitioning to neither the sick or dead state) as:\n\\[\np_{HH} = 1 - p_{HS} - p_{HD}= e^{-r_{HS}\\Delta t}  + e^{-r_{HD}\\Delta t} - 1\n\\]\nAnd finally the probability of dying among sick people is defined as\n\\[\np_{SD} = 1 - e^{-hr_{HD}\\cdot r_{HD}\\cdot \\Delta t}\n\\]\nFigure 6 shows the corresponding transition probability matrix:\n\n\nCode\nr_HD &lt;- 0.006\nr_SD &lt;- 10*0.006\n\nget_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle) %&gt;% \nfilter(name==\"P_st\") %&gt;% \nselect(-name) %&gt;% \n#column_to_rownames(\"from\") %&gt;% \nmutate_at(vars(-from), ~round(.,4)) %&gt;% \ngt() %&gt;% \n  cols_label(\"from\"=\"\")\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n0.8547\n0.1393\n0.0060\n\n\nSick\n0.0000\n0.9418\n0.0582\n\n\nDead\n0.0000\n0.0000\n1.0000\n\n\n\n\n\nFigure 6: Transition Probability Matrix Using Standard Rate-to-Probability Conversion Formulas\n\n\n\nGiven this transition probability matrix, how many healthy, sick and dead individuals do we have in our cohort after a 60-year time horizon? Figure 7 summarizes state occupancy at the end of 60 years:\n\n\nCode\nres_60yst &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD, cycle=1) %&gt;% \n  filter(method==\"P_st\") \nres_60yst %&gt;% \n  select(cycle,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n60\n0.1\n43.6\n956.3\n22.1\n\n\n\n\n\nFigure 7: 1-Year Cycle\n\n\n\nAs Figure 7 shows, after 60 years, 43.6 are recorded as being in the sick state and life expectancy has reduced to 22.1 years.\nAs above, let’s now repeat the same exercise using a daily cycle length:\n\n\nCode\nres_60yst_daily &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD,cycle=1/365) %&gt;% \n  filter(method==\"P_st\") \n\nres_60yst_daily %&gt;% \n  select(cycle,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n21900\n0.1\n42.6\n957.4\n21.7\n\n\n\n\n\nFigure 8: Daily Cycle\n\n\n\nBy switching to a daily cycle we now have 42.6 recorded as being in the sick state after 60 years (=21,900 days) and life expectancy is 21.7 years.\n\nSigns of Trouble\nLet’s recap what we have found after introducing background mortality as a competing risk:\n\nUsing a 1-year cycle length, life expectancy is 22.11 years.\nUsing a daily cycle length, life expectancy is 21.73 years.\n\nThe only difference above is the cycle length used, yet we obtain a 0.38 year difference in life expectancy. What causes this difference?\n\n\nDiscretizing a Continuous Time Process\nThe answer boils down to the fact that with longer cycle lengths we “hide” some deaths that occur because a full healthy sick dead transition occurs within a single cycle.\nWhen we use the standard rate-to-probability conversion formula (i.e., \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\)) we obtain the marginal probability of transition. This marginal probability reflects the union of all possible transitions that start Healthy and then transition to and from the sick state in the cycle.\nThat is, \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\) captures the probability of following scenarios occurring in a cycle:\n\nIndividual transitions from healthy to sick.\nIndividual transitions from healthy to sick to dead.\n\nBy including case 2 in the healthy sick transition probability, we effectively rule out the possibility of becoming sick and dying within the same cycle. This implicit assumption means that we are no longer modeling a continuous time process, since we effectively “hide” some (quick) deaths that occur within a cycle due to the disease:\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n    \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n    \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n    \n\nDead-&gt;Dead\n\n   \n\n\nFigure 9: compound Transition Patterns Using Standard Rate to Probability Conversion Formulas\n\n\n\n\nIn Figure 9, and using standard rate-to-probability conversion formulas, the recorded states of a healthy sick dead transition are recorded in blue; the “hidden” transition is shown in red.\n\nAlternative Rate-to-Probability Conversion\nAnother set of formulas often used to account for competing risks are as follows:\n\\[\np_{HS}= \\frac{r_{HS}}{r_{HS}+r_{HD}}\\big ( 1 - e^{-(r_{HS}+r_{HD})\\Delta t}\\big )\n\\]\n\\[\np_{HD}= \\frac{r_{HD}}{r_{HS}+r_{HD}}\\big ( 1 - e^{-(r_{HS}+r_{HD})\\Delta t}\\big )\n\\]\n\\[\np_{HH} = e^{-(r_{HS}+r_{HD})\\Delta t}\n\\]\nLet’s now use these formulas instead.\nFigure 10 shows the corresponding transition probability matrix:\n\n\nCode\nr_HD &lt;- 0.006\nr_SD &lt;- 10*0.006\n\nget_P(r_HS=r_HS,r_HD=r_HD,r_SD=r_SD,cycle=cycle) %&gt;% \nfilter(name==\"P_cr\") %&gt;% \nselect(-name) %&gt;% \n#column_to_rownames(\"from\") %&gt;% \nmutate_at(vars(-from), ~round(.,4)) %&gt;% \ngt() %&gt;% \n  cols_label(\"from\"=\"\")\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n0.8556\n0.1389\n0.0056\n\n\nSick\n0.0000\n0.9418\n0.0582\n\n\nDead\n0.0000\n0.0000\n1.0000\n\n\n\n\n\nFigure 10: Transition Probability Matrix Using Alternative Rate-to-Probability Conversion Formulas\n\n\n\nComparing Figure 6 and Figure 10, notice that a few things have changed. First, the probability of Healthy Sick transition declined. This would seem to be consistent with a world in which there are fewer alive sick individuals observed at the end of the cycle–which we would expect if acute illness results in a nontrivial number of quick deaths after illness onset in a cycle.\nHowever, look at the Healthy Dead transition probability change; it went down, too. If we were recording more acute deaths from the disease, we should see more Healthy Dead transitions from individuals sojourning through the Sick state on their way to death in a single cycle.\nWhat about state occupancy and life expectancy under different cycle lengths?\n\n\nCode\nres_60yst_cr &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD, cycle=1) %&gt;% \n  filter(method==\"P_cr\") %&gt;% \n  mutate(cycle = \"1y\") %&gt;% \n  mutate(cycle_t = 60)\n\nres_60yst_daily_cr &lt;- \n  check_sens(r_HD= r_HD, r_HS = r_HS, r_SD = r_SD,cycle=1/365) %&gt;% \n  filter(method==\"P_cr\") %&gt;% \n  mutate(cycle_t = cycle) %&gt;% \n  mutate(cycle = \"Daily\")\n\nres_60yst_cr %&gt;% \n  bind_rows(res_60yst_daily_cr) %&gt;% \n  select(cycle,cycle_t,Healthy,Sick,Dead,life_exp) %&gt;% \n  gt::gt() %&gt;% \n  sub_missing(missing_text=\"-\") %&gt;% \n  fmt_number(columns = c(Healthy,Sick,Dead,life_exp),decimals=1) %&gt;% \n  cols_label(\"life_exp\" = \"Life Expectancy\")\n\n\n\n\n\n\n\n\n\n\ncycle\ncycle_t\nHealthy\nSick\nDead\nLife Expectancy\n\n\n\n\n1y\n60\n0.1\n43.9\n956.0\n22.2\n\n\nDaily\n21900\n0.1\n42.6\n957.4\n21.7\n\n\n\n\n\nFigure 11: 1-Year vs. Daily Cycle\n\n\n\nCode\ndiff_st_cr &lt;- \n  res_60yst_cr %&gt;% \n    bind_rows(res_60yst_daily_cr) %&gt;% mutate(life_exp = life_exp-lead(life_exp)) %&gt;% pull(life_exp) %&gt;% na.omit() %&gt;% as.vector()\n\n\nAgain, we have a difference in life expectancy of 0.462 years. So switching to the alternative formulas has not fundamentally solved our problem.\n\n\nHow do transition probabilities change as the Likelihood of Disease-related death varies?\nAnother way to see the issue is to plot how the transition probabilities change (or not) at different levels of disease acuity. Figure 12 plots the relevant transition probabilities under a yearly time cycle, and while allowing the underlying hazard rate of death from the disease (hr_S) to vary.\nAs the hazard rate increases, the likelihood of ending up dead within a given cycle increases. Indeed, in the most extreme case, imagine the disease has a near instantaneous death rate. In that case we should see almost no Healthy Sick transitions within a yearly cycle, because nearly everyone who became sick within the cycle died within 1 day.\nWe see in Figure 12 that the Healthy Sick probabilities remain flat for transitions under which background mortality is a competing event. However, the Sick Dead transition probabilities rise as the likelihood of fatal disease increases.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n    filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n  scale_shape_manual(values = c(19,17)) +\n  scale_color_manual(values= c(\"blue\",\"red\")) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 12: Yearly Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)\n\n\n\n\nIt is common practice to address these issues using the following guidelines:\n\nSelect a cycle length where the probability of remaining in a given state is at least 95%.\nPick a cycle length that aligns with the clinical/disease timelines of the decision problem.\n\nTreatment schedules.\nAcute vs. chronic condition.\n\n\nBut do these actually solve the issue? No. Figure 13 shows how the transition probabilities change when we switch to a daily cycle length. Again, we see the problem: as disease acuity increases, the probability of a Healthy Dead transition does not change; even though we shortened the cycle length, we have not fundamentally addressed the issue.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1/365) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n  filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n    scale_shape_manual(values = c(19,17)) +\n  scale_color_manual(values= c(\"blue\",\"red\")) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 13: Daily Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks.)\n\n\n\n\nHow does this all translate into model outputs, such as life expectancy? Figure 14 plots life-expectancy (y-axis) against the underlying disease hazard rate for death. Each line provides the life-expectancy curve under a different cycle length, with everything else in the model held fixed.\nNot surprisingly, we see that as the likelihood of fatal disease increases, life expectancy declines.\nBut the most important takeaway is that the modeled life expectancy differs depending on the cycle length used. For a given hazard rate the underlying disease process is exactly the same – but we get different answers depending on our cycle length.\nThe pattern of results is instructive, too. Essentially, with longer cycle lengths and incorrect transition probabilities, we will “miss” more compound within-cycle Healthy Sick Dead transitions and instead record them as Healthy Sick transitions. This has a net effect of “hiding” more disease-related death in our model – and life-expectancy is inflated as a result.\n\n\n\n\n\nFigure 14: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length. The left panel uses the formula that accounts for competing risks. The right panel uses standard conversion formula."
  },
  {
    "objectID": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#embed-the-transition-probability-matrix",
    "href": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#embed-the-transition-probability-matrix",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "1. Embed the Transition Probability Matrix",
    "text": "1. Embed the Transition Probability Matrix\nOur rate matrix Q is constructed by including the relevant transition rates in the off-diagonal cells. The diagonal of Q is the negative sum of off-diagonal elements in the same row:\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\n\n\n\n\nHealthy\n-(\\(r_{HS}\\) + \\(r_{HD}\\))\n\\(r_{HS}\\)\n\\(r_{HD}\\)\n\n\nSick\n0\n-(\\(hr_{S} \\cdot r_{HD}\\))\n\\(hr_{S} \\cdot r_{HD}\\)\n\n\nDead\n0\n0\n0\n\n\n\nHere is the rate matrix for the Healthy-Sick-Dead model:\n\n\nCode\nparams &lt;- \n  list(r_HS = 0.15,\n       r_HD = 0.006,\n       hr_S = 10,\n       cycle = 1)\n\nQ &lt;- \n  with(params,{\n    matrix(\n    c(-(r_HS*cycle+r_HD*cycle),r_HS*cycle,r_HD*cycle,\n      0,-r_SD*cycle,r_SD*cycle,\n      0,0,0),\n      nrow=3,\n      ncol=3,\n      byrow=TRUE,\n    dimnames = list(c(\"Healthy\",\"Sick\",\"Dead\"), c(\"Healthy\",\"Sick\",\"Dead\"))\n  ) \n  })\nQ\n\n\n        Healthy  Sick  Dead\nHealthy  -0.156  0.15 0.006\nSick      0.000 -0.06 0.060\nDead      0.000  0.00 0.000\n\n\nWe next embed the transition probability matrix P by taking the matrix exponential of Q:\n\nlibrary(expm)\nP &lt;- expm(Q)\nP\n\n          Healthy      Sick        Dead\nHealthy 0.8555592 0.1346958 0.009744961\nSick    0.0000000 0.9417645 0.058235466\nDead    0.0000000 0.0000000 1.000000000\n\n\nAn alternative way of exponentiating a matrix is to perform a Taylor series expansion:\n\n# Identity matrix with same dimensions and names as Q \nQ_I &lt;- diag(3)\ndimnames(Q_I) = dimnames(Q)\n\n# Note the %^% operator is in the expm package. \n\nQ2 = Q %^% 2   # Q-squared\nQ3 = Q %^% 3   # Q-cubed\nQ4 = Q %^% 4   # etc.\n\nQ_I + Q + (1/factorial(2))*Q2 + (1/factorial(3))*Q3 + (1/factorial(4))*Q4 \n\n          Healthy      Sick        Dead\nHealthy 0.8555599 0.1346947 0.009745373\nSick    0.0000000 0.9417645 0.058235460\nDead    0.0000000 0.0000000 1.000000000\n\n\nHow does this approach (P_eQ) perform relative to the other transition probability matrices (P_st and P_cr)? Figure 15 shows how the transition probabilities vary by hazard rate.\nWe can now see we’ve achieved what we need: Healthy Dead transition probabilities that rise as the hazard rate of death from disease increases. Again, this occurs because as the likelihood of death after becoming ill increases, we increase the likelihood of a compound Healthy Sick Dead transition within a cycle. We need these to be recorded (accurately) as Healthy Dead transitions, rather than Healthy Sick transitions. Correspondingly, as the probability of a compound transition increases with an increasing hazard rate, the probability of a single Healthy Sick transition declines; we see this in Figure 15 as well.\n\n\nCode\n1:10 %&gt;% map(~get_P(r_HS=.15,r_HD=.006,r_SD=.006*.x,cycle=1) %&gt;% mutate(hr_S=.x)) %&gt;% \n  bind_rows() %&gt;% \n  gather(transition,value,-from,-name,-hr_S) %&gt;% \n  spread(name,value) %&gt;% \n  filter(P_cr!=1 & P_cr!=0) %&gt;% \n  gather(method,value,-from,-hr_S,-transition) %&gt;% \n  #filter(method!=\"P_eQ\") %&gt;% \n  tibble() %&gt;% \n  mutate_at(vars(transition), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  mutate_at(vars(from), function(x) factor(x,levels=c(\"Healthy\",\"Sick\",\"Dead\"),\n                                           labels=c(\"Healthy\",\"Sick\",\"Dead\"))) %&gt;% \n  filter(from!=transition) %&gt;% \n  ggplot(aes(x = hr_S, y = value)) + \n  geom_point(aes(colour=method, shape=method),size=3) + \n  scale_shape_manual(values = c(19,17,3)) +\n  facet_wrap(from~transition, scales=\"free\") + \n  ggthemes::theme_base() + \n  scale_x_continuous(expand = expansion(mult=.5))+\n  scale_y_continuous(expand = expansion(mult=.5))+\n  theme(legend.position = \"bottom\") +\n  scale_color_manual(values= c(\"blue\",\"darkgreen\",\"red\")) +\n  directlabels::geom_dl(aes(label = glue::glue(\"  {method}\")), method=\"last.bumpup\",hjust=1) + \n  labs(x = \"hr_S (Hazard Ratio for Sick-to-Dead)\",y = \"Value\")\n\n\n\n\n\nFigure 15: 1-Year Cycle - Transition Probabilities by Sick-to-Dead Hazard Rate (P_st uses standard conversion formula; P_cr uses the formula that accounts for competing risks, and P_eQ is embedded using the transition rate matrix Q.)\n\n\n\n\nWe also see that regardless of the cycle length used, we always end up with the same calculated life expectancy:\n\n\n\n\n\nFigure 16: Life Expectancy by Sick-to-Dead Hazard Rate and Cycle Length\n\n\n\n\nWe have thus “fixed” our problem of hidden disease-related deaths!\n\nWhy is this important?\nThe use of an embedded transition probability matrix is important for a number of reasons:\n\nThe Markov model accurately reflects the underlying continuous time process.\nWe get an accurate accounting of disease-related deaths.\nWe can use whatever cycle length we need – this facilitates computationally intensive processes such as probabilistic sensitivity analyses, which may not be feasible with a short (e.g., daily) cycle length.\nWe also avoid “state explosion” in the event our model has tunnel states. For example, if there is a one-year tunnel state for costs or utilities following disease onset, if we switched to a monthly or daily cycle we’d have to build in dozens or more health states into our Markov model. Beacuse we can stick with a one-year cycle, this makes use of tunnel states much more feasible.\n\nThe primary “cost” of using this approach over standard rate-to-probability conversion formulas is that we must be a bit more careful in structuring our transition probability matrix to include accumulators used to aggregate model outputs. We will cover this process in the section directly below."
  },
  {
    "objectID": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#include-non-markovian-accumulators-to-record-event-transitions",
    "href": "blog/posts/embedding/embedding-a-transition-probability-matrix.html#include-non-markovian-accumulators-to-record-event-transitions",
    "title": "Embedding A Transition Probability Matrix for a Discrete Time Markov Model",
    "section": "2. Include Non-Markovian Accumulators to Record Event Transitions",
    "text": "2. Include Non-Markovian Accumulators to Record Event Transitions\nWe now have the correct transition probabilities to model the underlying continuous-time process, but how do we account for these compound transitions in our aggregation of model outputs?\nFundamentally, what we have now is a model that will correctly records the “true” number of deaths at the end of the cycle, because all the compound Healthy Sick Dead transitions are included in the Healthy Dead transition probability.\nTo track the total number of transitions to Sick, we must augment our transition probability matrix with non-Markovian accumulators. This accumulator shows up as a purple edge in our model diagram below:\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n    \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n    \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n    \n\nDead-&gt;Dead\n\n   \n\n\n\n\n\nFortunately, accumulators are easy to build in. We simply add the relevant transition rate in a new column in the transition rate matrix Q, while leaving everything else the same.\nSuppose we want to count up all the Healthy Sick transitions in the model. To do this we simply add the appropriate transition rate (\\(r_{HS}\\)) in as an accumulator column:\n\n\n\n\n\n\n\n\n\n\n\nHealthy\nSick\nDead\naccHS\n\n\n\n\nHealthy\n-(\\(r_{HS}\\) + \\(r_{HD}\\))\n\\(r_{HS}\\)\n\\(r_{HD}\\)\n\\(r_{HS}\\)\n\n\nSick\n0\n-(\\(hr_{S} \\cdot r_{HD}\\))\n\\(hr_{S} \\cdot r_{HD}\\)\n0\n\n\nDead\n0\n0\n0\n0\n\n\naccHS\n0\n0\n0\n0\n\n\n\nNote the following:\n\nAn extra row of 0’s was added so that we balance the matrix, and ensure that we do not lose (or create!) anyone who becomes Sick.\nWe did not update the diagonal elements (i.e., the negative sum of transition rates); these stay the same as before.\nIf we wanted to add additional accumulators, we can just expand the matrix with more columns and rows as needed.\n\nHere is the augmented transition rate matrix for our example:\n\n\nCode\nQ_ &lt;- data.frame(Q)\nQ_[\"Healthy\",\"accHS\"] &lt;- params$r_HS\nQ_[\"accHS\",\"accHS\"] &lt;- 0\nQ_[is.na(Q_)] &lt;- 0\nQ_ &lt;- as.matrix(Q_)\nQ_ \n\n\n        Healthy  Sick  Dead accHS\nHealthy  -0.156  0.15 0.006  0.15\nSick      0.000 -0.06 0.060  0.00\nDead      0.000  0.00 0.000  0.00\naccHS     0.000  0.00 0.000  0.00\n\n\nWe next embed the transition probability matrix, as before:Notice that the accumulator (accHS) value is identical to the Healthy Sick transition probability we obtained using the alternative rate-to-probability conversion formula that accounted for competing risks (e.g., see Figure 10).\n\nP_ &lt;- expm(Q_)\nP_\n\n          Healthy      Sick        Dead     accHS\nHealthy 0.8555592 0.1346958 0.009744961 0.1388854\nSick    0.0000000 0.9417645 0.058235466 0.0000000\nDead    0.0000000 0.0000000 1.000000000 0.0000000\naccHS   0.0000000 0.0000000 0.000000000 1.0000000\n\n\nUsing the accumulator we can accurately count up how many individuals transition to the Sick state over our time horizon:\n\nm_trace &lt;- \n  0:(horizon/cycle) %&gt;% \n  map_df(~(c(1000,0,0,0) %*% (P_%^%.x) %&gt;% data.frame()))\n\n\n\nCode\nm_trace[3,] %&gt;% \n  round(.,2) %&gt;% \n  rownames_to_column(var=\"cycle\") %&gt;% \n  select(-cycle) %&gt;% \n  kable() %&gt;% \n  kableExtra::kable_styling()\n\n\n\n\n\n\n\n\nHealthy\n\n\nSick\n\n\nDead\n\n\naccHS\n\n\n\n\n\n\n731.98\n\n\n242.09\n\n\n25.93\n\n\n257.71\n\n\n\n\n\nFigure 17: State Occupancy after Two Years\n\n\n\nWe see in Figure 17 that after 2 years, 257.7 people (out of 1,000) have become sick, which is slightly less than the 259 who became sick after 2 years in our world without death as a competing risk. Moreover, we see that state occupancy in the Sick category is lower, at 242.1. This lower value reflects the fact some people had a compound transition through Sick and ended up dead in the same cycle. The difference (15.6) amounts to the total number of individual deaths we “hid” in the model when we used the incorrect rate-to-probability conversion formulas.This, of course, makes sense, since there are a small number of people who die before they could become ill once we add background mortality to the model"
  },
  {
    "objectID": "blog/posts/psa-quantiles/index.html",
    "href": "blog/posts/psa-quantiles/index.html",
    "title": "Parameters for Distributions",
    "section": "",
    "text": "Source Another source Excel Functions\n\nlibrary(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.1      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\n\n\nNormal Distribution\n\\[\n\\sigma = \\frac{x_2 - x_1}{\\Phi^{-1}(p_2)-\\Phi^{-1}(p_1)}\n\\tag{1}\\]\n\\[\n\\mu = \\frac{x_1\\Phi^{-1}(p_2)-x_2\\Phi^{-1}(p_1)}{\\Phi^{-1}(p_2)-\\Phi^{-1}(p_1)}\n\\]\n\nx1 &lt;- qnorm(0.1,1.3,.2)\np1 &lt;- 0.1\n\nx2 &lt;- qnorm(0.9,1.3,.2)\np2 &lt;- 0.9\n\nparam_normal &lt;- function(x1,x2,p1,p2) {\n    sigma = (x2 - x1) / (qnorm(p2,0,1)-qnorm(p1,0,1)); sigma\n    mu &lt;- (x1*qnorm(p2,0,1)-x2*qnorm(p1,0,1))/(qnorm(p2,0,1)-qnorm(p1,0,1)); mu\n    \n    c(\"mu\" = mu, \"sigma\" = sigma)\n}\n\n\n\nGamma\n\nx1 &lt;- 0.6\nx2 &lt;- 0.8\np1 &lt;- 0.1\np2 &lt;- 0.9\n\ngamma_fn &lt;- function(alpha) {\n    x1*qgamma(p2,shape = alpha, scale =1) - x2 * qgamma(p1, shape = alpha, scale = 1)\n}\n\ncalc_beta &lt;- function(x1,p1,alpha) {\n    x1 / qgamma(p1,alpha,1)\n}\n\ncurve(gamma_fn, xlim = c(1,100), col = \"blue\", lwd = 1.5, lty=2)\nabline(a=0,b=0)\n\n\n\nalpha_ &lt;- uniroot(gamma_fn,c(70,85))$root; alpha_\n\n[1] 79.74756\n\nbeta_ &lt;- calc_beta(x1 = x1,  p1 = p1, alpha = alpha_); beta_\n\n[1] 0.008754199\n\n# Check the answer\nqgamma(0.1,shape = alpha_, scale = beta_)\n\n[1] 0.6\n\nqgamma(0.9,shape = alpha_, scale = beta_)\n\n[1] 0.8\n\nparam_gamma &lt;- function(x1,x2,p1,p2,range) {\n    alpha_ &lt;- uniroot(gamma_fn,range)$root; alpha_\n    beta_ &lt;- calc_beta(x1 = x1,  p1 = p1, alpha = alpha_); beta_\n    \n    c(\"alpha\" = alpha_, \"beta\" = beta_)\n}\nparam_gamma(x1= x1, x2 = x2, p1 = p1, p2 = p2, range = c(60,100))\n\n       alpha         beta \n79.747557736  0.008754199 \n\n\n\n\nBeta Distribution\n\n# Source: https://stats.stackexchange.com/questions/112614/determining-beta-distribution-parameters-alpha-and-beta-from-two-arbitrary\n\nx1 &lt;- 0.6\nx2 &lt;- 0.8\np1 &lt;- 0.1\np2 &lt;- 0.9\n\n# Logistic transformation of the Beta CDF.\nf.beta &lt;- function(alpha, beta, x, lower=0, upper=1) {\n  p &lt;- pbeta((x-lower)/(upper-lower), alpha, beta)\n  log(p/(1-p))\n}\n\n# Sums of squares.\ndelta &lt;- function(fit, actual) sum((fit-actual)^2)\n\n# The objective function handles the transformed parameters `theta` and\n# uses `f.beta` and `delta` to fit the values and measure their discrepancies.\nobjective &lt;- function(theta, x, prob, ...) {\n  ab &lt;- exp(theta) # Parameters are the *logs* of alpha and beta\n  fit &lt;- f.beta(ab[1], ab[2], x, ...)\n  return (delta(fit, prob))\n}\n\nx.p &lt;- (function(p) log(p/(1-p)))(c(p1, p2))\nstart &lt;- log(c(1e1, 1e1))\nsol &lt;- nlm(objective, start, x=c(x1,x2), prob=x.p, lower=0, upper=1, typsize=c(1,1), fscale=1e-12, gradtol=1e-12)\n\nWarning in nlm(objective, start, x = c(x1, x2), prob = x.p, lower = 0, upper =\n1, : NA/Inf replaced by maximum positive value\n\nWarning in nlm(objective, start, x = c(x1, x2), prob = x.p, lower = 0, upper =\n1, : NA/Inf replaced by maximum positive value\n\nparams &lt;- exp(sol$estimate); params\n\n[1] 23.70741 10.03106\n\nqbeta(p = c(p1, p2), params[1], params[2])\n\n[1] 0.6000000 0.8000001\n\n\n\n# Step 1: Define the parameters and uncertainty distributions.\n\nw1 = 2\nw1.low = 1.75\nw1.hi = 2.25\np1.low = 0.1\np1.hi = 0.9\n\nc1 = 1\nc1.low = 1\nc1.hi = 1\np1.low = 0.1\np1.hi = 0.9\n\nw2 = 1\nw2.low = 1\nw2.hi = 1\n\nc2 = 0.85\nc2.low = 0.75\nc2.hi = 0.95\np2.low = 0.1\np2.hi = 0.9\n\nx1 = c2.low\nx2 = c2.hi\np1 = p2.low\np2 = p2.hi\ndist = \"unif\"\n\nget_dist_params &lt;- function(x1, x2, p1, p2, dist = \"unif\", range = NULL) {\n    \n    if (dist==\"unif\") {\n        get_min_unif &lt;- function(x1, x2, p1, p2) {\n            (p2*x1-p1*x2) / (p2 - p1) \n        }\n        get_max_unif &lt;- function(x1, x2, p1 , p2) {\n            ((1-p1)*x2-(1-p2)*x1)/(p2-p1)\n        }\n        get_avg_unif &lt;- function(x1, x2, p1, p2) {\n            mean(c(get_min_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2),\n                   get_max_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2)))\n        }\n        \n        params &lt;- c(mean = get_avg_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2), \n                    median = get_avg_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2),\n                    min = get_min_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2),\n                    max = get_max_unif(x1 = x1, x2 = x2, p1 = p1, p2 = p2))\n        attr(params,\"dist\") = \"uniform\"\n    }\n    \n    if (dist == \"norm\") {\n        param_norm &lt;- function(x1,x2,p1,p2) {\n            sigma = (x2 - x1) / (qnorm(p2,0,1)-qnorm(p1,0,1)); sigma\n            mu &lt;- (x1*qnorm(p2,0,1)-x2*qnorm(p1,0,1))/(qnorm(p2,0,1)-qnorm(p1,0,1)); mu\n            \n            c(\"mean\" = mu, \"sd\" = sigma)\n        }\n        \n        params = param_norm(x1 = x1, x2 = x2, p1 = p1, p2 = p2)\n        attr(params,\"dist\") = \"normal\"\n    }\n    \n    if (dist == \"lognorm\") {\n        get_mean_of_log &lt;- function(x1, x2, p1, p2) {\n            (qnorm(p2,0,1)*log(x1)-qnorm(p1,0,1)*log(x2)) / (qnorm(p2,0,1)-qnorm(p1,0,1))\n        }\n        mean_of_log &lt;- get_mean_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)\n        \n        get_sd_of_log &lt;- function(x1, x2, p1 , p2) {\n            (log(x2) - log(x1)) / (qnorm(p2,0,1) - qnorm(p1,0,1))\n        }\n        sd_of_log &lt;- get_sd_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)\n        \n        # params &lt;- c(\"mean\" = exp(get_mean_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2) + 0.5 * get_sd_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)^2),\n        #   \"median\" = exp(get_mean_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)),\n        #   \"sd\" = sqrt((exp(get_sd_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)^2)-1) * exp(2 * get_mean_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2) + \n        #                                                                                      get_sd_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2)^2)))\n        \n        params &lt;- c(\"mean_log\" = get_mean_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2), \n                    \"sd_log\" = get_sd_of_log(x1 = x1, x2 = x2, p1 = p1, p2 = p2))\n        attr(params,\"dist\") = \"lognormal\"\n\n    }\n    \n    if (dist == \"gamma\") {\n        gamma_fn &lt;- function(alpha) {\n            x1*qgamma(p2,shape = alpha, scale =1) - x2 * qgamma(p1, shape = alpha, scale = 1)\n        }\n        \n        calc_beta &lt;- function(x1,p1,alpha) {\n            x1 / qgamma(p1,alpha,1)\n        }\n        \n        #curve(gamma_fn, xlim = c(1,100), col = \"blue\", lwd = 1.5, lty=2)\n        #abline(a=0,b=0)\n        \n        alpha_ &lt;- uniroot(gamma_fn,c(1,100))$root; alpha_\n        beta_ &lt;- calc_beta(x1 = x1,  p1 = p1, alpha = alpha_); beta_\n    }\n    return(params)\n    \n}\n\n\nget_dist_params(x1 = w1.low, x2 = w1.hi, p1 = p1.low, p2 = p1.hi, dist = \"lognorm\" )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndisc_power &lt;- function(fit) {\n    beta.hat &lt;- fit[\"W\",]\n    accept &lt;- 1-as.integer(dplyr::between(0,beta.hat[,2],beta.hat[,3]))\n    return(accept)\n}\n\nX_W(n_=1000, p_treat=0.5, tau=60) %&gt;% \n    est() %&gt;% \n    disc_power()\n\n\nval.stat.life = 9600000\n\nsurv.1 &lt;- 0.987\nsurv.0 &lt;- 0.97\n\nval.stat.life*(surv.1-surv.0)\n\n\nw.eitc &lt;- 1\nc.eitc &lt;- rgamma(1e3,rate = 89,shape=1); mean(c.eitc)\n\nhttps://www.johndcook.com/quantiles_parameters.pdf\n\n\nqnorm(0.1, mean = 1, sd = 1)\n\nx1 &lt;- qnorm(0.1,1.3,.2)\np1 &lt;- 0.1\n\nx2 &lt;- qnorm(0.9,1.3,.2)\np2 &lt;- 0.9\n\nparam_normal &lt;- function(x1,x2,p1,p2) {\n    sigma = (x2 - x1) / (qnorm(p2,0,1)-qnorm(p1,0,1)); sigma\n    mu &lt;- (x1*qnorm(p2,0,1)-x2*qnorm(p1,0,1))/(qnorm(p2,0,1)-qnorm(p1,0,1)); mu\n    \n    c(\"mu\" = mu, \"sigma\" = sigma)\n}\n\nparam_normal(x1 = 3, p1 = .1, x2 = 5, p2 = .9)"
  },
  {
    "objectID": "blog/posts/appendix/index.html",
    "href": "blog/posts/appendix/index.html",
    "title": "Supplemental Appendix",
    "section": "",
    "text": "This section provides advice on best practices for embedding literature-based parameters into discrete-time Markov models so that the final transition probabilities accurately represent the underlying continuous time process.\n\n\nIt is common to draw upon literature-based parameters when constructing a Markov model. A key first step is to assess the parameters of interest in a published study. For a given paper with published rates, thsi means determining whether they report a percentrage affected in a given time step, or continuous rates. While the units of both of these are essentially equivalent (by a factor of 100), the interpretation is different. It is a subtle but important difference.\nFor example, let’s assume that a stochastic event occurs to a group of individuals with a rate of 1/unit time. This follows an exponential distribution. We first create a sample of 20000 individuals.\n\nx &lt;- rexp(20000)\n\nhist(x)\n\n\n\nmean(x)\n\n[1] 1.011341\n\nmedian(x)\n\n[1] 0.7090352\n\n# Percentage in first time cycle\nsum(x &lt; 1) / length(x)\n\n[1] 0.62495\n\n\nThe mean is close to 1, but the percentage observed in the first time cycle is close to the theoretical 63.2%. This appears counter-intuitive but the long tail of the exponential distribution creates a situation where the continuous rate is not the observed percentage in a time cycle.\nThis leads to the widely-used rate-to-probability conversion formula:\n\\[p = 1 - e^{-r}\\] \\[r = -log(1-p)\\] where \\(p\\) represents the probability in a unit of time and \\(r\\) represents the continuous rate.\nWhen constructing a Markov model, it is best to start with the continuous rate when aggregating from many sources and embed this continuous rate into a timestep—thus creating probability transitions for each time step.\nTo find the probability transition matrix of a timestep in Markov modeling from the continuous the following formula is used:\n\\[ T_{prob} = e^{R} \\]\nWhere \\(R\\) is the continuous rate matrix, and each diagonal is the negative sum of the rest of the row elements. \\(T_{prob}\\) is the transition probability for a single time step, where each diagonal is 1 - the sum of the other row elements.\nOne could have rates that change at each time step and this would return the proper embedding of the rates allowing for them to compete.\n\n\n\nWhat if a given source of data provides observed transition probabilities and these are exclusionary states, i.e., competing? How could one reverse these probabilities and embed other competing events into the model?\nTo do this, one must solve for the generator matrix of the transition probability matrix using eigenvalue decomposition. Note that this is not always possible, as it is trivial to construct a transition probability matrix that has no generator.\nConsider the following, which builds on the example provided in the main text. We wish to approximate a continuous time process using a discrete-time Markov model with three distinct states: A (healthy), B (sick/intervention), and C (complication from intervention). Moreover, in continuous time, this process proceeds sequentially, i.e., A-&gt;B-&gt;C.\nA (naively) specified model has transitions from A-&gt;B and from B-&gt;C specified as probabilities within the selected time step. As noted in the main text, this model cannot truly approximate continuous time process, as within a given time step there is a non-zero probability of transitioning from healthy to complication (i.e., A-&gt;C, with an implied sojourn through B). That is, during a timestep it is possible to transition from A-&gt;C.\nBy incorrectly specifying all transitions, it makes it impossible to find a proper generator—though eigenvalue decomposition can be used to get as close as possible. If negative rates of transition are found using eigenvalue decomposition, then probabilities inconsistent with continuous rates have been specified.\nIn mathematical terms, the generator matrix is the matrix logarithm of the transition probability matrix. A matrix has a logarithm if and only if if it is invertible.\n\\[ A = \\log T_{prob} \\]\nThe \\(\\log\\) can be found using spectral or eigenvalue decomposition. If \\(V\\) is a matrix where equal column is an eigenvector of \\(T_{prob}\\), then,\n\\[A' = V^{-1} A V\\] \\[\\log T_{prob} = V (\\log A') V^{-1}\\]\n\n\nAs an example, we’ll consider a model from “Decision Modelling for Heath Economic Evaluation” by Briggs, Clatxon, and Sculpher. In Table 2.2, they define a transition probability matrix for HIV monotherapy that was derived from observed percent transitions in a patient cohort.\n\nhiv_monotherapy_tp &lt;- matrix(c(0.721, 0.202, 0.067, 0.010,\n                               0.000, 0.581, 0.407, 0.012,\n                               0.000, 0.000, 0.750, 0.250,\n                               0.000, 0.000, 0.000, 1.000), \n                               nrow=4, byrow=TRUE,\n                               dimnames=list(c(\"A\", \"B\", \"C\", \"D\"),\n                                             c(\"A\", \"B\", \"C\", \"D\")))\nhiv_monotherapy_tp                                          \n\n      A     B     C     D\nA 0.721 0.202 0.067 0.010\nB 0.000 0.581 0.407 0.012\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nThe bottom diagonal was corrected to be a Markov absorbing state by having 1 on the diagonal. For the purposes of example, we’ll assume we wish to add an additional state “E”, which has a continuous rate of 0.2 that competes with other transitions.\nTo accomplish this we must find the continuous generator.\n\nV  &lt;- eigen(hiv_monotherapy_tp)$vectors\niV &lt;- solve(V)\nAp &lt;- iV %*% hiv_monotherapy_tp %*% V\n\nAp\n\n              [,1]          [,2]          [,3]          [,4]\n[1,]  1.000000e+00 -1.138759e-17  0.000000e+00  1.625347e-17\n[2,]  1.724225e-16  7.500000e-01  0.000000e+00 -1.565421e-16\n[3,] -1.054209e-15 -1.977467e-16  7.210000e-01  3.654408e-17\n[4,] -6.257371e-17 -1.879313e-17 -5.963692e-18  5.810000e-01\n\n\nDue to the numeric probabilities not being exactly correct, the off-diagonal elements of \\(A'\\) are not zero, but they are quite close. We will zero these off diagonal elements and assume that the non-zero elements are numerical error. Then continue by taking the log of the diagonal.\n\nlAp &lt;- diag(log(diag(Ap)), nrow(Ap), ncol(Ap))\n\nR  &lt;- V %*% lAp %*% iV\n\nR \n\n              [,1]          [,2]         [,3]        [,4]\n[1,] -3.271161e-01  3.114961e-01  0.002439536  0.01318051\n[2,]  2.558460e-18 -5.430045e-01  0.614888976 -0.07188445\n[3,]  0.000000e+00  7.064112e-18 -0.287682072  0.28768207\n[4,]  0.000000e+00  0.000000e+00  0.000000000  0.00000000\n\n\nAn now we have the continuous time rate generator for the Markov Model. There is still some numerical error—for example the bottom row, has values very near to zero, and the diagonal is not exactly the negative sum of the rest of the row. We can clean this up by tweaking the numbers numerical towards their constraints.\n\nR[abs(R) &lt; 1e-6 ] &lt;- 0\n\n\nrownames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\ncolnames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\n\nround(R, 3)\n\n       A      B      C      D\nA -0.327  0.311  0.002  0.013\nB  0.000 -0.543  0.615 -0.072\nC  0.000  0.000 -0.288  0.288\nD  0.000  0.000  0.000  0.000\n\n\nSome numerical error is inevitable in this process and cannot be avoided. However, even cleaning up the small and obvious errors, the transition from B -&gt; D is impossible since it’s negative. Rates are relative to the occupancy of the source state, in this case B. Having a negative rate implies that B would have some transitions in which the dead come alive into B based upon the occupancy of B. Obviously, this is not possible. The problem now is how to adjust the model’s rates to be physically possible, while as faithful to the original data as possible. B is a sicker state, so it should have a higher death rate.\nFirst, let’s double check it recapitulates the original rates.\n\nexpm(R)\n\n4 x 4 Matrix of class \"dgeMatrix\"\n      A     B     C     D\nA 0.721 0.202 0.067 0.010\nB 0.000 0.581 0.407 0.012\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nWhich exactly matches the original transition probability table given.\nNext, lets’ assume that one has to pass into state C to die and the original data didn’t have frequent enough measurements to detect all the transitions.\n\n# A more plausible death rate for 'A', 'B'\nR['A', 'D'] &lt;- 0\nR['B', 'D'] &lt;- 0\n\ndiag(R) &lt;- diag(R) - rowSums(R) # Keep it Markovian\nround(expm(R), 3)\n\n4 x 4 Matrix of class \"dgeMatrix\"\n      A     B     C     D\nA 0.731 0.197 0.066 0.007\nB 0.000 0.541 0.393 0.066\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nThe rate from A-&gt;D is within error of the original study. However, deaths from B are at a much higher rate. This is all under the assumption that one must pass through C to die, and the adjusted transitions reflect this.\nNow one could add a competing event to to the model as a rate adding a new row column with it’s defined rates and compute the updated transition probability matrix.\nThese difficulties of working backward from probabilities unscore the importance of having the original estimates be rates that have been adjusted to be the non-competing rate (e.g., based on survival models).\n\n\n\n\nThe above examples also illustrate another difficulty: correctly summarizing costs and utilities in the presence of implied “jumpover” states. For example, we zeroed the rate of A-&gt;D, yet the final transition matrix contains that transition.\nAssume that the transition B-&gt;C entailed a cost, given that some of the population goes A-&gt;B-&gt;C-&gt;D these transitions are hidden in the embedded transition matrix, yet a summary of the number of B-&gt;C transitions is needed for a time step. One can solve this by adding non-Markovian states or accumulator states to track these transitions.\nThe diagonal term of the transition intensity matrix is the negative sum of all Markovian states. Additional rows and columns can be added that violate the principal that total state occupancy cannot be created or destroyed, by simply leaving them out of the balancing term of the diagonal.\n\nRwAcc &lt;- cbind(rbind(R, rep(0, 4)), rep(0, 5))\nrownames(RwAcc) &lt;- c(\"A\", \"B\", \"C\", \"D\", \"AccBC\")\ncolnames(RwAcc) &lt;- c(\"A\", \"B\", \"C\", \"D\", \"AccBC\")\n\nRwAcc['B', 'AccBC'] &lt;- RwAcc['B', 'C']\nround(expm(RwAcc), 3)\n\n5 x 5 Matrix of class \"dgeMatrix\"\n          A     B     C     D AccBC\nA     0.731 0.197 0.066 0.007 0.071\nB     0.000 0.541 0.393 0.066 0.459\nC     0.000 0.000 0.750 0.250 0.000\nD     0.000 0.000 0.000 1.000 0.000\nAccBC 0.000 0.000 0.000 0.000 1.000\n\n\nNote that once embedded into probabilities, there is a transition from A-&gt;AccBC which tracks how many transitions from A-&gt;B-&gt;C and B-&gt;C occur. The original rate specified was zero for A-&gt;AccBC, but due to jumping states this now has a non-zero probability and the accumulator is able to track this.\nIdealy the original rate estimates would have assumed a structural model that was sensible and rates could be estimated to match the data. This is a statistical modeling problem outside the scope of this appendix.\nFor the sake of organization, it is recommended that the upper left matrix remain the original Markov and all the non-Markovian rows be to the bottom and right of the matrix.\n\n\n\nAnother problem that occurs is that of non-stationary rates. What if a rate is changing over an interval time step? How is this best modeled? A first order approach would be to simply take the mean of the rates at either time point. A higher order approach is to integrate the total risk exposure over the time interval.\n\\[r_{e} = \\int_{t_1}^{t_2} r(t) dt\\] This computes the effective rate \\(r_e\\) from a time varying rate, \\(r(t)\\).\nFor example, in our applications the probability of death from outside causes could be modeled based on mortality tables using a Gompertz distribution with a shape \\(a\\) and rate \\(b\\) parameter. The hazard function of a distribution is the continuous rate function. The hazard function can be derived from the probability density function (PDF) divided by 1 minus cumulative probability function (CDF). For the Gompertz this is,\n\\[h(t) = \\frac{f(t)}{1-F(t)} = \\frac{b e^{at} e^{-b/a(e^{at}-1)}}{e^{-b/a (e^{at}-1)}} = b e^{at}\\]\nFrom this the effective rate over a timestep of a discrete Markov simulation can be computed.\n\\[r_{e} = \\int_{t_1}^{t_2} b e^{at} dt = \\frac{b}{a} (e^{at_2} - e^{at_1})\\]\nWhile this exists as an anayltical result, in general it’s better to use the effective risk over a time interval as this leads to improved accuracy of a simulation."
  },
  {
    "objectID": "blog/posts/appendix/index.html#rates-vs.-percentages",
    "href": "blog/posts/appendix/index.html#rates-vs.-percentages",
    "title": "Supplemental Appendix",
    "section": "",
    "text": "It is common to draw upon literature-based parameters when constructing a Markov model. A key first step is to assess the parameters of interest in a published study. For a given paper with published rates, thsi means determining whether they report a percentrage affected in a given time step, or continuous rates. While the units of both of these are essentially equivalent (by a factor of 100), the interpretation is different. It is a subtle but important difference.\nFor example, let’s assume that a stochastic event occurs to a group of individuals with a rate of 1/unit time. This follows an exponential distribution. We first create a sample of 20000 individuals.\n\nx &lt;- rexp(20000)\n\nhist(x)\n\n\n\nmean(x)\n\n[1] 1.011341\n\nmedian(x)\n\n[1] 0.7090352\n\n# Percentage in first time cycle\nsum(x &lt; 1) / length(x)\n\n[1] 0.62495\n\n\nThe mean is close to 1, but the percentage observed in the first time cycle is close to the theoretical 63.2%. This appears counter-intuitive but the long tail of the exponential distribution creates a situation where the continuous rate is not the observed percentage in a time cycle.\nThis leads to the widely-used rate-to-probability conversion formula:\n\\[p = 1 - e^{-r}\\] \\[r = -log(1-p)\\] where \\(p\\) represents the probability in a unit of time and \\(r\\) represents the continuous rate.\nWhen constructing a Markov model, it is best to start with the continuous rate when aggregating from many sources and embed this continuous rate into a timestep—thus creating probability transitions for each time step.\nTo find the probability transition matrix of a timestep in Markov modeling from the continuous the following formula is used:\n\\[ T_{prob} = e^{R} \\]\nWhere \\(R\\) is the continuous rate matrix, and each diagonal is the negative sum of the rest of the row elements. \\(T_{prob}\\) is the transition probability for a single time step, where each diagonal is 1 - the sum of the other row elements.\nOne could have rates that change at each time step and this would return the proper embedding of the rates allowing for them to compete."
  },
  {
    "objectID": "blog/posts/appendix/index.html#competing-events",
    "href": "blog/posts/appendix/index.html#competing-events",
    "title": "Supplemental Appendix",
    "section": "",
    "text": "What if a given source of data provides observed transition probabilities and these are exclusionary states, i.e., competing? How could one reverse these probabilities and embed other competing events into the model?\nTo do this, one must solve for the generator matrix of the transition probability matrix using eigenvalue decomposition. Note that this is not always possible, as it is trivial to construct a transition probability matrix that has no generator.\nConsider the following, which builds on the example provided in the main text. We wish to approximate a continuous time process using a discrete-time Markov model with three distinct states: A (healthy), B (sick/intervention), and C (complication from intervention). Moreover, in continuous time, this process proceeds sequentially, i.e., A-&gt;B-&gt;C.\nA (naively) specified model has transitions from A-&gt;B and from B-&gt;C specified as probabilities within the selected time step. As noted in the main text, this model cannot truly approximate continuous time process, as within a given time step there is a non-zero probability of transitioning from healthy to complication (i.e., A-&gt;C, with an implied sojourn through B). That is, during a timestep it is possible to transition from A-&gt;C.\nBy incorrectly specifying all transitions, it makes it impossible to find a proper generator—though eigenvalue decomposition can be used to get as close as possible. If negative rates of transition are found using eigenvalue decomposition, then probabilities inconsistent with continuous rates have been specified.\nIn mathematical terms, the generator matrix is the matrix logarithm of the transition probability matrix. A matrix has a logarithm if and only if if it is invertible.\n\\[ A = \\log T_{prob} \\]\nThe \\(\\log\\) can be found using spectral or eigenvalue decomposition. If \\(V\\) is a matrix where equal column is an eigenvector of \\(T_{prob}\\), then,\n\\[A' = V^{-1} A V\\] \\[\\log T_{prob} = V (\\log A') V^{-1}\\]\n\n\nAs an example, we’ll consider a model from “Decision Modelling for Heath Economic Evaluation” by Briggs, Clatxon, and Sculpher. In Table 2.2, they define a transition probability matrix for HIV monotherapy that was derived from observed percent transitions in a patient cohort.\n\nhiv_monotherapy_tp &lt;- matrix(c(0.721, 0.202, 0.067, 0.010,\n                               0.000, 0.581, 0.407, 0.012,\n                               0.000, 0.000, 0.750, 0.250,\n                               0.000, 0.000, 0.000, 1.000), \n                               nrow=4, byrow=TRUE,\n                               dimnames=list(c(\"A\", \"B\", \"C\", \"D\"),\n                                             c(\"A\", \"B\", \"C\", \"D\")))\nhiv_monotherapy_tp                                          \n\n      A     B     C     D\nA 0.721 0.202 0.067 0.010\nB 0.000 0.581 0.407 0.012\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nThe bottom diagonal was corrected to be a Markov absorbing state by having 1 on the diagonal. For the purposes of example, we’ll assume we wish to add an additional state “E”, which has a continuous rate of 0.2 that competes with other transitions.\nTo accomplish this we must find the continuous generator.\n\nV  &lt;- eigen(hiv_monotherapy_tp)$vectors\niV &lt;- solve(V)\nAp &lt;- iV %*% hiv_monotherapy_tp %*% V\n\nAp\n\n              [,1]          [,2]          [,3]          [,4]\n[1,]  1.000000e+00 -1.138759e-17  0.000000e+00  1.625347e-17\n[2,]  1.724225e-16  7.500000e-01  0.000000e+00 -1.565421e-16\n[3,] -1.054209e-15 -1.977467e-16  7.210000e-01  3.654408e-17\n[4,] -6.257371e-17 -1.879313e-17 -5.963692e-18  5.810000e-01\n\n\nDue to the numeric probabilities not being exactly correct, the off-diagonal elements of \\(A'\\) are not zero, but they are quite close. We will zero these off diagonal elements and assume that the non-zero elements are numerical error. Then continue by taking the log of the diagonal.\n\nlAp &lt;- diag(log(diag(Ap)), nrow(Ap), ncol(Ap))\n\nR  &lt;- V %*% lAp %*% iV\n\nR \n\n              [,1]          [,2]         [,3]        [,4]\n[1,] -3.271161e-01  3.114961e-01  0.002439536  0.01318051\n[2,]  2.558460e-18 -5.430045e-01  0.614888976 -0.07188445\n[3,]  0.000000e+00  7.064112e-18 -0.287682072  0.28768207\n[4,]  0.000000e+00  0.000000e+00  0.000000000  0.00000000\n\n\nAn now we have the continuous time rate generator for the Markov Model. There is still some numerical error—for example the bottom row, has values very near to zero, and the diagonal is not exactly the negative sum of the rest of the row. We can clean this up by tweaking the numbers numerical towards their constraints.\n\nR[abs(R) &lt; 1e-6 ] &lt;- 0\n\n\nrownames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\ncolnames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\n\nround(R, 3)\n\n       A      B      C      D\nA -0.327  0.311  0.002  0.013\nB  0.000 -0.543  0.615 -0.072\nC  0.000  0.000 -0.288  0.288\nD  0.000  0.000  0.000  0.000\n\n\nSome numerical error is inevitable in this process and cannot be avoided. However, even cleaning up the small and obvious errors, the transition from B -&gt; D is impossible since it’s negative. Rates are relative to the occupancy of the source state, in this case B. Having a negative rate implies that B would have some transitions in which the dead come alive into B based upon the occupancy of B. Obviously, this is not possible. The problem now is how to adjust the model’s rates to be physically possible, while as faithful to the original data as possible. B is a sicker state, so it should have a higher death rate.\nFirst, let’s double check it recapitulates the original rates.\n\nexpm(R)\n\n4 x 4 Matrix of class \"dgeMatrix\"\n      A     B     C     D\nA 0.721 0.202 0.067 0.010\nB 0.000 0.581 0.407 0.012\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nWhich exactly matches the original transition probability table given.\nNext, lets’ assume that one has to pass into state C to die and the original data didn’t have frequent enough measurements to detect all the transitions.\n\n# A more plausible death rate for 'A', 'B'\nR['A', 'D'] &lt;- 0\nR['B', 'D'] &lt;- 0\n\ndiag(R) &lt;- diag(R) - rowSums(R) # Keep it Markovian\nround(expm(R), 3)\n\n4 x 4 Matrix of class \"dgeMatrix\"\n      A     B     C     D\nA 0.731 0.197 0.066 0.007\nB 0.000 0.541 0.393 0.066\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000\n\n\nThe rate from A-&gt;D is within error of the original study. However, deaths from B are at a much higher rate. This is all under the assumption that one must pass through C to die, and the adjusted transitions reflect this.\nNow one could add a competing event to to the model as a rate adding a new row column with it’s defined rates and compute the updated transition probability matrix.\nThese difficulties of working backward from probabilities unscore the importance of having the original estimates be rates that have been adjusted to be the non-competing rate (e.g., based on survival models)."
  },
  {
    "objectID": "blog/posts/appendix/index.html#state-jumping",
    "href": "blog/posts/appendix/index.html#state-jumping",
    "title": "Supplemental Appendix",
    "section": "",
    "text": "The above examples also illustrate another difficulty: correctly summarizing costs and utilities in the presence of implied “jumpover” states. For example, we zeroed the rate of A-&gt;D, yet the final transition matrix contains that transition.\nAssume that the transition B-&gt;C entailed a cost, given that some of the population goes A-&gt;B-&gt;C-&gt;D these transitions are hidden in the embedded transition matrix, yet a summary of the number of B-&gt;C transitions is needed for a time step. One can solve this by adding non-Markovian states or accumulator states to track these transitions.\nThe diagonal term of the transition intensity matrix is the negative sum of all Markovian states. Additional rows and columns can be added that violate the principal that total state occupancy cannot be created or destroyed, by simply leaving them out of the balancing term of the diagonal.\n\nRwAcc &lt;- cbind(rbind(R, rep(0, 4)), rep(0, 5))\nrownames(RwAcc) &lt;- c(\"A\", \"B\", \"C\", \"D\", \"AccBC\")\ncolnames(RwAcc) &lt;- c(\"A\", \"B\", \"C\", \"D\", \"AccBC\")\n\nRwAcc['B', 'AccBC'] &lt;- RwAcc['B', 'C']\nround(expm(RwAcc), 3)\n\n5 x 5 Matrix of class \"dgeMatrix\"\n          A     B     C     D AccBC\nA     0.731 0.197 0.066 0.007 0.071\nB     0.000 0.541 0.393 0.066 0.459\nC     0.000 0.000 0.750 0.250 0.000\nD     0.000 0.000 0.000 1.000 0.000\nAccBC 0.000 0.000 0.000 0.000 1.000\n\n\nNote that once embedded into probabilities, there is a transition from A-&gt;AccBC which tracks how many transitions from A-&gt;B-&gt;C and B-&gt;C occur. The original rate specified was zero for A-&gt;AccBC, but due to jumping states this now has a non-zero probability and the accumulator is able to track this.\nIdealy the original rate estimates would have assumed a structural model that was sensible and rates could be estimated to match the data. This is a statistical modeling problem outside the scope of this appendix.\nFor the sake of organization, it is recommended that the upper left matrix remain the original Markov and all the non-Markovian rows be to the bottom and right of the matrix."
  },
  {
    "objectID": "blog/posts/appendix/index.html#non-stationary-rates",
    "href": "blog/posts/appendix/index.html#non-stationary-rates",
    "title": "Supplemental Appendix",
    "section": "",
    "text": "Another problem that occurs is that of non-stationary rates. What if a rate is changing over an interval time step? How is this best modeled? A first order approach would be to simply take the mean of the rates at either time point. A higher order approach is to integrate the total risk exposure over the time interval.\n\\[r_{e} = \\int_{t_1}^{t_2} r(t) dt\\] This computes the effective rate \\(r_e\\) from a time varying rate, \\(r(t)\\).\nFor example, in our applications the probability of death from outside causes could be modeled based on mortality tables using a Gompertz distribution with a shape \\(a\\) and rate \\(b\\) parameter. The hazard function of a distribution is the continuous rate function. The hazard function can be derived from the probability density function (PDF) divided by 1 minus cumulative probability function (CDF). For the Gompertz this is,\n\\[h(t) = \\frac{f(t)}{1-F(t)} = \\frac{b e^{at} e^{-b/a(e^{at}-1)}}{e^{-b/a (e^{at}-1)}} = b e^{at}\\]\nFrom this the effective rate over a timestep of a discrete Markov simulation can be computed.\n\\[r_{e} = \\int_{t_1}^{t_2} b e^{at} dt = \\frac{b}{a} (e^{at_2} - e^{at_1})\\]\nWhile this exists as an anayltical result, in general it’s better to use the effective risk over a time interval as this leads to improved accuracy of a simulation."
  },
  {
    "objectID": "blog/posts/appendix/index.html#numerical-checkpoint",
    "href": "blog/posts/appendix/index.html#numerical-checkpoint",
    "title": "Supplemental Appendix",
    "section": "Numerical Checkpoint",
    "text": "Numerical Checkpoint\nA good check at this point is to see if the simulation kept the total population consistent, i.e., neither created nor destroyed occupants of the Markov simulation. If the plot strays far from zero, then something is wrong in constructing the model.\n\nplot(0:20, 1-rowSums(simulation[,c(\"H\", \"A\", \"DA\", \"DS\")]), xlab=\"time (years)\", \n     ylab=\"absolute error\", main=\"Total Population Numerical Error\")\n\n\n\n\nNow with the simulation complete and passing a simple check, one can proceed to integrate costs and qualities.\nFirst let’s define the alternate Simpson’s coefficient function for integration.\n\n# Better accuracy that \"life-table\" aka trapezoidal method\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\nalt_simp      &lt;- function(x,h) h*sum(alt_simp_coef(length(x)) * x)\n\n\nCosts\n\n1000*simulation[21,\"ACC\"] # The last point is the total\n\n     ACC \n554.7587 \n\n\n\n\nQuality-Adjusted Life Years\nTotal possible life years:\n\n  alt_simp(rowSums(simulation[,c(\"H\", \"A\")]), 1)\n\n[1] 6.943292\n\n\nTotal Disutility of ‘A’ (via the tunnel states):\n\n  alt_simp(rowSums(simulation[,c(\"T1\", \"T2\")]), 1)\n\n[1] 0.9392552\n\n\nFinal quality-adjusted life years:\n\n  alt_simp(rowSums(simulation[,c(\"H\", \"A\")]), 1) - \n  alt_simp(rowSums(simulation[,c(\"T1\", \"T2\")]), 1)\n\n[1] 6.004037"
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html",
    "title": "Cause-Deleted Life Tables",
    "section": "",
    "text": "All-Cause Life Table Data\n\n\nCause-Specific Deaths\nFirst, we use the CDC wonder engine to extract death by specific cause. This is extracted and stored in data/cardiovascular-deaths.txt.\n\n\n\n\n\nCardiovascular log(mortality) rates by age\n\n\n\n\nNote that the death rate per 100k population is not calculated above age 85 (but general life tables go to 100+), so we need to predict it. Luckily the (log) death rate is fairly linear:\n\n\n\n\n\nLet’s just fit a basic generalized additive model (GAM) in age.\nLet’s see how our imputed mortality rate (red) compares and extrapolates:\n\n\n\n\n\nlog mortality rate by age, with imputed values in red\n\n\n\n\nNow we can construct cause-deleted life tables (per 100k) with sufficient information to fit a mortality model.\nWe now fit the mortalitiy models.\n\n\n\n\n\n\n\n\n\n\n\n\nHistorical Mortality\nLet’s compare historical mortality rates in the US to the UK."
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html",
    "title": "Approaches for Modeling Mortality Using Life-Table Data",
    "section": "",
    "text": "This document outlines how to model mortality using a gompertz model fit to life table data.\n\nThe inspiration for much of the modeling code can be found here\nIn general, Gompertz and Gompertz-Makeham models only work for adults, given the wonkiness of mortality in younger ages.\n\nHere is a nice primer on mortality modeling using several mixtures.\nHere is one approach to model under-five mortality.\n\nFernando has a nice paper noting that clinical trials often estimate a hazard ratio for death for overall all-cause death, not disease specific death. What does that mean for modeling?\n\nSource\n\n\n\nlibrary(tidyverse)\nlibrary(flexsurv)\nlibrary(survival)\nlibrary(demography)\nlibrary(fmsb)\nlibrary(here)"
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#multiple-decrements",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#multiple-decrements",
    "title": "Cause-Deleted Life Tables",
    "section": "Multiple Decrements",
    "text": "Multiple Decrements"
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables",
    "title": "Cause-Deleted Life Tables",
    "section": "Cause-Deleted Life Tables",
    "text": "Cause-Deleted Life Tables\nWhat would things look like if deaths due to neoplasms could be avoided?\n\n\nCalculate life expectancy without deaths due to neoplasms.\ndf_ &lt;- \n    df %&gt;% \n    mutate(Rd = (D - Di) / D, \n           md = m * Rd) %&gt;% \n    mutate( # now construct a survival function, but treating \n            # the hazard md as if its the only one operating\n        Hd = cumsum(n * md), \n        Sd = edit.na(exp(-lag(Hd)),1)\n    ) %&gt;% \n    mutate(Pd = edit.na((Sd - lead(Sd))/md, tail(Sd/md,1)))\n\n\nThis changes life-expectancy to 82.4 years. Note that this is under a (strong) assumption of independence among the competing causes."
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables-approach-1",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables-approach-1",
    "title": "Cause-Deleted Life Tables",
    "section": "Cause-Deleted Life Tables: Approach 1",
    "text": "Cause-Deleted Life Tables: Approach 1\nWhat would things look like if deaths due to neoplasms could be avoided?\n\n\nCalculate life expectancy without deaths due to neoplasms.\ndf_ &lt;- \n    df %&gt;% \n    mutate(Rd = (D - Di) / D, \n           md = m * Rd) %&gt;% \n    mutate( # now construct a survival function, but treating \n            # the hazard md as if its the only one operating\n        Hd = cumsum(n * md), \n        Sd = edit.na(exp(-lag(Hd)),1)\n    ) %&gt;% \n    mutate(Pd = edit.na((Sd - lead(Sd))/md, tail(Sd/md,1)))\n\n\nThis changes life-expectancy to 82.39 years. Note that this is under a (strong) assumption of independence among the competing causes."
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables-approach-2",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#cause-deleted-life-tables-approach-2",
    "title": "Cause-Deleted Life Tables",
    "section": "Cause-Deleted Life Tables: Approach 2",
    "text": "Cause-Deleted Life Tables: Approach 2\nThis is based on Chiang’s method. This method assumps proportionality of cause-specific hazards within an age group (which as the textbook notes, is weaker than the constant risk assumption used above).\n\n\nCalculate life expectancy without deaths due to neoplasms.\ndf2_ &lt;-\n    df_ %&gt;%\n    mutate(pd = (1 - q) ^ Rd,\n           ld = 100000 * cumprod(c(1, pd[-length(pd)]))) %&gt;%\n    mutate(\n        dd = edit.na(ld - lead(ld), tail(ld, 1)),\n        qd = dd / ld,\n        ad = ifelse(\n            age &lt; 10 | age == 80,\n            n + Rd * (q / qd) * (a - n),\n            ifelse(age &gt;= 10 & age &lt;= 75,\n                   ((-5 / 24) * lag(dd) + 2.5 * dd + (5 / 24) * lead(dd)) / dd,\n                   a / Rd)\n        )\n    ) %&gt;% \n    mutate(\n        Ld = edit.na(dd * ad + (ld - dd) * n,  tail(ld * ad, 1))\n    )\n\n\nThis method yields a life expectancy of 82.46 years."
  },
  {
    "objectID": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#final-cause-deleted-life-table",
    "href": "blog/posts/cause-deleted-life-tables/cause-delented-life-tables.html#final-cause-deleted-life-table",
    "title": "Cause-Deleted Life Tables",
    "section": "Final Cause-Deleted Life Table",
    "text": "Final Cause-Deleted Life Table\n\n\nCreate Final Cause-Deleted Life Table.\nlt &lt;-\n    df2_ %&gt;%\n    mutate(\n        Td = sum(Ld) - cumsum(Ld) + Ld, \n        ed = Td / ld\n    ) #%&gt;% \n    #select(age,Rd,lx,a,ld,ad,ed)\n\nlt %&gt;% head(n=19) %&gt;% \n    kable() %&gt;% \n    kable_styling()\n\n\n\n\nTable 3: Cause-Deleted Life Table After Removing Deaths From Neoplasms (1991 US Females)\n\n\nage\nD\nDi\nlx\na\nq\nqi\nd\ndi\nn\nm\nH\nS\nP\nRd\nmd\nHd\nSd\nPd\npd\nld\ndd\nqd\nad\nLd\nTd\ned\n\n\n\n\n0\n15758\n63\n100000\n0.152\n0.00783\n0.00003\n783\n3.1304\n1\n0.00788\n0.00788\n1.00000\n0.99607\n0.99600\n0.00785\n0.00785\n1.00000\n0.99608\n0.99220\n100000\n779.882\n0.00780\n0.15201\n99339\n8245748\n82.4575\n\n\n1\n3169\n275\n99217\n1.605\n0.00168\n0.00015\n167\n14.4919\n4\n0.00042\n0.00957\n0.99215\n3.96525\n0.91322\n0.00038\n0.00939\n0.99218\n3.96567\n0.99846\n99220\n152.524\n0.00154\n1.60518\n396515\n8146410\n82.1044\n\n\n5\n1634\n268\n99050\n2.275\n0.00092\n0.00015\n91\n14.9253\n5\n0.00018\n0.01049\n0.99048\n4.95012\n0.83599\n0.00015\n0.01016\n0.99065\n4.95137\n0.99923\n99068\n76.094\n0.00077\n2.27521\n495131\n7749894\n78.2284\n\n\n10\n1573\n217\n98959\n2.843\n0.00090\n0.00012\n89\n12.2778\n5\n0.00018\n0.01139\n0.98957\n4.94562\n0.86205\n0.00016\n0.01093\n0.98989\n4.94755\n0.99922\n98992\n76.752\n0.00078\n2.87537\n494794\n7254764\n73.2867\n\n\n15\n3955\n318\n98870\n2.657\n0.00236\n0.00019\n233\n18.7343\n5\n0.00047\n0.01375\n0.98868\n4.93757\n0.91960\n0.00043\n0.01310\n0.98913\n4.94027\n0.99783\n98915\n214.383\n0.00217\n2.65264\n494071\n6759969\n68.3414\n\n\n20\n4948\n467\n98637\n2.547\n0.00262\n0.00025\n258\n24.3504\n5\n0.00052\n0.01636\n0.98635\n4.92529\n0.90562\n0.00047\n0.01547\n0.98698\n4.92906\n0.99763\n98700\n233.829\n0.00237\n2.54826\n492929\n6265899\n63.4841\n\n\n25\n6491\n856\n98379\n2.550\n0.00314\n0.00041\n309\n40.7493\n5\n0.00063\n0.01951\n0.98377\n4.91112\n0.86813\n0.00055\n0.01821\n0.98464\n4.91650\n0.99727\n98467\n268.545\n0.00273\n2.57653\n491682\n5772970\n58.6287\n\n\n30\n9428\n1924\n98070\n2.616\n0.00425\n0.00087\n417\n85.0984\n5\n0.00085\n0.02377\n0.98068\n4.89296\n0.79593\n0.00068\n0.02160\n0.98196\n4.90148\n0.99661\n98198\n332.479\n0.00339\n2.58477\n490187\n5281288\n53.7820\n\n\n35\n12027\n3532\n97653\n2.677\n0.00584\n0.00171\n570\n167.3934\n5\n0.00117\n0.02962\n0.97651\n4.86829\n0.70633\n0.00083\n0.02573\n0.97863\n4.88307\n0.99587\n97866\n403.829\n0.00413\n2.58246\n488351\n4791101\n48.9560\n\n\n40\n15543\n5958\n97083\n2.685\n0.00818\n0.00314\n794\n304.3590\n5\n0.00164\n0.03783\n0.97081\n4.83418\n0.61668\n0.00101\n0.03079\n0.97460\n4.86067\n0.99495\n97462\n492.324\n0.00505\n2.63691\n486145\n4302750\n44.1481\n\n\n45\n19264\n8434\n96289\n2.681\n0.01330\n0.00582\n1281\n560.8365\n5\n0.00268\n0.05122\n0.96287\n4.78229\n0.56219\n0.00151\n0.03832\n0.96968\n4.83018\n0.99250\n96969\n727.378\n0.00750\n2.67237\n483154\n3816605\n39.3589\n\n\n50\n25384\n11673\n95008\n2.655\n0.02095\n0.00963\n1990\n915.1146\n5\n0.00423\n0.07237\n0.95007\n4.70046\n0.54014\n0.00229\n0.04975\n0.96241\n4.78464\n0.98863\n96242\n1094.144\n0.01137\n2.69457\n478687\n3333451\n34.6362\n\n\n55\n37211\n17078\n93018\n2.647\n0.03371\n0.01547\n3136\n1439.2682\n5\n0.00685\n0.10663\n0.93018\n4.57216\n0.54105\n0.00371\n0.06828\n0.95147\n4.71354\n0.98162\n95148\n1749.234\n0.01838\n2.70304\n471721\n2854764\n30.0035\n\n\n60\n59431\n25263\n89882\n2.646\n0.05155\n0.02191\n4633\n1969.4011\n5\n0.01057\n0.15946\n0.89886\n4.37764\n0.57492\n0.00607\n0.09865\n0.93400\n4.59979\n0.97003\n93399\n2798.900\n0.02997\n2.69495\n460541\n2383043\n25.5148\n\n\n65\n88087\n33534\n85249\n2.631\n0.07669\n0.02920\n6538\n2488.9631\n5\n0.01592\n0.23904\n0.85261\n4.09781\n0.61931\n0.00986\n0.14794\n0.90606\n4.42046\n0.95178\n90600\n4368.320\n0.04822\n2.69590\n442933\n1922501\n21.2197\n\n\n70\n114693\n36695\n78711\n2.628\n0.11552\n0.03696\n9093\n2909.2241\n5\n0.02444\n0.36126\n0.78738\n3.70583\n0.68006\n0.01662\n0.23106\n0.86248\n4.13806\n0.91991\n86231\n6906.623\n0.08009\n2.68644\n415178\n1479568\n17.1581\n\n\n75\n143554\n36571\n69618\n2.618\n0.17427\n0.04439\n12132\n3090.6793\n5\n0.03801\n0.55131\n0.69679\n3.17293\n0.74525\n0.02833\n0.37269\n0.79369\n3.70026\n0.86701\n79325\n10549.135\n0.13299\n2.67576\n372105\n1064390\n13.4181\n\n\n80\n164986\n30220\n57486\n2.570\n0.27363\n0.05012\n15730\n2881.2178\n5\n0.06312\n0.86691\n0.57620\n2.47064\n0.81683\n0.05156\n0.63048\n0.68888\n3.03625\n0.77017\n68776\n15806.494\n0.22983\n2.63677\n306524\n692285\n10.0658\n\n\n85\n320578\n32739\n41756\n6.539\n1.00000\n0.10212\n41756\n4264.3278\nNA\n0.15293\nNA\n0.42025\n2.74800\n0.89788\n0.13731\nNA\n0.53234\n3.87687\n0.00000\n52969\n52969.130\n1.00000\n7.28275\n385761\n385761\n7.2828\n\n\n\n\n\n\n\n\n\n\n# A tibble: 83 × 2\n       x       qx\n   &lt;int&gt;    &lt;dbl&gt;\n 1    18 0.000949\n 2    19 0.00103 \n 3    20 0.00111 \n 4    21 0.00127 \n 5    22 0.00126 \n 6    23 0.00128 \n 7    24 0.00136 \n 8    25 0.00131 \n 9    26 0.00136 \n10    27 0.00133 \n# ℹ 73 more rows\n\n\n[1] 0.000019375 0.101511777 0.000869107 0.002996477 0.000000000\n\n\nTime Series:\nStart = 2010 \nEnd = 2010 \nFrequency = 1 \n[1] 38.523\n\n\n[1] 38.501"
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html#chatgpt",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html#chatgpt",
    "title": "Modeling Mortality Using a Gompertz Model",
    "section": "",
    "text": "Note the following was generated by chatGPT to discuss various way to model mortality–it’s useful but will need to be vetted!\n\n\nLee-Carter (LC) forecasting is a popular method for projecting mortality rates over time. It was introduced by Ronald Lee and Lawrence Carter in 1992, and has since been widely used in actuarial science, demography, and public health research.\nThe LC method assumes that the logarithm of the mortality rate can be modeled as a linear function of age and a time-dependent factor:\nlog(mu(x,t)) = alpha(x) + beta(x)k(t) + epsilon(x,t)\nwhere mu(x,t) represents the mortality rate at age x and time t, alpha(x) and beta(x) are age-specific constants, k(t) is a time-dependent factor common to all ages, and epsilon(x,t) is a normally-distributed error term.\nTo estimate the LC model parameters, researchers typically use historical mortality data for a given population and age range. The parameters are estimated through a process called singular value decomposition, which involves breaking down the covariance matrix of the logarithms of the mortality rates into its component parts.\nOnce the LC model parameters have been estimated, they can be used to forecast future mortality rates by projecting the time-dependent factor k(t) into the future. This can be done using various methods, such as extrapolating historical trends or incorporating information from other sources, such as economic or demographic indicators.\nOne advantage of the LC method is that it can capture age-specific mortality trends and changes over time, which can be useful for analyzing the impact of interventions or policies on mortality rates. However, the method has some limitations, such as its assumption of a linear relationship between age and mortality rates, and its reliance on historical data for parameter estimation. As such, researchers may choose to use alternative models or methods in certain contexts or for certain populations.\n\n\n\nThe Lee-Carter (LC) model, Gompertz model, and Gompertz-Makeham model are all used for forecasting mortality rates, but they differ in their assumptions and applications.\nThe Gompertz model assumes that mortality rates increase exponentially with age, and has been widely used for modeling mortality in various contexts. The Gompertz-Makeham model extends the Gompertz model by adding a constant term (the Makeham term) to account for mortality risk factors that are independent of age, such as genetic or environmental factors. The Gompertz and Gompertz-Makeham models are relatively simple and computationally efficient, but they may not capture more complex mortality patterns, such as mortality trends or cohort effects.\nThe LC model, on the other hand, allows for more flexible and nuanced modeling of age-specific mortality trends over time. It assumes that a common factor, k(t), influences mortality rates at all ages, and estimates age-specific deviations from this factor using historical mortality data. This allows for capturing trends and changes in mortality rates that are not explained by age alone.\nIn terms of forecasting performance, studies have found that the LC model generally outperforms the Gompertz and Gompertz-Makeham models, particularly for longer forecast horizons and for populations with more complex mortality patterns. However, the choice of model may depend on the specific research question, the data available, and the trade-off between model complexity and forecasting accuracy.\nOverall, while the Gompertz and Gompertz-Makeham models are simpler and computationally efficient, the LC model offers more flexibility and accuracy for modeling and forecasting mortality rates, particularly in populations with complex mortality patterns."
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html#download-the-data-from-the-human-mortality-database",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html#download-the-data-from-the-human-mortality-database",
    "title": "Approaches for Modeling Mortality Using Life-Table Data",
    "section": "Download the data from the Human Mortality Database",
    "text": "Download the data from the Human Mortality Database\n\nhmd.usa &lt;- demography::hmd.mx(\"USA\",\"&lt;USER NAME (email)&gt;\", \"&lt;PASSWORD&gt;\",\"USA\")\nwrite_rds(hmd.usa,file=here(\"blog/posts/cause-deleted-life-tables/data/usa-life-table.rds\"))\n\n\nhmd.usa &lt;- read_rds(here(\"blog/posts/cause-deleted-life-tables/data/usa-life-table.rds\"))\n\nlt &lt;-  # Construct a life-table for 2010 mortality \n  demography::lifetable(hmd.usa,series = \"male\", years = 2010) %&gt;% \n  as_tibble() %&gt;% \n  mutate_at(vars(lx,dx), function(x) x*100000)\n\n# Restrict the estimation sample to only 30-99 year olds. \nlt_a &lt;- lt  %&gt;% filter(x&lt;100) %&gt;% \n  filter(x&gt;30 & x&lt;100)"
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html#define-various-functions",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html#define-various-functions",
    "title": "Approaches for Modeling Mortality Using Life-Table Data",
    "section": "Define various functions",
    "text": "Define various functions\n\n# SOURCE: https://github.com/scpatricio/bell_mortality\n# Here, however, I'm just using the negative binomial rather than the bell distribution code. \n\n# Gompertz\ngompertz = function(t, theta){\n    a = theta[1]\n    b = theta[2]\n    \n    return(a*exp(b*t))\n}\n\n\n  \n# Gompertz-Makeham\nmakeham = function(t, theta){\n    a = theta[1]\n    b = theta[2]\n    c = theta[3]\n    \n    return(a*exp(b*t)+c)\n}\n\nseries = function(j, phi){\n    out = NULL\n    \n    for(i in 1:length(j)){\n        out[i] = sum(log(0:(j[i]-1) + phi))\n    }\n    \n    return(out)\n}\n\nlogLike_NB = function(theta, Dx, Ex, mu, t){ # negative binomial\n    theta = abs(theta)\n    phi = theta[1]\n    \n    lamb = Ex*mu(t, theta[-1])\n    \n    log_lik = series(Dx, phi) +Dx*log(lamb)-(Dx+phi)*log(phi+lamb)+phi*log(phi)\n    \n    return(-sum(log_lik, na.rm = T))\n}\n\n# E1 function\nE1 = function(z){\n    integrate(function(t){\n        (exp(-t))/t\n    }, z, Inf)$value\n}\n\nex_gomp = function(t, a, b){\n    exp(a*exp(b*t)/b)*E1(a*exp(b*t)/b)/b\n}\n\n# Gompertz-Makeham\nGamma_Inc_sup = function(s, z){\n    integrate(function(t){\n        t^(s-1)*exp(-t)\n    }, z, Inf)$value\n}\n\nex_mak = function(t, a, b, c){\n    (exp(a*exp(b*t)/b)/b)*((a*exp(b*t)/b)^(c/b))*Gamma_Inc_sup(-c/b,a*exp(b*t)/b)\n}\n\n\nnb_estim_gompertz = abs(optim(par = c(1, 0.001, 0.2),\n                     fn = logLike_NB,\n                     Ex = lt_a$lx,\n                     Dx = lt_a$dx,\n                     mu = gompertz,\n                     t = lt_a$x-30)$par)\n\n\nnb_estim_makeham = abs(optim(par = c(1, 0.001, 0.1, 0.001),\n                     fn = logLike_NB,\n                       Ex = lt_a$lx,\n                       Dx = lt_a$dx,\n                       mu = makeham,\n                       t = lt_a$x-30)$par)\n\n\n  \n# Predicted Mortality Rates\n\nlt_a$pr_gomp_nb = log(gompertz(lt_a$x-30,nb_estim_gompertz[-1]))\nlt_a$pr_makeham_nb = log(makeham(lt_a$x-30,nb_estim_makeham[-1]))\n\nlt %&gt;% \n  ggplot(aes(x = x, y = log(qx))) + geom_point() +\n  hrbrthemes::theme_ipsum() + \n  geom_line(data = lt_a %&gt;% \n  select(x,starts_with(\"pr_\")) %&gt;% \n  gather(method,y,-x), aes(x=x,y=y,colour=method))"
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html#lee-carter-vs.-gompertz-gompertz-makeham",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html#lee-carter-vs.-gompertz-gompertz-makeham",
    "title": "Approaches for Modeling Mortality Using Life-Table Data",
    "section": "Lee-Carter vs. Gompertz / Gompertz-Makeham",
    "text": "Lee-Carter vs. Gompertz / Gompertz-Makeham\nThe Lee-Carter (LC) model, Gompertz model, and Gompertz-Makeham model are all used for forecasting mortality rates, but they differ in their assumptions and applications.\nThe Gompertz model assumes that mortality rates increase exponentially with age, and has been widely used for modeling mortality in various contexts. The Gompertz-Makeham model extends the Gompertz model by adding a constant term (the Makeham term) to account for mortality risk factors that are independent of age, such as genetic or environmental factors. The Gompertz and Gompertz-Makeham models are relatively simple and computationally efficient, but they may not capture more complex mortality patterns, such as mortality trends or cohort effects.\nThe LC model, on the other hand, allows for more flexible and nuanced modeling of age-specific mortality trends over time. It assumes that a common factor, k(t), influences mortality rates at all ages, and estimates age-specific deviations from this factor using historical mortality data. This allows for capturing trends and changes in mortality rates that are not explained by age alone.\nIn terms of forecasting performance, studies have found that the LC model generally outperforms the Gompertz and Gompertz-Makeham models, particularly for longer forecast horizons and for populations with more complex mortality patterns. However, the choice of model may depend on the specific research question, the data available, and the trade-off between model complexity and forecasting accuracy.\nOverall, while the Gompertz and Gompertz-Makeham models are simpler and computationally efficient, the LC model offers more flexibility and accuracy for modeling and forecasting mortality rates, particularly in populations with complex mortality patterns.\nIn summary, Gompertz models, Gompertz-Makeham models, and Lee-Carter models are all used to model adult mortality, but they differ in their assumptions and complexity. The Gompertz model is the simplest but assumes that mortality rates increase indefinitely with age, while the Gompertz-Makeham model adds a constant term to account for other mortality risks but still assumes infinite mortality rates. The Lee-Carter model is non-parametric and can capture changes in mortality rates over time and age-specific and time-specific effects on mortality."
  },
  {
    "objectID": "blog/posts/gompertz-mortality/gompertz-mortality.html#heligman-pollard-model",
    "href": "blog/posts/gompertz-mortality/gompertz-mortality.html#heligman-pollard-model",
    "title": "Approaches for Modeling Mortality Using Life-Table Data",
    "section": "Heligman-Pollard model",
    "text": "Heligman-Pollard model\n(Description from ChatGPT)\nThe Heligman-Pollard model is a statistical model for mortality modeling that is widely used in actuarial science and demography. The model was first proposed by Nathan Keyfitz in 1977 and later extended by Kenneth Heligman and Edward Pollard in 1980.\nThe model expresses the relationship between mortality rates and age in a mathematical form, and it can be used to estimate the probability of death for individuals at different ages. The basic assumption of the model is that mortality rates decline at a decreasing rate with increasing age, and that there is a certain amount of randomness in the mortality data.\nThe Heligman-Pollard model can be expressed in the following form:\n\\[\nlog(m(x)) = a(x) + b(x)*k\n\\]\nwhere:\n\n\\(m(x)\\) is the mortality rate at age x.\n\\(a(x)\\) and \\(b(x)\\) are age-specific parameters that describe the level and shape of the mortality curve, respectively.\n\\(k\\) is a constant parameter that controls the rate at which the mortality curve declines with increasing age.\n\nThe model can be estimated using regression techniques, and the estimated parameters can be used to calculate the probability of death at different ages.\nThe Heligman-Pollard model has been widely used in actuarial science and demography for mortality forecasting, life insurance pricing, and pension plan design. It is a flexible and robust model that can be easily applied to different populations and time periods. However, like any statistical model, the Heligman-Pollard model has its limitations and should be used with caution.\n\nyear     &lt;- 2010\nages     &lt;- lt$x\ndeaths   &lt;- lt$dx\nexposure &lt;- lt$lx\nfit &lt;- MortalityLaw(x   = ages,\n                    Dx  = deaths,   # vector with death counts\n                    Ex  = exposure, # vector containing exposures\n                    law = \"HP2\",\n                    opt.method = \"LF2\")\nplot(fit)\n\n\n\nget_mort &lt;- function(x,params) {\n  with(as.list(params),{\n    mu1 &lt;-  A^((x + B)^C) + (G * H^x)/(1 + G * H^x)\n    mu2 &lt;-  D * exp(-E * (log(x/F_))^2)\n    ifelse(x == 0, mu1, mu1 + mu2)\n  })\n}\n\nplot(lt$x,log(lt$qx))\npoints(lt$x,log(get_mort(lt$x,fit$coefficients)),col=\"blue\")\n\n\n\n\n\nget_mort(lt$x,fit$coefficients)\n\n  [1] 0.0066864860 0.0005582469 0.0002885961 0.0002003338 0.0001602317\n  [6] 0.0001397381 0.0001292190 0.0001245984 0.0001239791 0.0001267321\n [11] 0.0001335566 0.0001468856 0.0001709979 0.0002113375 0.0002730405\n [16] 0.0003591946 0.0004695373 0.0006000746 0.0007436868 0.0008914307\n [21] 0.0010340905 0.0011635680 0.0012738498 0.0013614663 0.0014254900\n [26] 0.0014671988 0.0014895519 0.0014966070 0.0014929770 0.0014833808\n [31] 0.0014723136 0.0014638355 0.0014614635 0.0014681448 0.0014862880\n [36] 0.0015178311 0.0015643293 0.0016270496 0.0017070630 0.0018053301\n [41] 0.0019227758 0.0020603539 0.0022191009 0.0024001804 0.0026049204\n [46] 0.0028348439 0.0030916956 0.0033774656 0.0036944110 0.0040450775\n [51] 0.0044323206 0.0048593287 0.0053296466 0.0058472025 0.0064163357\n [56] 0.0070418283 0.0077289396 0.0084834424 0.0093116644 0.0102205308\n [61] 0.0112176119 0.0123111730 0.0135102275 0.0148245938 0.0162649540\n [66] 0.0178429163 0.0195710783 0.0214630928 0.0235337337 0.0257989620\n [71] 0.0282759903 0.0309833444 0.0339409200 0.0371700327 0.0406934588\n [76] 0.0445354625 0.0487218087 0.0532797540 0.0582380149 0.0636267047\n [81] 0.0694772366 0.0758221847 0.0826950989 0.0901302648 0.0981624054\n [86] 0.1068263163 0.1161564314 0.1261863140 0.1369480733 0.1484717061\n [91] 0.1607843674 0.1739095788 0.1878663864 0.2026684850 0.2183233315\n [96] 0.2348312738 0.2521847294 0.2703674475 0.2893538944 0.3091088018\n[101] 0.3295869150"
  },
  {
    "objectID": "blog/drafts/scratch/scratch.html",
    "href": "blog/drafts/scratch/scratch.html",
    "title": "Cause-Deleted Life Tables",
    "section": "",
    "text": "All-Cause Life Table Data\n\n\nModel All-Cause Mortality\n\n\nCause-Specific Deaths\n\n\n\n\n\nNote that the death rate per 100k population is not calculated above age 85, so we need to predict it. Luckily the (log) death rate is very linear:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHistorical Mortality"
  },
  {
    "objectID": "lectures/lec_structure.html#common-advice-on-conversion",
    "href": "lectures/lec_structure.html#common-advice-on-conversion",
    "title": "5. Structuring the Markov Model",
    "section": "Common Advice on Conversion",
    "text": "Common Advice on Conversion\n\\(\\pi_{A \\rightarrow B} = 1 - e^{-r_{A \\rightarrow B} t}\\) to convert a rate, \\(r\\) to a probability, \\(\\pi\\).\n\\(r_{A \\rightarrow B} = -\\log(1 - (\\pi_{A \\rightarrow B} - 1) / t\\) to convert a probability, \\(\\pi\\), to a rate, \\(r\\).\nWhich is technically correct for a model with one rate."
  },
  {
    "objectID": "lectures/lec_structure.html#competing-rates",
    "href": "lectures/lec_structure.html#competing-rates",
    "title": "5. Structuring the Markov Model",
    "section": "Competing Rates",
    "text": "Competing Rates\nWhen 2 rates compete for a transition these formulas are mathematically wrong.\nWhat is correct is embedding the rate matrix, \\(X\\) into a time step, \\(Y = Y_0 e^{Xt}\\)."
  },
  {
    "objectID": "lectures/lec_structure.html#resulting-error",
    "href": "lectures/lec_structure.html#resulting-error",
    "title": "5. Structuring the Markov Model",
    "section": "Resulting Error",
    "text": "Resulting Error\n\nIf one has misapplied this in a publication, it’s okay."
  },
  {
    "objectID": "lectures/lec_structure.html#quantified-absolute-error",
    "href": "lectures/lec_structure.html#quantified-absolute-error",
    "title": "5. Structuring the Markov Model",
    "section": "Quantified Absolute Error",
    "text": "Quantified Absolute Error"
  },
  {
    "objectID": "lectures/lec_structure.html#quantified-relative-error",
    "href": "lectures/lec_structure.html#quantified-relative-error",
    "title": "5. Structuring the Markov Model",
    "section": "Quantified Relative Error",
    "text": "Quantified Relative Error\n\n\nFor rates &lt; 0.1 of the chosen time step the error is &lt;5%."
  },
  {
    "objectID": "lectures/lec_structure.html#comparison",
    "href": "lectures/lec_structure.html#comparison",
    "title": "5. Structuring the Markov Model",
    "section": "Comparison",
    "text": "Comparison\n\nCommon Economic Statistics are relative to a base or reference case.\n\nNet monetary benefit.\nNet health benefit.\nIncremental cost effectiveness ratio.\n\nThe bias introduced is generally of the same order of magnitude and cancels. Similar to the “difference in difference” method in statistics.\nThese decision thresholds are robust against this misspecification.\nAbsolute values in a single scenario will be biased relative to rates."
  },
  {
    "objectID": "lectures/lec_structure.html#rate-misspecification-conclusions",
    "href": "lectures/lec_structure.html#rate-misspecification-conclusions",
    "title": "5. Structuring the Markov Model",
    "section": "Rate Misspecification Conclusions",
    "text": "Rate Misspecification Conclusions\n\nExisting publications are generally okay if they misspecified rates via these formulas. Check the maximum rate of an event as a rough estimate of effect.\nPublished rates from clinical studies are usually adjusted for competing events."
  },
  {
    "objectID": "lectures/lec_structure.html#section",
    "href": "lectures/lec_structure.html#section",
    "title": "5. Structuring the Markov Model",
    "section": "",
    "text": "library(ggplot2); theme_set(theme_bw())\nlibrary(flexsurv) # For pgompertz\n\nLoading required package: survival\n\nlibrary(survival) # For fitting\nlibrary(readxl)\nlibrary(janitor)\n\n\nAttaching package: 'janitor'\n\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\n# Read in Raw Lifetable Data\ndeaths.male &lt;- read.table(here::here(\"gompertz-mortality/data/mltper_1x1.txt\"),skip=2,header=T,as.is=TRUE)\ndeaths.female &lt;- read.table(here::here(\"gompertz-mortality/data/fltper_1x1.txt\"),skip=2,header=T,as.is=TRUE)\n\n# Make Some Edits\ndeaths.male[which(deaths.male$Age==\"110+\"),]$Age &lt;- 110\ndeaths.female[which(deaths.female$Age==\"110+\"),]$Age &lt;- 110\ndeaths.male$Age &lt;- as.numeric(deaths.male$Age)\ndeaths.female$Age &lt;- as.numeric(deaths.female$Age)\n\n# Isolate each file to 2010 deaths only\ndeaths.male.2010 &lt;- subset(deaths.male,Year==2010)\ndeaths.female.2010 &lt;- subset(deaths.female,Year==2010)\n\n# Generate the CDF ## CDF == 1-Survival = 1 - lx/10)\ndeaths.male.2010$cdf &lt;- with(deaths.male.2010,1-lx/100000)\ndeaths.female.2010$cdf &lt;- with(deaths.female.2010,1-lx/100000)\n\n# Expand to full data frame\ndeaths.male.long &lt;- data.frame(Age=rep(deaths.male.2010$Age, deaths.male.2010$dx))\ndeaths.male.long$Death &lt;- 1\n\ndeaths.female.long &lt;- data.frame(Age=rep(deaths.female.2010$Age, deaths.female.2010$dx))\ndeaths.female.long$Death &lt;- 1\n\nparameters = data.frame(\n  Age = 0:110,\n  male.shape=rep(NA,111),\n  male.rate=rep(NA,111),\n  female.shape=rep(NA,111),\n  female.rate=rep(NA,111)\n)\n\nparameters &lt;- read.csv(here::here(\"lectures/media/gompertz-mortality.csv\"))"
  },
  {
    "objectID": "scratch/scratch.html",
    "href": "scratch/scratch.html",
    "title": "Cause-Deleted Life Tables",
    "section": "",
    "text": "All-Cause Life Table Data\n\n\nModel All-Cause Mortality\n\n\nCause-Specific Deaths\n\n\n\n\n\nNote that the death rate per 100k population is not calculated above age 85, so we need to predict it. Luckily the (log) death rate is very linear:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nHistorical Mortality"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html",
    "title": "Basic Markov Modeling in R",
    "section": "",
    "text": "The objective of this posting is to provide R code that replicates the model and results in Green et al. (2023).\nGreen et al. (2023) provide a link to the Excel file as well as code to execute the same model in R. The R code is written in base R, meaning that it does not require any loaded packages to execute. However, the model structure is somewhat complicated–requiring, for example, both state occupancy and transitions out of certain states to be tracked.More specifically, in the Green et al. (2023) model there is an additional cost from transitioning from Progressive disease to death, but this cost does not apply if the cause of death was background mortality. This is straighforward to track when the calculations are done cycle-by-cycle, as in the original Excel file and R code. However, this type of dynamic is not easily captured in a generalized approach to modeling—as we aim to build here—unless the specific health states are separately defined in the model. Our adaptation to the code generalizes the modeling process but does not change the results.\nThe code provided below replicates the original model, but draws on various capabilities within the (now ubiquitous) tidyverse universe to both simplify and generalize the execution process; this will become useful in the workshop when we augment the model with additional health states, new evidence, etc.\nThe original model is structured as follows:\n\nCreated on Sketchviz\n\nIn this model, individuals can cycle into the death state in one of two ways:\n\nFrom the Asymptomatic state, in which case the probability of death is goverened by age-dependent mortality probabilities.\nFrom the Progressive Disease state, in which case the probability of death is govered both by age-dependent mortality, as well as a heightened probability of death from the disease.\n\nTo simplify and generalize the code required to execute the model we will make a slight adaptation to the model structure and seaprate out death from Progressive disease and death from background causes. The adapted model diagram is provided below.\n\nHosted on Sketchviz\n\nThe only other adaptation to the model we will make is to set the discount rates to 0."
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#functions",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#functions",
    "title": "Replication of Didactic Model",
    "section": "",
    "text": "1alt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\n2cycle_adj      &lt;- function(x,h) h*sum(alt_simp_coef(length(x)) * x)\n\n\n1\n\nAlternative Simpson’s method coefficients\n\n2\n\nFunction to create cycle adjustment values"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#model-parameters",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#model-parameters",
    "title": "Replication of Green et al. Model",
    "section": "",
    "text": "We first parameterize the model in params:\n\nparams = list(\n    t_names = c(\"without_drug\", \"with_drug\"),   # Treatment names\n    n_treatments =2, # Number of treatments\n    s_names  =c(\"Asympt\", \"Progressive\", \"DeadCause\",\"Dead\"), # State names\n    n_states =4, # Number of states\n\n    n_cohort =1000, # Cohort size\n    cycle =1, # Cycle length\n    \n    n_cycles = 46, # Total number of cycles\n    Initial_age =55,  # Cohort starting age\n    effect =0.5,  # Treatment Effect (drug) \n    \n    cAsymp =500,   # Cost of asympomatic state\n    cDeath =1000,  # cost of death (progressive disease state only)\n    cDrug =1000,   # Cost of drug\n    cProg =3000,   # Cycle cost of progressive disease\n    uAsymp =0.95, # Asymptomatic state utility\n    uProg =0.75,  # Progressive disease state utility\n    oDr = 0.06,  # Discount rate (QALYs)\n    cDr = 0.06,  # Discount rate (costs)\n    tpDcm =0.15,  # Death from progressive disease trans prob\n    tpProg =0.01, # Transition prob: progressive disease\n    tpDn =0.0379  # Background mortality transition prob\n)\n\nparams2 &lt;- modifyList(params,list( s_names  =c(\"Asympt\", \"Progressive\", \"Dead\"), # State names\n                                   n_states =3))"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#cycle-adjustment",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#cycle-adjustment",
    "title": "Basic Markov Modeling in R",
    "section": "Cycle Adjustment",
    "text": "Cycle Adjustment\n\n1alt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\n2cycle_adj      &lt;- function(x,h) h*sum(alt_simp_coef(length(x)) * x)\n3cycle_adj &lt;- alt_simp_coef(params$n_cycles-1)\n\n\n1\n\nAlternative Simpson’s method coefficients\n\n2\n\nFunction to create cycle adjustment values\n\n3\n\nSpecify the cycle-specific adjustment factors for the model."
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#transition-probability-matrices",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#transition-probability-matrices",
    "title": "Replication of Green et al. Model",
    "section": "",
    "text": "We will eventually build up to a function m_Pt(t) that takes as its inputs a vector of cycles and returns a time-dependent transition probability matrix for that cycle.\nLet’s start with cycle tt=1.\nWe first need to get the current age of the cohort:\n\ntt = cycle = 1\ncurrent_age &lt;- params$Initial_age  + (tt) - 1\ncurrent_age\n\n[1] 55\n\n\nUsing the mortality lookup table, we can now define the probability of death at that age. The probability of disease progression is also a simple linear function of the cycle number in the original model:\n\ntpDn_lookup &lt;-\n    c(\n        \"(34,44]\" = 0.0017,\n        \"(44,54]\" = 0.0044,\n        \"(54,64]\" = 0.0138,\n        \"(64,74]\" = 0.0379,\n        \"(74,84]\" = 0.0912,\n        \"(84,100]\" = 0.1958\n    )\nage_grp &lt;- cut(current_age,\n               breaks = c(34, 44, 54, 64, 74, 84, 100))\ntpDn_ &lt;- tpDn_lookup[age_grp]\ntpDn_\n\n(54,64] \n 0.0138 \n\n# Probability of disease progression \ntpProg_ &lt;- params$tpProg * (tt)\ntpProg_\n\n[1] 0.01\n\n\nWe next define an array (one dimension for each strategoy) based on these transition probabilities:\n\n m_P_ &lt;- with(params,{\n          array(data = c(0, 0, 0,0,\n                           tpProg_, 0, 0,0,\n                           0,tpDcm +tpDn_,0,0,\n                           tpDn_ ,  0, 0,0,\n                           \n                           0, 0, 0,0,\n                           tpProg_*(1-effect), 0, 0,0,\n                           0,tpDcm+tpDn_,0,0,\n                           tpDn_,  0,0, 0),\n                  dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))  \n        })\n        \n# Diagonals are 1-rowSum()\nm_P &lt;-\n    apply(m_P_, 3, simplify = FALSE, function(x) {\n        tmp_ = x\n        diag(tmp_) = 1 - rowSums(tmp_)\n        tmp_\n    })\n\nm_P\n\n$without_drug\n             to\nfrom          Asympt Progressive DeadCause   Dead\n  Asympt      0.9762      0.0100    0.0000 0.0138\n  Progressive 0.0000      0.8362    0.1638 0.0000\n  DeadCause   0.0000      0.0000    1.0000 0.0000\n  Dead        0.0000      0.0000    0.0000 1.0000\n\n$with_drug\n             to\nfrom          Asympt Progressive DeadCause   Dead\n  Asympt      0.9812      0.0050    0.0000 0.0138\n  Progressive 0.0000      0.8362    0.1638 0.0000\n  DeadCause   0.0000      0.0000    1.0000 0.0000\n  Dead        0.0000      0.0000    0.0000 1.0000\n\n\nWe now define a function that does all the above as a function of the cycle, and use this function to define the transition probability matrix arrays that will govern our cohort simulation.\n\nm_Pt &lt;- function(t) {\n    lapply(t, function(tt){\n        \n        current_age &lt;- params$Initial_age  + (tt) - 1\n\n        tpDn_lookup &lt;-\n            c(\"(34,44]\" = 0.0017,\n              \"(44,54]\" = 0.0044,\n              \"(54,64]\" = 0.0138,\n              \"(64,74]\" = 0.0379,\n              \"(74,84]\" = 0.0912,\n              \"(84,100]\" = 0.1958)\n        \n        age_grp &lt;- cut(current_age, \n                       breaks = c(34,44,54,64,74,84,100))\n        tpDn_ &lt;- tpDn_lookup[age_grp]\n        tpProg_ &lt;- params$tpProg * (tt)\n \n        m_P_ &lt;- with(params,{\n          array(data = c(0, 0, 0,0,\n                           tpProg_, 0, 0,0,\n                           0,tpDcm +tpDn_,0,0,\n                           tpDn_ ,  0, 0,0,\n                           \n                           0, 0, 0,0,\n                           tpProg_*(1-effect), 0, 0,0,\n                           0,tpDcm+tpDn_,0,0,\n                           tpDn_,  0,0, 0),\n                  dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))  \n        })\n        \n        # Diagonals are 1-rowSum()\n        m_P &lt;-\n            apply(m_P_, 3, simplify = FALSE, function(x) {\n                tmp_ = x\n                diag(tmp_) = 1 - rowSums(tmp_)\n                tmp_\n            })\n\n        return(m_P)\n    })\n}\n\nm_Pt2 &lt;- function(t) {\n    lapply(t, function(tt){\n        \n        current_age &lt;- params2$Initial_age  + (tt) - 1\n        \n        tpDn_lookup &lt;-\n            c(\"(34,44]\" = 0.0017,\n              \"(44,54]\" = 0.0044,\n              \"(54,64]\" = 0.0138,\n              \"(64,74]\" = 0.0379,\n              \"(74,84]\" = 0.0912,\n              \"(84,100]\" = 0.1958)\n        \n        age_grp &lt;- cut(current_age, \n                       breaks = c(34,44,54,64,74,84,100))\n        tpDn_ &lt;- tpDn_lookup[age_grp]\n        tpProg_ &lt;- params2$tpProg * (tt)\n        \n        m_P_ &lt;- with(params2,{\n            array(data = c(0, 0, 0,\n                           tpProg_, 0, 0,\n                            tpDn_,tpDcm +tpDn_,0,\n                           \n                           0, 0, 0,\n                           tpProg_ * (1 - effect), 0, 0,\n                           tpDn_,tpDcm +tpDn_ ,0),\n                  dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))  \n        })\n        \n        # Diagonals are 1-rowSum()\n        m_P &lt;-\n            apply(m_P_, 3, simplify = FALSE, function(x) {\n                tmp_ = x\n                diag(tmp_) = 1 - rowSums(tmp_)\n                tmp_\n            })\n        \n        return(m_P)\n    })\n}\n\n\nm_P &lt;- m_Pt(1:(params$n_cycles-1))\nm_P2 &lt;- m_Pt2(1:(params$n_cycles-1))\n\nLet’s take a look at the first cycle to confirm it’s the same:\n\nm_P[[1]]\n\n$without_drug\n             to\nfrom          Asympt Progressive DeadCause   Dead\n  Asympt      0.9762      0.0100    0.0000 0.0138\n  Progressive 0.0000      0.8362    0.1638 0.0000\n  DeadCause   0.0000      0.0000    1.0000 0.0000\n  Dead        0.0000      0.0000    0.0000 1.0000\n\n$with_drug\n             to\nfrom          Asympt Progressive DeadCause   Dead\n  Asympt      0.9812      0.0050    0.0000 0.0138\n  Progressive 0.0000      0.8362    0.1638 0.0000\n  DeadCause   0.0000      0.0000    1.0000 0.0000\n  Dead        0.0000      0.0000    0.0000 1.0000"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#payoffs",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#payoffs",
    "title": "Replication of Green et al. Model",
    "section": "",
    "text": "We now need to define the payoffs for costs and quality of life.\n\n u_payoff &lt;- with(params,{\n    array(c(\"Asympt\" = uAsymp, \"Progressive\" = uProg, \n            \"DeadCause\" = 0, \"Dead\" = 0, \n            \n            \"Asympt\" = uAsymp, \"Progressive\" = uProg,  \n            \"DeadCause\" = 0, \"Dead\" = 0 ),\n          \n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n})\nu_payoff\n\n, ,  = without_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost   0.95        0.75         0    0\n\n, ,  = with_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost   0.95        0.75         0    0\n\nu_payoff2 &lt;- with(params2,{\n    array(c(\"Asympt\" = uAsymp, \"Progressive\" = uProg, \n             \"Dead\" = 0, \n            \n            \"Asympt\" = uAsymp, \"Progressive\" = uProg,  \n            \"Dead\" = 0 ),\n          \n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n})\n\n\nc_payoff &lt;- with(params,{\n    array(c(\"Asympt\" = cAsymp, \"Progressive\" = cProg, \n            \"DeadCause\" = 0 , \"Dead\" = 0, \n            \n            \"Asympt\" = cAsymp+cDrug, \"Progressive\" = cProg,\n            \"DeadCause\" = 0 , \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n})\n\nc_transition_payoff &lt;- with(params,{\n    array(c(\"Asympt\" = 0, \"Progressive\" = 0, \"DeadCause\" = cDeath , \"Dead\" = 0, \n            \"Asympt\" = 0, \"Progressive\" = 0, \"DeadCause\" = cDeath , \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n})\nc_payoff\n\n, ,  = without_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost    500        3000         0    0\n\n, ,  = with_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost   1500        3000         0    0\n\nc_transition_payoff\n\n, ,  = without_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost      0           0      1000    0\n\n, ,  = with_drug\n\n      to\nfrom   Asympt Progressive DeadCause Dead\n  cost      0           0      1000    0\n\n\n\nc_payoff2 &lt;- with(params2,{\n    array(c(\"Asympt\" = cAsymp, \"Progressive\" = cProg, \n            \"Dead\" = 0, \n            \n            \"Asympt\" = cAsymp+cDrug, \"Progressive\" = cProg,\n             \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n})\n\nc_transition_payoff2 &lt;-\n    matrix(\n        0,\n        nrow = nrow(m_P2[[1]][[1]]),\n        ncol = ncol(m_P2[[1]][[1]]),\n        dimnames = dimnames(m_P2[[1]][[1]])\n    )\nc_transition_payoff2[\"Progressive\",\"Dead\"] = params2$cDeath\n\nc_payoff2\n\n, ,  = without_drug\n\n      to\nfrom   Asympt Progressive Dead\n  cost    500        3000    0\n\n, ,  = with_drug\n\n      to\nfrom   Asympt Progressive Dead\n  cost   1500        3000    0\n\nc_transition_payoff2\n\n             to\nfrom          Asympt Progressive Dead\n  Asympt           0           0    0\n  Progressive      0           0 1000\n  Dead             0           0    0\n\n\nWe now define and execute a function to cosntruct the Markov trace:\n\nsim_cohort &lt;- function(params) {\n    \n    m_P &lt;- m_Pt(1:(params$n_cycles-1))\n    \n    tr &lt;- \n        m_P %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0, \"DeadCause\" = 0, \"Dead\" = 0))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n            }))\n        }))\n    tr &lt;- \n        tr %&gt;% \n        map(~({\n            .x &lt;- rbind(t(c(params$n_cohort,0,0,0)),.x)\n        }))\n    \n    return(tr)\n}\n\nsim_cohort_array &lt;- function(params) {\n    \n    m_P &lt;- m_Pt2(1:(params$n_cycles-1))\n    \n    tr &lt;- \n        m_P %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0,  \"Dead\" = 0))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n            }))\n        }))\n    tr &lt;- \n        tr %&gt;% \n        map(~({\n            .x &lt;- rbind(t(c(params$n_cohort,0,0)),.x)\n        }))\n    \n    arr &lt;- \n        m_P %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0, \"Dead\" = 0))\n            arr_ &lt;- diag(as.vector(tr_))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n                arr_ &lt;&lt;- diag(as.vector(tr_)) %*% tp\n                arr_\n            }))\n        }))\n    arr &lt;- \n        arr %&gt;% \n        map(~({\n            .x &lt;- rbind(diag(c(params$n_cohort,0,0)),.x)\n        }))\n    \n    arr &lt;- arr %&gt;% map(~({\n        .x %&gt;% data.frame() %&gt;% \n            mutate(cycle = sort(rep(1:params$n_cycles,params$n_states))) %&gt;% \n            group_by(cycle) %&gt;% \n            nest()\n    }))\n    \n\n    \n    return(list(trace = tr, array = arr))\n}\n\n\n\nmarkov_trace &lt;- \n    sim_cohort(params)\nmarkov_trace\n\n$without_drug\n               Asympt Progressive DeadCause    Dead\n [1,] 1000.0000000000    0.000000    0.0000   0.000\n [2,]  976.2000000000   10.000000    0.0000  13.800\n [3,]  943.2044400000   27.886000    1.6380  27.272\n [4,]  901.8920855280   51.614406    6.2057  40.288\n [5,]  853.3702913266   79.235650   14.6602  52.734\n [6,]  798.9252667400  108.925365   27.6390  64.510\n [7,]  739.9645820545  139.018906   45.4809  75.536\n [8,]  677.9555500784  168.045130   68.2522  85.747\n [9,]  614.3633194810  194.755782   95.7780  95.103\n[10,]  550.5924069189  218.147484  127.6790 103.581\n[11,]  487.9349910115  237.474166  163.4116 111.179\n[12,]  415.7694058409  246.525620  208.0330 129.672\n[13,]  350.1194166586  250.095784  254.3551 145.430\n[14,]  291.3343666017  248.618311  301.3481 158.699\n[15,]  239.5059827832  242.689741  348.0635 169.741\n[16,]  194.5028086183  233.014236  393.6649 178.818\n[17,]  156.0107027927  220.351311  437.4483 186.190\n[18,]  123.5760776821  205.469119  478.8523 192.102\n[19,]   96.6488503552  189.105165  517.4600 196.786\n[20,]   74.6225773592  171.935586  552.9928 200.449\n[21,]   56.8698662055  154.553405  585.2995 203.277\n[22,]   39.7406625044  129.217796  622.5778 208.464\n[23,]   27.3733683330  106.793409  653.7451 212.088\n[24,]   18.5810424245   87.330714  679.5037 214.585\n[25,]   12.4270011735   70.725996  700.5679 216.279\n[26,]    8.1869083731   56.773636  717.6270 217.412\n[27,]    5.3116661525   45.208431  731.3208 218.159\n[28,]    3.3930923382   35.738307  742.2251 218.644\n[29,]    2.1335764623   28.068293  750.8451 218.953\n[30,]    1.3202571148   21.916958  757.6152 219.148\n[31,]    0.8037725315   17.026665  762.9016 219.268\n[32,]    0.3972243851   11.388014  768.7894 219.425\n[33,]    0.1923360473    7.577150  772.7274 219.503\n[34,]    0.0912057536    5.020443  775.3476 219.541\n[35,]    0.0423377108    3.315384  777.0836 219.559\n[36,]    0.0192297883    2.183742  778.2301 219.567\n[37,]    0.0085418719    1.435527  778.9852 219.571\n[38,]    0.0037088808    0.942282  779.4816 219.572\n[39,]    0.0015733072    0.617850  779.8075 219.573\n[40,]    0.0006516639    0.404811  780.0211 219.573\n[41,]    0.0002634025    0.265088  780.1611 219.574\n[42,]    0.0001038333    0.173529  780.2528 219.574\n[43,]    0.0000398927    0.113566  780.3128 219.574\n[44,]    0.0000149279    0.074312  780.3520 219.574\n[45,]    0.0000054367    0.048622  780.3777 219.574\n[46,]    0.0000019257    0.031811  780.3946 219.574\n\n$with_drug\n           Asympt Progressive DeadCause    Dead\n [1,] 1000.000000     0.00000    0.0000   0.000\n [2,]  981.200000     5.00000    0.0000  13.800\n [3,]  957.847440    13.99300    0.8190  27.341\n [4,]  930.261434    26.06866    3.1111  40.559\n [5,]  898.818597    40.40384    7.3811  53.396\n [6,]  863.944436    56.25616   13.9992  65.800\n [7,]  826.103669    72.95973   23.2140  77.723\n [8,]  785.789810    89.92256   35.1648  89.123\n [9,]  743.514319   106.62483   49.8941  99.967\n[10,]  699.795677   122.61783   67.3593 110.227\n[11,]  655.148712   137.52281   87.4441 119.884\n[12,]  594.285397   147.71546  113.2846 144.715\n[13,]  536.104857   155.61685  141.0403 167.238\n[14,]  480.939667   161.22326  170.2808 187.556\n[15,]  429.046277   164.59518  200.5746 205.784\n[16,]  380.606952   165.84622  231.5020 222.045\n[17,]  335.733393   165.13227  262.6645 236.470\n[18,]  294.471759   162.64126  293.6929 249.194\n[19,]  256.808821   158.58342  324.2532 260.355\n[20,]  222.678928   153.18243  354.0510 270.088\n[21,]  191.971504   146.66735  382.8340 278.527\n[22,]  154.306695   131.44819  418.2102 296.035\n[23,]  123.260188   116.71662  449.9155 310.108\n[24,]   97.843937   102.73950  478.0675 321.349\n[25,]   77.179298    89.70000  502.8483 330.272\n[26,]   60.493134    77.71177  524.4839 337.311\n[27,]   47.112052    66.83180  543.2280 342.828\n[28,]   36.455306    57.07210  559.3478 347.125\n[29,]   28.026839    48.41005  573.1136 350.449\n[30,]   21.406900    40.79744  584.7901 353.006\n[31,]   16.243556    34.16813  594.6305 354.958\n[32,]   10.545316    24.87054  606.4458 358.138\n[33,]    6.793293    17.95756  615.0460 360.203\n[34,]    4.342273    12.86873  621.2558 361.533\n[35,]    2.753869     9.15691  625.7058 362.383\n[36,]    1.732735     6.47238  628.8722 362.923\n[37,]    1.081573     4.54612  631.1104 363.262\n[38,]    0.669710     3.17416  632.6824 363.474\n[39,]    0.411336     2.20378  633.7800 363.605\n[40,]    0.250586     1.52193  634.5421 363.685\n[41,]    0.151404     1.04576  635.0684 363.734\n[42,]    0.090721     0.71517  635.4300 363.764\n[43,]    0.053907     0.48692  635.6773 363.782\n[44,]    0.031762     0.33013  635.8457 363.792\n[45,]    0.018555     0.22296  635.9599 363.799\n[46,]    0.010747     0.15004  636.0370 363.802\n\nmarkov_array &lt;- \n    sim_cohort_array(params2)"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#footnotes",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#footnotes",
    "title": "Replication of Didactic Model",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nHere is the footnote.↩︎\nHere’s one with multiple blocks.\nSubsequent paragraphs are indented to show that they belong to the previous footnote.\n{ some.code }\nThe whole paragraph can be indented, or just the first line. In this way, multi-paragraph footnotes work like multi-paragraph list items.↩︎"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html",
    "href": "slides/SLIDE_TEMPLATES.html",
    "title": "slide templates",
    "section": "",
    "text": "Block quote\n\n\n– [@neumann2016]\n\n\n\n\nAutomatically animate matching elements across slides with Auto-Animate.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAutomatically animate matching elements across slides with Auto-Animate.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n This list\n Doesn’t have bullets"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#auto-animate",
    "href": "slides/SLIDE_TEMPLATES.html#auto-animate",
    "title": "slide templates",
    "section": "",
    "text": "Automatically animate matching elements across slides with Auto-Animate."
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#auto-animate-1",
    "href": "slides/SLIDE_TEMPLATES.html#auto-animate-1",
    "title": "slide templates",
    "section": "",
    "text": "Automatically animate matching elements across slides with Auto-Animate."
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#replace-bullet-points-with-fontawesome",
    "href": "slides/SLIDE_TEMPLATES.html#replace-bullet-points-with-fontawesome",
    "title": "slide templates",
    "section": "",
    "text": "This list\n Doesn’t have bullets"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#original-image",
    "href": "slides/SLIDE_TEMPLATES.html#original-image",
    "title": "slide templates",
    "section": "Original Image",
    "text": "Original Image"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#resized-image",
    "href": "slides/SLIDE_TEMPLATES.html#resized-image",
    "title": "slide templates",
    "section": "Resized Image",
    "text": "Resized Image"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#resized-image2",
    "href": "slides/SLIDE_TEMPLATES.html#resized-image2",
    "title": "slide templates",
    "section": "Resized Image2",
    "text": "Resized Image2"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#multi-column-list",
    "href": "slides/SLIDE_TEMPLATES.html#multi-column-list",
    "title": "slide templates",
    "section": "Multi-Column list",
    "text": "Multi-Column list\n\n\n\nOne\nTwo\nThree\nFour\n\n\n\nFive\nSix\nSeven"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-1",
    "href": "slides/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-1",
    "title": "slide templates",
    "section": "Fade In - Left Column First, Right Column (with image second)",
    "text": "Fade In - Left Column First, Right Column (with image second)\n\n\n\n\nText 1.\nText 2"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-2",
    "href": "slides/SLIDE_TEMPLATES.html#fade-in---left-column-first-right-column-with-image-second-2",
    "title": "slide templates",
    "section": "Fade In - Left Column First, Right Column (with image second)",
    "text": "Fade In - Left Column First, Right Column (with image second)\n\n\n\nText 1.\nText 2"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#colored-text",
    "href": "slides/SLIDE_TEMPLATES.html#colored-text",
    "title": "slide templates",
    "section": "Colored text",
    "text": "Colored text\n\nShow this word in red.\nShow this word in blue.\nShow this word in green."
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#probabilities",
    "href": "slides/SLIDE_TEMPLATES.html#probabilities",
    "title": "slide templates",
    "section": "Probabilities",
    "text": "Probabilities"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#section-3",
    "href": "slides/SLIDE_TEMPLATES.html#section-3",
    "title": "slide templates",
    "section": "",
    "text": "Text 1\nText 2\nText 3"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#slide-with-plot-and-padding",
    "href": "slides/SLIDE_TEMPLATES.html#slide-with-plot-and-padding",
    "title": "slide templates",
    "section": "Slide with Plot and Padding",
    "text": "Slide with Plot and Padding"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#kaiser-health-insurance-quiz",
    "href": "slides/SLIDE_TEMPLATES.html#kaiser-health-insurance-quiz",
    "title": "slide templates",
    "section": "Kaiser Health Insurance Quiz",
    "text": "Kaiser Health Insurance Quiz"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#embed-a-youtube-video",
    "href": "slides/SLIDE_TEMPLATES.html#embed-a-youtube-video",
    "title": "slide templates",
    "section": "Embed a Youtube Video",
    "text": "Embed a Youtube Video"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#re-size-tables-before-re-sizing",
    "href": "slides/SLIDE_TEMPLATES.html#re-size-tables-before-re-sizing",
    "title": "slide templates",
    "section": "Re-size tables – Before re-sizing",
    "text": "Re-size tables – Before re-sizing\n\n\n\n\n\n\n\n\n\nType of study\nMeasurement/Valuation of costs both alternative\nIdentification of consequences\nMeasurement / valuation of consequences\n\n\n\n\nCost analysis\nMonetary units\nNone\nNone\n\n\nCost-effectiveness analysis\nMonetary units\nSingle effect of interest, common to both alternatives, but achieved to different degrees.\nNatural units (e.g., life-years gained, disability days saved, points of blood pressure reduction, etc.)\n\n\nCost-utility analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives.\nHealthy years (typically measured as quality-adjusted life-years)\n\n\nCost-benefit analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives\nMonetary units"
  },
  {
    "objectID": "slides/SLIDE_TEMPLATES.html#re-size-tables-after-re-sizing",
    "href": "slides/SLIDE_TEMPLATES.html#re-size-tables-after-re-sizing",
    "title": "slide templates",
    "section": "Re-size tables – After re-sizing",
    "text": "Re-size tables – After re-sizing\n\n\n\n\n\n\n\n\n\n\nType of study\nMeasurement/Valuation of costs both alternative\nIdentification of consequences\nMeasurement / valuation of consequences\n\n\n\n\nCost analysis\nMonetary units\nNone\nNone\n\n\nCost-effectiveness analysis\nMonetary units\nSingle effect of interest, common to both alternatives, but achieved to different degrees.\nNatural units (e.g., life-years gained, disability days saved, points of blood pressure reduction, etc.)\n\n\nCost-utility analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives.\nHealthy years (typically measured as quality-adjusted life-years)\n\n\nCost-benefit analysis\nMonetary units\nSingle or multiple effects, not necessarily common to both alternatives\nMonetary units"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#estimate-costs-and-qalys",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#estimate-costs-and-qalys",
    "title": "Replication of Green et al. Model",
    "section": "",
    "text": "state_costs_without &lt;- markov_trace[[1]] %*% c_payoff[,,1]\ntransition_costs_without &lt;- matrix(c(0,diff(markov_trace[[1]][,\"DeadCause\"]))) * params$cDeath\ncosts_without &lt;- state_costs_without + transition_costs_without\nqalys_without &lt;- markov_trace[[1]] %*% u_payoff[,,1]\n\nstate_costs_with &lt;- markov_trace[[2]] %*% c_payoff[,,2]\ntransition_costs_with &lt;- matrix(c(0,diff(markov_trace[[2]][,\"DeadCause\"]))) * params$cDeath\ncosts_with &lt;- state_costs_with + transition_costs_with\nqalys_with &lt;- markov_trace[[2]] %*% u_payoff[,,2]\n\ncycle_adj &lt;- alt_simp_coef(params$n_cycles)\ndiscounting &lt;- 1/(1+params$oDr)^(0:(params$n_cycles-1))\n\ntot_costs_without &lt;- sum(as.vector(costs_without[-1]) * discounting[-1])\ntot_costs_with &lt;- sum(as.vector(costs_with[-1])  * discounting[-1])\n\ntot_qalys_without &lt;- sum(as.vector(qalys_without) *  discounting)\ntot_qalys_with &lt;- sum(as.vector(qalys_with) *  discounting)\n\n#inc_cost &lt;- (tot_costs_with - tot_costs_without) \ninc_qaly &lt;- (tot_qalys_with - tot_qalys_without); inc_qaly\n\n[1] 868.79\n\ninc_cost &lt;- (tot_costs_with - tot_costs_without); inc_cost\n\n[1] 6884827\n\nicer = inc_cost / inc_qaly ; icer\n\n[1] 7924.7"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#define-payoffs",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#define-payoffs",
    "title": "Basic Markov Modeling in R",
    "section": "Define Payoffs",
    "text": "Define Payoffs\n\nu_payoff &lt;- with(params,{\n    array(c(\"Asymptomatic_disease\" = uAsymp, \"Progressive_disease\" = uProg, \"DeadCause\" = 0, \"Dead\" = 0, \n            \"Asymptomatic_disease\" = uAsymp, \"Progressive_disease\" = uProg,  \"DeadCause\" = 0, \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"qaly\",\n                          to = c(s_names),\n                          t_names))\n    }) %&gt;% \n         apply(.,3,function(x) t(x), simplify = FALSE)\nu_payoff\n\n$without_drug\n             from\nto            qaly\n  Asympt      0.95\n  Progressive 0.75\n  DeadCause   0.00\n  Dead        0.00\n\n$with_drug\n             from\nto            qaly\n  Asympt      0.95\n  Progressive 0.75\n  DeadCause   0.00\n  Dead        0.00\n\nc_state_payoff &lt;- with(params,{\n    array(c(\"Asymptomatic_disease\" = cAsymp, \"Progressive_disease\" = cProg, \"DeadCause\" = 0 , \"Dead\" = 0, \n            \"Asymptomatic_disease\" = cAsymp+cDrug, \"Progressive_disease\" = cProg, \"DeadCause\" = 0 , \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names),\n                          t_names))\n    }) %&gt;% \n        apply(.,3,function(x) t(x), simplify = FALSE)\nc_state_payoff\n\n$without_drug\n             from\nto            cost\n  Asympt       500\n  Progressive 3000\n  DeadCause      0\n  Dead           0\n\n$with_drug\n             from\nto            cost\n  Asympt      1500\n  Progressive 3000\n  DeadCause      0\n  Dead           0\n\nc_transition_payoff &lt;- with(params,{\n    array(c(\"Asymptomatic_disease\" = 0, \"Progressive_disease\" = 0, \"DeadCause\" = cDeath , \"Dead\" = 0, \n            \"Asymptomatic_disease\" = 0, \"Progressive_disease\" = 0, \"DeadCause\" = cDeath , \"Dead\" = 0 ),\n          dim = c(1, n_states, n_treatments),\n          dimnames = list(from = \"transition_cost\",\n                          to = c(s_names),\n                          t_names))\n    }) %&gt;% \n        apply(.,3,function(x) t(x), simplify = FALSE)\nc_transition_payoff\n\n$without_drug\n             from\nto            transition_cost\n  Asympt                    0\n  Progressive               0\n  DeadCause              1000\n  Dead                      0\n\n$with_drug\n             from\nto            transition_cost\n  Asympt                    0\n  Progressive               0\n  DeadCause              1000\n  Dead                      0\n\n\n\nqaly_unadj &lt;- # .x[-1,] because we don't count the cycle with the full cohort in asymptomatic\n    map2(markov_result$trace, u_payoff,  ~ ({\n        .x[-1,] %*% .y\n    })) %&gt;% \n    set_names(params$t_names)\n\ncost_state_unadj &lt;- \n    map2(markov_result$trace, c_state_payoff, ~({\n        .x[-1,] %*% .y\n    })) %&gt;% \n    set_names(params$t_names)\n\ncost_transition_unadj &lt;- \n    map2(markov_result$trace, c_state_payoff, ~({\n         matrix(c(0,diff(.x[-1,\"DeadCause\"]))) * params$cDeath\n    })) %&gt;% \n    set_names(params$t_names)\n    \ncost_unadj &lt;- map2(cost_state_unadj, cost_transition_unadj, ~(.x + .y))"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#discounting",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#discounting",
    "title": "Basic Markov Modeling in R",
    "section": "Discounting",
    "text": "Discounting\n\ndiscounting_cost &lt;- \n    1/(1+params$cDr)^(0:(params$n_cycles-2))\ndiscounting_outcome &lt;- \n    1/(1+params$oDr)^(0:(params$n_cycles-2))"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation",
    "title": "Basic Markov Modeling in R",
    "section": "Total Cost and QALY Calculation",
    "text": "Total Cost and QALY Calculation\n\ntot_cost &lt;- \n    map(cost_unadj, ~(sum(.x * discounting_cost)/params$n_cohort))  %&gt;% \n    set_names(params$t_names)\ntot_qaly &lt;- \n    map(qaly_unadj, ~(sum(.x * discounting_outcome)/params$n_cohort)) %&gt;% \n    set_names(params$t_names)\n\ndiff_cost &lt;- \n    tot_cost$with_drug - tot_cost$without_drug\ndiff_qaly &lt;- \n    tot_qaly$with_drug - tot_qaly$without_drug\n\ncbind.data.frame(cbind(tot_qaly),cbind(tot_cost))  %&gt;% \n    set_names(c(\"Eff\",\"Cost\")) %&gt;% \n    data.frame() %&gt;% \n    rbind.data.frame(\"difference\" = data.frame(Eff = round(diff_qaly,2), Cost = round(diff_cost,0))) %&gt;% \n    mutate(ICER = c(\"\",\"\",paste0(round(diff_cost / diff_qaly,0)))) %&gt;% \n    kable(digits = c(0,0,0)) %&gt;% \n    kable_styling()\n\n\nR Model Results \n\n\n\nEff\nCost\nICER\n\n\n\n\nwithout_drug\n12.203\n17526\n\n\n\nwith_drug\n14.446\n28912\n\n\n\ndifference\n2.24\n11386\n5074\n\n\n\n\n\n\n\n\n\n\nExcel Model Results"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation-no-cycle-adjustment",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation-no-cycle-adjustment",
    "title": "Basic Markov Modeling in R",
    "section": "Total Cost and QALY Calculation (No Cycle Adjustment)",
    "text": "Total Cost and QALY Calculation (No Cycle Adjustment)\n\ntot_cost &lt;- \n    map(cost_unadj, ~(sum(.x * discounting_cost )/params$n_cohort))  %&gt;% \n    set_names(params$t_names)\ntot_qaly &lt;- \n    map(qaly_unadj, ~(sum(.x * discounting_outcome )/params$n_cohort)) %&gt;% \n    set_names(params$t_names)\n\ndiff_cost &lt;- \n    tot_cost$with_drug - tot_cost$without_drug\ndiff_qaly &lt;- \n    tot_qaly$with_drug - tot_qaly$without_drug\n\ncbind.data.frame(cbind(tot_qaly),cbind(tot_cost))  %&gt;% \n    set_names(c(\"Eff\",\"Cost\")) %&gt;% \n    data.frame() %&gt;% \n    rbind.data.frame(\"difference\" = data.frame(Eff = round(diff_qaly,2), Cost = round(diff_cost,0))) %&gt;% \n    mutate(ICER = c(\"\",\"\",paste0(round(diff_cost / diff_qaly,0)))) %&gt;% \n    kable(digits = c(0,0,0)) %&gt;% \n    kable_styling()\n\n\nR Model Results \n\n\n\nEff\nCost\nICER\n\n\n\n\nwithout_drug\n12.203\n17526\n\n\n\nwith_drug\n14.446\n28912\n\n\n\ndifference\n2.24\n11386\n5074\n\n\n\n\n\n\n\n\n\n\nExcel Model Results"
  },
  {
    "objectID": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation-with-cycle-adjustment",
    "href": "blog/posts/green-et-al-replication/green-et-al-replication.html#total-cost-and-qaly-calculation-with-cycle-adjustment",
    "title": "Basic Markov Modeling in R",
    "section": "Total Cost and QALY Calculation (With Cycle Adjustment)",
    "text": "Total Cost and QALY Calculation (With Cycle Adjustment)\n\n1alt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj &lt;- alt_simp_coef(params$n_cycles-1)\n\n\n1\n\nAlternative Simpson’s method coefficients\n\n\n\n\n\ntot_cost_cadj &lt;- \n    map(cost_unadj, ~(sum(.x * discounting_cost * cycle_adj )/params$n_cohort))  %&gt;% \n    set_names(params$t_names)\ntot_qaly_cadj &lt;- \n    map(qaly_unadj, ~(sum(.x * discounting_outcome * cycle_adj )/params$n_cohort)) %&gt;% \n    set_names(params$t_names)\n\ndiff_cost_cadj &lt;- \n    tot_cost_cadj$with_drug - tot_cost_cadj$without_drug\ndiff_qaly_cadj &lt;- \n    tot_qaly_cadj$with_drug - tot_qaly_cadj$without_drug\n\ncbind.data.frame(cbind(tot_qaly_cadj),cbind(tot_cost_cadj))  %&gt;% \n    set_names(c(\"Eff\",\"Cost\")) %&gt;% \n    data.frame() %&gt;% \n    rbind.data.frame(\"difference\" = data.frame(Eff = round(diff_qaly_cadj,2), Cost = round(diff_cost_cadj,0))) %&gt;% \n    mutate(ICER = c(\"\",\"\",paste0(round(diff_cost / diff_qaly,0)))) %&gt;% \n    kable(digits = c(0,0,0)) %&gt;% \n    kable_styling()\n\n\nR Model Results \n\n\n\nEff\nCost\nICER\n\n\n\n\nwithout_drug\n11.734\n17269\n\n\n\nwith_drug\n13.977\n28167\n\n\n\ndifference\n2.24\n10898\n5074"
  },
  {
    "objectID": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html",
    "href": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html",
    "title": "Extending the Transition Matrix",
    "section": "",
    "text": "Hosted on Sketchviz"
  },
  {
    "objectID": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#define-payoffs",
    "href": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#define-payoffs",
    "title": "Extending the Transition Matrix",
    "section": "Define Payoffs",
    "text": "Define Payoffs\n\nu_payoff &lt;- with(params,{\n    array(c(\"Asympt\" = uAsymp, \"Progressive\" = uProg, \"DeadCause\" = 0 , \"Dead\" = 0, \"accProgressive\" = 0,\"trProgressive\" = 0, \"trDeadCause\" = 0,\n            \"Asympt\" = uAsymp, \"Progressive\" = uProg, \"DeadCause\" = 0 , \"Dead\" = 0, \"accProgressive\" = 0,\"trProgressive\" = 0,\"trDeadCause\" = 0),\n          dim = c(1, n_states+length(a_names)+length(tunnel_names), n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names,a_names,tunnel_names),\n                          t_names))\n    \n}) %&gt;% \n   apply(.,3,function(x) t(x), simplify = FALSE)\nu_payoff\n\n$without_drug\n                from\nto               cost\n  Asympt         0.95\n  Progressive    0.75\n  DeadCause      0.00\n  Dead           0.00\n  accProgressive 0.00\n  trProgressive  0.00\n  trDeadCause    0.00\n\n$with_drug\n                from\nto               cost\n  Asympt         0.95\n  Progressive    0.75\n  DeadCause      0.00\n  Dead           0.00\n  accProgressive 0.00\n  trProgressive  0.00\n  trDeadCause    0.00\n\nc_payoff &lt;- with(params,{\n    array(c(\"Asympt\" = cAsymp, \"Progressive\" = cProg, \"DeadCause\" = 0 , \"Dead\" = 0, \"accProgressive\" = 0,\"trProgressive\" = 0, \"trDeadCause\" = cDeath,\n            \"Asympt\" = cAsymp+cDrug, \"Progressive\" = cProg, \"DeadCause\" = 0 , \"Dead\" = 0, \"accProgressive\" = 0,\"trProgressive\" = 0, \"trDeadCause\" = cDeath),\n          dim = c(1, n_states+length(a_names)+length(tunnel_names), n_treatments),\n          dimnames = list(from = \"cost\",\n                          to = c(s_names,a_names,tunnel_names),\n                          t_names))\n    \n    }) %&gt;% \n        apply(.,3,function(x) t(x), simplify = FALSE)\nc_payoff\n\n$without_drug\n                from\nto               cost\n  Asympt          500\n  Progressive    3000\n  DeadCause         0\n  Dead              0\n  accProgressive    0\n  trProgressive     0\n  trDeadCause    1000\n\n$with_drug\n                from\nto               cost\n  Asympt         1500\n  Progressive    3000\n  DeadCause         0\n  Dead              0\n  accProgressive    0\n  trProgressive     0\n  trDeadCause    1000\n\n\n\nqaly_unadj &lt;- # .x[-1,] because we don't count the cycle with the full cohort in asymptomatic\n    map2(markov_result$trace, u_payoff,  ~ ({\n        .x[-1,] %*% .y\n    })) %&gt;% \n    set_names(params$t_names)\n\ncost_unadj &lt;- \n    map2(markov_result$trace, c_payoff, ~({\n        .x[-1,] %*% .y\n    })) %&gt;% \n    set_names(params$t_names)"
  },
  {
    "objectID": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#discounting",
    "href": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#discounting",
    "title": "Extending the Transition Matrix",
    "section": "Discounting",
    "text": "Discounting\n\ndiscounting_cost &lt;- \n    1/(1+params$cDr)^(0:(params$n_cycles-2))\ndiscounting_outcome &lt;- \n    1/(1+params$oDr)^(0:(params$n_cycles-2))"
  },
  {
    "objectID": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#total-cost-and-qaly-calculation-with-cycle-adjustment",
    "href": "blog/posts/extending-the-matrix/extending-the-transition-matrix.html#total-cost-and-qaly-calculation-with-cycle-adjustment",
    "title": "Extending the Transition Matrix",
    "section": "Total Cost and QALY Calculation (With Cycle Adjustment)",
    "text": "Total Cost and QALY Calculation (With Cycle Adjustment)\n\n1alt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj &lt;- alt_simp_coef(params$n_cycles-1)\n\n\n1\n\nAlternative Simpson’s method coefficients\n\n\n\n\n\ntot_cost &lt;- \n    map(cost_unadj, ~(sum(.x * discounting_cost * cycle_adj )/params$n_cohort))  %&gt;% \n    set_names(params$t_names)\ntot_qaly &lt;- \n    map(qaly_unadj, ~(sum(.x * discounting_outcome * cycle_adj )/params$n_cohort)) %&gt;% \n    set_names(params$t_names)\n\ndiff_cost &lt;- \n    tot_cost$with_drug - tot_cost$without_drug\ndiff_qaly &lt;- \n    tot_qaly$with_drug - tot_qaly$without_drug\n\ncbind.data.frame(cbind(tot_qaly),cbind(tot_cost))  %&gt;% \n    set_names(c(\"Eff\",\"Cost\")) %&gt;% \n    data.frame() %&gt;% \n    rbind.data.frame(\"difference\" = data.frame(Eff = round(diff_qaly,2), Cost = round(diff_cost,0))) %&gt;% \n    mutate(ICER = c(\"\",\"\",paste0(round(diff_cost / diff_qaly,0)))) %&gt;% \n    kable(digits = c(0,0,0)) %&gt;% \n    kable_styling()\n\n\nR Model Results \n\n\n\nEff\nCost\nICER\n\n\n\n\nwithout_drug\n11.659\n16629\n\n\n\nwith_drug\n13.971\n27813\n\n\n\ndifference\n2.31\n11184\n4838"
  },
  {
    "objectID": "blog/posts/signs-of-trouble/signs-of-trouble.html",
    "href": "blog/posts/signs-of-trouble/signs-of-trouble.html",
    "title": "Signs of Trouble",
    "section": "",
    "text": "The objective of this blog post is to demonstrate how state occupancy will differ over different cycle lengths when using standard conversion formulas in the presence of competing risks. In the embedded version, however, changing the cycle length does not affect state occupancy estimates."
  },
  {
    "objectID": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-conversion-formulas",
    "href": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-conversion-formulas",
    "title": "Signs of Trouble",
    "section": "1. Using Conversion Formulas",
    "text": "1. Using Conversion Formulas\n\nConvert each annual transition probability to a rate using \\(r = -ln(1 - p)\\).\nConvert the rate to the model timestep using \\(1 - exp(-rt)\\), where \\(t\\) is the timestep (e.g., \\(t = \\frac{1}{12}\\) for a monthly cycle)\nConstruct the transition probability matrix using the converted probabilities.\n\n\n\nCode\nmPt &lt;- function(t, params) {\n    lapply(t, function(tt){\n        \n        current_age &lt;- params$Initial_age  +  (tt)*params$cycle - 1 \n\n        tpDn_lookup &lt;-\n            c(\"(34,44]\" = 0.0017,\n              \"(44,54]\" = 0.0044,\n              \"(54,64]\" = 0.0138,\n              \"(64,74]\" = 0.0379,\n              \"(74,84]\" = 0.0912,\n              \"(84,100]\" = 0.1958)\n        \n        age_grp &lt;- cut(current_age, \n                       breaks = c(34,44,54,64,74,84,100))\n        \n        tpDn &lt;- tpDn_lookup[age_grp]\n        tpProg_ &lt;- params$tpProg * (tt * params$cycle )\n        tpDcm_ &lt;- params$tpDcm \n        \n        rDn &lt;- -log(1 - tpDn)\n        rProg_ &lt;- -log(1 - tpProg_)\n        rDcm_ &lt;- -log(1 - tpDcm_)\n        \n        tpDn &lt;- 1 - exp(-rDn * params$cycle)\n        tpProg_ &lt;- 1 - exp(-rProg_ * params$cycle)\n        tpDcm_ &lt;- 1 - exp(-rDcm_ * params$cycle)\n        \n        effect_ &lt;- params$effect\n        n_states_ &lt;- params$n_states\n        s_names_ &lt;- params$s_names\n        t_names_ &lt;- params$t_names\n        n_treatments_ &lt;- params$n_treatments\n        \n        mP_ &lt;- \n            array(data = c(0, 0, 0,0,\n                           tpProg_, 0, 0,0,\n                           0,tpDcm_,0,0,\n                           tpDn , tpDn, 0,0,\n                           \n                           0, 0, 0,0,\n                           tpProg_*(1-effect_), 0, 0,0,\n                           0,tpDcm_,0,0,\n                           tpDn, tpDn,0, 0),\n                  dim = c(n_states_, n_states_, n_treatments_),\n                  dimnames = list(from = s_names_,\n                                  to = s_names_,\n                                  t_names_))\n        diag(mP_[,,1]) &lt;-  # Diagonal of transition probability matrix is 1 minus off-diagonal sum\n            1 - rowSums(mP_[,,1])\n        diag(mP_[,,2]) &lt;- \n            1 - rowSums(mP_[,,2])\n        \n        mP &lt;- # This turns the named array into a simpler list object\n            apply(mP_,3,function(x) x, simplify = FALSE)\n\n        return(mP)\n    })\n}"
  },
  {
    "objectID": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-transition-rate-matrix-embedding",
    "href": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-transition-rate-matrix-embedding",
    "title": "Signs of Trouble",
    "section": "2. Using Transition Rate Matrix Embedding",
    "text": "2. Using Transition Rate Matrix Embedding\n\nConvert each annual transition probability to a rate using \\(r = -ln(1 - p)\\).\nUse these rates to fill out the Markovian transition rate matrix mR\n\nDiagonal of mR is the negative row sum of off-diagonal elements.\n\nAugment the transition rate matrix with non-Markovian accumulators and transition/tunnel states.\nEmbed the transition rate matrix into the time step using \\(mP = exp(mR*t)\\), where \\(t\\) is the timestep (e.g., \\(t = \\frac{1}{12}\\) for a monthly cycle).\n\n\n\nCode\nmPt_embedded &lt;- function(t,params) {\n    lapply(t, function(tt){\n        \n        current_age &lt;- params$Initial_age  + (tt)*params$cycle - 1\n        cycle = tt\n        cycle_years &lt;- ceiling(tt * params$cycle)\n            \n        tpDn_lookup &lt;-\n            c(\"(34,44]\" = 0.0017,\n              \"(44,54]\" = 0.0044,\n              \"(54,64]\" = 0.0138,\n              \"(64,74]\" = 0.0379,\n              \"(74,84]\" = 0.0912,\n              \"(84,100]\" = 0.1958)\n        \n        age_grp &lt;- cut(current_age, \n                       breaks = c(34,44,54,64,74,84,100))\n        tpDn &lt;- tpDn_lookup[age_grp]\n        \n        tpProg_ &lt;- params$tpProg * (cycle_years)\n        tpDcm_ &lt;- params$tpDcm \n        effect_ &lt;- params$effect\n        n_states_ &lt;- params$n_states\n        s_names_ &lt;- params$s_names\n        t_names_ &lt;- params$t_names\n        n_treatments_ &lt;- params$n_treatments\n        \n        mR_ &lt;- \n            array(data = c(0, 0, 0,0,\n                                   -log(1-tpProg_), 0, 0,0,\n                                   0,-log(1-tpDcm_),0,0,\n                           -log(1 - tpDn),  -log(1 - tpDn), 0,0,\n                           \n                                   0, 0, 0,0,\n                                   -log(1-(tpProg_*(1-effect_))), 0, 0,0,\n                                   0,-log(1-tpDcm_),0,0,\n                           -log(1 - tpDn),  -log(1 - tpDn),0, 0),\n                          dim = c(n_states_, n_states_, n_treatments_),\n                          dimnames = list(from = s_names_,\n                                          to = s_names_,\n                                          t_names_))\n\n        mR_ &lt;- apply(mR_,3,function(x){\n            diag(x) &lt;- -rowSums(x)\n            x\n        },simplify=FALSE)\n        \n        ###############################\n        # Add Non-Markovian Components\n        ###############################\n        \n        mR &lt;- lapply(mR_,function(x){\n            r_ &lt;- nrow(x)\n            add_ &lt;- length(params$a_names)   + length(params$tunnel_names) + 1\n            \n            new_row_names &lt;- c(rownames(x), params$a_names,params$tunnel_names,\"XX\")\n            new_col_names &lt;- c(colnames(x), params$a_names,params$tunnel_names,\"XX\")\n            # Expand matrix\n            x &lt;- cbind(x,  matrix(rep(0, r_ * add_), nrow=r_))\n            x  &lt;- rbind(x, matrix(rep(0, add_ * (r_+add_)), nrow=add_))\n            \n            rownames(x) &lt;- new_row_names\n            colnames(x) &lt;- new_col_names\n            \n            x[\"Asympt\",\"accProgressive\"] = x[\"Asympt\",\"Progressive\"]\n            x[\"Asympt\",\"trProgressive\"] = x[\"Asympt\",\"Progressive\"]\n            x[\"Progressive\",\"trDeadCause\"] = x[\"Progressive\",\"DeadCause\"] \n            x\n        })\n        \n        mP_ &lt;- # Embed the transition probability matrix\n            lapply(mR,function(x) expm(x * params$cycle))\n                \n        mP &lt;- lapply(mP_,function(x){\n            # Don't allow the transition columns to remain...\n            x[\"trDeadCause\",\"trDeadCause\"] = 0\n            x[\"trProgressive\",\"trProgressive\"] = 0\n            # The receiving bucket was required for embedding, but is no longer needed\n            x[-which(rownames(x)==\"XX\"),-which(colnames(x)==\"XX\")]    \n        }) \n        \n        \n    })\n}"
  },
  {
    "objectID": "index.html#morning-bottom-up",
    "href": "index.html#morning-bottom-up",
    "title": "What They Didn’t Teach You About Decision Modeling",
    "section": "Morning: “Bottom Up”",
    "text": "Morning: “Bottom Up”\n\nMortality modeling\n\nExercise: Alive-Dead Model (Parts 1 and 2 of learnr)\n\nCompeting events (e.g., embedding)\n\nExercise: Alive-CVD-Dead Model (Part 3 of learnr)"
  },
  {
    "objectID": "index.html#afternoon-top-down",
    "href": "index.html#afternoon-top-down",
    "title": "What They Didn’t Teach You About Decision Modeling",
    "section": "Afternoon: “Top Down”",
    "text": "Afternoon: “Top Down”\n\nStructuring the Markov model\n\nEmbedding is covered earlier in the day.\nCover accumulators and transition states\nExercise: Augment the Green et al. model with accumulators and transition state/\n\nIncorporating new evidence\n\nSolving for PSA distributions\nPSA copula sampling\nExercise: Add a third strategy\nExercise: Solve for PSA distributions of third strategy."
  },
  {
    "objectID": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-conversion-formulas-1",
    "href": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-conversion-formulas-1",
    "title": "Signs of Trouble",
    "section": "1. Using Conversion Formulas",
    "text": "1. Using Conversion Formulas\n\n\nCode\nsim_cohort &lt;- function(params) {\n    \n    mP &lt;- mPt(1:(params$n_cycles-1),params)\n    \n    tr &lt;-\n        mP %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asympt\" = params$n_cohort, \"Progressive\" = 0, \"DeadCause\" = 0, \"Dead\" = 0))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n            }))\n        }))\n    tr &lt;-  \n        tr %&gt;% \n        map(~({\n            .x &lt;- rbind(t(c(params$n_cohort,0,0,0)),.x)\n        }))\n    \n    arr &lt;-\n        mP %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0, \"DeadCause\" = 0, \"Dead\" = 0))\n            arr_ &lt;- diag(as.vector(tr_))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n                arr_ &lt;&lt;- diag(as.vector(tr_)) %*% tp\n                arr_\n            }))\n        }))\n    arr &lt;- \n        arr %&gt;% \n        map(~({\n            .x &lt;- rbind(diag(c(params$n_cohort,0,0,0)),.x)\n        }))\n    \n    arr &lt;- arr %&gt;% map(~({\n        .x %&gt;% data.frame() %&gt;% \n            mutate(cycle = sort(rep(1:params$n_cycles,params$n_states))) %&gt;% \n            group_by(cycle) %&gt;% \n            nest()\n    }))\n    \n    return(list(trace = tr, array = arr))\n}\n\nmarkov_result &lt;-\n    sim_cohort(params)\nmarkov_result12 &lt;- \n    sim_cohort(params12)\nmarkov_result365 &lt;- \n    sim_cohort(params365)\n\nmarkov_result$trace %&gt;% \n    map(~(.x %&gt;% data.frame() %&gt;% \n              mutate(cycle = (row_number()-1)))) %&gt;% \n    bind_rows(.id = \"strategy\") %&gt;% \n    mutate(cycle = cycle * params$cycle) %&gt;% \n    mutate(cycle_length = paste0(params$cycle))  %&gt;% \n    bind_rows(\n        markov_result12$trace %&gt;% \n        map(~(.x %&gt;% data.frame() %&gt;% \n                  mutate(cycle = (row_number()-1)))) %&gt;% \n        bind_rows(.id = \"strategy\") %&gt;% \n        mutate(cycle = cycle * params12$cycle) %&gt;% \n        mutate(cycle_length = paste0(params12$cycle))\n    ) %&gt;% \n     bind_rows(\n        markov_result365$trace %&gt;% \n        map(~(.x %&gt;% data.frame() %&gt;% \n                  mutate(cycle = (row_number()-1)))) %&gt;% \n        bind_rows(.id = \"strategy\") %&gt;% \n        mutate(cycle = cycle * params365$cycle) %&gt;% \n        mutate(cycle_length = paste0(params365$cycle))\n    ) %&gt;%\n    mutate(cycle_length = factor(round(as.numeric(paste0(cycle_length)),2), labels = c(\"Day\",\"Month\",\"Year\"))) %&gt;% \n    gather(state,value,-strategy,-cycle,-cycle_length) %&gt;% \n    ggplot(aes(x = cycle, y = value, colour = state ,lty=cycle_length)) + \n    geom_line() +\n    facet_grid(~strategy) +\n    hrbrthemes::theme_ipsum(base_family = \"Arial\") + \n    ggsci::scale_color_aaas(name=\"\") + \n    theme(legend.position = \"top\") +\n    geom_dl(method = list(\"last.bumpup\",hjust=1,vjust=-1),aes(label = state)) +\n    geom_dl(method = list(\"first.bumpup\",hjust=0,vjust=-1),aes(label = state))\n\n\n\n\n\n\n\n\n\nAs the figure shows, state occupancy differs across the various cycle lengths."
  },
  {
    "objectID": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-embedding",
    "href": "blog/posts/signs-of-trouble/signs-of-trouble.html#using-embedding",
    "title": "Signs of Trouble",
    "section": "2. Using Embedding",
    "text": "2. Using Embedding\n\n\nCode\nsim_cohort_emb &lt;- function(params) {\n    \n    mP &lt;- mPt_embedded(1:(params$n_cycles-1),params)\n    \n    tr &lt;-\n        mP %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0, \"DeadCause\" = 0, \"Dead\" = 0,\n                       \"accProgressive\" = 0, \"trProgressive\" = 0, \"trDeadCause\" = 0))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n            }))\n        }))\n    tr &lt;-  \n        tr %&gt;% \n        map(~({\n            .x &lt;- rbind(t(c(params$n_cohort,0,0,0,rep(0,length(c(params$a_names,params$t_names))))),.x)\n        }))\n    \n    arr &lt;-\n        mP %&gt;% transpose() %&gt;% \n        map(~({\n            tr_ &lt;- t(c(\"Asymptomatic_disease\" = params$n_cohort, \"Progressive_disease\" = 0, \"DeadCause\" = 0, \"Dead\" = 0, \n                       \"accProgressive\" = 0, \"trProgressive\" = 0, \"trDeadCause\" = 0))\n            arr_ &lt;- diag(as.vector(tr_))\n            do.call(rbind,lapply(.x, function(tp) {\n                tr_ &lt;&lt;- tr_ %*% tp\n                arr_ &lt;&lt;- diag(as.vector(tr_)) %*% tp\n                arr_\n            }))\n        }))\n    arr &lt;- \n        arr %&gt;% \n        map(~({\n            .x &lt;- rbind(diag(c(params$n_cohort,0,0,0,rep(0,length(c(params$a_names,params$t_names))))),.x)\n        }))\n    \n   \n    arr &lt;- arr %&gt;% map(~({\n        .x %&gt;% data.frame() %&gt;% \n            mutate(cycle = sort(rep(1:params$n_cycles,params$n_states+length(c(params$a_names,params$t_names))))) %&gt;% \n            group_by(cycle) %&gt;% \n            nest()\n    }))\n    \n    return(list(trace = tr, array = arr))\n}\n\nmarkov_result_emb &lt;-\n    sim_cohort_emb(params)\nmarkov_result_emb12 &lt;-\n    sim_cohort_emb(params12)\nmarkov_result_emb365 &lt;-\n    sim_cohort_emb(params365)\n\nmarkov_result_emb$trace %&gt;% \n    map(~(.x %&gt;% data.frame() %&gt;% \n              mutate(cycle = (row_number()-1)))) %&gt;% \n    bind_rows(.id = \"strategy\") %&gt;% \n    mutate(cycle = cycle * params$cycle) %&gt;% \n    mutate(cycle_length = paste0(params$cycle))  %&gt;% \n    bind_rows(\n        markov_result_emb12$trace %&gt;% \n        map(~(.x %&gt;% data.frame() %&gt;% \n                  mutate(cycle = (row_number()-1)))) %&gt;% \n        bind_rows(.id = \"strategy\") %&gt;% \n        mutate(cycle = cycle * params12$cycle) %&gt;% \n        mutate(cycle_length = paste0(params12$cycle))\n    ) %&gt;% \n    bind_rows(\n        markov_result_emb365$trace %&gt;% \n        map(~(.x %&gt;% data.frame() %&gt;% \n                  mutate(cycle = (row_number()-1)))) %&gt;% \n        bind_rows(.id = \"strategy\") %&gt;% \n        mutate(cycle = cycle * params365$cycle) %&gt;% \n        mutate(cycle_length = paste0(params365$cycle))\n    ) %&gt;%   \n    select(-starts_with(\"tr\"),-starts_with(\"acc\")) %&gt;% \n    mutate(cycle_length = factor(round(as.numeric(paste0(cycle_length)),2), labels = c(\"Day\",\"Month\",\"Year\"))) %&gt;% \n    gather(state,value,-strategy,-cycle,-cycle_length) %&gt;% \n    ggplot(aes(x = cycle, y = value, colour = state ,lty=cycle_length)) + \n    geom_line() +\n    facet_grid(~strategy) +\n    hrbrthemes::theme_ipsum(base_family = \"Arial\") + \n    ggsci::scale_color_aaas(name=\"\") + \n    theme(legend.position = \"top\") +\n    geom_dl(method = list(\"last.bumpup\",hjust=1,vjust=-1),aes(label = state)) +\n    geom_dl(method = list(\"first.bumpup\",hjust=0,vjust=-1),aes(label = state))\n\n\n\n\n\n\n\n\n\nThe figure clearly shows that changing the cycle length does not affect the state occupancy estimates."
  },
  {
    "objectID": "blog/posts/backwards-conversion/backwards-conversion.html",
    "href": "blog/posts/backwards-conversion/backwards-conversion.html",
    "title": "Backwards Conversion",
    "section": "",
    "text": "library(tidyverse)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(survival)\nlibrary(flexsurv)\nlibrary(haven)\nlibrary(dampack)\nlibrary(Matrix)\nlibrary(here)\nlibrary(glue)\nlibrary(demography)\nlibrary(glue)\nlibrary(MortalityLaws)\nlibrary(demography)\nlibrary(MASS)\nlibrary(directlabels)\nlibrary(markovchain)\nlibrary(expm)\n\noptions(\"scipen\" = 100, \"digits\" = 5)\n\nselect &lt;- dplyr::select\ntheme_set(hrbrthemes::theme_ipsum(base_family = \"Arial\"))\nWhat if a given source of data provides observed transition probabilities and these are exclusionary states, i.e., competing? How could one reverse these probabilities and embed other competing events into the model?\nTo do this, one must solve for the generator matrix of the transition probability matrix using eigenvalue decomposition. Note that this is not always possible, as it is trivial to construct a transition probability matrix that has no generator.\nConsider the following, which builds on the example provided in the main text. We wish to approximate a continuous time process using a discrete-time Markov model with three distinct states: A (healthy), B (sick/intervention), and C (complication from intervention). Moreover, in continuous time, this process proceeds sequentially, i.e., A-&gt;B-&gt;C.\nA (naively) specified model has transitions from A-&gt;B and from B-&gt;C specified as probabilities within the selected time step. As noted in the main text, this model cannot truly approximate continuous time process, as within a given time step there is a non-zero probability of transitioning from healthy to complication (i.e., A-&gt;C, with an implied sojourn through B). That is, during a timestep it is possible to transition from A-&gt;C.\nBy incorrectly specifying all transitions, it makes it impossible to find a proper generator—though eigenvalue decomposition can be used to get as close as possible. If negative rates of transition are found using eigenvalue decomposition, then probabilities inconsistent with continuous rates have been specified.\nIn mathematical terms, the generator matrix is the matrix logarithm of the transition probability matrix. A matrix has a logarithm if and only if if it is invertible.\n\\[ A = \\log T_{prob} \\]\nThe \\(\\log\\) can be found using spectral or eigenvalue decomposition. If \\(V\\) is a matrix where equal column is an eigenvector of \\(T_{prob}\\), then,\n\\[A' = V^{-1} A V\\] \\[\\log T_{prob} = V (\\log A') V^{-1}\\]"
  },
  {
    "objectID": "blog/posts/backwards-conversion/backwards-conversion.html#alternative-approach",
    "href": "blog/posts/backwards-conversion/backwards-conversion.html#alternative-approach",
    "title": "Backwards Conversion",
    "section": "Alternative Approach",
    "text": "Alternative Approach\nThe theoretical approach requires computation of the eigenvalues of the matrix, and then correction along the way for various numerical errors to derive the generator matrix of rates. The observed statistical error from a stochastic process in general create a situation in which the Q-matrix is not derivable theoretically resulting in negative probabilities. Finding the closest generator matrix can be done using Higham’s 2008 method from `Functions of Matrices: Theory and Computation’ with extra balancing options from Stadelmann’s thesis.\n\nR &lt;- transition2Generator(mP)\nrownames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\ncolnames(R) &lt;- c(\"A\", \"B\", \"C\", \"D\")\nR\n\n         A       B          C         D\nA -0.32712  0.3115  0.0024395  0.013181\nB  0.00000 -0.5430  0.6148890 -0.071884\nC  0.00000  0.0000 -0.2876821  0.287682\nD  0.00000  0.0000  0.0000000  0.000000\n\n\nNote: this is the closest Markov model allowing any transition. There are still transitions from A-&gt;C and A-&gt;D. Notably B-&gt;D occurs at a negative rate. If D were representing an absorbing state, e.g. Death, then this would represent a physical impossibility, as this negative rate represents D -&gt; B."
  },
  {
    "objectID": "blog/posts/backwards-conversion/backwards-conversion.html#demonstrate-that-the-embedded-new-transition-probability-matrix-successfully-recreates-the-original-transition-probability-matrix-and-results.",
    "href": "blog/posts/backwards-conversion/backwards-conversion.html#demonstrate-that-the-embedded-new-transition-probability-matrix-successfully-recreates-the-original-transition-probability-matrix-and-results.",
    "title": "Backwards Conversion",
    "section": "Demonstrate that the embedded (new) transition probability matrix successfully recreates the original transition probability matrix and results.",
    "text": "Demonstrate that the embedded (new) transition probability matrix successfully recreates the original transition probability matrix and results.\nLet’s double check it recapitulates the original rates.\n\nround(expm(R),3)\n\n      A     B     C     D\nA 0.721 0.202 0.067 0.010\nB 0.000 0.581 0.407 0.012\nC 0.000 0.000 0.750 0.250\nD 0.000 0.000 0.000 1.000"
  },
  {
    "objectID": "blog/posts/backwards-conversion/backwards-conversion.html#an-assumed-model",
    "href": "blog/posts/backwards-conversion/backwards-conversion.html#an-assumed-model",
    "title": "Backwards Conversion",
    "section": "An assumed model",
    "text": "An assumed model\nIf one were to assume that all transitions were forward , i.e. A-&gt;B-&gt;C-&gt;D the best approach would be to fit the generator matrix directly from raw data (there are many statistical Markov and ordinal data fitting models). Without the raw data available, an ad-hoc method to minimize squared error against the original under the 3 rate constraint does a decent job of recapitulating the original transition probabilities.\n\ninit  &lt;- c(1/3, 1/3, 1/3, 0)\nstep1 &lt;- init %*% mP\nm_3r &lt;- function(r)\n    matrix(c(-(r[1]+r[4]+r[5]),  r[1],      r[4],    r[5],\n                 0, -(r[2]+r[6]),   r[2],    r[6],\n                 0,     0,  -r[3], r[3],\n                 0,     0,      0,   0), nrow=4, byrow=TRUE)\nr.est &lt;- optim((-diag(R))[1:3],\n      lower=c(0.1, 0.1, 0.1),\n      method=\"L-BFGS-B\",\n      function(r) {\n      sum( ((init %*% expm(m_3r(r))) - step1)^2 )\n})$par\nm_3r(r.est)\nround(expm(m_3r(r.est)),3)\n\n\nmP_ &lt;- mP\ndiag(mP_) = 0\nmR_ &lt;- apply(mP_,c(1,2),function(x)-log(1-x))\ndiag(mR_) &lt;- -rowSums(mR_)\nexpm(mR_)\n\nlist(\"eigen\" = R,\n     \"m_3r\" = m_3r(r.est),\n     \"form\" = mR_)"
  },
  {
    "objectID": "slides/01_mortality.html#slide-1",
    "href": "slides/01_mortality.html#slide-1",
    "title": "Mortality Modeling",
    "section": "Slide 1",
    "text": "Slide 1\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#approaches-to-modeling-mortality",
    "href": "slides/01_mortality.html#approaches-to-modeling-mortality",
    "title": "1. Coping with Mortality",
    "section": "Approaches to Modeling Mortality",
    "text": "Approaches to Modeling Mortality\n\n\nStandard approach is to draw from life table data:\n\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.22\n0.00556\n0.00553\n\n\n1\n99447\n38.18\n0.00038\n0.00038\n\n\n2\n99409\n23.16\n0.00023\n0.00023\n\n\n\n\n\n\n\n\nlx is the total number living in a hypothetical cohort (of 100,000).\ndx is the number of deaths in the age interval."
  },
  {
    "objectID": "slides/01_mortality.html#learning-objectives",
    "href": "slides/01_mortality.html#learning-objectives",
    "title": "1. Coping with Mortality",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nUnderstand options for modeling background mortality based on life tables and parametric mortality models.\nConstruct a cause-deleted life table to model cause-specific and non-cause-specific death."
  },
  {
    "objectID": "slides/01_mortality.html#life-table-data",
    "href": "slides/01_mortality.html#life-table-data",
    "title": "1. Coping with Mortality",
    "section": "Life Table Data",
    "text": "Life Table Data\n\n\nDeath probabilities are useful for discrete time Markov models.\n\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.22\n0.00556\n0.00553\n\n\n1\n99447\n38.18\n0.00038\n0.00038\n\n\n2\n99409\n23.16\n0.00023\n0.00023"
  },
  {
    "objectID": "slides/01_mortality.html#death-probabilities-can-be-directly-lifted-out-of-the-life-table",
    "href": "slides/01_mortality.html#death-probabilities-can-be-directly-lifted-out-of-the-life-table",
    "title": "Mortality Modeling",
    "section": "Death Probabilities Can Be Directly Lifted Out of the Life Table",
    "text": "Death Probabilities Can Be Directly Lifted Out of the Life Table\n\nUseful for discrete time Markov models\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.221\n0.00556\n0.00553\n\n\n1\n99447\n38.180\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n0.00018\n0.00018\n\n\n4\n99368\n14.209\n0.00014\n0.00014\n\n\n5\n99354\n13.213\n0.00013\n0.00013"
  },
  {
    "objectID": "slides/01_mortality.html#death-rates-can-be-directly-lifted-out-of-the-life-table",
    "href": "slides/01_mortality.html#death-rates-can-be-directly-lifted-out-of-the-life-table",
    "title": "Mortality Modeling",
    "section": "Death Rates Can Be Directly Lifted Out of the Life Table",
    "text": "Death Rates Can Be Directly Lifted Out of the Life Table\n\nUseful for discrete event simulation (DES)\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.221\n0.00556\n0.00553\n\n\n1\n99447\n38.180\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n0.00018\n0.00018\n\n\n4\n99368\n14.209\n0.00014\n0.00014\n\n\n5\n99354\n13.213\n0.00013\n0.00013\n\n\n\n\n\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-death-probabilities-are-useful-for-discrete-time-markov-models",
    "href": "slides/01_mortality.html#life-table-death-probabilities-are-useful-for-discrete-time-markov-models",
    "title": "Mortality Modeling",
    "section": "Life Table Death Probabilities Are Useful for Discrete Time Markov Models",
    "text": "Life Table Death Probabilities Are Useful for Discrete Time Markov Models\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.221\n0.00556\n0.00553\n\n\n1\n99447\n38.180\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n0.00018\n0.00018\n\n\n4\n99368\n14.209\n0.00014\n0.00014\n\n\n5\n99354\n13.213\n0.00013\n0.00013"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-death-rates-are-useful-for-discrete-event-simulation",
    "href": "slides/01_mortality.html#life-table-death-rates-are-useful-for-discrete-event-simulation",
    "title": "Mortality Modeling",
    "section": "Life Table Death Rates Are Useful for Discrete Event Simulation",
    "text": "Life Table Death Rates Are Useful for Discrete Event Simulation\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.221\n0.00556\n0.00553\n\n\n1\n99447\n38.180\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n0.00018\n0.00018\n\n\n4\n99368\n14.209\n0.00014\n0.00014\n\n\n5\n99354\n13.213\n0.00013\n0.00013\n\n\n\n\n\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-data-1",
    "href": "slides/01_mortality.html#life-table-data-1",
    "title": "1. Coping with Mortality",
    "section": "Life Table Data",
    "text": "Life Table Data\n\n\nDeath rates are useful for discrete event simulation (DES) models.\n\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.22\n0.00556\n0.00553\n\n\n1\n99447\n38.18\n0.00038\n0.00038\n\n\n2\n99409\n23.16\n0.00023\n0.00023"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-data-2",
    "href": "slides/01_mortality.html#life-table-data-2",
    "title": "Mortalty Modeling",
    "section": "Life Table Data",
    "text": "Life Table Data\n\n\nDeath rates are useful for discrete event simulation (DES) models.\n\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.221\n0.00556\n0.00553\n\n\n1\n99447\n38.180\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n0.00018\n0.00018\n\n\n4\n99368\n14.209\n0.00014\n0.00014\n\n\n5\n99354\n13.213\n0.00013\n0.00013"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-data-3",
    "href": "slides/01_mortality.html#life-table-data-3",
    "title": "Mortality Modeling",
    "section": "Life Table Data",
    "text": "Life Table Data\n\nWhat if age bins are more coarse (e.g., 0, 5, 10,… vs. 0,1,2,3,…)?\nWe may also want to simplify the parameterization of our model to summarize background mortality in just a few parameters, not one for every age or age group in the model."
  },
  {
    "objectID": "slides/01_mortality.html#modeling-mortality",
    "href": "slides/01_mortality.html#modeling-mortality",
    "title": "1. Coping with Mortality",
    "section": "Modeling Mortality",
    "text": "Modeling Mortality\n\n\n\n\n\n\nThe R packages MortalityLaws and demography facilitate life table data aquisition and modeling."
  },
  {
    "objectID": "slides/01_mortality.html#modeling-mortality-1",
    "href": "slides/01_mortality.html#modeling-mortality-1",
    "title": "1. Coping with Mortality",
    "section": "Modeling Mortality",
    "text": "Modeling Mortality\n\n\n\n\n\n\nThe R packages MortalityLaws and demography facilitate life table data aquisition and modeling."
  },
  {
    "objectID": "slides/00_welcome-and-intros.html#welcome-to-berlin",
    "href": "slides/00_welcome-and-intros.html#welcome-to-berlin",
    "title": "Welcome and Introductions",
    "section": "Welcome to Berlin!",
    "text": "Welcome to Berlin!"
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "",
    "text": "source(\"./manifest.r\")\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.1     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nAttaching package: 'kableExtra'\n\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n\n\n\nAttaching package: 'Matrix'\n\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\n\nhere() starts at /Users/johngraves/Dropbox/teaching/SMDM-Europe-2023\n\nLoading required package: forecast\n\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n\nRegistered S3 methods overwritten by 'demography':\n  method      from \n  print.lca   e1071\n  summary.lca e1071\n\nThis is demography 2.0.0.9000 \n\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:dplyr':\n\n    select"
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#slide",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#slide",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "Slide",
    "text": "Slide\n\n\nBack to Website"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html",
    "href": "slides/03_advanced-bookkeeping.html",
    "title": "Advanced Bookkeeping",
    "section": "",
    "text": "source(\"./manifest.r\")\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.1     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nAttaching package: 'kableExtra'\n\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n\n\n\nAttaching package: 'Matrix'\n\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\n\nhere() starts at /Users/johngraves/Dropbox/teaching/SMDM-Europe-2023\n\nLoading required package: forecast\n\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n\nRegistered S3 methods overwritten by 'demography':\n  method      from \n  print.lca   e1071\n  summary.lca e1071\n\nThis is demography 2.0.0.9000 \n\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:dplyr':\n\n    select"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#slide",
    "href": "slides/03_advanced-bookkeeping.html#slide",
    "title": "Advanced Bookkeeping",
    "section": "Slide",
    "text": "Slide\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html",
    "href": "slides/01_mortality.html",
    "title": "Mortality Modeling",
    "section": "",
    "text": "source(\"manifest.r\")\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.1     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nAttaching package: 'kableExtra'\n\n\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n\n\n\nAttaching package: 'Matrix'\n\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\n\nhere() starts at /Users/johngraves/Dropbox/teaching/SMDM-Europe-2023\n\nLoading required package: forecast\n\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n\nRegistered S3 methods overwritten by 'demography':\n  method      from \n  print.lca   e1071\n  summary.lca e1071\n\nThis is demography 2.0.0.9000 \n\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:dplyr':\n\n    select"
  },
  {
    "objectID": "slides/02_competing-events.html",
    "href": "slides/02_competing-events.html",
    "title": "Competing Risks",
    "section": "",
    "text": "Pitfalls of traditional transition probability conversion formulas.\nDiscuss compound transitions and how to account for them.\nDemonstrate how to properly embed a transition probability matrix into a timestep."
  },
  {
    "objectID": "slides/02_competing-events.html#slide",
    "href": "slides/02_competing-events.html#slide",
    "title": "Dealing With Competing Events",
    "section": "Slide",
    "text": "Slide\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#life-table-basd-mortality",
    "href": "slides/01_mortality.html#life-table-basd-mortality",
    "title": "Mortalty Modeling",
    "section": "Life Table-Basd Mortality",
    "text": "Life Table-Basd Mortality\n\nWhat if age bins are coarse (e.g., 0, 5, 10,… vs. 0,1,2,3,…)?\n\nAssume death probability/rate is constant within age bins (and cycles)?\n\nIn a DES model, we need to sample a time to death.\n\nCan sample from survival function in underlying life table."
  },
  {
    "objectID": "slides/01_mortality.html#life-table-basd-mortality-1",
    "href": "slides/01_mortality.html#life-table-basd-mortality-1",
    "title": "Mortality Modeling",
    "section": "Life Table-Basd Mortality",
    "text": "Life Table-Basd Mortality\n\nWhat if age bins are more coarse (e.g., 0, 5, 10,… vs. 0,1,2,3,…)?\nWe may also want to simplify the parameterization of our model to summarize background mortality in just a few parameters, not one for every age or age group in the model."
  },
  {
    "objectID": "slides/01_mortality.html#life-table-based-mortality",
    "href": "slides/01_mortality.html#life-table-based-mortality",
    "title": "1. Coping with Mortality",
    "section": "Life Table-Based Mortality",
    "text": "Life Table-Based Mortality\n\n\nA common approach is to use a life table-based lookup table in the model:\n\n\n\ntpDn_lookup &lt;-\n    c(\"(34,44]\" = 0.0017,  \n      \"(44,54]\" = 0.0044,\n      \"(54,64]\" = 0.0138,\n      \"(64,74]\" = 0.0379,\n      \"(74,84]\" = 0.0912,\n      \"(84,100]\" = 0.1958)\n\n\nHighlighted row: annual probability of death for 35-44 year old."
  },
  {
    "objectID": "slides/01_mortality.html#obtaining-life-table-data",
    "href": "slides/01_mortality.html#obtaining-life-table-data",
    "title": "1. Coping with Mortality",
    "section": "Obtaining Life Table Data",
    "text": "Obtaining Life Table Data\n\n\n\n\n\n\nThe R packages MortalityLaws and demography facilitate life table data aquisition and modeling.\n\n\n\nCommon sources:\n\nHuman Mortality Database\nGlobal Burden of Disease\nHuman Cause of Death Database\nHuman Life Table Database"
  },
  {
    "objectID": "slides/01_mortality.html#processing-life-table-data",
    "href": "slides/01_mortality.html#processing-life-table-data",
    "title": "1. Coping with Mortality",
    "section": "Processing Life Table Data",
    "text": "Processing Life Table Data\n\nCode below extracts U.S. life table data from the human mortality database (HMD)."
  },
  {
    "objectID": "slides/01_mortality.html#processing-life-table-data-1",
    "href": "slides/01_mortality.html#processing-life-table-data-1",
    "title": "1. Coping with Mortality",
    "section": "Processing Life Table Data",
    "text": "Processing Life Table Data\n\n\nCode below extracts U.S. life table data from the human mortality database (HMD).\n\n\n\nhmd_usa &lt;-\n    demography::hmd.mx(\"USA\",\n                       username = \"&lt;&lt;your user name&gt;&gt;\",\n                       password = \"&lt;&lt;your password&gt;&gt;\", \"USA\")"
  },
  {
    "objectID": "slides/01_mortality.html#processing-life-table-data-2",
    "href": "slides/01_mortality.html#processing-life-table-data-2",
    "title": "1. Coping with Mortality",
    "section": "Processing Life Table Data",
    "text": "Processing Life Table Data\n\nCode below processes HMD data and constructs a (2019) life table from it.\nRadix (cohort size) is 100,000 individuals."
  },
  {
    "objectID": "slides/02_competing-events.html#a-world-without-death",
    "href": "slides/02_competing-events.html#a-world-without-death",
    "title": "Competing Events and Embedding",
    "section": "A World Without Death",
    "text": "A World Without Death\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.006   \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n  hr_S * r_HD hr_S=10   \n\nDead-&gt;Dead\n\n   \n\n\n\n\n\n\nWe will first construct a very simple CVD model with only two states: Healthy and CVD."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.006   \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n  hr_S * r_HD hr_S=10   \n\nDead-&gt;Dead\n\n   \n\n\n\n\n\n\nWe will first construct a very simple CVD model with only two states: Healthy and CVD."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-1",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-1",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nNext, place these probabilities within the transition probability matrix array.\n\n\n\nOuter array dimensions goverened by the number of strategies under consideration."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-2",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-2",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-3",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-3",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array.\n\n\nFinal result:\n\n\n, ,  = natural_history\n\n         to\nfrom      Healthy     CVD\n  Healthy 0.86071 0.13929\n  CVD     0.00000 1.00000"
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-4",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-4",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nNext, place these probabilities within the transition probability matrix array.\n\n\n\nOuter array dimensions goverened by the number of strategies under consideration."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-5",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-5",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array."
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-6",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-6",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array.\n\n\nFinal result:\n\n\n, ,  = natural_history\n\n         to\nfrom      Healthy     CVD\n  Healthy 0.86071 0.13929\n  CVD     0.00000 1.00000"
  },
  {
    "objectID": "slides/02_competing-events.html#part-1-a-world-without-death-7",
    "href": "slides/02_competing-events.html#part-1-a-world-without-death-7",
    "title": "Competing Events and Embedding",
    "section": "Part 1: A World Without Death",
    "text": "Part 1: A World Without Death\nNext, construct the markov trace\n\nsim_cohort &lt;- function(params) {\n1  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0))\n  trace &lt;- \n2    0:params$n_cycles %&gt;% map_df(~({\n3        apply(params$mP,3, simplify=FALSE, function(tp) {\n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n4    as.matrix()\n}\ntr &lt;- sim_cohort(params)\ntr[1:5,]\n\n\n1\n\nInitial state occupancy.\n\n2\n\nIterate through all cycles specified for the model.\n\n3\n\nApply the transition probability separately by strategy.\n\n4\n\nPull it all together.\n\n\n\n\n     natural_history.Healthy natural_history.CVD\n[1,]                 1000.00                0.00\n[2,]                  860.71              139.29\n[3,]                  740.82              259.18\n[4,]                  637.63              362.37\n[5,]                  548.81              451.19\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#next-construct-the-markov-trace",
    "href": "slides/02_competing-events.html#next-construct-the-markov-trace",
    "title": "Competing Events and Embedding",
    "section": "Next, construct the markov trace",
    "text": "Next, construct the markov trace\nSpecify the initial state occupancy\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}"
  },
  {
    "objectID": "slides/02_competing-events.html#next-construct-the-markov-trace-1",
    "href": "slides/02_competing-events.html#next-construct-the-markov-trace-1",
    "title": "Competing Events and Embedding",
    "section": "Next, construct the markov trace",
    "text": "Next, construct the markov trace\nIterate over the cycles in the model.\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}"
  },
  {
    "objectID": "slides/02_competing-events.html#next-construct-the-markov-trace-2",
    "href": "slides/02_competing-events.html#next-construct-the-markov-trace-2",
    "title": "Competing Events and Embedding",
    "section": "Next, construct the markov trace",
    "text": "Next, construct the markov trace\nWithin a cycle, iterate over the strategies under consideration.\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}"
  },
  {
    "objectID": "slides/02_competing-events.html#next-construct-the-markov-trace-3",
    "href": "slides/02_competing-events.html#next-construct-the-markov-trace-3",
    "title": "Competing Events and Embedding",
    "section": "Next, construct the markov trace",
    "text": "Next, construct the markov trace\nThe markov trace tells us the fraction of the population in each state in any cycle:\n\ntr &lt;- sim_cohort(params)\ntr[1:5,]\n\n     natural_history.Healthy natural_history.CVD\n[1,]                 1.00000             0.00000\n[2,]                 0.86071             0.13929\n[3,]                 0.74082             0.25918\n[4,]                 0.63763             0.36237\n[5,]                 0.54881             0.45119"
  },
  {
    "objectID": "slides/02_competing-events.html#next-construct-the-markov-trace-4",
    "href": "slides/02_competing-events.html#next-construct-the-markov-trace-4",
    "title": "Competing Events and Embedding",
    "section": "Next, construct the markov trace",
    "text": "Next, construct the markov trace\nThe markov trace tells us the fraction of the population in each state in any cycle:\n\ntr &lt;- sim_cohort(params)\ntr[1:5,]\n\n     natural_history.Healthy natural_history.CVD\n[1,]                 1.00000             0.00000\n[2,]                 0.86071             0.13929\n[3,]                 0.74082             0.25918\n[4,]                 0.63763             0.36237\n[5,]                 0.54881             0.45119"
  },
  {
    "objectID": "slides/02_competing-events.html#life-expectancy",
    "href": "slides/02_competing-events.html#life-expectancy",
    "title": "Competing Risks",
    "section": "2. Life Expectancy",
    "text": "2. Life Expectancy\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100."
  },
  {
    "objectID": "slides/02_competing-events.html#life-expectancy-1",
    "href": "slides/02_competing-events.html#life-expectancy-1",
    "title": "Competing Risks",
    "section": "2. Life Expectancy",
    "text": "2. Life Expectancy\n\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100\n\n\n\n1payoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1)\n2life_exp_cycle = trace[-1,] %*% payoff_life_exp\n3total_life_exp = sum(life_exp_cycle)\n\n\n1\n\nLife expectancy payoff is 1 for every state where someone remains alive.\n\n2\n\nTotal life-years alive in each state is the markov trace multiplied by the payoff vector.\n\n3\n\nTotal life expectancy is the sum of cycle values."
  },
  {
    "objectID": "slides/02_competing-events.html#life-expectancy-2",
    "href": "slides/02_competing-events.html#life-expectancy-2",
    "title": "Competing Risks",
    "section": "2. Life Expectancy",
    "text": "2. Life Expectancy\n\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100\n\n\n\npayoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1)\nlife_exp_cycle = trace[-1,] %*% payoff_life_exp\ntotal_life_exp = sum(life_exp_cycle)\ntotal_life_exp * params$cycle\n\n[1] 100"
  },
  {
    "objectID": "slides/02_competing-events.html#markov-trace-at-2-years",
    "href": "slides/02_competing-events.html#markov-trace-at-2-years",
    "title": "Competing Events and Embedding",
    "section": "Markov Trace at 2 Years",
    "text": "Markov Trace at 2 Years\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many will have transitioned to the sick state by year 2?"
  },
  {
    "objectID": "slides/02_competing-events.html#summary",
    "href": "slides/02_competing-events.html#summary",
    "title": "Competing Risks",
    "section": "Summary",
    "text": "Summary\n\nAfter 2 years, 259 individuals are in the CVD health state.\nBecause there is no death, after 100 cycles life expectancy is 100 years.\nWe verified that the above results hold exactly when we convert to a daily cycle length."
  },
  {
    "objectID": "slides/02_competing-events.html#markov-trace-at-2-years-1",
    "href": "slides/02_competing-events.html#markov-trace-at-2-years-1",
    "title": "Competing Events and Embedding",
    "section": "Markov Trace at 2 Years",
    "text": "Markov Trace at 2 Years\n\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many will have transitioned to the CVD state by year 2?\n\n\n\nPin this number to your brain for a few minutes!\n\n\n\n\n\n\nnatural_history.Healthy\nnatural_history.CVD\n\n\n\n\n740.82\n259.18"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years",
    "href": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 1: CVD State Occupancy at 2 Years",
    "text": "Checkpoint 1: CVD State Occupancy at 2 Years\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many will have transitioned to the CVD state by year 2?"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years-1",
    "href": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years-1",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 1: CVD State Occupancy at 2 Years",
    "text": "Checkpoint 1: CVD State Occupancy at 2 Years\n\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many will have transitioned to the CVD state by year 2?\n\n\n\nPin this number to your brain for a few minutes!\n\n\n\n\n\n\nnatural_history.Healthy\nnatural_history.CVD\n\n\n\n\n740.82\n259.18"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-2-life-expectancy",
    "href": "slides/02_competing-events.html#checkpoint-2-life-expectancy",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 2: Life Expectancy",
    "text": "Checkpoint 2: Life Expectancy\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-2-life-expectancy-1",
    "href": "slides/02_competing-events.html#checkpoint-2-life-expectancy-1",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 2: Life Expectancy",
    "text": "Checkpoint 2: Life Expectancy\n\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100\n\n\n1payoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1)\n2life_exp_cycle = tr[-1,] %*% payoff_life_exp\n3total_life_exp = sum(life_exp_cycle)\n\n\n1\n\nLife expectancy payoff is 1 for every state where someone remains alive.\n\n2\n\nTotal life-years alive in each state is the markov trace multiplied by the payoff vector.\n\n3\n\nTotal life expectancy is the sum of cycle values."
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-2-life-expectancy-2",
    "href": "slides/02_competing-events.html#checkpoint-2-life-expectancy-2",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 2: Life Expectancy",
    "text": "Checkpoint 2: Life Expectancy\n\n\nWe have a model with 100 annual cycles and no death.\nLet’s verify that life expectancy is 100\n\n\n\npayoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1)\nlife_exp_cycle = tr[-1,] %*% payoff_life_exp\ntotal_life_exp = sum(life_exp_cycle)\ntotal_life_exp\n\n[1] 100"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths",
    "href": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 3: Changing Cycle Lengths",
    "text": "Checkpoint 3: Changing Cycle Lengths\n\nWe will next switch to a daily cycle length and verify that we can recapitulate these numbers.\n\n\nparams_daily &lt;- modifyList(params,list(\n  cycle = 1/365,\n  n_cycles = params$n_cycles * 365))"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-1",
    "href": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-1",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 3: Changing Cycle Lengths",
    "text": "Checkpoint 3: Changing Cycle Lengths\n\nparams_daily$mP &lt;- \n  with(params_daily,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\nparams_daily$mP\n\n, ,  = natural_history\n\n         to\nfrom      Healthy        CVD\n  Healthy 0.99959 0.00041087\n  CVD     0.00000 1.00000000"
  },
  {
    "objectID": "slides/02_competing-events.html#adding-a-death-state",
    "href": "slides/02_competing-events.html#adding-a-death-state",
    "title": "Competing Events and Embedding",
    "section": "Adding a Death State",
    "text": "Adding a Death State\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-2",
    "href": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-2",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 3: Changing Cycle Lengths",
    "text": "Checkpoint 3: Changing Cycle Lengths\n\n# Markov Trace (Daily Cycle)\ntr_daily &lt;- sim_cohort(params_daily)\n\n\n# State Occupancy at 2 Years\n1000 * tr_daily[365 * 2 + 1,]\n\nnatural_history.Healthy     natural_history.CVD \n                 740.82                  259.18"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-3",
    "href": "slides/02_competing-events.html#checkpoint-3-changing-cycle-lengths-3",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 3: Changing Cycle Lengths",
    "text": "Checkpoint 3: Changing Cycle Lengths\n\n# Life Expectancy\npayoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1) \nlife_exp_cycle = tr_daily[-1,] %*% payoff_life_exp  \ntotal_life_exp = sum(life_exp_cycle) \ntotal_life_exp * params_daily$cycle\n\n[1] 100"
  },
  {
    "objectID": "slides/02_competing-events.html#part-2-adding-background-mortality",
    "href": "slides/02_competing-events.html#part-2-adding-background-mortality",
    "title": "Competing Events and Embedding",
    "section": "Part 2: Adding Background Mortality",
    "text": "Part 2: Adding Background Mortality\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nSick\n\n Sick   \n\nHealthy-&gt;Sick\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.006   \n\nSick-&gt;Sick\n\n    \n\nSick-&gt;Dead\n\n  hr_S * r_HD hr_S=10   \n\nDead-&gt;Dead\n\n   \n\n\nFigure 1: Healthy-CVD-Dead Model\n\n\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#section",
    "href": "slides/02_competing-events.html#section",
    "title": "Competing Risks",
    "section": "",
    "text": "We will first construct a very simple CVD model with only two states: Healthy and CVD.\nTransitions are goverened by a single rate from Healthy  CVD"
  },
  {
    "objectID": "slides/02_competing-events.html#parameterize-the-model",
    "href": "slides/02_competing-events.html#parameterize-the-model",
    "title": "Competing Risks",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n  list(\n    t_names = c(\"natural_history\"),   # Strategy names. \n    n_treatments = 1,                 # Number of treatments\n    s_names  = c(\"Healthy\", \"CVD\"),   # State names\n    n_states = 2,                     # Number of states\n    n_cohort = 1,                     # Cohort size\n    n_cycles = 100,                   # Number of cycles in model.  \n    cycle = 1,                        # Cycle length\n    initial_age = 55,                 # Cohort starting age\n    r_H_CVD = 0.15                    # Rate of healthy -&gt; CVD\n  )"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix",
    "href": "slides/02_competing-events.html#transition-probability-matrix",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\nWe’ll next construct a transition probability matrix using the standard rate-to-probability conversion formula:\n\\[\np = 1 - \\exp(-rt)\n\\] where \\(r\\) is the rate, \\(t\\) is the time-step (e.g., 1 for annual, 1/12 for monthly, etc.)."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array",
    "title": "Modeling With Competing Risks",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\nparams_mort$mP &lt;- \n  with(params_mort,{\n    \n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    tp_H_D = 1 - exp(-r_H_D * cycle)\n    tp_CVD_D &lt;- 1 - exp(-(hr_CVD * r_H_D) * cycle)\n    \n    array(data = c(1 - tp_H_CVD - tp_H_D, 0, 0, \n                 tp_H_CVD,1-tp_CVD_D, 0,\n                 tp_H_D, tp_CVD_D, 1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-1",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-1",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nNext, place these probabilities within the transition probability matrix array.\n\n\n\nOuter array dimensions goverened by the number of strategies under consideration."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-2",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-2",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-3",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-3",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\nFinal result:\n\n\n$natural_history\n         to\nfrom      Healthy     CVD\n  Healthy 0.86071 0.13929\n  CVD     0.00000 1.00000"
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace",
    "href": "slides/02_competing-events.html#construct-the-markov-trace",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({ \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}\n\n\n\nsim_cohort(params) is a function that constructs a Markov trace from the supplied parameters."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-4",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-4",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\nparams_mort$mP &lt;- \n  with(params_mort,{\n    \n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    tp_H_D = 1 - exp(-r_H_D * cycle)\n    tp_CVD_D &lt;- 1 - exp(-(hr_CVD * r_H_D) * cycle)\n    \n    array(data = c(1 - tp_H_CVD - tp_H_D, 0, 0, \n                 tp_H_CVD,1-tp_CVD_D, 0,\n                 tp_H_D, tp_CVD_D, 1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-1",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-1",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}\n\n\n\nSpecify the initial state occupancy."
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-2",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-2",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}\n\n\n\nIterate over the cycles in the model."
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-3",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-3",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- t(c(\"Healthy\" = params$n_cohort, \"CVD\" = 0)) \n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({  \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}\n\n\n\nWithin a cycle, iterate over the strategies under consideration."
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-4",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-4",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\nThe markov trace tells us the fraction of the population in each state in any cycle:\n\ntrace &lt;- sim_cohort(params)\ntrace[1:5,]\n\n     natural_history.Healthy natural_history.CVD\n[1,]                 1.00000             0.00000\n[2,]                 0.86071             0.13929\n[3,]                 0.74082             0.25918\n[4,]                 0.63763             0.36237\n[5,]                 0.54881             0.45119"
  },
  {
    "objectID": "slides/02_competing-events.html#section-1",
    "href": "slides/02_competing-events.html#section-1",
    "title": "Competing Risks",
    "section": "",
    "text": "We will first construct a very simple CVD model with only two states: Healthy and CVD.\nTransitions are goverened by a single rate from Healthy  CVD\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.006   \n\nCVD-&gt;CVD\n\n    \n\nCVD-&gt;Dead\n\n  hr_S * r_HD hr_S=10   \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/02_competing-events.html#parameterize-the-model-1",
    "href": "slides/02_competing-events.html#parameterize-the-model-1",
    "title": "Competing Risks",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams_mort = \n  list(\n    t_names = c(\"natural_history\"),           # Strategy names. \n    n_treatments = 1,                         # Number of treatments\n    s_names  = c(\"Healthy\", \"CVD\", \"Dead\"),   # State names\n    n_states = 3,                             # Number of states\n    n_cohort = 1,                             # Cohort size\n    n_cycles = 100,                           # Number of cycles in model.  \n    cycle = 1,                                # Cycle length\n    initial_age = 55,                         # Cohort starting age\n    r_H_CVD = 0.15,                           # Rate of healthy -&gt; CVD\n    hr_CVD = 10,                              # Hazard Ratio: CVD Death\n    r_H_D = 0.01                              # Rate of healthy -&gt; dead\n  )"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-5",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-5",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\n\n$natural_history\n         to\nfrom      Healthy     CVD      Dead\n  Healthy 0.85076 0.13929 0.0099502\n  CVD     0.00000 0.90484 0.0951626\n  Dead    0.00000 0.00000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-5",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-5",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n  tr_ &lt;- c(1,rep(0,params$n_states-1))\n  trace &lt;- \n    0:params$n_cycles %&gt;% map_df(~({ \n        apply(params$mP,3, simplify=FALSE, function(tp) {  \n          (tr_ %*% (tp %^% .x)) %&gt;% data.frame()\n        })\n    })) %&gt;% \n    as.matrix() \n}\n\ntrace_mort &lt;- \n  sim_cohort(params_mort)"
  },
  {
    "objectID": "slides/02_competing-events.html#construct-the-markov-trace-6",
    "href": "slides/02_competing-events.html#construct-the-markov-trace-6",
    "title": "Competing Risks",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\ntrace_mort[1:5,]\n\n     natural_history.Healthy natural_history.CVD natural_history.Dead\n[1,]                 1.00000             0.00000            0.0000000\n[2,]                 0.85076             0.13929            0.0099502\n[3,]                 0.72379             0.24454            0.0316707\n[4,]                 0.61577             0.32209            0.0621437\n[5,]                 0.52387             0.37721            0.0989213"
  },
  {
    "objectID": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years-2",
    "href": "slides/02_competing-events.html#checkpoint-1-cvd-state-occupancy-at-2-years-2",
    "title": "Competing Events and Embedding",
    "section": "Checkpoint 1: CVD State Occupancy at 2 Years",
    "text": "Checkpoint 1: CVD State Occupancy at 2 Years\n\n\n\n\n\nnatural_history.Healthy\nnatural_history.CVD\nnatural_history.Dead\n\n\n\n\n723.8\n245.5\n31.7\n\n\n\n\n\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#cvd-state-occupancy-at-two-years",
    "href": "slides/02_competing-events.html#cvd-state-occupancy-at-two-years",
    "title": "Competing Risks",
    "section": "1. CVD State Occupancy at Two Years",
    "text": "1. CVD State Occupancy at Two Years\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many are in the CVD health state at year 2?"
  },
  {
    "objectID": "slides/02_competing-events.html#cvd-state-occupancy-at-two-years-1",
    "href": "slides/02_competing-events.html#cvd-state-occupancy-at-two-years-1",
    "title": "Competing Risks",
    "section": "1. CVD State Occupancy at Two Years",
    "text": "1. CVD State Occupancy at Two Years\n\n\nSuppose we start off with a cohort of 1000 healthy individuals.\nHow many are in the CVD health state at year 2?\n\n\n\nPin this number to your brain for a few minutes!\n\n\n\n\n\n\nHealthy\nCVD\n\n\n\n\n740.82\n259.18"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length",
    "href": "slides/02_competing-events.html#daily-cycle-length",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\nWe will next switch to a daily cycle length and verify that we can recapitulate these numbers."
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-1",
    "href": "slides/02_competing-events.html#daily-cycle-length-1",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n\nWe will next switch to a daily cycle length and verify that we can recapitulate these numbers.\n\n\n\nparams_daily &lt;- modifyList(params,list(\n  cycle = 1/365,\n  n_cycles = params$n_cycles * 365))"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-2",
    "href": "slides/02_competing-events.html#daily-cycle-length-2",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\nparams_daily$mP &lt;- \n  with(params_daily,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  }) \n\n\n\n$natural_history\n         to\nfrom      Healthy        CVD\n  Healthy 0.99959 0.00041087\n  CVD     0.00000 1.00000000"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-3",
    "href": "slides/02_competing-events.html#daily-cycle-length-3",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n# Markov Trace (Daily Cycle)\ntrace_daily &lt;- \n  sim_cohort(params_daily)\n\n# State Occupancy at 2 Years\n1000 * trace_daily[365 * 2 + 1,]\n\n\n\n\n\n\nHealthy\nCVD\n\n\n\n\n740.82\n259.18"
  },
  {
    "objectID": "slides/02_competing-events.html#cvd-state-occupancy-at-2-years",
    "href": "slides/02_competing-events.html#cvd-state-occupancy-at-2-years",
    "title": "Competing Risks",
    "section": "1. CVD State Occupancy at 2 Years",
    "text": "1. CVD State Occupancy at 2 Years\n\n\n\n\n\nHealthy\nCVD\nDead\n\n\n\n\n723.8\n244.5\n31.7"
  },
  {
    "objectID": "slides/02_competing-events.html#life-expectancy-3",
    "href": "slides/02_competing-events.html#life-expectancy-3",
    "title": "Competing Risks",
    "section": "2. Life Expectancy",
    "text": "2. Life Expectancy\n\npayoff_life_exp_mort = c(\"Healthy\" = 1, \"CVD\" = 1, \"Dead\" = 0) \nlife_exp_cycle_mort = trace_mort[-1,] %*% payoff_life_exp_mort \ntotal_life_exp_mort = sum(life_exp_cycle_mort)\ntotal_life_exp_mort\n\n[1] 15.507"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-4",
    "href": "slides/02_competing-events.html#daily-cycle-length-4",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n# Life Expectancy\npayoff_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1) \nlife_exp_cycle_daily = trace_daily[-1,] %*% payoff_life_exp  \ntotal_life_exp_daily = sum(life_exp_cycle_daily) \ntotal_life_exp_daily * params_daily$cycle\n\n[1] 100"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-5",
    "href": "slides/02_competing-events.html#daily-cycle-length-5",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\nparams_mort_daily &lt;- modifyList(params_mort,list(\n  cycle = 1/365,\n  n_cycles = params$n_cycles * 365))"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-6",
    "href": "slides/02_competing-events.html#daily-cycle-length-6",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\nparams_mort_daily$mP &lt;- \n  with(params_mort_daily,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    tp_H_D = 1 - exp(-r_H_D * cycle)\n    tp_CVD_D &lt;- 1 - exp(-(hr_CVD * r_H_D) * cycle)\n    \n    array(data = c(1 - tp_H_CVD - tp_H_D, 0, 0, \n                 tp_H_CVD,1-tp_CVD_D, 0,\n                 tp_H_D, tp_CVD_D, 1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-7",
    "href": "slides/02_competing-events.html#daily-cycle-length-7",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n\n$natural_history\n         to\nfrom      Healthy        CVD        Dead\n  Healthy 0.99956 0.00041087 0.000027397\n  CVD     0.00000 0.99972606 0.000273935\n  Dead    0.00000 0.00000000 1.000000000"
  },
  {
    "objectID": "slides/02_competing-events.html#summary-1",
    "href": "slides/02_competing-events.html#summary-1",
    "title": "Modeling With Competing Risks",
    "section": "Summary",
    "text": "Summary\n\n\n\n\n\n\nIn the presence of competing events (mortality), we obtain different results for different cycle lengths!"
  },
  {
    "objectID": "slides/02_competing-events.html#summary-2",
    "href": "slides/02_competing-events.html#summary-2",
    "title": "Modeling With Competing Risks",
    "section": "Summary",
    "text": "Summary\n\n\n\n\n\n\nIn the presence of competing events (mortality), we obtain different results for different cycle lengths!\n\n\n\n\n\n\n  \n  \n  \n    \n    \n      \n      \n        Model With\nNo Mortality\n      \n      \n        Model With Mortality\n      \n    \n    \n      Yearly Cycle\n      Daily Cycle\n      Yearly Cycle\n      Daily Cycle\n    \n  \n  \n    1. CVD State Occupancy at Two Years\n259.18\n259.18\n244.540\n231.488\n    2. Life Expectancy\n100.00\n100.00\n15.507\n15.624"
  },
  {
    "objectID": "slides/02_competing-events.html#section-2",
    "href": "slides/02_competing-events.html#section-2",
    "title": "Competing Risks",
    "section": "",
    "text": "We next include a background mortality rate that is increased by a hazard ratio (10.0) among people with CVD."
  },
  {
    "objectID": "slides/02_competing-events.html#section-3",
    "href": "slides/02_competing-events.html#section-3",
    "title": "Competing Risks",
    "section": "",
    "text": "We next include a background mortality rate that is increased by a hazard ratio (10.0) among people with CVD.\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.01   \n\nCVD-&gt;CVD\n\n    \n\nCVD-&gt;Dead\n\n   hr_CVD * r_HD hr_CVD=10   \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/02_competing-events.html#in-the-presence-of-competing-risks",
    "href": "slides/02_competing-events.html#in-the-presence-of-competing-risks",
    "title": "Competing Events and Embedding",
    "section": "In the presence of competing risks,",
    "text": "In the presence of competing risks,\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#signs-of-trouble",
    "href": "slides/02_competing-events.html#signs-of-trouble",
    "title": "Competing Risks",
    "section": "Signs of Trouble",
    "text": "Signs of Trouble\n\n\n\n\n\n\nIn the presence of competing events (mortality), we obtain different results for different cycle lengths!"
  },
  {
    "objectID": "slides/02_competing-events.html#what-went-wrong-1",
    "href": "slides/02_competing-events.html#what-went-wrong-1",
    "title": "Competing Risks",
    "section": "What Went Wrong?",
    "text": "What Went Wrong?\n\n\nTo gain intuition for what is going on, let’s split out death for those with vs. without CVD:"
  },
  {
    "objectID": "slides/02_competing-events.html#parameterize-the-model-2",
    "href": "slides/02_competing-events.html#parameterize-the-model-2",
    "title": "Competing Risks",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams_mort2 = \n  list(\n    t_names = c(\"natural_history\"),                       \n    n_treatments = 1,                                     \n    s_names  = c(\"Healthy\", \"CVD\", \"CVDDeath\", \"Dead\"),   \n    n_states = 4,                                         \n    n_cohort = 1,                                         \n    n_cycles = 100,                                        \n    cycle = 1,                                            \n    initial_age = 55,                                     \n    r_H_CVD = 0.15,                                       \n    hr_CVD = 10,                                          \n    r_H_D = 0.01                                          \n  )"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-array-6",
    "href": "slides/02_competing-events.html#transition-probability-matrix-array-6",
    "title": "Competing Events and Embedding",
    "section": "Transition Probability Matrix Array",
    "text": "Transition Probability Matrix Array\n\nparams_mort2$mP\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#who-can-spot-the-problem-annual-cycle",
    "href": "slides/02_competing-events.html#who-can-spot-the-problem-annual-cycle",
    "title": "Competing Events and Embedding",
    "section": "Who Can Spot the Problem? (Annual Cycle)",
    "text": "Who Can Spot the Problem? (Annual Cycle)\n\nparams_mort2$mP\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#who-can-spot-the-problem-10-year-cycle",
    "href": "slides/02_competing-events.html#who-can-spot-the-problem-10-year-cycle",
    "title": "Competing Events and Embedding",
    "section": "Who Can Spot the Problem? (10-Year Cycle)",
    "text": "Who Can Spot the Problem? (10-Year Cycle)\n\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#who-can-spot-the-problem-1y-cycle",
    "href": "slides/02_competing-events.html#who-can-spot-the-problem-1y-cycle",
    "title": "Competing Events and Embedding",
    "section": "Who Can Spot the Problem? (1Y Cycle)",
    "text": "Who Can Spot the Problem? (1Y Cycle)\n\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#who-can-spot-the-problem-10y-cycle",
    "href": "slides/02_competing-events.html#who-can-spot-the-problem-10y-cycle",
    "title": "Competing Events and Embedding",
    "section": "Who Can Spot the Problem? (10Y Cycle)",
    "text": "Who Can Spot the Problem? (10Y Cycle)\n\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-time-process",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-time-process",
    "title": "Competing Events and Embedding",
    "section": "Discretizing a Continuous Time Process",
    "text": "Discretizing a Continuous Time Process\n\nWe “hold” some deaths in each cycle because the probability matrix rules out “compound transitions”\nCompound transition: Healthy  CVD  Dead in a single cycle."
  },
  {
    "objectID": "slides/02_competing-events.html#wheres-the-problem-1yr-cycle",
    "href": "slides/02_competing-events.html#wheres-the-problem-1yr-cycle",
    "title": "Competing Events and Embedding",
    "section": "Where’s the Problem? (1yr Cycle)",
    "text": "Where’s the Problem? (1yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#wheres-the-problem-10yr-cycle",
    "href": "slides/02_competing-events.html#wheres-the-problem-10yr-cycle",
    "title": "Competing Events and Embedding",
    "section": "Where’s the Problem? (10yr Cycle)",
    "text": "Where’s the Problem? (10yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\n\n\n\n\n\nRecall that in this model, CVD has a very high death rate—meaning that many people who develop CVD will die soon after."
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-time-process-1",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-time-process-1",
    "title": "Competing Events and Embedding",
    "section": "Discretizing a Continuous Time Process",
    "text": "Discretizing a Continuous Time Process\n\n\n, ,  = natural_history\n\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-time-process-2",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-time-process-2",
    "title": "Competing Events and Embedding",
    "section": "Discretizing a Continuous Time Process",
    "text": "Discretizing a Continuous Time Process\n\nWhen we use the standard rate-to-probability conversion formula (i.e., \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\)) we obtain the marginal transition probability.\nThis marginal probability reflects the union of all possible transitions that start Healthy and then transition to and from the CVD state in the cycle."
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-time-process-3",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-time-process-3",
    "title": "Competing Events and Embedding",
    "section": "Discretizing a Continuous Time Process",
    "text": "Discretizing a Continuous Time Process\nThat is, \\(p_{HS}= 1 - e^{-r_{HS}\\Delta t}\\) captures the probability of following scenarios occurring in a cycle:\n\nIndividual transitions from healthy to CVD.\nIndividual transitions from healthy to CVD to CVD Death."
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-time-process-4",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-time-process-4",
    "title": "Competing Events and Embedding",
    "section": "Discretizing a Continuous Time Process",
    "text": "Discretizing a Continuous Time Process\n\nThe same result holds if we use the simpler model with just three health states (Healthy, CVD, Dead)\nChanging cycle lengths does not get us out of this problem.\nRather than use the conversion formulas, we need to properly “embed” the transition probability matrix."
  },
  {
    "objectID": "slides/02_competing-events.html#year-cycle",
    "href": "slides/02_competing-events.html#year-cycle",
    "title": "Competing Risks",
    "section": "10 Year Cycle",
    "text": "10 Year Cycle\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\nThis matrix “captures” all transitions from Healthy  CVD in a single transition probability (0.7769)."
  },
  {
    "objectID": "slides/02_competing-events.html#year-cycle-1",
    "href": "slides/02_competing-events.html#year-cycle-1",
    "title": "Competing Risks",
    "section": "10 Year Cycle",
    "text": "10 Year Cycle\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\nBut we actually need to distribute out the marginal probability so that we’re left only with the probability that someone transitions to CVD and remains there at the end of the cycle.\nAs constructed, we have ruled out the possibility of compound transitions (Healthy  CVD  CVDDeath) in a single cycle."
  },
  {
    "objectID": "slides/02_competing-events.html#year-cycle-2",
    "href": "slides/02_competing-events.html#year-cycle-2",
    "title": "Competing Risks",
    "section": "10 Year Cycle",
    "text": "10 Year Cycle\n\n\n$natural_history\n         to\nfrom      Healthy     CVD     Dead\n  Healthy 0.12797 0.77687 0.095163\n  CVD     0.00000 0.36788 0.632121\n  Dead    0.00000 0.00000 1.000000\n\n\n\nThis problem isn’t fixed in the version of the model where death is a single health state.\nThe problem persists, but is “hidden” from view!"
  },
  {
    "objectID": "slides/02_competing-events.html#takeaway",
    "href": "slides/02_competing-events.html#takeaway",
    "title": "Modeling With Competing Risks",
    "section": "Takeaway",
    "text": "Takeaway\n\n\n\n\n\n\nDepending on context, embedding error may be decision relevant (i.e., change optimal decisions)"
  },
  {
    "objectID": "slides/02_competing-events.html#year-cycle-3",
    "href": "slides/02_competing-events.html#year-cycle-3",
    "title": "Competing Risks",
    "section": "10 Year Cycle",
    "text": "10 Year Cycle\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\nThis results in overcounting CVD state occupancy in some cases (people who develop CVD and die soon after) and undercounting CVD state occupancy in others (people who die of background causes before they would have developed CVD in the same cycle)."
  },
  {
    "objectID": "slides/02_competing-events.html#takeaway-1",
    "href": "slides/02_competing-events.html#takeaway-1",
    "title": "Competing Events and Embedding",
    "section": "Takeaway",
    "text": "Takeaway\n\n\n\n\n\n\nIn the presence of competing events (mortality), using standard conversion formulas will yield incorrect transition probability matrices.\n\n\n\n\n\n\n\n\n\nDepending on context, embedding error may be decision relevant (i.e., change optimal decisions)"
  },
  {
    "objectID": "slides/02_competing-events.html#year-cycle-4",
    "href": "slides/02_competing-events.html#year-cycle-4",
    "title": "Competing Events and Embedding",
    "section": "10 Year Cycle",
    "text": "10 Year Cycle\n\n\n\n\n         Healthy   CVD CVDDeath Dead\nHealthy    0.202 0.415    0.333 0.05\nCVD        0.000 0.368    0.632 0.00\nCVDDeath   0.000 0.000    1.000 0.00\nDead       0.000 0.000    0.000 1.00\n\n\n        Healthy   CVD  Dead\nHealthy   0.202 0.415 0.383\nCVD       0.000 0.368 0.632\nDead      0.000 0.000 1.000\n\n\n\n\nThe correct transition probability matrix includes a seemingly impossible transition: Healthy  CVDDeath"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-8",
    "href": "slides/02_competing-events.html#daily-cycle-length-8",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n# Markov Trace (Daily Cycle)\ntrace_mort_daily &lt;- sim_cohort(params_mort_daily)\n\n\n\n\n\n\nHealthy\nCVD\nDead\n\n\n\n\n726.1\n231.5\n42.4"
  },
  {
    "objectID": "slides/02_competing-events.html#section-4",
    "href": "slides/02_competing-events.html#section-4",
    "title": "Competing Risks",
    "section": "",
    "text": "params_mort2$mP &lt;- \n  with(params_mort2,{\n    \n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    tp_H_D = 1 - exp(-r_H_D * cycle)\n    tp_CVD_D &lt;- 1 - exp(-(hr_CVD * r_H_D) * cycle)\n    \n    array(data = c(1 - tp_H_CVD - tp_H_D, 0, 0,0,  \n                 tp_H_CVD,1-tp_CVD_D, 0,0,\n                 0,tp_CVD_D,1,0,\n                 tp_H_D, 0,0, 1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-1",
    "href": "slides/02_competing-events.html#transition-probability-matrix-1",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#daily-cycle-length-9",
    "href": "slides/02_competing-events.html#daily-cycle-length-9",
    "title": "Competing Risks",
    "section": "3. Daily Cycle Length",
    "text": "3. Daily Cycle Length\n\n# Life Expectancy\npayoff_mort_life_exp = c(\"Healthy\" = 1, \"CVD\" = 1, \"Death\" = 0) \nlife_exp_mort_daily = trace_mort_daily[-1,] %*% payoff_mort_life_exp  \ntotal_life_exp_mort_daily = sum(life_exp_mort_daily) \ntotal_life_exp_mort_daily * params_mort_daily$cycle\n\n[1] 15.624"
  },
  {
    "objectID": "slides/02_competing-events.html#what-went-wrong-2",
    "href": "slides/02_competing-events.html#what-went-wrong-2",
    "title": "Competing Risks",
    "section": "What Went Wrong?",
    "text": "What Went Wrong?\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.01   \n\nCVD-&gt;CVD\n\n    \n\nCVDDeath\n\n CVDDeath   \n\nCVD-&gt;CVDDeath\n\n    hr_CVD * r_HD hr_CVD=10   \n\nDead-&gt;Dead\n\n    \n\nCVDDeath-&gt;CVDDeath"
  },
  {
    "objectID": "slides/02_competing-events.html#wheres-the-problem-1yr-cycle-1",
    "href": "slides/02_competing-events.html#wheres-the-problem-1yr-cycle-1",
    "title": "Competing Events and Embedding",
    "section": "Where’s the Problem? (1yr Cycle)",
    "text": "Where’s the Problem? (1yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000\n\n\n\n\n\n\n\n\nRecall that in this model, CVD has a very high death rate—meaning that many people who develop CVD will die soon after."
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\nOur constructed model rules out compound transitions within a cycle.\nCompound transition: Healthy  CVD  CVD Death in a single cycle.\n\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-1",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-1",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\nTo accurately capture the underlying continuous time process, there should be a transition probability defined for a seemingly impossible transition: Healthy  CVD Death.\n\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-2",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-2",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.01   \n\nTest\n\n   \n\nHealthy-&gt;Test\n\n   \n\nCVD-&gt;CVD\n\n    \n\nCVDDeath\n\n CVDDeath   \n\nCVD-&gt;CVDDeath\n\n    hr_CVD * r_HD hr_CVD=10   \n\nDead-&gt;Dead\n\n    \n\nCVDDeath-&gt;CVDDeath\n\n    \n\nTest-&gt;CVDDeath\n\n    \n\nTest2"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-3",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-3",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.01   \n\nCVDDeath\n\n CVDDeath   \n\nHealthy-&gt;CVDDeath\n\n    \n\nCVD-&gt;CVD\n\n    \n\nCVD-&gt;CVDDeath\n\n    hr_CVD * r_HD hr_CVD=10   \n\nDead-&gt;Dead\n\n    \n\nCVDDeath-&gt;CVDDeath"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-4",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-4",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\nChanging to shorter cycle does not get us out of this problem."
  },
  {
    "objectID": "slides/02_competing-events.html#correct-transition-matrix-10-year-cycle",
    "href": "slides/02_competing-events.html#correct-transition-matrix-10-year-cycle",
    "title": "Modeling With Competing Risks",
    "section": "Correct Transition Matrix: 10-year Cycle",
    "text": "Correct Transition Matrix: 10-year Cycle\n\n\n         Healthy   CVD CVDDeath Dead\nHealthy    0.202 0.415    0.333 0.05\nCVD        0.000 0.368    0.632 0.00\nCVDDeath   0.000 0.000    1.000 0.00\nDead       0.000 0.000    0.000 1.00\n\n\n\nThe correct transition probability matrix includes a seemingly impossible transition: Healthy  CVDDeath"
  },
  {
    "objectID": "slides/02_competing-events.html#section-5",
    "href": "slides/02_competing-events.html#section-5",
    "title": "Competing Risks",
    "section": "",
    "text": "Rather than use the conversion formulas, we need to properly “embed” the transition probability matrix.\nThe correct transition probability matrix includes a seemingly impossible transition: Healthy  CVDDeath"
  },
  {
    "objectID": "slides/02_competing-events.html#section-6",
    "href": "slides/02_competing-events.html#section-6",
    "title": "Competing Risks",
    "section": "",
    "text": "Rather than use the conversion formulas, we need to properly “embed” the transition probability matrix.\nThe correct transition probability matrix includes a seemingly impossible transition: Healthy  CVDDeath\n\n\n\n\n         Healthy   CVD CVDDeath Dead\nHealthy    0.202 0.415    0.333 0.05\nCVD        0.000 0.368    0.632 0.00\nCVDDeath   0.000 0.000    1.000 0.00\nDead       0.000 0.000    0.000 1.00"
  },
  {
    "objectID": "slides/02_competing-events.html#what-you-were-taught",
    "href": "slides/02_competing-events.html#what-you-were-taught",
    "title": "Competing Risks",
    "section": "What You Were Taught",
    "text": "What You Were Taught\n\nConvert each rate to a probability for the time step using \\(p = 1-\\exp(-rt)\\).\nPlace the probabilities within a transition matrix \\(\\mathbf{P}\\).\nDiagonal elements of \\(\\mathbf{P}\\): 1 - (row sum of nondiagonal elements)."
  },
  {
    "objectID": "slides/02_competing-events.html#what-were-teaching-you",
    "href": "slides/02_competing-events.html#what-were-teaching-you",
    "title": "Modeling With Competing Risks",
    "section": "What We’re Teaching You",
    "text": "What We’re Teaching You\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{\\mathbf{Rt}}\\)."
  },
  {
    "objectID": "slides/02_competing-events.html#what-were-teaching-you-1",
    "href": "slides/02_competing-events.html#what-were-teaching-you-1",
    "title": "Modeling With Competing Risks",
    "section": "What We’re Teaching You",
    "text": "What We’re Teaching You\n\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{(\\mathbf{R}t})\\).\n\n\n\n\n\n\n\n\nThis process will ensure that the matrix captures “jumpover” states for compound transitions!"
  },
  {
    "objectID": "slides/02_competing-events.html#what-were-teaching-you-2",
    "href": "slides/02_competing-events.html#what-were-teaching-you-2",
    "title": "Modeling With Competing Risks",
    "section": "What We’re Teaching You",
    "text": "What We’re Teaching You\n\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{(\\mathbf{R}t})\\).\n\n\n\n\n\n\n\n\nThis process will ensure that the matrix captures “jumpover” states for compound transitions!\n\n\n\n\n\n\n\n\n\nIt also ensures that changing cycle lengths will not change your answers!"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-2",
    "href": "slides/02_competing-events.html#transition-probability-matrix-2",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nNext, place these probabilities within the transition probability matrix array.\n\n\n\nOuter array dimensions goverened by the number of strategies under consideration."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-3",
    "href": "slides/02_competing-events.html#transition-probability-matrix-3",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nparams$mP &lt;- \n  with(params,{\n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    array(data = c(1 - tp_H_CVD, 0, \n                 tp_H_CVD,1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })\n\n\n\nRemaining code simply names the various dimensions of the array."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-4",
    "href": "slides/02_competing-events.html#transition-probability-matrix-4",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\n\n$natural_history\n         to\nfrom      Healthy     CVD\n  Healthy 0.86071 0.13929\n  CVD     0.00000 1.00000"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-5",
    "href": "slides/02_competing-events.html#transition-probability-matrix-5",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nparams_mort$mP &lt;- \n  with(params_mort,{\n    \n    tp_H_CVD = 1 - exp(-r_H_CVD * cycle) \n    tp_H_D = 1 - exp(-r_H_D * cycle)\n    tp_CVD_D &lt;- 1 - exp(-(hr_CVD * r_H_D) * cycle)\n    \n    array(data = c(1 - tp_H_CVD - tp_H_D, 0, 0, \n                 tp_H_CVD,1-tp_CVD_D, 0,\n                 tp_H_D, tp_CVD_D, 1),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#parameterize-the-model-3",
    "href": "slides/02_competing-events.html#parameterize-the-model-3",
    "title": "Competing Risks",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams_mort_embedded = \n  list(\n    t_names = c(\"natural_history\"),                       \n    n_treatments = 1,                                     \n    s_names  = c(\"Healthy\", \"CVD\", \"CVDDeath\", \"Dead\"),   \n    n_states = 4,                                         \n    n_cohort = 1,                                         \n    n_cycles = 100,                                        \n    cycle = 1,                                            \n    initial_age = 55,                                     \n    r_H_CVD = 0.15,                                       \n    hr_CVD = 10,                                          \n    r_H_D = 0.01                                          \n  )\n\n\nNote: this is the same parameter list as earlier!"
  },
  {
    "objectID": "slides/02_competing-events.html#define-the-transition-rate-matrix",
    "href": "slides/02_competing-events.html#define-the-transition-rate-matrix",
    "title": "Competing Events and Embedding",
    "section": "Define the Transition Rate Matrix",
    "text": "Define the Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    \n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle\n    })\n  R    \n  })\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix",
    "href": "slides/02_competing-events.html#transition-rate-matrix",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    \n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle\n    })\n  R    \n  })"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix-1",
    "href": "slides/02_competing-events.html#transition-rate-matrix-1",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    \n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle\n    })\n  R    \n  })\n\n\n\nCalculate the CVD  Dead rate"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix-2",
    "href": "slides/02_competing-events.html#transition-rate-matrix-2",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    \n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle\n    })\n  R    \n  })\n\n\n\nPlace the rates within the matrix. We’ll get the diagonal elements in a second to ensure things balance out."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix-3",
    "href": "slides/02_competing-events.html#transition-rate-matrix-3",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle \n    })\n  R    \n  })\n\n\n\nDiagonal elements are the negative row sum (i.e., each row of \\(\\mathbf{R}\\) sums to 0)"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix-4",
    "href": "slides/02_competing-events.html#transition-rate-matrix-4",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR &lt;- \n  with(params_mort2_emb,{\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    R_ &lt;- \n      array(data = c(0, 0, 0,0,  \n                 r_H_CVD,0, 0,0,\n                 0,r_CVD_D,0,0,\n                 r_H_D, 0,0, 0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x) \n      x * cycle\n    })\n  R    \n  })\n\n\n\nConvert \\(\\mathbf{R}\\) to the model cycle length (e.g., 1 year, 1 day, 1 month, etc.)."
  },
  {
    "objectID": "slides/02_competing-events.html#transition-rate-matrix-5",
    "href": "slides/02_competing-events.html#transition-rate-matrix-5",
    "title": "Competing Risks",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams_mort_embedded$mR\n\n$natural_history\n          to\nfrom       Healthy   CVD CVDDeath Dead\n  Healthy    -0.16  0.15      0.0 0.01\n  CVD         0.00 -0.10      0.1 0.00\n  CVDDeath    0.00  0.00      0.0 0.00\n  Dead        0.00  0.00      0.0 0.00"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-6",
    "href": "slides/02_competing-events.html#transition-probability-matrix-6",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\n\n$natural_history\n         to\nfrom      Healthy     CVD      Dead\n  Healthy 0.85076 0.13929 0.0099502\n  CVD     0.00000 0.90484 0.0951626\n  Dead    0.00000 0.00000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#transition-probability-matrix-7",
    "href": "slides/02_competing-events.html#transition-probability-matrix-7",
    "title": "Competing Risks",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nexpm(params_mort_embedded$mR[[\"natural_history\"]])\n\n         Healthy     CVD  CVDDeath     Dead\nHealthy  0.85214 0.13173 0.0068811 0.009241\nCVD      0.00000 0.90484 0.0951626 0.000000\nCVDDeath 0.00000 0.00000 1.0000000 0.000000\nDead     0.00000 0.00000 0.0000000 1.000000\n\n\n\nNotice how the embedded matrix now has a transition probability from Healthy  CVD Death!"
  },
  {
    "objectID": "slides/02_competing-events.html#common-advice-on-conversion",
    "href": "slides/02_competing-events.html#common-advice-on-conversion",
    "title": "Competing Events and Embedding",
    "section": "Common Advice on Conversion",
    "text": "Common Advice on Conversion\n\\(\\pi_{A \\rightarrow B} = 1 - e^{-r_{A \\rightarrow B} t}\\) to convert a rate, \\(r\\) to a probability, \\(\\pi\\).\n\\(r_{A \\rightarrow B} = -\\log(1 - (\\pi_{A \\rightarrow B} - 1) / t\\) to convert a probability, \\(\\pi\\), to a rate, \\(r\\).\nWhich is technically correct for a model with one rate."
  },
  {
    "objectID": "slides/02_competing-events.html#competing-rates",
    "href": "slides/02_competing-events.html#competing-rates",
    "title": "Competing Events and Embedding",
    "section": "Competing Rates",
    "text": "Competing Rates\nWhen 2 rates compete for a transition these formulas are mathematically wrong.\nWhat is correct is embedding the rate matrix, \\(X\\) into a time step, \\(Y = Y_0 e^{Xt}\\)."
  },
  {
    "objectID": "slides/02_competing-events.html#resulting-error",
    "href": "slides/02_competing-events.html#resulting-error",
    "title": "Competing Risks",
    "section": "Resulting Error",
    "text": "Resulting Error\n\nIf one has misapplied this in a model, it’s going to be okay."
  },
  {
    "objectID": "slides/02_competing-events.html#quantified-absolute-error",
    "href": "slides/02_competing-events.html#quantified-absolute-error",
    "title": "Competing Risks",
    "section": "Quantified Absolute Error",
    "text": "Quantified Absolute Error\n\n\nError after one cycle"
  },
  {
    "objectID": "slides/02_competing-events.html#quantified-relative-error",
    "href": "slides/02_competing-events.html#quantified-relative-error",
    "title": "Competing Risks",
    "section": "Quantified Relative Error",
    "text": "Quantified Relative Error\n\n\nFor rates &lt; 0.1 of the chosen time step the error is &lt;5%.\nThis error will accumulate over each timestep."
  },
  {
    "objectID": "slides/02_competing-events.html#comparison",
    "href": "slides/02_competing-events.html#comparison",
    "title": "Competing Events and Embedding",
    "section": "Comparison",
    "text": "Comparison\n\nCommon Economic Statistics are relative to a base or reference case. I.e., \\(f(\\theta_M) - f(\\theta_{ref})\\)\n\nNet monetary benefit.\nNet health benefit.\nIncremental cost effectiveness ratio.\n\n\nWith error it becomes:\n\\[f(\\theta_M) + \\epsilon_M - (f(\\theta_{ref}) + \\epsilon_{ref})\\]"
  },
  {
    "objectID": "slides/02_competing-events.html#specification-error",
    "href": "slides/02_competing-events.html#specification-error",
    "title": "Competing Risks",
    "section": "Specification Error",
    "text": "Specification Error\nIf \\(\\epsilon_A - \\epsilon_{B} \\sim 0\\) the impact to the decision threshold is minimal.\n\nThese decision thresholds are semi-robust against this misspecification.\nRestated: Single model runs are biased under misspecification, but comparison across strategies helps cancel this out."
  },
  {
    "objectID": "slides/02_competing-events.html#rate-misspecification-conclusions",
    "href": "slides/02_competing-events.html#rate-misspecification-conclusions",
    "title": "Competing Risks",
    "section": "Rate Misspecification Conclusions",
    "text": "Rate Misspecification Conclusions\n\n\n\n\n\n\nIn the presence of competing events (mortality), using standard conversion formulas will yield incorrect transition probability matrices."
  },
  {
    "objectID": "slides/02_competing-events.html#other",
    "href": "slides/02_competing-events.html#other",
    "title": "Modeling With Competing Risks",
    "section": "Other",
    "text": "Other\n\nDiscrete Event Simulation automatically handles competing events.\nPublished rates from clinical studies are usually adjusted for competing events (survival studies)."
  },
  {
    "objectID": "slides/02_competing-events.html#spot-the-problem-1yr-cycle",
    "href": "slides/02_competing-events.html#spot-the-problem-1yr-cycle",
    "title": "Competing Risks",
    "section": "Spot the Problem (1yr Cycle)",
    "text": "Spot the Problem (1yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000"
  },
  {
    "objectID": "slides/02_competing-events.html#spot-the-problem-1yr-cycle-1",
    "href": "slides/02_competing-events.html#spot-the-problem-1yr-cycle-1",
    "title": "Competing Risks",
    "section": "Spot the Problem (1yr Cycle)",
    "text": "Spot the Problem (1yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000\n\n\n\n\n\n\n\n\nRecall that in this model, CVD has a very high death rate—meaning that many people who develop CVD will die very soon after."
  },
  {
    "objectID": "slides/02_competing-events.html#spot-the-problem-10yr-cycle",
    "href": "slides/02_competing-events.html#spot-the-problem-10yr-cycle",
    "title": "Competing Risks",
    "section": "Spot the Problem (10yr Cycle)",
    "text": "Spot the Problem (10yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath     Dead\n  Healthy  0.12797 0.77687  0.00000 0.095163\n  CVD      0.00000 0.36788  0.63212 0.000000\n  CVDDeath 0.00000 0.00000  1.00000 0.000000\n  Dead     0.00000 0.00000  0.00000 1.000000\n\n\n\n\n\n\n\n\nRecall that in this model, CVD has a very high death rate—meaning that many people who develop CVD will die very soon after.\n\n\n\n\n\n\n\n\n\nWith this knowledge in mind, can you spot something wrong with the above (annual) transition matrix?"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-5",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-5",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\nChanging to shorter cycle lengths adds computational demands but does not get us out of this problem.\n\n\n\n\n\n\n\n\n\nThe same result holds if we use the simpler model with just three health states (Healthy, CVD, Dead)"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-6",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-6",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\nChanging to shorter cycle lengths adds computational demands but does not get us out of this problem.\n\n\n\n\n\n\n\n\n\nThe same result holds if we use the simpler model with just three health states (Healthy, CVD, Dead)"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-7",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-7",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\nChanging to shorter cycle lengths adds computational demands but does not get us out of this problem.\n\n\n\n\n\n\n\n\n\nThe same result holds if we use the simpler model with just three health states (Healthy, CVD, Dead)"
  },
  {
    "objectID": "slides/02_competing-events.html#comparisons-across-strategies-bail-you-out",
    "href": "slides/02_competing-events.html#comparisons-across-strategies-bail-you-out",
    "title": "Competing Risks",
    "section": "Comparisons Across Strategies Bail You Out",
    "text": "Comparisons Across Strategies Bail You Out\n\nCommon CEA approaches compare strategies, i.e., \\(f(\\theta_A) - f(\\theta_{B})\\)\n\nNet monetary benefit.\nNet health benefit.\nIncremental cost effectiveness ratio.\n\nWith error it becomes:"
  },
  {
    "objectID": "slides/02_competing-events.html#why-does-this-matter",
    "href": "slides/02_competing-events.html#why-does-this-matter",
    "title": "Competing Risks",
    "section": "Why Does This Matter?",
    "text": "Why Does This Matter?\n\nWithout properly embedding, you are no longer modeling a continuous time process.\nSo your model results will differ compared to a continuous time model (e.g., discrete event simulation)\nMicrosimulation suffers the same problem because the patient-level transition probability matrix is embedded in a time step and requires Markov Rate conversion."
  },
  {
    "objectID": "slides/02_competing-events.html#rate-misspecification-conclusions-1",
    "href": "slides/02_competing-events.html#rate-misspecification-conclusions-1",
    "title": "Competing Risks",
    "section": "Rate Misspecification Conclusions",
    "text": "Rate Misspecification Conclusions\n\nExisting publication’s decision thresholds are generally okay if they misspecified rates.\nCheck the maximum rate of an event as a rough estimate of potential bias.\nRule of thumb, on the error plot use the estimated rate for full time scale of simulation, i.e. one step is entire simulation."
  },
  {
    "objectID": "slides/02_competing-events.html#spot-the-problem-1yr-cycle-2",
    "href": "slides/02_competing-events.html#spot-the-problem-1yr-cycle-2",
    "title": "Competing Risks",
    "section": "Spot the Problem (1yr Cycle)",
    "text": "Spot the Problem (1yr Cycle)\n\n\n$natural_history\n          to\nfrom       Healthy     CVD CVDDeath      Dead\n  Healthy  0.85076 0.13929 0.000000 0.0099502\n  CVD      0.00000 0.90484 0.095163 0.0000000\n  CVDDeath 0.00000 0.00000 1.000000 0.0000000\n  Dead     0.00000 0.00000 0.000000 1.0000000\n\n\n\n\n\n\n\n\nRecall that in this model, CVD has a very high death rate—meaning that many people who develop CVD will die very soon after.\n\n\n\n\n\n\n\n\n\nWith this knowledge in mind, can you spot something wrong with the above (annual) transition matrix?"
  },
  {
    "objectID": "slides/02_competing-events.html#discretizing-a-continuous-process-8",
    "href": "slides/02_competing-events.html#discretizing-a-continuous-process-8",
    "title": "Competing Risks",
    "section": "Discretizing a Continuous Process",
    "text": "Discretizing a Continuous Process\n\n\n\n\n\n\nChanging to shorter cycle lengths adds computational demands but does not get us out of this problem.\n\n\n\n\n\n\n\n\n\nThe same result holds if we use the simpler model with just three health states (Healthy, CVD, Dead)"
  },
  {
    "objectID": "slides/02_competing-events.html#comparisons-across-strategies-bail-you-out-1",
    "href": "slides/02_competing-events.html#comparisons-across-strategies-bail-you-out-1",
    "title": "Competing Risks",
    "section": "Comparisons Across Strategies Bail You Out",
    "text": "Comparisons Across Strategies Bail You Out\n\n\nCommon CEA approaches compare strategies, i.e., \\(f(\\theta_A) - f(\\theta_{B})\\)\n\nNet monetary benefit.\nNet health benefit.\nIncremental cost effectiveness ratio.\n\nWith error it becomes:\n\n\n\\[f(\\theta_A) + \\epsilon_A - (f(\\theta_{B}) + \\epsilon_{B})\\]"
  },
  {
    "objectID": "slides/02_competing-events.html#additional-notes",
    "href": "slides/02_competing-events.html#additional-notes",
    "title": "Competing Risks",
    "section": "Additional Notes",
    "text": "Additional Notes\n\nDiscrete Event Simulation automatically handles competing events.\nMicrosimulation misspecification error interacts with the discrete time step truncation and increases this error!\nPublished rates from clinical studies are usually adjusted for competing events (the purpose of survival studies)."
  },
  {
    "objectID": "slides/02_competing-events.html#what-well-teach-you",
    "href": "slides/02_competing-events.html#what-well-teach-you",
    "title": "Competing Risks",
    "section": "What We’ll Teach You",
    "text": "What We’ll Teach You\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{(\\mathbf{R}t)}\\)."
  },
  {
    "objectID": "slides/02_competing-events.html#what-well-teach-you-1",
    "href": "slides/02_competing-events.html#what-well-teach-you-1",
    "title": "Competing Risks",
    "section": "What We’ll Teach You",
    "text": "What We’ll Teach You\n\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{(\\mathbf{R}t})\\).\n\n\n\n\n\n\n\n\nThis process will ensure that the matrix captures “jumpover” states for compound transitions!"
  },
  {
    "objectID": "slides/02_competing-events.html#what-well-teach-you-2",
    "href": "slides/02_competing-events.html#what-well-teach-you-2",
    "title": "Competing Risks",
    "section": "What We’ll Teach You",
    "text": "What We’ll Teach You\n\n\nPlace each rate in a rate matrix \\(\\mathbf{R}\\).\nDiagonal elements of \\(\\mathbf{R}\\): -1 * (row sum of nondiagonal elements).\nEmbed the transition probability matrix using matrix exponentiation \\(\\mathbf{P} = \\exp{(\\mathbf{R}t})\\).\n\n\n\n\n\n\n\n\nThis process will ensure that the matrix captures “jumpover” states for compound transitions!\n\n\n\n\n\n\n\n\n\nIt also ensures that changing cycle lengths will not change your answers!"
  },
  {
    "objectID": "slides/02_competing-events.html#section-7",
    "href": "slides/02_competing-events.html#section-7",
    "title": "Competing Risks",
    "section": "",
    "text": "Using Conversion Formulas:\n\n\n          to\nfrom       Healthy   CVD CVDDeath Dead\n  Healthy    0.851 0.139    0.000 0.01\n  CVD        0.000 0.905    0.095 0.00\n  CVDDeath   0.000 0.000    1.000 0.00\n  Dead       0.000 0.000    0.000 1.00\n\n\n\n\n\nUsing Rate Matrix Eponentiation:\n\n\n         Healthy   CVD CVDDeath  Dead\nHealthy    0.852 0.132    0.007 0.009\nCVD        0.000 0.905    0.095 0.000\nCVDDeath   0.000 0.000    1.000 0.000\nDead       0.000 0.000    0.000 1.000"
  },
  {
    "objectID": "slides/02_competing-events.html#signs-of-trouble-1",
    "href": "slides/02_competing-events.html#signs-of-trouble-1",
    "title": "Competing Risks",
    "section": "Signs of Trouble",
    "text": "Signs of Trouble\n\n\n\n\n\n\nIn the presence of competing events (mortality), we obtain different results for different cycle lengths!\n\n\n\n\n\n\n  \n  \n  \n    \n    \n      \n      \n        Model With\nNo Mortality\n      \n      \n        Model With Mortality\n      \n    \n    \n      Yearly Cycle\n      Daily Cycle\n      Yearly Cycle\n      Daily Cycle\n    \n  \n  \n    1. CVD State Occupancy at Two Years\n259.18\n259.18\n244.540\n231.488\n    2. Life Expectancy\n100.00\n100.00\n15.507\n15.624"
  },
  {
    "objectID": "slides/02_competing-events.html#signs-of-trouble-2",
    "href": "slides/02_competing-events.html#signs-of-trouble-2",
    "title": "Competing Risks",
    "section": "Signs of Trouble",
    "text": "Signs of Trouble\n\n\n\n\n\n\nIn the presence of competing events (mortality), we obtain different results for different cycle lengths! Notice how the state occupancy in CVD differs in the right panel of the figure below."
  },
  {
    "objectID": "slides/02_competing-events.html#case-study",
    "href": "slides/02_competing-events.html#case-study",
    "title": "Competing Risks",
    "section": "Case Study",
    "text": "Case Study"
  },
  {
    "objectID": "slides/02_competing-events.html#case-study-learning-objectives",
    "href": "slides/02_competing-events.html#case-study-learning-objectives",
    "title": "Modeling With Competing Risks",
    "section": "Case Study Learning Objectives",
    "text": "Case Study Learning Objectives\n\nConstruct a natural history model for CVD.\nBackground mortality based on cause-deleted life table data.\nCVD mortality based on cause-specific mortality.\nMarkov model is properly embedded.\nMarkov model results will closely match cause-deleted and cause-specific mortality in the US population.\n\n\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#learning-objectives",
    "href": "slides/02_competing-events.html#learning-objectives",
    "title": "Competing Risks",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nPitfalls of traditional transition probability conversion formulas.\nDiscuss compound transitions and how to account for them.\nDemonstrate how to properly embed a transition probability matrix into a timestep."
  },
  {
    "objectID": "slides/02_competing-events.html#learning-objectives-1",
    "href": "slides/02_competing-events.html#learning-objectives-1",
    "title": "Competing Risks",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nConstruct a natural history model for CVD.\nBackground mortality based on cause-deleted life table data.\nCVD mortality based on cause-specific mortality.\nMarkov model is properly embedded.\nMarkov model results will closely match cause-deleted and cause-specific mortality in the US population.\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/02_competing-events.html#why-dont-the-conversion-formulas-work",
    "href": "slides/02_competing-events.html#why-dont-the-conversion-formulas-work",
    "title": "Competing Risks",
    "section": "Why Don’t the Conversion Formulas Work?",
    "text": "Why Don’t the Conversion Formulas Work?\n\nWhen we use the standard rate-to-probability conversion formula (i.e., \\(p_{H,CVD}= 1 - \\exp(-r_{H,CVD} t)\\) ) we obtain the marginal transition probability.\nThis marginal probability reflects the union of all possible transitions that start Healthy and then transition to and from the CVD state in the cycle."
  },
  {
    "objectID": "slides/02_competing-events.html#why-dont-the-conversion-formulas-work-1",
    "href": "slides/02_competing-events.html#why-dont-the-conversion-formulas-work-1",
    "title": "Competing Risks",
    "section": "Why Don’t the Conversion Formulas Work?",
    "text": "Why Don’t the Conversion Formulas Work?\nThat is, \\(p_{H,CVD}= 1 - \\exp(-r_{H,CVD} t)\\) captures the probability of following scenarios occurring in a cycle:\n\nIndividual transitions from healthy to CVD.\nIndividual transitions from healthy to CVD to CVD Death.\nIndividual dies from background causes before they would have developed CVD in the same cycle."
  },
  {
    "objectID": "slides/02_competing-events.html#embedding-error",
    "href": "slides/02_competing-events.html#embedding-error",
    "title": "Competing Risks",
    "section": "Embedding Error",
    "text": "Embedding Error\n\nIf one has misapplied this in a model, it’s going to be okay."
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#what-is-a-copula",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#what-is-a-copula",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "What is a Copula?",
    "text": "What is a Copula?\n\nThe binding “glue” between correlated variables."
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-asn-psa",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-asn-psa",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "Copulas asn PSA",
    "text": "Copulas asn PSA\nWe typically draw PSA samples from the marginal distribution of each variable:\n\\[\nF_1(x_1), F_2(x_2), ..., F_d(x_d)\n\\]\n\n\nBack to Website"
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "Copulas and PSA Sampling",
    "text": "Copulas and PSA Sampling\nWe typically draw PSA samples from the marginal distribution of each variable:\n\\[\nF_1(x_1),  ..., F_d(x_d)\n\\]"
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling-1",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling-1",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "Copulas and PSA Sampling",
    "text": "Copulas and PSA Sampling\nCopulas allow us to sample from the joint distribution:\n\\[\nF(x_1,...,x_d) = C \\big ( F_1(x_1), ..., F_d(x_d) \\big )\n\\]\n(This is a result of Sklar [1959].)"
  },
  {
    "objectID": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling-2",
    "href": "slides/04_incorporating-new-evidence-and-uncertainty.html#copulas-and-psa-sampling-2",
    "title": "Incorporating New Evidence and Uncertainty",
    "section": "Copulas and PSA Sampling",
    "text": "Copulas and PSA Sampling\n\nCopula: a multivariate cumulative distribution function with uniform marginals.\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#approaches-to-modeling-mortality-1",
    "href": "slides/01_mortality.html#approaches-to-modeling-mortality-1",
    "title": "1. Coping with Mortality",
    "section": "Approaches to Modeling Mortality",
    "text": "Approaches to Modeling Mortality\n\n\nStandard approach is to draw from life table data:\n\n\n\n\n\n\n\nage\nlx\ndx\nmx\nqx\n\n\n\n\n0\n100000\n553.22\n0.00556\n0.00553\n\n\n1\n99447\n38.18\n0.00038\n0.00038\n\n\n2\n99409\n23.16\n0.00023\n0.00023\n\n\n\n\n\n\n\n\nmx is the death rate within the interval.\nqx is the probability of death within an interval."
  },
  {
    "objectID": "slides/01_mortality.html#life-table-based-mortality-1",
    "href": "slides/01_mortality.html#life-table-based-mortality-1",
    "title": "1. Coping with Mortality",
    "section": "Life Table-Based Mortality",
    "text": "Life Table-Based Mortality\n\nWhat if age bins are coarse (e.g., 0, 5, 10,… vs. 0,1,2,3,…)?\n\nAssume death probability/rate is constant within age bins (and cycles)?\nIn a DES model, we need to sample a time to death.\n\nCan sample from survival function in underlying life table.\nAges in life table often topcoded (e.g., 85, 100, etc.)"
  },
  {
    "objectID": "slides/01_mortality.html#section",
    "href": "slides/01_mortality.html#section",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Name\nModel\nCode\n\n\n\n\nAdult mortality\n\n\nGompertz\n$mu[x] = A exp[Bx]$\ngompertz\n\n\nGompertz\n$mu[x] = 1/sigma * exp[(x-M)/sigma)]$\ngompertz0\n\n\nMakeham\n$mu[x] = A exp[Bx] + C$\nmakeham\n\n\nMakeham\n$mu[x] = 1/sigma * exp[(x-M)/sigma)] + C$\nmakeham0\n\n\nPerks\n$mu[x] = [A + BC^x] / [BC^{-x} + 1 + DC^x]$\nperks\n\n\nStrehler-Mildvan\n$mu[x] = K * exp[-V0 * (1 - Bx)/D]$\nstrehler_mildvan\n\n\nAdult and/or old-age mortality\n\n\nVan der Maen\n$mu[x] = A + Bx + Cx^2 + I/[N - x]$\nvandermaen\n\n\nBeard\n$mu[x] = A exp(Bx) / [1 + KA exp(Bx)]$\nbeard\n\n\nBeard-Makeham\n$mu[x] = A exp(Bx) / [1 + KA exp(Bx)] + C$\nbeard_makeham\n\n\nGamma-Gompertz\n$mu[x] = A exp(Bx) / (1 + AG/B * [exp(Bx) - 1])$\nggompertz"
  },
  {
    "objectID": "slides/01_mortality.html#alive-dead-model-1",
    "href": "slides/01_mortality.html#alive-dead-model-1",
    "title": "1. Coping with Mortality",
    "section": "Alive-Dead Model",
    "text": "Alive-Dead Model\n\n\nAs a refresher, let’s construct a very simple alive-dead model using life table death probability (qx) values.\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nAlive\n\n Alive   \n\nAlive-&gt;Alive\n\n  1.0-qx(t)   \n\nDead\n\n Dead   \n\nAlive-&gt;Dead\n\n  qx(t)   \n\nDead-&gt;Dead\n\n  1.0"
  },
  {
    "objectID": "slides/01_mortality.html#parameterize-the-model",
    "href": "slides/01_mortality.html#parameterize-the-model",
    "title": "1. Coping with Mortality",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n  list(\n    t_names = c(\"lifetable\"),         # Strategy names. \n    n_treatments = 1,                 # Number of treatments\n    s_names  = c(\"Alive\", \"Dead\"),    # State names\n    n_states = 2,                     # Number of states\n    n_cohort = 100000,                # Cohort size\n    initial_age = 0,                  # Cohort starting age    \n    n_cycles = 110,                   # Number of cycles in model.  \n    cycle = 1,                        # Cycle length\n    life_table = lt                   # Processed HMD life table data (2019, USA)\n  )"
  },
  {
    "objectID": "slides/01_mortality.html#transition-probability-matrix",
    "href": "slides/01_mortality.html#transition-probability-matrix",
    "title": "Mortalty Modeling",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\nWe’ll next construct a transition probability matrix using the age-specific probability of death field (qx) from the life table data.\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#parameterize-the-model-1",
    "href": "slides/01_mortality.html#parameterize-the-model-1",
    "title": "1. Coping with Mortality",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n  list(\n    t_names = c(\"lifetable\"),         # Strategy names. \n    n_treatments = 1,                 # Number of treatments\n    s_names  = c(\"Alive\", \"Dead\"),    # State names\n    n_states = 2,                     # Number of states\n    n_cohort = 100000,                # Cohort size\n    initial_age = 0,                  # Cohort starting age    \n    n_cycles = 110,                   # Number of cycles in model.  \n    cycle = 1,                        # Cycle length\n    life_table = lt                   # Processed HMD life table data (2019, USA)\n  )\n\n\n\nNo specific strategies or policies under consideration; we’re just trying to replicate mortality using life table data for a hypothetical cohort of 100,000 infants."
  },
  {
    "objectID": "slides/01_mortality.html#parameterize-the-model-2",
    "href": "slides/01_mortality.html#parameterize-the-model-2",
    "title": "1. Coping with Mortality",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n    list(\n        t_names = c(\"lifetable\"),         # Strategy names. \n        n_treatments = 1,                 # Number of treatments\n        s_names  = c(\"Alive\", \"Dead\"),    # State names\n        n_states = 2,                     # Number of states\n        n_cohort = 100000,                # Cohort size\n        initial_age = 0,                  # Cohort starting age    \n        n_cycles = 110,                   # Number of cycles in model.  \n        cycle = 1,                        # Cycle length\n        life_table = lt                   # Processed HMD life table data (2019, USA)\n    )\n\n\n\nDiscrete time will be in annual cycles."
  },
  {
    "objectID": "slides/01_mortality.html#parameterize-the-model-3",
    "href": "slides/01_mortality.html#parameterize-the-model-3",
    "title": "1. Coping with Mortality",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n    list(\n        t_names = c(\"lifetable\"),         # Strategy names. \n        n_treatments = 1,                 # Number of treatments\n        s_names  = c(\"Alive\", \"Dead\"),    # State names\n        n_states = 2,                     # Number of states\n        n_cohort = 100000,                # Cohort size\n        initial_age = 0,                  # Cohort starting age    \n        n_cycles = 110,                   # Number of cycles in model.  \n        cycle = 1,                        # Cycle length\n        life_table = lt                   # Processed HMD life table data (2019, USA)\n    )\n\n\n\nThe lifetable “strategy” will draw on the HMD life table data processed earlier."
  },
  {
    "objectID": "slides/01_mortality.html#age-dependent-transition-matrix",
    "href": "slides/01_mortality.html#age-dependent-transition-matrix",
    "title": "1. Coping with Mortality",
    "section": "Age-Dependent Transition Matrix",
    "text": "Age-Dependent Transition Matrix\n\nWe’ll next construct a transition probability matrix using the age-specific probability of death field (qx) from the life table data.\nTo do so, we need to define a function that, for a given age and cycle length, calculates the probability of death and places this within a transition matrix."
  },
  {
    "objectID": "slides/01_mortality.html#age-dependent-transition-matrix-1",
    "href": "slides/01_mortality.html#age-dependent-transition-matrix-1",
    "title": "1. Coping with Mortality",
    "section": "Age-Dependent Transition Matrix",
    "text": "Age-Dependent Transition Matrix\n\n\nLife Table:\n\nlt[1,c(\"age\",\"qx\")]\n\n# A tibble: 1 × 2\n    age      qx\n  &lt;dbl&gt;   &lt;dbl&gt;\n1     0 0.00553\n\nlt[90,c(\"age\",\"qx\")]\n\n# A tibble: 1 × 2\n    age    qx\n  &lt;dbl&gt; &lt;dbl&gt;\n1    89 0.123\n\n\n\nTransition Matrix:\n\nparams$mP[[1]][,,\"lifetable\"]\n\n       to\nfrom    Alive   Dead     \n  Alive 0.99447 0.0055322\n  Dead  0       1        \n\nparams$mP[[90]][,,\"lifetable\"]\n\n       to\nfrom    Alive   Dead   \n  Alive 0.87677 0.12323\n  Dead  0       1"
  },
  {
    "objectID": "slides/01_mortality.html#age-dependent-transition-matrix-2",
    "href": "slides/01_mortality.html#age-dependent-transition-matrix-2",
    "title": "Mortalty Modeling",
    "section": "Age-Dependent Transition Matrix",
    "text": "Age-Dependent Transition Matrix\n\nparams$mP &lt;- \n  fn_mPt(1:params$n_cycles, params)\n\n\n\n\nlt[1,c(\"age\",\"qx\")]\n\n# A tibble: 1 × 2\n    age      qx\n  &lt;dbl&gt;   &lt;dbl&gt;\n1     0 0.00553\n\nlt[90,c(\"age\",\"qx\")]\n\n# A tibble: 1 × 2\n    age    qx\n  &lt;dbl&gt; &lt;dbl&gt;\n1    89 0.123\n\n\n\n\nparams$mP[[1]][,,\"lifetable\"]\n\n       to\nfrom    Alive   Dead     \n  Alive 0.99447 0.0055322\n  Dead  0       1        \n\nparams$mP[[90]][,,\"lifetable\"]\n\n       to\nfrom    Alive   Dead   \n  Alive 0.87677 0.12323\n  Dead  0       1"
  },
  {
    "objectID": "slides/01_mortality.html#construct-the-markov-trace",
    "href": "slides/01_mortality.html#construct-the-markov-trace",
    "title": "1. Coping with Mortality",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\nsim_cohort &lt;- function(params) {\n params$t_names %&gt;% map(~({ \n    tr_ &lt;- t(c(\"alive\" = params$n_cohort, \"dead\" = 0))\n    \n    res &lt;- do.call(rbind,lapply(params$mP, function(tp) {\n        tr_ &lt;&lt;- tr_ %*% matrix(unlist(tp[,,.x]),nrow=params$n_state)\n    }))\n    res &lt;- rbind(c(params$n_cohort,0),res) \n    dimnames(res) &lt;- list(paste0(c(0:params$n_cycles)), params$s_names)\n    res\n  })) %&gt;% \n    set_names(params$t_names)\n}"
  },
  {
    "objectID": "slides/01_mortality.html#construct-the-markov-trace-1",
    "href": "slides/01_mortality.html#construct-the-markov-trace-1",
    "title": "1. Coping with Mortality",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\n\nOutput: named list object with full Markov trace for each strategy."
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy",
    "href": "slides/01_mortality.html#life-expectancy",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\nWe have a model with 110 annual cycles for a cohort of 100,000 0 year olds.\nAccording to the underlying life table data, life expectancy at birth is 78.96315 years.\nLet’s verify we can replicate this with our Markov model."
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-1",
    "href": "slides/01_mortality.html#life-expectancy-1",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\nWe have a model with 110 annual cycles for a cohort of 100,000 0 year olds.\nAccording to the underlying life table data, life expectancy at birth is 78.96315 years.\nLet’s verify we can replicate this with our Markov model.\n\n\n\n\n\n\n\nage\nqx\nex\n\n\n\n\n0\n0.00553\n78.963"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-2",
    "href": "slides/01_mortality.html#life-expectancy-2",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\nDefine the payoff for life expectancy (1 if alive, 0 otherwise)\n\n\n\n# Define the payoff for life expectancy\npayoff_life_exp = c(\"Alive\" = 1, \"Dead\" = 0)\n\n# Calculate alive years in each cycle\nlife_exp_cycle = (trace[[1]] * (1 / params$n_cohort)) %*% payoff_life_exp\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_life_exp = cycle_adj(life_exp_cycle)"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-at-age-40",
    "href": "slides/01_mortality.html#life-expectancy-at-age-40",
    "title": "Mortalty Modeling",
    "section": "Life Expectancy at Age 40",
    "text": "Life Expectancy at Age 40\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-3",
    "href": "slides/01_mortality.html#life-expectancy-3",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\nCalculate life years in each cycle.1\n\n\n\n# Define the payoff for life expectancy\npayoff_life_exp = c(\"Alive\" = 1, \"Dead\" = 0)\n\n# Calculate alive years in each cycle\nlife_exp_cycle = (trace[[1]] * (1 / params$n_cohort)) %*% payoff_life_exp\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_life_exp = cycle_adj(life_exp_cycle)\n\nNote that we divide by 100000 to normalize the results to a single individual for life expectancy calculations."
  },
  {
    "objectID": "slides/01_mortality.html#alternative-parametric-mortality-model",
    "href": "slides/01_mortality.html#alternative-parametric-mortality-model",
    "title": "1. Coping with Mortality",
    "section": "Alternative: Parametric Mortality Model",
    "text": "Alternative: Parametric Mortality Model\n\nFit a parametric mortality model to the life table data.\nReduces dimensionality to a few parameters.\nUse these parameters to sample time of death, obtain mortality rate/probability at any arbitrary time, etc."
  },
  {
    "objectID": "slides/01_mortality.html#processing-life-table-data-3",
    "href": "slides/01_mortality.html#processing-life-table-data-3",
    "title": "1. Coping with Mortality",
    "section": "Processing Life Table Data",
    "text": "Processing Life Table Data\n\n\nCode below processes HMD data and constructs a (2019) life table from it.\nRadix (cohort size) is 100,000 individuals.\n\n\n\nmortality_year = 2019 \nradix = 100000\n\nlt = \n    hmd_usa %&gt;% \n    demography::lifetable(.,series = \"total\", years = mortality_year) %&gt;% \n    as_tibble() %&gt;% \n    rename(age = x) %&gt;% \n    mutate_at(vars(lx,dx), function(x) x * radix)"
  },
  {
    "objectID": "slides/01_mortality.html#section-1",
    "href": "slides/01_mortality.html#section-1",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Name\nModel\nCode\n\n\n\n\nOld-age mortality\n\n\nVan der Maen\n$mu[x] = A + Bx + I/[N - x]$\nvandermaen2\n\n\nQuadratic\n$mu[x] = A + Bx + Cx^2$\nquadratic\n\n\nKannisto\n$mu[x] = A exp(Bx) / [1 + A exp(Bx)]$\nkannisto\n\n\nKannisto-Makeham\n$mu[x] = A exp(Bx) / [1 + A exp(Bx)] + C$\nkannisto_makeham"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-4",
    "href": "slides/01_mortality.html#life-expectancy-4",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\nDefine a function for cycle adjustment.1\n\n\n\n# Define the payoff for life expectancy\npayoff_life_exp = c(\"Alive\" = 1, \"Dead\" = 0)\n\n# Calculate alive years in each cycle\nlife_exp_cycle = (trace[[1]] * (1 / params$n_cohort)) %*% payoff_life_exp\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_life_exp = cycle_adj(life_exp_cycle)\n\nWe use the alternative Simpson’s method here, but you could also use a half-cycle or other correction type."
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-5",
    "href": "slides/01_mortality.html#life-expectancy-5",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\nSum of values (with cycle adjustment applied) is total life expectancy.\n\n\n\n# Define the payoff for life expectancy\npayoff_life_exp = c(\"Alive\" = 1, \"Dead\" = 0)\n\n# Calculate alive years in each cycle\nlife_exp_cycle = (trace[[1]] * (1 / params$n_cohort)) %*% payoff_life_exp\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_life_exp = cycle_adj(life_exp_cycle)"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-6",
    "href": "slides/01_mortality.html#life-expectancy-6",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy\n\n\n\n\n\nAge\nLife Expectancy (Life Table data)\nLife Expectancy (Markov-Life Table)\n\n\n\n\n0\n78.963\n78.924\n\n\n\n\n\n\n\n\nWe can repeat this exercise for different cohort starting ages and verify things line up."
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-7",
    "href": "slides/01_mortality.html#life-expectancy-7",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy",
    "text": "Life Expectancy"
  },
  {
    "objectID": "slides/01_mortality.html#mortality-modeling-1",
    "href": "slides/01_mortality.html#mortality-modeling-1",
    "title": "1. Coping with Mortality",
    "section": "Mortality Modeling",
    "text": "Mortality Modeling\n\nDepending on context and modeling environment, you may need to model mortality.\nThe MortalityLaws package has a number of mortality models we can draw from:"
  },
  {
    "objectID": "slides/01_mortality.html#mortality-modeling-2",
    "href": "slides/01_mortality.html#mortality-modeling-2",
    "title": "1. Coping with Mortality",
    "section": "Mortality Modeling",
    "text": "Mortality Modeling\n\n\n\nMortality Models in MortalityLaws package \n\n\nName\nModel\nCode\n\n\n\n\nInfant mortality\n\n\nOpperman\n$mu[x] = A/sqrt(x) - B + C*sqrt(x)$\nopperman\n\n\nWeibull\n$mu[x] = 1/sigma * (x/M)^{(M/sigma - 1)}$\nweibull\n\n\nAccident hump\n\n\nInverse-Gompertz\n$mu[x] = [1- exp(-(x-M)/sigma)] / [exp(-(x-M)/sigma) - 1]$\ninvgompertz\n\n\nInverse-Weibull\n$mu[x] = 1/sigma * (x/M)^{[-M/sigma - 1]} / [exp((x/M)^{(-M/sigma)}) - 1]$\ninvweibull"
  },
  {
    "objectID": "slides/01_mortality.html#section-2",
    "href": "slides/01_mortality.html#section-2",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Name\nModel\nCode\n\n\n\n\nFull age range\n\n\nThiele\n$mu[x] = A exp(-Bx) + C exp[-.5D (x-E)^2] + F exp(Gx)$\nthiele\n\n\nWittstein\n$q[x] = (1/B) A^{-[(Bx)^N]} + A^{-[(M-x)^N]}$\nwittstein\n\n\nHeligman-Pollard\n$q[x]/p[x] = A^{[(x + B)^C]} + D exp[-E log(x/F)^2] + G H^x$\nHP\n\n\nHeligman-Pollard\n$q[x] = A^{[(x + B)^C]} + D exp[-E log(x/F)^2] + GH^x / [1 + GH^x]$\nHP2\n\n\nRogers-Planck\n$q[x] = A0 + A1 exp[-Ax] + A2 exp[B(x - u) - exp(-C(x - u))] + A3 exp[Dx]$\nrogersplanck\n\n\nMartinelle\n$mu[x] = [A exp(Bx) + C] / [1 + D exp(Bx)] + K exp(Bx)$\nmartinelle\n\n\nCarriere\n$l[x] = P1 l[x](weibull) + P2 l[x](invweibull) + P3 l[x](gompertz)$\ncarriere1\n\n\nKostaki\n$q[x]/p[x] = A^{[(x+B)^C]} + D exp[-(E_i log(x/F_))^2] + G H^x$\nkostaki"
  },
  {
    "objectID": "slides/01_mortality.html#section-3",
    "href": "slides/01_mortality.html#section-3",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "We extract the percentage of overall deaths that are from CVD by age bin:\n\nihme_cvd &lt;- \n  tibble::tribble(\n        ~age_name,        ~val,\n               1, 0.038771524,\n               5, 0.038546046,\n              10, 0.044403585,\n              15, 0.033781126,\n              20, 0.035856165,\n              25, 0.053077797,\n              30, 0.086001439,\n              35, 0.130326551,\n              40, 0.184310334,\n              45,  0.21839762,\n              50, 0.243705394,\n              55, 0.256334637,\n              60,  0.26828001,\n              65, 0.272698709,\n              70,  0.28529754,\n              75, 0.310642009,\n               0, 0.016750489,\n              80, 0.353518012,\n              85, 0.399856716,\n              90, 0.447817792,\n              95, 0.495305502\n        ) %&gt;% \n    mutate(age_ihme = cut(age_name,unique(c(0,1,seq(0,95,5),105)),right=FALSE))  %&gt;% \n    select(age_ihme,  pct_cvd = val)"
  },
  {
    "objectID": "slides/01_mortality.html#mortality-modeling-3",
    "href": "slides/01_mortality.html#mortality-modeling-3",
    "title": "1. Coping with Mortality",
    "section": "Mortality Modeling",
    "text": "Mortality Modeling\n\nAnother nice feature of the package is that each mortality model type has its own defined function to calculate the mortality rate (or probability) given an age and model coefficients."
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model",
    "href": "slides/01_mortality.html#gompertz-model",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\nBecause we want to stay general (i.e., model all over the age spectrum), our first attempt will be a Gompertz model.\nGompertz reduces mortality to two parameters."
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-1",
    "href": "slides/01_mortality.html#gompertz-model-1",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\nages     &lt;- lt$age[lt$age&lt;100]\ndeaths   &lt;- lt$dx[lt$age&lt;100]\nexposure &lt;- lt$lx[lt$age&lt;100]\n\ngom_fit &lt;- MortalityLaw(\n    x  = ages,      # vector with ages\n    Dx  = deaths,   # vector with death counts\n    Ex  = exposure, # vector containing exposures\n    law = \"gompertz\",\n    opt.method = \"LF2\")"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-2",
    "href": "slides/01_mortality.html#gompertz-model-2",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Fitted coefficients\ngom_fit$coefficients\n\n         A          B \n0.00010772 0.07534542"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-40-year-old-cohort",
    "href": "slides/01_mortality.html#gompertz-model-40-year-old-cohort",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model: 40 Year Old Cohort",
    "text": "Gompertz Model: 40 Year Old Cohort\n\nages     &lt;- lt$age[lt$age&gt;=40 & lt$age&lt;100]\ndeaths   &lt;- lt$dx[lt$age&gt;=40 & lt$age&lt;100]\nexposure &lt;- lt$lx[lt$age&gt;=40 & lt$age&lt;100]\n\ngom_fit40 &lt;- MortalityLaw(\n                x  = ages,      # vector with ages\n                Dx  = deaths,   # vector with death counts\n                Ex  = exposure, # vector containing exposures\n                law = \"gompertz\",\n                opt.method = \"LF2\")"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-3",
    "href": "slides/01_mortality.html#gompertz-model-3",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Fitted coefficients\ngom_fit$coefficients\n\n         A          B \n0.00010772 0.07534542 \n\n# Hazard rate of death for a 40 year old based on Gompertz model\n# mx = A exp(Bx)\ngom_fit$coefficients[\"A\"] * exp(gom_fit$coefficients[\"B\"] * 40 )\n\n        A \n0.0021938"
  },
  {
    "objectID": "slides/01_mortality.html#heligman-pollard",
    "href": "slides/01_mortality.html#heligman-pollard",
    "title": "1. Coping with Mortality",
    "section": "Heligman-Pollard",
    "text": "Heligman-Pollard\n\nWhile you could draw from any of the aforementioned mortality models, the Heligman-Pollard model tends to fit the entire age distribution reasonably well.\nEasy to use: just use HP in lieu of gompertz!"
  },
  {
    "objectID": "slides/01_mortality.html#heligman-pollard-1",
    "href": "slides/01_mortality.html#heligman-pollard-1",
    "title": "1. Coping with Mortality",
    "section": "Heligman-Pollard",
    "text": "Heligman-Pollard\n\n\nWhile you could draw from any of the aforementioned mortality models, the Heligman-Pollard model tends to fit the entire age distribution reasonably well.\nEasy to use: just use HP in lieu of gompertz!\n\n\n\nages     &lt;- lt$age[lt$age&lt;100]\ndeaths   &lt;- lt$dx[lt$age&lt;100]\nexposure &lt;- lt$lx[lt$age&lt;100]\n\nhp_fit &lt;- MortalityLaw(\n                x  = ages,      # vector with ages\n                Dx  = deaths,   # vector with death counts\n                Ex  = exposure, # vector containing exposures\n                law = \"HP\",\n                opt.method = \"LF2\")"
  },
  {
    "objectID": "slides/01_mortality.html#section-4",
    "href": "slides/01_mortality.html#section-4",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Merge these percentages into the underlying life table data and use them to calculate the total number of CVD deaths by age:\n\n\n\n\n\nage\nage_ihme\npct_cvd\ndx\ndx_i\n\n\n\n\n0\n[0,1)\n0.01675\n553.221\n9\n\n\n10\n[10,15)\n0.04440\n11.518\n1\n\n\n25\n[25,30)\n0.05308\n103.706\n6\n\n\n50\n[50,55)\n0.24371\n365.721\n89\n\n\n75\n[75,80)\n0.31064\n1997.766\n621\n\n\n98\n[95,105)\n0.49531\n1262.593\n625"
  },
  {
    "objectID": "slides/01_mortality.html#construct-the-markov-trace-2",
    "href": "slides/01_mortality.html#construct-the-markov-trace-2",
    "title": "1. Coping with Mortality",
    "section": "Construct the Markov Trace",
    "text": "Construct the Markov Trace\n\n\nOutput: named list object with full Markov trace for each strategy.\n\n\n\ntrace &lt;- \n  sim_cohort(params)\ntrace[[\"lifetable\"]][1:10,]\n\n   Alive   Dead\n0 100000   0.00\n1  99447 553.22\n2  99409 591.40\n3  99385 614.56\n4  99368 632.25\n5  99354 646.46\n6  99340 659.67\n7  99328 671.69\n8  99317 682.52\n9  99307 693.14"
  },
  {
    "objectID": "slides/01_mortality.html#mortality-modeling-4",
    "href": "slides/01_mortality.html#mortality-modeling-4",
    "title": "1. Coping with Mortality",
    "section": "Mortality Modeling",
    "text": "Mortality Modeling\nGenerally speaking, we need three inputs:\n\nage: Ages for lifetable\ndx: The number of deaths between exact ages x and x+1.\nlx: Number of survivors to exact age x."
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-4",
    "href": "slides/01_mortality.html#gompertz-model-4",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Fitted coefficients\ngom_fit$coefficients\n\n         A          B \n0.00010772 0.07534542 \n\n# Hazard rate of death for a 40 year old based on Gompertz model\n# mx = A exp(Bx)\ngom_fit$coefficients[\"A\"] * exp(gom_fit$coefficients[\"B\"] * 40 )\n\n        A \n0.0021938 \n\n# Can simply use the supplied function to calcualte \nMortalityLaws::gompertz(x = 40, par = gom_fit$coefficients)\n\n$hx\n[1] 0.0021938\n\n$par\n         A          B \n0.00010772 0.07534542 \n\n$Sx\n[1] 0.97269"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-5",
    "href": "slides/01_mortality.html#gompertz-model-5",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Calculate death hazard rate at age 40 from fitted Gompertz model. \nmx = gom_fit$coefficients[\"A\"] * exp(gom_fit$coefficients[\"B\"] * 40 )"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-6",
    "href": "slides/01_mortality.html#gompertz-model-6",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Calculate death hazard rate at age 40 from fitted Gompertz model. \nmx = gom_fit$coefficients[\"A\"] * exp(gom_fit$coefficients[\"B\"] * 40 )\n\n# Convert mortality rate to probability\n-log(1-mx)\n\n        A \n0.0021962"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-7",
    "href": "slides/01_mortality.html#gompertz-model-7",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n# Calculate death hazard rate at age 40 from fitted Gompertz model. \nmx = gom_fit$coefficients[\"A\"] * exp(gom_fit$coefficients[\"B\"] * 40 )\n\n# Convert mortality rate to probability\n-log(1-mx)\n\n        A \n0.0021962 \n\n# Compare with life table probability (qx) at age 40:\nlt[41,c(\"age\",\"qx\")] \n\n# A tibble: 1 × 2\n    age      qx\n  &lt;dbl&gt;   &lt;dbl&gt;\n1    40 0.00208"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-8",
    "href": "slides/01_mortality.html#gompertz-model-8",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\nGompertz doesn’t fit all age ranges well—particularly young ages.\n(This is a well-known fact in demography.)\nIf we were to focus only on adults, however, this would be a nice way to go."
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-40-year-old-cohort-1",
    "href": "slides/01_mortality.html#gompertz-model-40-year-old-cohort-1",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model: 40 Year Old Cohort",
    "text": "Gompertz Model: 40 Year Old Cohort\n\nplot(gom_fit40)"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-9",
    "href": "slides/01_mortality.html#gompertz-model-9",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\nplot(gom_fit)"
  },
  {
    "objectID": "slides/01_mortality.html#gompertz-model-10",
    "href": "slides/01_mortality.html#gompertz-model-10",
    "title": "1. Coping with Mortality",
    "section": "Gompertz Model",
    "text": "Gompertz Model\n\n\nIf we were to focus only on adults, however, this would be a nice way to go."
  },
  {
    "objectID": "slides/01_mortality.html#heligman-pollard-2",
    "href": "slides/01_mortality.html#heligman-pollard-2",
    "title": "1. Coping with Mortality",
    "section": "Heligman-Pollard",
    "text": "Heligman-Pollard\n\nplot(hp_fit)"
  },
  {
    "objectID": "slides/01_mortality.html#heligman-pollard-3",
    "href": "slides/01_mortality.html#heligman-pollard-3",
    "title": "1. Coping with Mortality",
    "section": "Heligman-Pollard",
    "text": "Heligman-Pollard\nMortality rate for a 40 year old:\n\nHP(x = 40, par = hp_fit$coefficients)\n\n$hx\n[1] 0.0020409\n\n$par\n           A            B            C            D            E           F_ \n 0.000386408  0.021271772  0.107422357  0.001025285  2.871760263 33.201213579 \n           G            H \n 0.000022277  1.102611045 \n\n\n\nx   = 40\nmu1 = A^((x + B)^C) + G * H^x)\nmu2 = D * exp(-E * (log(x/F_))^2))\neta = ifelse(x == 0, mu1, mu1 + mu2)\nhx  = eta/(1 + eta)"
  },
  {
    "objectID": "slides/01_mortality.html#heligman-pollard-4",
    "href": "slides/01_mortality.html#heligman-pollard-4",
    "title": "1. Coping with Mortality",
    "section": "Heligman-Pollard",
    "text": "Heligman-Pollard\n\ngompertz(x = 40, par = gom_fit$coefficients)$hx\n\n[1] 0.0021938\n\nHP(x = 40, par = hp_fit$coefficients)$hx\n\n[1] 0.0020409"
  },
  {
    "objectID": "slides/01_mortality.html#well-approach-this-from-two-angles",
    "href": "slides/01_mortality.html#well-approach-this-from-two-angles",
    "title": "1. Coping with Mortality",
    "section": "We’ll Approach This From Two Angles",
    "text": "We’ll Approach This From Two Angles\n\nDiscrete Event Simulation: Sample a background mortality time.\nDiscrete Time Markov: Use parameterized mortality in Alive-Dead model."
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-dates-des",
    "href": "slides/01_mortality.html#sampling-death-dates-des",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Dates (DES)",
    "text": "1. Sampling Death Dates (DES)\n\nDifficult to sample death times from life tables due to coarseness of data (e.g., five-year age bins).\nSolution:\n\nFit a parametric mortality model (e.g., Heligman-Pollard)\nConstruct a survival function from modeled hazards.\nSample a death time from the survival function."
  },
  {
    "objectID": "slides/01_mortality.html#median-survival",
    "href": "slides/01_mortality.html#median-survival",
    "title": "1. Coping with Mortality",
    "section": "Median Survival",
    "text": "Median Survival\n\n\n[1] 70.467\n\n\n[1] 71.069\n\n\n[1] 71\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des",
    "href": "slides/01_mortality.html#sampling-death-rates-des",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\nIntuition is easier if we start with a defined quantile (e.g., 25th percentile of survival)"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-1",
    "href": "slides/01_mortality.html#sampling-death-rates-des-1",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\n\nIntuition is easier if we start with a defined quantile (e.g., 25th percentile of survival)\n\n\n\nu = 0.25"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-2",
    "href": "slides/01_mortality.html#sampling-death-rates-des-2",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\n\nWe can feed the quantile (0.25) and coefficients into an inverse quantile function.\nStraightforward to do for Gompertz model\n\n\n\nu = 0.25\nqgompertz(p = u, shape = gom_fit$coefficients[\"B\"], rate = gom_fit$coefficients[\"A\"])\n\n[1] 70.467"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-3",
    "href": "slides/01_mortality.html#sampling-death-rates-des-3",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\n\nLet’s verify this gets us close to what we see in the life table data.\n\n\n\nu = 0.25\nqgompertz(p = u, shape = gom_fit$coefficients[\"B\"], rate = gom_fit$coefficients[\"A\"])\n\n[1] 70.467\n\n\n\n\n\n\n\nage\nmx\nSx\n\n\n\n\n70\n0.01827\n0.76590\n\n\n71\n0.01995\n0.75077\n\n\n72\n0.02162\n0.73472"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-desth-rates-des",
    "href": "slides/01_mortality.html#sampling-desth-rates-des",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Desth Rates (DES)",
    "text": "1. Sampling Desth Rates (DES)\n\nWe now have the tools we need to sample death times that closely match underlying mortality data!\nFor a given simulated patient, sample a uniform (0,1) and feed this number into the inverse quantile function."
  },
  {
    "objectID": "slides/01_mortality.html#sampling-desth-rates-des-1",
    "href": "slides/01_mortality.html#sampling-desth-rates-des-1",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Desth Rates (DES)",
    "text": "1. Sampling Desth Rates (DES)\n\n\nWe now have the tools we need to sample death times that closely match underlying mortality data!\nFor a given simulated patient, sample a uniform (0,1) and feed this number into the inverse quantile function.\n\n\n\n# Sample death times for 10 individuals\nu &lt;- runif(10, min = 0, max = 1)\nqHP &lt;- \n  approxfun(y = 0:115,\n  x = 1 - exp(-cumsum(HP(x = 0:115, par = hp_fit$coefficients)$hx)))\nqHP(u)\n\n [1]  87.961  96.594  76.346  77.580  52.578  79.897  80.674  77.385  69.524\n[10] 100.034\n\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-4",
    "href": "slides/01_mortality.html#sampling-death-rates-des-4",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\nThere is no inverse quantile function for Heligman-Pollard, but we can create one!"
  },
  {
    "objectID": "slides/01_mortality.html#modeled-mortality-markov",
    "href": "slides/01_mortality.html#modeled-mortality-markov",
    "title": "1. Coping with Mortality",
    "section": "2. Modeled Mortality (Markov)",
    "text": "2. Modeled Mortality (Markov)\n\nLet’s now incorporate modeled mortality parameters into our Alive-Dead model.\nRather than draw a probability of death from the life table data, we’ll calculate the probability of death at a given age using the model coefficients."
  },
  {
    "objectID": "slides/01_mortality.html#parameterize-the-model-4",
    "href": "slides/01_mortality.html#parameterize-the-model-4",
    "title": "1. Coping with Mortality",
    "section": "Parameterize the model",
    "text": "Parameterize the model\n\nparams = \n  list(\n    t_names = c(\"lifetable\",          # Strategy names\n                \"heligman-pollard\",\n                \"gompertz\"),          \n    n_treatments = 3,                 # Number of treatments\n    s_names  = c(\"Alive\", \"Dead\"),    # State names\n    n_states = 2,                     # Number of states\n    n_cohort = 100000,                # Cohort size\n    initial_age = 40,                 # Cohort starting age    \n    n_cycles = 110,                   # Number of cycles in model.  \n    cycle = 1,                        # Cycle length\n    life_table = lt,                  # Processed HMD life table data (2019, USA)\n    gom_fit = gom_fit,                # Fitted Gompertz model object\n    hp_fit = hp_fit                   # Fitted Heligman-Pollard model object\n  )"
  },
  {
    "objectID": "slides/01_mortality.html#the-big-picture",
    "href": "slides/01_mortality.html#the-big-picture",
    "title": "1. Coping with Mortality",
    "section": "The Big Picture",
    "text": "The Big Picture\n\nDecision thresholds methods, e.g. ICER, NMB, NHB all involve comparing a model run versus a reference run of the same model.\nFor example, a model of \\(f_{cost}\\) and \\(f_{qaly}\\) are run versus \\(\\theta_{ref}\\) and \\(\\theta_{target}\\).\nThese runs will have error due to misspecification, and in differencing the error can mostly cancel. Let \\(g\\) represent the truth, thus \\(f(\\theta) = g(\\theta)+\\epsilon_{theta}\\)."
  },
  {
    "objectID": "slides/01_mortality.html#the-hopeful-big-picture",
    "href": "slides/01_mortality.html#the-hopeful-big-picture",
    "title": "1. Coping with Mortality",
    "section": "The Hopeful Big Picture",
    "text": "The Hopeful Big Picture\n\\[\\text{ICER} = \\frac{f_{cost}(\\theta_{target}) - \\epsilon_{ct} - f_{cost}(\\theta_{ref}) + \\epsilon_{cr}}{f_{qaly}(\\theta_{target}) - \\epsilon_{qt} - f_{qaly}(\\theta_{ref}) + \\epsilon_{qr}}\\]\n\nIf \\(\\epsilon_{ct} \\sim \\epsilon_{cr}\\) and \\(\\epsilon_{qt} \\sim \\epsilon_{qr}\\) then the model errors cancel and this approaches the true model.\nThe decision threshold is robust in this case even when model run results are biased!\nWe will explore this perodically today."
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-5",
    "href": "slides/01_mortality.html#sampling-death-rates-des-5",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\n\nThere is no inverse quantile function for Heligman-Pollard, but we can create one!\nApproxfun returns a function that provides a value of y for a given value of x.\n\n\n\nqHP &lt;- \n  approxfun(y = 0:115,\n            x = 1 - exp(-cumsum(HP(x = 0:115, par = hp_fit$coefficients)$hx)))"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-6",
    "href": "slides/01_mortality.html#sampling-death-rates-des-6",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\nFor approxfun():\n\nx is quantile in CDF for survival, i.e., 1 - Survival1\ny is the age.\n\nSo qHP(0.5) would return median survival age in the modeled data.\n\nRecall that survival is \\(\\exp(-H)\\), where \\(H\\) is the cumulative hazard"
  },
  {
    "objectID": "slides/01_mortality.html#age-dependent-transition-matrices",
    "href": "slides/01_mortality.html#age-dependent-transition-matrices",
    "title": "1. Coping with Mortality",
    "section": "Age-Dependent Transition Matrices",
    "text": "Age-Dependent Transition Matrices\n\nfn_mPt &lt;- function(t, params) {\n  with(params, {\n    h = cycle # Time step\n    lapply(t, function(tt){\n       # Life table method\n        current_age_lt = pmin(initial_age  + (tt)*h - 1,max(lt$age))\n        p_death &lt;- lt[lt$age==current_age_lt,\"qx\"]\n        # parametric mortality methods\n        current_age = initial_age  + (tt)*h - 1\n        r_death_gompertz &lt;- gompertz(current_age,params$gom_fit$coefficients)$hx\n        p_death_gompertz &lt;- 1 - exp(-r_death_gompertz)\n        r_death_hp &lt;- HP(current_age, params$hp_fit$coefficients)$hx\n        p_death_hp &lt;- 1 - exp(-r_death_hp)\n        \n        array(data = c(1 - p_death, 0, \n                 p_death,1,\n                 \n                 1 - p_death_hp, 0, \n                 p_death_hp,1,\n                 \n                1 - p_death_gompertz, 0, \n                 p_death_gompertz,1),\n              \n              dim = c(n_states, n_states, n_treatments),\n              dimnames = list(from = s_names,\n                              to = s_names,\n                              t_names)) \n    })\n  })\n}"
  },
  {
    "objectID": "slides/01_mortality.html#construct-a-markov-trace",
    "href": "slides/01_mortality.html#construct-a-markov-trace",
    "title": "1. Coping with Mortality",
    "section": "Construct a Markov Trace",
    "text": "Construct a Markov Trace\n\n# Add transition matrices into params.\nparams$mP &lt;- \n  fn_mPt(1:params$n_cycles, params)\n\n# Construct the Markov trace. \ntrace &lt;- \n  sim_cohort(params)"
  },
  {
    "objectID": "slides/01_mortality.html#motivation-cause-deleted-mortality",
    "href": "slides/01_mortality.html#motivation-cause-deleted-mortality",
    "title": "1. Coping with Mortality",
    "section": "Motivation: Cause-Deleted Mortality",
    "text": "Motivation: Cause-Deleted Mortality\n\nOften, background mortality is drawn directly from life table data.\nModels also frequently include cause-specific death as a separate tracked event or health state."
  },
  {
    "objectID": "slides/01_mortality.html#motivation-cause-deleted-mortality-1",
    "href": "slides/01_mortality.html#motivation-cause-deleted-mortality-1",
    "title": "1. Coping with Mortality",
    "section": "Motivation: Cause-Deleted Mortality",
    "text": "Motivation: Cause-Deleted Mortality\n\nThis approach “double-counts” death because cause-specific death is also reflected in the life table estimates!\nOK if cause-specific death is a small contributor to overall death rates.\nBut what if modeled disease is a frequent cause of death (e.g., cardiovascular disease, cancer)?"
  },
  {
    "objectID": "slides/01_mortality.html#soluation-cause-deleted-life-table",
    "href": "slides/01_mortality.html#soluation-cause-deleted-life-table",
    "title": "1. Coping with Mortality",
    "section": "Soluation: Cause-Deleted Life Table",
    "text": "Soluation: Cause-Deleted Life Table\n\nWe can construct an alternative life table that “nets out” cause-specific deaths.\nNot foolproof: need to make an assumption that we can parse out deaths as indepdendent contributors to overall mortality."
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-mortality",
    "href": "slides/01_mortality.html#cvd-deleted-mortality",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Mortality",
    "text": "CVD-Deleted Mortality\n\nWe’ll next show you the process of constructing a cause-deleted life table.\nBasis for example is cardiovascular disease (CVD), which at older ages is a substantial contributor (~50%) of overall mortality.\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#solution-cause-deleted-life-table",
    "href": "slides/01_mortality.html#solution-cause-deleted-life-table",
    "title": "1. Coping with Mortality",
    "section": "Solution: Cause-Deleted Life Table",
    "text": "Solution: Cause-Deleted Life Table\n\nWe can construct an alternative life table that “nets out” cause-specific deaths.\nNot foolproof: need to make an assumption that we can parse out deaths as indepdendent contributors to overall mortality."
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-tables",
    "href": "slides/01_mortality.html#cvd-deleted-life-tables",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Tables",
    "text": "CVD-Deleted Life Tables\n\nWe’ll next show you the process of constructing a cause-deleted life table.\nBasis for example is cardiovascular disease (CVD), which at older ages is a substantial contributor (~50%) of overall mortality."
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-tables-1",
    "href": "slides/01_mortality.html#cvd-deleted-life-tables-1",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Tables",
    "text": "CVD-Deleted Life Tables\nConstructing the cause-deleted life table will provide two necessary inputs:\n\nOverall mortality by age.\nCVD-specific mortality by age (ideally as a % of all deaths at a given age)"
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-tables-2",
    "href": "slides/01_mortality.html#cvd-deleted-life-tables-2",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Tables",
    "text": "CVD-Deleted Life Tables\n\n\nOur estimates of CVD death by age will be drawn from the Global Burden of Disease website.\n\n\n\n\n\nScreenshot of Global Burden of Disease Data"
  },
  {
    "objectID": "slides/01_mortality.html#section-5",
    "href": "slides/01_mortality.html#section-5",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "We next calculate the cause-deleted probability of death (qd) and death rate (md), as well as the cause-specific probability of death (qi) and death rate (mi):"
  },
  {
    "objectID": "slides/01_mortality.html#section-6",
    "href": "slides/01_mortality.html#section-6",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "age\ndx\ndxd\ndx_i\nq\nqi\nmd\nmi\n\n\n\n\n0\n553.221\n544.221\n9\n0.00553\n0.00009\n0.00546\n0.00009\n\n\n1\n38.180\n37.180\n1\n0.00038\n0.00001\n0.00037\n0.00001\n\n\n2\n23.160\n22.160\n1\n0.00023\n0.00001\n0.00022\n0.00001\n\n\n3\n17.689\n16.689\n1\n0.00018\n0.00001\n0.00017\n0.00001\n\n\n4\n14.209\n13.209\n1\n0.00014\n0.00001\n0.00013\n0.00001\n\n\n5\n13.213\n12.213\n1\n0.00013\n0.00001\n0.00012\n0.00001"
  },
  {
    "objectID": "slides/01_mortality.html#section-7",
    "href": "slides/01_mortality.html#section-7",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Back to Website"
  },
  {
    "objectID": "slides/01_mortality.html#section-8",
    "href": "slides/01_mortality.html#section-8",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Back to Website"
  },
  {
    "objectID": "slides/01_mortality.html#section-9",
    "href": "slides/01_mortality.html#section-9",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Back to Website"
  },
  {
    "objectID": "slides/01_mortality.html#modeling-cvd-deleted-mortality",
    "href": "slides/01_mortality.html#modeling-cvd-deleted-mortality",
    "title": "1. Coping with Mortality",
    "section": "Modeling CVD-Deleted Mortality",
    "text": "Modeling CVD-Deleted Mortality\n\nWe can also apply the methods covered earlier to the cause-deleted life table data!\n\n\nages_     &lt;- lt_$age[lt_$age&lt;100 & lt_$age&gt;=25]\ndeaths_   &lt;- lt_$dxd[lt_$age&lt;100 & lt_$age&gt;=25] \nexposure_  &lt;- lt_$lx[lt_$age&lt;100 & lt_$age&gt;=25]\n\nmort_fit_CVDdeleted &lt;- MortalityLaw(\n    x  = ages_,\n    Dx  = deaths_,   # vector with death counts\n    Ex  = exposure_, # vector containing exposures\n    law = \"HP2\",\n    opt.method = \"LF2\")"
  },
  {
    "objectID": "slides/01_mortality.html#section-10",
    "href": "slides/01_mortality.html#section-10",
    "title": "1. Coping with Mortality",
    "section": "",
    "text": "Back to Website"
  },
  {
    "objectID": "slides/00_welcome-and-intros.html#learning-objectives",
    "href": "slides/00_welcome-and-intros.html#learning-objectives",
    "title": "Welcome and Introductions",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nUnderlying robust property of decision modeling.\nUnderstand options for modeling background mortality based on life tables and parametric mortality models.\nConstruct a cause-deleted life table to model cause-specific and non-cause-specific death."
  },
  {
    "objectID": "slides/00_welcome-and-intros.html#the-big-picture",
    "href": "slides/00_welcome-and-intros.html#the-big-picture",
    "title": "Welcome and Introductions",
    "section": "The Big Picture",
    "text": "The Big Picture\n\nDecision thresholds methods, e.g. ICER, NMB, NHB all involve comparing a model run versus a reference run of the same model.\nFor example, a model of \\(f_{cost}\\) and \\(f_{qaly}\\) are run versus \\(\\theta_{ref}\\) and \\(\\theta_{target}\\).\nThese runs will have error due to misspecification, and in differencing the error can mostly cancel. Let \\(g\\) represent the truth, thus \\(f(\\theta) = g(\\theta)+\\epsilon_{theta}\\)."
  },
  {
    "objectID": "slides/00_welcome-and-intros.html#the-hopeful-big-picture",
    "href": "slides/00_welcome-and-intros.html#the-hopeful-big-picture",
    "title": "Welcome and Introductions",
    "section": "The Hopeful Big Picture",
    "text": "The Hopeful Big Picture\n\\[\\text{ICER} = \\frac{f_{cost}(\\theta_{target}) - \\epsilon_{ct} - f_{cost}(\\theta_{ref}) + \\epsilon_{cr}}{f_{qaly}(\\theta_{target}) - \\epsilon_{qt} - f_{qaly}(\\theta_{ref}) + \\epsilon_{qr}}\\]\n\nIf \\(\\epsilon_{ct} \\sim \\epsilon_{cr}\\) and \\(\\epsilon_{qt} \\sim \\epsilon_{qr}\\) then the model errors cancel and this approaches the true model.\nThe decision threshold is robust in this case even when model run results are biased!\nWe will explore this perodically today.\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/01_mortality.html#us-life-table-2019",
    "href": "slides/01_mortality.html#us-life-table-2019",
    "title": "1. Coping with Mortality",
    "section": "US Life Table (2019)",
    "text": "US Life Table (2019)\nHighlighted column: Remaining life expectancy at exact age x.\n\n\n\n\n\nage\nlx\ndx\nex\nqx\nmx\n\n\n\n\n0\n100000\n553.221\n78.963\n0.00553\n0.00556\n\n\n1\n99447\n38.180\n78.402\n0.00038\n0.00038\n\n\n2\n99409\n23.160\n77.432\n0.00023\n0.00023\n\n\n3\n99385\n17.689\n76.450\n0.00018\n0.00018"
  },
  {
    "objectID": "slides/01_mortality.html#death-hazard-at-age-40-gompertz-vs.-hp",
    "href": "slides/01_mortality.html#death-hazard-at-age-40-gompertz-vs.-hp",
    "title": "1. Coping with Mortality",
    "section": "Death Hazard at Age 40: Gompertz vs. HP",
    "text": "Death Hazard at Age 40: Gompertz vs. HP\n\ngompertz(x = 40, par = gom_fit$coefficients)$hx\n\n[1] 0.0021938\n\nHP(x = 40, par = hp_fit$coefficients)$hx\n\n[1] 0.0020409"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-7",
    "href": "slides/01_mortality.html#sampling-death-rates-des-7",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\nqHP &lt;- \n  approxfun(y = 0:115,\n            x = 1 - exp(-cumsum(HP(x = 0:115, par = hp_fit$coefficients)$hx)))\nqHP(0.25)\n\n[1] 71.069\n\n\nSurvival in life table:\n\n\n\n\n\nage\nmx\nSx\n\n\n\n\n70\n0.01827\n0.76590\n\n\n71\n0.01995\n0.75077\n\n\n72\n0.02162\n0.73472"
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-8",
    "href": "slides/01_mortality.html#sampling-death-rates-des-8",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\nWe now have the tools we need to sample death times that closely match underlying mortality data!\nFor a given simulated patient, sample a uniform (0,1) and feed this number into the inverse quantile function."
  },
  {
    "objectID": "slides/01_mortality.html#sampling-death-rates-des-9",
    "href": "slides/01_mortality.html#sampling-death-rates-des-9",
    "title": "1. Coping with Mortality",
    "section": "1. Sampling Death Rates (DES)",
    "text": "1. Sampling Death Rates (DES)\n\n\nWe now have the tools we need to sample death times that closely match underlying mortality data!\nFor a given simulated patient, sample a uniform (0,1) and feed this number into the inverse quantile function.\n\n\n\n# Sample death times for 10 individuals\nu &lt;- runif(10, min = 0, max = 1)\nqHP &lt;- \n  approxfun(y = 0:115,\n  x = 1 - exp(-cumsum(HP(x = 0:115, par = hp_fit$coefficients)$hx)))\nqHP(u)\n\n [1] 85.515 80.901 86.782 91.911 64.470 78.970 87.541 75.338 99.504 81.106"
  },
  {
    "objectID": "slides/01_mortality.html#life-expectancy-alive-dead-model",
    "href": "slides/01_mortality.html#life-expectancy-alive-dead-model",
    "title": "1. Coping with Mortality",
    "section": "Life Expectancy: Alive-Dead Model",
    "text": "Life Expectancy: Alive-Dead Model\n\ntotal_life_exp\n\n$lifetable\n[1] 40.959\n\n$`heligman-pollard`\n[1] 41.008\n\n$gompertz\n[1] 41.29"
  },
  {
    "objectID": "slides/01_mortality.html#motivation",
    "href": "slides/01_mortality.html#motivation",
    "title": "1. Coping with Mortality",
    "section": "Motivation",
    "text": "Motivation\n\nOften, background mortality is drawn directly from life table data.\nModels also frequently include cause-specific death as a separate tracked event or health state."
  },
  {
    "objectID": "slides/01_mortality.html#motivation-1",
    "href": "slides/01_mortality.html#motivation-1",
    "title": "1. Coping with Mortality",
    "section": "Motivation",
    "text": "Motivation\n\nThis approach “double-counts” death because cause-specific death is also reflected in the life table estimates!\nOK if cause-specific death is a small contributor to overall death rates.\nBut what if modeled disease is a frequent cause of death (e.g., cardiovascular disease, cancer)?"
  },
  {
    "objectID": "slides/01_mortality.html#solution",
    "href": "slides/01_mortality.html#solution",
    "title": "1. Coping with Mortality",
    "section": "Solution",
    "text": "Solution\n\nWe can construct an alternative life table that “nets out” cause-specific deaths.\nNot foolproof: need to make an assumption that we can parse out deaths as indepdendent contributors to overall mortality."
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-table",
    "href": "slides/01_mortality.html#cvd-deleted-life-table",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Table",
    "text": "CVD-Deleted Life Table\nConstructing the cause-deleted life table requires two necessary inputs:\n\nOverall mortality by age.\nCause-specific mortality by age (ideally as a % of all deaths at a given age).\n\n\nThese are obtainable for many countries from the Global Burden of Disease and Human Cause of Death Database websites."
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-table-1",
    "href": "slides/01_mortality.html#cvd-deleted-life-table-1",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Table",
    "text": "CVD-Deleted Life Table\n\n\nOur estimates of CVD death by age will be drawn from the Global Burden of Disease website.\n\n\n\n\n\nScreenshot of Global Burden of Disease Data"
  },
  {
    "objectID": "slides/01_mortality.html#cvd-deleted-life-table-2",
    "href": "slides/01_mortality.html#cvd-deleted-life-table-2",
    "title": "1. Coping with Mortality",
    "section": "CVD-Deleted Life Table",
    "text": "CVD-Deleted Life Table\n\n\nOur estimates of CVD death by age will be drawn from the Global Burden of Disease website.\n\n\n\n\n\nScreenshot of Global Burden of Disease Data"
  },
  {
    "objectID": "slides/01_mortality.html#construct-a-markov-trace-1",
    "href": "slides/01_mortality.html#construct-a-markov-trace-1",
    "title": "1. Coping with Mortality",
    "section": "Construct a Markov Trace",
    "text": "Construct a Markov Trace\n\n\n\ntrace[[\"lifetable\"]][1:10,]\n\n   Alive    Dead\n0 100000    0.00\n1  99792  207.68\n2  99584  416.43\n3  99365  634.88\n4  99138  861.67\n5  98899 1101.19\n6  98639 1361.45\n7  98358 1641.68\n8  98054 1945.62\n9  97728 2271.99\n\n\n\n\ntrace[[\"gompertz\"]][1:10,]\n\n   Alive    Dead\n0 100000    0.00\n1  99781  219.14\n2  99545  454.89\n3  99292  708.46\n4  99019  981.15\n5  98726 1274.35\n6  98410 1589.51\n7  98072 1928.21\n8  97708 2292.12\n9  97317 2682.98\n\n\n\n\ntrace[[\"heligman-pollard\"]][1:10,]\n\n   Alive    Dead\n0 100000    0.00\n1  99796  203.88\n2  99584  416.04\n3  99363  637.42\n4  99131  869.10\n5  98888 1112.31\n6  98632 1368.43\n7  98361 1639.00\n8  98074 1925.75\n9  97769 2230.56"
  },
  {
    "objectID": "slides/01_mortality.html#calculate-life-expectancy",
    "href": "slides/01_mortality.html#calculate-life-expectancy",
    "title": "1. Coping with Mortality",
    "section": "Calculate Life Expectancy",
    "text": "Calculate Life Expectancy\n\n# Define the payoff for life expectancy\npayoff_life_exp = c(\"Alive\" = 1, \"Dead\" = 0)\n\n# Calculate alive years in each cycle\nlife_exp_cycle = lapply(trace, function(tr) (tr * (1 / params$n_cohort)) %*% payoff_life_exp)\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_life_exp = lapply(life_exp_cycle,cycle_adj)"
  },
  {
    "objectID": "slides/01_mortality.html#steps",
    "href": "slides/01_mortality.html#steps",
    "title": "1. Coping with Mortality",
    "section": "Steps",
    "text": "Steps\n\nCause-specific probability of death (qi): \\(q \\cdot dx_i / dx\\)\nCacluate cause-specific rates by dividing deaths of a given cause into person-years of exposure.\n\n\nThis is equivalent to multiplying the overall rate by the ratio of deaths of a given cause to the total."
  },
  {
    "objectID": "slides/01_mortality.html#steps-1",
    "href": "slides/01_mortality.html#steps-1",
    "title": "1. Coping with Mortality",
    "section": "Steps",
    "text": "Steps\n\n\nCause-specific probability of death (qi): \\(q \\cdot dx_i / dx\\)\nCacluate cause-specific rates by dividing deaths of a given cause into person-years of exposure.\n\nThis is equivalent to multiplying the overall rate by the ratio of deaths of a given cause to the total.\n\n\n\n\nlt_ &lt;- \n  lt_ %&gt;% \n    # Cause specific probability of death. \n    mutate(qi = q * dx_i / dx) %&gt;% \n    mutate(Rd = (dx - dx_i) / dx) %&gt;% \n    mutate(md = m * Rd) %&gt;% \n    mutate(mi = m - md) %&gt;% \n    mutate(dxd = dx - dx_i)"
  },
  {
    "objectID": "slides/01_mortality.html#basic-cvd-model",
    "href": "slides/01_mortality.html#basic-cvd-model",
    "title": "1. Coping with Mortality",
    "section": "Basic CVD Model",
    "text": "Basic CVD Model\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD(t)   \n\nCVD-&gt;CVD\n\n    \n\nDead(CVD)\n\n Dead (CVD)   \n\nCVD-&gt;Dead(CVD)\n\n      r_DCVD(t)           \n\nCVD-&gt;Dead\n\n    r_HD(t)   \n\nDead(CVD)-&gt;Dead(CVD)\n\n    \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/01_mortality.html#basic-cvd-model-1",
    "href": "slides/01_mortality.html#basic-cvd-model-1",
    "title": "1. Coping with Mortality",
    "section": "Basic CVD Model",
    "text": "Basic CVD Model\n\n\nHealthy  Death based on modeled (Heligman-Pollard) cause-deleted mortality.\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD(t)   \n\nCVD-&gt;CVD\n\n    \n\nDead(CVD)\n\n Dead (CVD)   \n\nCVD-&gt;Dead(CVD)\n\n      r_DCVD(t)           \n\nCVD-&gt;Dead\n\n    r_HD(t)   \n\nDead(CVD)-&gt;Dead(CVD)\n\n    \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/01_mortality.html#basic-cvd-model-2",
    "href": "slides/01_mortality.html#basic-cvd-model-2",
    "title": "1. Coping with Mortality",
    "section": "Basic CVD Model",
    "text": "Basic CVD Model\n\n\nCVD  Death based on age- and cause-specific death rates from cause-deleted life table.\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD(t)   \n\nCVD-&gt;CVD\n\n    \n\nDead(CVD)\n\n Dead (CVD)   \n\nCVD-&gt;Dead(CVD)\n\n      r_DCVD(t)           \n\nCVD-&gt;Dead\n\n    r_HD(t)   \n\nDead(CVD)-&gt;Dead(CVD)\n\n    \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/01_mortality.html#age-dependent-transition-matrices-1",
    "href": "slides/01_mortality.html#age-dependent-transition-matrices-1",
    "title": "1. Coping with Mortality",
    "section": "Age-Dependent Transition Matrices",
    "text": "Age-Dependent Transition Matrices"
  },
  {
    "objectID": "slides/01_mortality.html#basic-cvd-model-3",
    "href": "slides/01_mortality.html#basic-cvd-model-3",
    "title": "1. Coping with Mortality",
    "section": "Basic CVD Model",
    "text": "Basic CVD Model\n\n\nWe also allow for a CVD  Death transition based on non-CVD causes.\n\n\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_HS   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD(t)   \n\nCVD-&gt;CVD\n\n    \n\nDead(CVD)\n\n Dead (CVD)   \n\nCVD-&gt;Dead(CVD)\n\n      r_DCVD(t)           \n\nCVD-&gt;Dead\n\n    r_HD(t)   \n\nDead(CVD)-&gt;Dead(CVD)\n\n    \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/01_mortality.html#construct-a-markov-trace-2",
    "href": "slides/01_mortality.html#construct-a-markov-trace-2",
    "title": "1. Coping with Mortality",
    "section": "Construct a Markov Trace",
    "text": "Construct a Markov Trace\n\ntrace &lt;- \n  sim_cohort(params)\ntrace[[\"natural_history\"]][1:10,]\n\n  Healthy     CVD CVDDeath    Dead\n0  100000     0.0   0.0000    0.00\n1   90391  9506.2   0.2945  103.00\n2   81702 18088.0   1.1404  208.58\n3   73847 25833.6   2.4853  316.88\n4   66745 32822.6   4.2817  428.11\n5   60324 39126.6   6.8544  542.45\n6   54519 44809.4  11.5751  660.14\n7   49270 49930.7  17.3944  781.42\n8   44526 54544.1  23.8195  906.57\n9   40236 58697.0  31.3741 1035.87"
  },
  {
    "objectID": "slides/01_mortality.html#good-news",
    "href": "slides/01_mortality.html#good-news",
    "title": "1. Coping with Mortality",
    "section": "Good News",
    "text": "Good News\n\nModeled CVD and non-CVD mortality closely matches the cause-deleted life table data!"
  },
  {
    "objectID": "slides/01_mortality.html#cvd-natural-history-model-1",
    "href": "slides/01_mortality.html#cvd-natural-history-model-1",
    "title": "1. Coping with Mortality",
    "section": "CVD Natural History Model",
    "text": "CVD Natural History Model\n\nNext set of slides will walk through the process of constructing a natural history model for cardiovascular disease.\nWe’ll construct a model with non-CVD background mortality, and CVD mortality.\nFirst step is constructing a cause-deleted life table.\n\nNeeded because at older ages, CVD is a substantial contributor (~50%) of overall mortality."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#learning-objectives",
    "href": "slides/03_advanced-bookkeeping.html#learning-objectives",
    "title": "Advanced Bookkeeping",
    "section": "Learning Objectives",
    "text": "Learning Objectives\n\nEstablish the transition rate matrix as the central “hub” of the modeling process.\nInclude transition states and accumulators to accurately track and count events, costs, and QALYs.\nBackwards convert an existing Markov model to facilitate new health states, new strategies, or new settings."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#green-et-al.-2023",
    "href": "slides/03_advanced-bookkeeping.html#green-et-al.-2023",
    "title": "Advanced Bookkeeping",
    "section": "Green et al. (2023)",
    "text": "Green et al. (2023)\n\n\n\n\n\n\n\nG\n\n  \n\nAsymptomatic\n\n Asymptomatic   \n\nAsymptomatic-&gt;Asymptomatic\n\n    \n\nProgressive\n\n Progressive Disease   \n\nAsymptomatic-&gt;Progressive\n\n  tpProg * (1-effect)   \n\nDead\n\n Dead   \n\nAsymptomatic-&gt;Dead\n\n  tpDn   \n\nProgressive-&gt;Progressive\n\n    \n\nProgressive-&gt;Dead\n\n     tpDcm+tpDn   \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#parameterize",
    "href": "slides/03_advanced-bookkeeping.html#parameterize",
    "title": "Advanced Bookkeeping",
    "section": "Parameterize",
    "text": "Parameterize\n\nparams = \n  list(\n    t_names = c(\"natural_history\"),           # Strategy names. \n    n_treatments = 1,                         # Number of treatments\n    s_names  = c(\"Healthy\", \"CVD\", \"Dead\"),   # State names\n    n_states = 3,                             # Number of states\n    n_cohort = 1,                             # Cohort size\n    n_cycles = 100,                           # Number of cycles in model.  \n    cycle = 1,                                # Cycle length\n    initial_age = 55,                         # Cohort starting age\n    r_H_CVD = 0.15,                           # Rate of healthy -&gt; CVD\n    hr_CVD = 10,                              # Hazard Ratio: CVD Death\n    r_H_D = 0.01                              # Rate of healthy -&gt; dead\n  )"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#age-specific-transition-matrices",
    "href": "slides/03_advanced-bookkeeping.html#age-specific-transition-matrices",
    "title": "Advanced Bookkeeping",
    "section": "Age-Specific Transition Matrices",
    "text": "Age-Specific Transition Matrices\n\n\nBack to Website"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#two-strategies",
    "href": "slides/03_advanced-bookkeeping.html#two-strategies",
    "title": "Advanced Bookkeeping",
    "section": "Two Strategies",
    "text": "Two Strategies\n\nWithout drug\nDrug that confers a 50% reduction in the probability of transitioning to progressive disease."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#complicating-factors",
    "href": "slides/03_advanced-bookkeeping.html#complicating-factors",
    "title": "Advanced Bookkeeping",
    "section": "Complicating Factors",
    "text": "Complicating Factors\n\nHigher rate of death from progressive disease, with a cost ($1,000) associated with it.\nBut can also die of background causes from progressive disease."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#green-et-al.-2023-1",
    "href": "slides/03_advanced-bookkeeping.html#green-et-al.-2023-1",
    "title": "Advanced Bookkeeping",
    "section": "Green et al. (2023)",
    "text": "Green et al. (2023)\n\n\n\n\n\n\n\nG\n\n  \n\nAsymptomatic\n\n Asymptomatic   \n\nAsymptomatic-&gt;Asymptomatic\n\n    \n\nProgressive\n\n Progressive Disease   \n\nAsymptomatic-&gt;Progressive\n\n  tpProg * (1-effect)   \n\nDead\n\n Dead   \n\nAsymptomatic-&gt;Dead\n\n  tpDn   \n\nProgressive-&gt;Progressive\n\n    \n\nProgressive-&gt;Dead\n\n     tpDcm+tpDn   \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#parameterize-1",
    "href": "slides/03_advanced-bookkeeping.html#parameterize-1",
    "title": "Advanced Bookkeeping",
    "section": "Parameterize",
    "text": "Parameterize"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-rate-matrix",
    "href": "slides/03_advanced-bookkeeping.html#transition-rate-matrix",
    "title": "Advanced Bookkeeping",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\n\nThe central “hub” of a Markov model.\nStraightforward to convert rate matrix into a transition probability matrix.\nFacilitates modeling using alternative techniques:\n\nContinuous time Markov\nDiscrete event simulation"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-1",
    "href": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-1",
    "title": "Advanced Bookkeeping",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nThe “workshop” where you can include additional health states, new evidence, change cycle lengths, etc.\nEnsures that results obtained via discrete time Markov model will match those under an identical model but different method (e.g., DES)."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-probability-matrix",
    "href": "slides/03_advanced-bookkeeping.html#transition-probability-matrix",
    "title": "Advanced Bookkeeping",
    "section": "Transition Probability Matrix",
    "text": "Transition Probability Matrix\n\nexpm(params$mR[[\"natural_history\"]])\n\n        Healthy     CVD     Dead\nHealthy 0.85214 0.13107 0.016785\nCVD     0.00000 0.89583 0.104166\nDead    0.00000 0.00000 1.000000"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tracking-transitions-and-event-counts",
    "href": "slides/03_advanced-bookkeeping.html#tracking-transitions-and-event-counts",
    "title": "Advanced Bookkeeping",
    "section": "Tracking Transitions and Event Counts",
    "text": "Tracking Transitions and Event Counts\n\nGiven compound transitions, how can we track the total number of people who develop CVD?\nWhat if there is a transitory utility decrement or cost to contracting CVD?"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tracking-transitions-and-event-counts-1",
    "href": "slides/03_advanced-bookkeeping.html#tracking-transitions-and-event-counts-1",
    "title": "Advanced Bookkeeping",
    "section": "Tracking Transitions and Event Counts",
    "text": "Tracking Transitions and Event Counts"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\nAugmenting the transition matrix with non-markovian rows and columns can facilitate accurate counting and bookkeeping.\nDepending on the objective, can include non-markovian accumulators and/or transition states."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements-1",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements-1",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\nAccumulator: tracks the total number of individuals who have entered a given state up until a given cycle (even if they moved out of the state later)."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements-2",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements-2",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\nTransition state: tracks the total number of individuals who enter a given state in a given cycle.\n\nCan construct as a tunnel state if you move them through to the next state (or exit for some other reason like background mortality).\nBut you don’t have to do this. Depending on objective, you could just count the total number who enter the state to count up transitory costs, etc."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements-3",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements-3",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\n\n\n\n\n\nHealthy\nCVD\nCVDDeath\nDead\ntrCVD\naccCVD\n\n\n\n\nHealthy\n0.85\n0.13\n0.01\n0.01\n.\n.\n\n\nCVD\n0\n0.9\n0.1\n0\n.\n.\n\n\nCVDDeath\n0\n0\n1\n0\n.\n.\n\n\nDead\n0\n0\n0\n1\n.\n.\n\n\ntrCVD\n.\n.\n.\n.\n.\n.\n\n\naccCVD\n.\n.\n.\n.\n.\n."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements-4",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements-4",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\nTransition state: tracks the total number of individuals who enter a given state in a given cycle.\n\nCan construct as a tunnel state if you move them through to the next state (or to secular death).\nBut you don’t have to do this. Depending on objective, you could just count the total number who enter the state to count up transitory costs, etc."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-elements-5",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-elements-5",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Elements",
    "text": "Non-Markovian Elements\n\n\n\n\n\n\nHealthy\nCVD\nCVDDeath\nDead\ntrCVD\naccCVD\n\n\n\n\nHealthy\n0.85\n0.13\n0.01\n0.01\n.\n.\n\n\nCVD\n0\n0.9\n0.1\n0\n.\n.\n\n\nCVDDeath\n0\n0\n1\n0\n.\n.\n\n\nDead\n0\n0\n0\n1\n.\n.\n\n\ntrCVD\n.\n.\n.\n.\n.\n.\n\n\naccCVD\n.\n.\n.\n.\n.\n."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices",
    "href": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices",
    "title": "Advanced Bookkeeping",
    "section": "Markovian Transition Matrices",
    "text": "Markovian Transition Matrices\n\nTraditional Markov modeling approaches restrict to a transition probability matrix.\nRow sums all equal 1.0."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices-1",
    "href": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices-1",
    "title": "Advanced Bookkeeping",
    "section": "Markovian Transition Matrices",
    "text": "Markovian Transition Matrices\n\n\nTraditional Markov modeling approaches restrict to a transition probability matrix.\nRow sums all equal 1.0.\n\n\n\n\n\n\n\n\nHealthy\nCVD\nDead\n\n\n\n\nHealthy\n0.852\n0.131\n0.017\n\n\nCVD\n0.000\n0.896\n0.104\n\n\nDead\n0.000\n0.000\n1.000"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices-2",
    "href": "slides/03_advanced-bookkeeping.html#markovian-transition-matrices-2",
    "title": "Advanced Bookkeeping",
    "section": "Markovian Transition Matrices",
    "text": "Markovian Transition Matrices\n\n\nTraditional Markov modeling approaches restrict to a transition probability matrix.\nRow sums all equal 1.0.\n\n\n\n\n\n\n\n\nHealthy\nCVD\nCVDDeath\nDead\n\n\n\n\nHealthy\n0.85\n0.13\n0.01\n0.01\n\n\nCVD\n0.00\n0.90\n0.10\n0.00\n\n\nCVDDeath\n0.00\n0.00\n1.00\n0.00\n\n\nDead\n0.00\n0.00\n0.00\n1.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#where-were-headed",
    "href": "slides/03_advanced-bookkeeping.html#where-were-headed",
    "title": "Advanced Bookkeeping",
    "section": "Where we’re headed",
    "text": "Where we’re headed\n\n\n\n\n\n\nHealthy\nCVD\nDead\ntrCVD\naccCVD\n\n\n\n\nHealthy\n0.852\n0.131\n0.017\n.\n.\n\n\nCVD\n0\n0.896\n0.104\n.\n.\n\n\nDead\n0\n0\n1\n.\n.\n\n\ntrCVD\n.\n.\n.\n.\n.\n\n\naccCVD\n.\n.\n.\n.\n."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#augmenting-the-transition-matrix-1",
    "href": "slides/03_advanced-bookkeeping.html#augmenting-the-transition-matrix-1",
    "title": "Advanced Bookkeeping",
    "section": "Augmenting the Transition Matrix",
    "text": "Augmenting the Transition Matrix\n\nAs noted earlier, all roads begin from the transition rate matrix.\nThe way in which we construct the Markovian components is the same.\n\nPlace rates as appropriate.\nDiagonal of Markovian elements is the negative sum of the other row elements."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-2",
    "href": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-2",
    "title": "Advanced Bookkeeping",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams$mR &lt;- \n  with(params,{\n    r_CVD_D &lt;- hr_CVD * r_H_D\n    R_ &lt;- \n      array(data = c(0, 0, 0,  \n                 r_H_CVD,0, 0,\n                 r_H_D,r_H_D + r_CVD_D,0,\n                 r_H_D, 0,0),\n          dim = c(n_states, n_states, n_treatments),\n                  dimnames = list(from = s_names,\n                                  to = s_names,\n                                  t_names))\n    R &lt;- apply(R_,3, simplify=FALSE,function(x) {\n      diag(x) = -rowSums(x)\n      x * cycle\n    })\n  R    \n  })"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#what-they-didnt-teach-you",
    "href": "slides/03_advanced-bookkeeping.html#what-they-didnt-teach-you",
    "title": "Advanced Bookkeeping",
    "section": "What they didn’t teach you",
    "text": "What they didn’t teach you\n\nThe transition rate matrix is also essential for accurate and transparent accounting of costs and QALYs."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#what-well-teach-you",
    "href": "slides/03_advanced-bookkeeping.html#what-well-teach-you",
    "title": "Advanced Bookkeeping",
    "section": "What we’ll teach you",
    "text": "What we’ll teach you\n\nWe’ll demonstrate how to augment the matrix with non-Markovian elements using the basic CVD model from the last session.\nWe’ll show you how to backwards convert an existing transition probability matrix into a continuous generator (rate) matrix.\nWe’ll then replicate and extend a recent didactic model (Green et al. 2023) in an applied case study using these methods."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#cvd-model-1",
    "href": "slides/03_advanced-bookkeeping.html#cvd-model-1",
    "title": "Advanced Bookkeeping",
    "section": "CVD Model",
    "text": "CVD Model\n\n\nLet’s quickly build up the basic CVD model again."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-3",
    "href": "slides/03_advanced-bookkeeping.html#transition-rate-matrix-3",
    "title": "Advanced Bookkeeping",
    "section": "Transition Rate Matrix",
    "text": "Transition Rate Matrix\n\nparams$mR\n\n$natural_history\n         to\nfrom      Healthy   CVD Dead\n  Healthy   -0.16  0.15 0.01\n  CVD        0.00 -0.11 0.11\n  Dead       0.00  0.00 0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#augmenting-the-transition-matrix-2",
    "href": "slides/03_advanced-bookkeeping.html#augmenting-the-transition-matrix-2",
    "title": "Advanced Bookkeeping",
    "section": "Augmenting the Transition Matrix",
    "text": "Augmenting the Transition Matrix\n\n\nRate matrix for basic CVD model\n\n\n\n\n\n\n\n\nHealthy\nCVD\nDead\n\n\n\n\nHealthy\n-0.16\n0.15\n0.01\n\n\nCVD\n0.00\n-0.11\n0.11\n\n\nDead\n0.00\n0.00\n0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#adding-an-accumulator",
    "href": "slides/03_advanced-bookkeeping.html#adding-an-accumulator",
    "title": "Advanced Bookkeeping",
    "section": "Adding an Accumulator",
    "text": "Adding an Accumulator\n\nSuppose we wanted to track the total number of people who develop CVD over the simulated time horizon.\nWe can’t do this accurately using Markov trace because of compound transitions.\nWe need some way to track everyone who moves into the CVD state.\nWe can do this by adding a non-markovian accumulator to the rate matrix."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#total-cvd-cases",
    "href": "slides/03_advanced-bookkeeping.html#total-cvd-cases",
    "title": "Advanced Bookkeeping",
    "section": "Total CVD Cases",
    "text": "Total CVD Cases\n\nSuppose we wanted to track the total number of people who develop CVD over the simulated time horizon.\nWe can’t do this accurately using CVD state occupancy in the Markov trace due to compound transitions."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#total-cvd-cases-1",
    "href": "slides/03_advanced-bookkeeping.html#total-cvd-cases-1",
    "title": "Advanced Bookkeeping",
    "section": "Total CVD Cases",
    "text": "Total CVD Cases\n\nWe need some way to track everyone who moves into the CVD state.\nWe can do this by adding a non-markovian accumulator to the rate matrix."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\nWe’ll start with the original transition rate matrix:\n\nR_ &lt;- params$mR[[\"natural_history\"]]\nR_\n\n         to\nfrom      Healthy   CVD Dead\n  Healthy   -0.16  0.15 0.01\n  CVD        0.00 -0.11 0.11\n  Dead       0.00  0.00 0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-1",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-1",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\n\n\nNext, we will add both a column and a row for the accumulator that tracks movement into the CVD health state.\n\n\n\nFor now, just include zeros."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-2",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-2",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\n\n\nNext, we will add both a column and a row for the accumulator that tracks movement into the CVD health state.\nFor now, just include zeros.\n\n\n\nR &lt;- \n  cbind(R_,\"accCVD\" = c(0,0,0)) %&gt;% \n  rbind(.,\"accCVD\" = c(0,0,0,0))  \nR\n\n        Healthy   CVD Dead accCVD\nHealthy   -0.16  0.15 0.01      0\nCVD        0.00 -0.11 0.11      0\nDead       0.00  0.00 0.00      0\naccCVD     0.00  0.00 0.00      0"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-3",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-3",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\n\n\nNext fill in the appropriate transition rate.\n\n\n\nR[\"Healthy\",\"accCVD\"] = params$r_H_CVD\nR\n\n        Healthy   CVD Dead accCVD\nHealthy   -0.16  0.15 0.01   0.15\nCVD        0.00 -0.11 0.11   0.00\nDead       0.00  0.00 0.00   0.00\naccCVD     0.00  0.00 0.00   0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-4",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-4",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\n\n\nEmbed using matrix exponentiation to obtain the transition probability matrix.\n\n\n\nThe transition matrix now includes a Markovian submatrix (green) and a non-markovian accumulator component (purple).\n\n\nexpm(R)  \n\n\n\n\n\n\n\nHealthy\nCVD\nDead\naccCVD\n\n\n\n\nHealthy\n0.852\n0.131\n0.017\n0.139\n\n\nCVD\n0\n0.896\n0.104\n0\n\n\nDead\n0\n0\n1\n0\n\n\naccCVD\n0\n0\n0\n1"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#cvd-model-2",
    "href": "slides/03_advanced-bookkeeping.html#cvd-model-2",
    "title": "Advanced Bookkeeping",
    "section": "CVD Model",
    "text": "CVD Model\n\n\n\n\n\n\n\nG\n\n  \n\nHealthy\n\n Healthy   \n\nHealthy-&gt;Healthy\n\n    \n\nCVD\n\n CVD   \n\nHealthy-&gt;CVD\n\n  r_H_CVD = 0.15   \n\nDead\n\n Dead   \n\nHealthy-&gt;Dead\n\n  r_HD=0.01   \n\nCVD-&gt;CVD\n\n    \n\nCVD-&gt;Dead\n\n   hr_CVD * r_HD hr_CVD=10   \n\nDead-&gt;Dead"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tracking-events",
    "href": "slides/03_advanced-bookkeeping.html#tracking-events",
    "title": "Advanced Bookkeeping",
    "section": "Tracking Events",
    "text": "Tracking Events\n\nGiven compound transitions, how can we track the total number of people who develop CVD?\nWhat if there is a transitory utility decrement or cost to contracting CVD?"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#advanced-bookkeeping",
    "href": "slides/03_advanced-bookkeeping.html#advanced-bookkeeping",
    "title": "Advanced Bookkeeping",
    "section": "Advanced Bookkeeping",
    "text": "Advanced Bookkeeping\n\nGiven compound transitions, how can we track the total number of people who develop CVD?\nWhat if there is a cost associated with a single transition type (e.g., CVD  CVD death)?\nWhat if we want to include a tunnel state to capture transient utility changes after contracting CVD or experiencing an acute event?"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#advanced-bookkeeping-1",
    "href": "slides/03_advanced-bookkeeping.html#advanced-bookkeeping-1",
    "title": "Advanced Bookkeeping",
    "section": "Advanced Bookkeeping",
    "text": "Advanced Bookkeeping\nAugmenting the transition matrix with non-markovian elements can address each question:\n\nAccumulator states to count total number of people who enter a health state.\nTransition states to count the number of people who transition into a state in a given cycle.\nTunnel states to capture transient events (e.g., 2 cycle utility decrement, etc.)"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-5",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-5",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators\n\nNote that the Markovian submatrix still has rows that sum to one.\nAlso note that the accumulator captures the same transition probability that was (incorrectly) placed in the Healthy  CVD cell in lecture 2!\n\nRecall that this probability is the marginal probability of transition (i.e., all transitions into CVD state). So it’s exactly what we want to accumulate!"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-6",
    "href": "slides/03_advanced-bookkeeping.html#non-markovian-accumulators-6",
    "title": "Advanced Bookkeeping",
    "section": "Non-Markovian Accumulators",
    "text": "Non-Markovian Accumulators"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#how-many-with-cvd-after-1-years",
    "href": "slides/03_advanced-bookkeeping.html#how-many-with-cvd-after-1-years",
    "title": "Advanced Bookkeeping",
    "section": "How Many with CVD After 1 Years?",
    "text": "How Many with CVD After 1 Years?\n\nIf we simply went based on state occupancy after one cycle, we’d understate the number of people who develop CVD.\n\nThis is the number who remain in the CVD health state.\nSome had a compound transition and died within the cycle after they developed CVD!\n\n\n\n\n\n\n\ncycle\nHealthy\nCVD\nDead\naccCVD\n\n\n\n\n0\n100000\n0\n0.0\n0\n\n\n1\n85214\n13107\n1678.5\n13862"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#how-many-with-cvd-after-1-years-1",
    "href": "slides/03_advanced-bookkeeping.html#how-many-with-cvd-after-1-years-1",
    "title": "Advanced Bookkeeping",
    "section": "How Many with CVD After 1 Years?",
    "text": "How Many with CVD After 1 Years?\n\n\nThe accumulator column tells us how many total people developed CVD.\n\n\n\n\n\n\n\ncycle\nHealthy\nCVD\nDead\naccCVD\n\n\n\n\n0\n100000\n0\n0.0\n0\n\n\n1\n85214\n13107\n1678.5\n13862"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states",
    "href": "slides/03_advanced-bookkeeping.html#transition-states",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\nWhat if we need to count how many people transition to a given state in a cycle?\nFor example, we may want to apply a one-time cost to a transition such as CVD  CVD death.\nThis type of transition is not immediately captured in the Markov trace.\n\nObserved cycle-to-cycle change in death counts capture CVD  CVD Death as well as death from background causes."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-1",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-1",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\nWhat if we need to count how many people transition to a given state in a cycle?\nFor example, we may want to apply a one-time cost to a transition such as CVD  CVD death.\nThis type of transition is not immediately captured in the Markov trace.\n\nObserved cycle-to-cycle change in death counts capture CVD  CVD Death as well as death from background causes."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-2",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-2",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\nTransition states are straightforward to capture as another element in the transition matrix.\nSimilar to an accumulator state, but we require state exit after one cycle.\nAmounts so simply zeroing out the accCVD  accCVD transition probability."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-3",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-3",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\nWe’ll start with the original transition rate matrix:\n\nR_ &lt;- params$mR[[\"natural_history\"]]\nR_\n\n         to\nfrom      Healthy   CVD Dead\n  Healthy   -0.16  0.15 0.01\n  CVD        0.00 -0.11 0.11\n  Dead       0.00  0.00 0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-4",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-4",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\nNext, we will add both a column and a row for the transition state that tracks movement into the CVD Death state."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-5",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-5",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\nNext, we will add both a column and a row for the transition state that tracks movement into the CVD Death state.\nFor now, just include zeros.\n\n\n\n\nR &lt;- \n  cbind(R_,\"trCVDDeath\" = c(0,0,0)) %&gt;% \n  rbind(.,\"trCVDDeath\" = c(0,0,0,0))  \nR\n\n           Healthy   CVD Dead trCVDDeath\nHealthy      -0.16  0.15 0.01          0\nCVD           0.00 -0.11 0.11          0\nDead          0.00  0.00 0.00          0\ntrCVDDeath    0.00  0.00 0.00          0"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-6",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-6",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\nWe then fill in the appropriate transition rate.\n\n\n\nR[\"CVD\",\"trCVDDeath\"] = params$hr_CVD * params$r_H_D\nR\n\n           Healthy   CVD Dead trCVDDeath\nHealthy      -0.16  0.15 0.01        0.0\nCVD           0.00 -0.11 0.11        0.1\nDead          0.00  0.00 0.00        0.0\ntrCVDDeath    0.00  0.00 0.00        0.0"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-7",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-7",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\nEmbed using matrix exponentiation to obtain the transition probability matrix.\nNote that we need to manually zero out the transition probability that keeps people in the transition state.\n\n\n\nP = expm(R)  \nP[\"trCVDDeath\",\"trCVDDeath\"] = 0\nP\n\n           Healthy     CVD     Dead trCVDDeath\nHealthy    0.85214 0.13107 0.016785  0.0068583\nCVD        0.00000 0.89583 0.104166  0.0946962\nDead       0.00000 0.00000 1.000000  0.0000000\ntrCVDDeath 0.00000 0.00000 0.000000  0.0000000"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#how-many-cvd-death-transitions-are-there",
    "href": "slides/03_advanced-bookkeeping.html#how-many-cvd-death-transitions-are-there",
    "title": "Advanced Bookkeeping",
    "section": "How Many CVD Death Transitions Are There?",
    "text": "How Many CVD Death Transitions Are There?\n\n\nHypothetical cohort of 100,000.\n\n\n\nNote how there are some deaths in the first cycle, despite everyone starting from healthy!\n\n\n\n\n\n\ncycle\nHealthy\nCVD\nDead\ntrCVDDeath\n\n\n\n\n0\n100000\n0\n0.0\n0.00\n\n\n1\n85214\n13107\n1678.5\n685.83"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#incorporating-a-one-time-cost",
    "href": "slides/03_advanced-bookkeeping.html#incorporating-a-one-time-cost",
    "title": "Advanced Bookkeeping",
    "section": "Incorporating a one-time cost",
    "text": "Incorporating a one-time cost\n\n\nCan define a cost “payoff” for trCVDDeath and apply as usual to calculate accumulated costs from a one-time CVD death cost.\n\n\n\n# Define the cost vector\ncost_payoff = c(\"Healthy\" = 0, \"CVD\" = 500, \"Dead\" = 0, \"trCVDDeath\" = 2000) \n\n# Sum up total costs in each cycle\ncosts_cycle = trace[[\"natural_history\"]][-1,] %*% cost_payoff\n\n# Function for cycle correction (alternative Simpson's method)\nalt_simp_coef &lt;- function(i) c(17, 59, 43, 49, rep(48, i-8), 49, 43, 59, 17) / 48\ncycle_adj      &lt;- function(x) sum(alt_simp_coef(length(x)) * x)\n\ntotal_costs = cycle_adj(costs_cycle) \ntotal_costs\n\n[1] 5926.6"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-8",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-8",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\n\n\n\n\nHealthy\nCVD\nDead\ntrCVDDeath\n\n\n\n\nHealthy\n0.852\n0.131\n0.017\n0.007\n\n\nCVD\n0.000\n0.896\n0.104\n0.095\n\n\nDead\n0.000\n0.000\n1.000\n0.000\n\n\ntrCVDDeath\n0.000\n0.000\n0.000\n0.000\n\n\n\n\n\n\n\n\nNote that the Markovian submatrix still has rows that sum to one.\nAlso note that the transition state column captures transitions to death that occur from both the Healthy state (compound transitions) and the CVD state!"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-1",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-1",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\nTunnel states are structured similarly to accumulators and transition states.\nOne additional complication: need to allow for tunnel state exit to background mortality (or other exit states)."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#accumulators-and-transition-states",
    "href": "slides/03_advanced-bookkeeping.html#accumulators-and-transition-states",
    "title": "Advanced Bookkeeping",
    "section": "Accumulators and Transition States",
    "text": "Accumulators and Transition States\n\nOccupy both ends of a spectrum.\nAccumulators: probability of remaining in accumulator state = 1.0.\nTransition States: probability of remaining in transition state = 0.0."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-2",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-2",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\nProbability of remaining in tunnel: 0 &lt; p &lt; 1.\nReflects the idea that most will remain in the tunnel for the cycle, but some might leave due to secular death, transition back to a less severe disease state (e.g., remission), etc."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-3",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-3",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\nProcess for constructing is similar, with a “catch.”\nWe are already accounting for transitions to death in the primary Markovian submatrix.\nBut for accurate bookkeeping purposes (e.g., QALYs and costs) we still need to net them out."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-4",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-4",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\nWe’ll do this by including a temporary “receiving bucket” in the rate matrix.\nThe receiving bucket is used for embedding, but can be discarded for the final transition probability matrix."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-5",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-5",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\nSuppose we want to record a temporary 2 year (cycle) initial treatment cost once someone develops CVD.\nWe can set up a tunnel state to capture this."
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-state",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-state",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel State",
    "text": "Tunnel State\nWe’ll start with the original transition rate matrix:\n\n\n$natural_history\n         to\nfrom      Healthy   CVD Dead\n  Healthy   -0.16  0.15 0.01\n  CVD        0.00 -0.11 0.11\n  Dead       0.00  0.00 0.00\n\n\n\nR_ &lt;- params$mR[[\"natural_history\"]]\nR_\n\n         to\nfrom      Healthy   CVD Dead\n  Healthy   -0.16  0.15 0.01\n  CVD        0.00 -0.11 0.11\n  Dead       0.00  0.00 0.00"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-state-1",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-state-1",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel State",
    "text": "Tunnel State\n\nNext, we will add columns and rows for the tunnel states.\nGiven that our model has an annual cycle, and the tunnel lasts two years, we need to add two columns and two rows PLUS a receiving bucket. So three new rows and columns.\nIf we had a monthly time cycle, we’d need to add 25 …"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-states-6",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-states-6",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel States",
    "text": "Tunnel States\n\n\nFor now, just include zeros.\n\n\n\n\nR &lt;- \n  cbind(R_,\"tunCVDy1\" = c(0,0,0), \"tunCVDy2\" = c(0,0,0),\"NULL\" = c(0,0,0)) %&gt;% \n  rbind(.,\"tunCVDy1\" = c(0,0,0,0,0,0), \"tunCVDy2\" = c(0,0,0,0,0,0), \"NULL\" = c(0,0,0,0,0,0))  \nR\n\n         Healthy   CVD Dead tunCVDy1 tunCVDy2 NULL\nHealthy    -0.16  0.15 0.01        0        0    0\nCVD         0.00 -0.11 0.11        0        0    0\nDead        0.00  0.00 0.00        0        0    0\ntunCVDy1    0.00  0.00 0.00        0        0    0\ntunCVDy2    0.00  0.00 0.00        0        0    0\nNULL        0.00  0.00 0.00        0        0    0"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-state-2",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-state-2",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel State",
    "text": "Tunnel State\n\n\nWe then fill in the appropriate transition rate for entry into the tunnel.\n\n\n\nR[\"Healthy\",\"tunCVDy1\"] = R[\"Healthy\",\"CVD\"]\nR\n\n         Healthy   CVD Dead tunCVDy1 tunCVDy2 NULL\nHealthy    -0.16  0.15 0.01     0.15        0    0\nCVD         0.00 -0.11 0.11     0.00        0    0\nDead        0.00  0.00 0.00     0.00        0    0\ntunCVDy1    0.00  0.00 0.00     0.00        0    0\ntunCVDy2    0.00  0.00 0.00     0.00        0    0\nNULL        0.00  0.00 0.00     0.00        0    0"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#tunnel-state-3",
    "href": "slides/03_advanced-bookkeeping.html#tunnel-state-3",
    "title": "Advanced Bookkeeping",
    "section": "Tunnel State",
    "text": "Tunnel State\n\n\nEmbed using matrix exponentiation to obtain the initial transition probability matrix.\nNote that we need to TK\n\n\n\nP_ = expm(R)  \nP_[\"tunCVDy1\",\"NULL\"] = P_[\"CVD\",\"Dead\"]\nP_[\"tunCVDy1\",\"tunCVDy1\"] = 0\nP_[\"tunCVDy1\",\"tunCVDy2\"] = 1 - P_[\"tunCVDy1\",\"NULL\"]\nP_[\"tunCVDy2\",\"tunCVDy2\"] = 0\nP_[\"tunCVDy2\",\"NULL\"] = 1\nP = P_[-which(rownames(P_)==\"NULL\"),-which(colnames(P_)==\"NULL\")]\nP\n\n         Healthy     CVD     Dead tunCVDy1 tunCVDy2\nHealthy  0.85214 0.13107 0.016785  0.13862  0.00000\nCVD      0.00000 0.89583 0.104166  0.00000  0.00000\nDead     0.00000 0.00000 1.000000  0.00000  0.00000\ntunCVDy1 0.00000 0.00000 0.000000  0.00000  0.89583\ntunCVDy2 0.00000 0.00000 0.000000  0.00000  0.00000"
  },
  {
    "objectID": "slides/03_advanced-bookkeeping.html#transition-states-9",
    "href": "slides/03_advanced-bookkeeping.html#transition-states-9",
    "title": "Advanced Bookkeeping",
    "section": "Transition States",
    "text": "Transition States\n\n\n\n\n\n\nHealthy\nCVD\nDead\ntunCVDy1\ntunCVDy2\n\n\n\n\nHealthy\n0.852\n0.131\n0.017\n0.139\n0.000\n\n\nCVD\n0.000\n0.896\n0.104\n0.000\n0.000\n\n\nDead\n0.000\n0.000\n1.000\n0.000\n0.000\n\n\ntunCVDy1\n0.000\n0.000\n0.000\n0.000\n0.896\n\n\ntunCVDy2\n0.000\n0.000\n0.000\n0.000\n0.000\n\n\n\n\n\n\n\n\nNote that the Markovian submatrix still has rows that sum to one."
  },
  {
    "objectID": "slides/02_competing-events.html#rate-misspecification-error-decision-threshold",
    "href": "slides/02_competing-events.html#rate-misspecification-error-decision-threshold",
    "title": "Competing Risks",
    "section": "Rate Misspecification Error Decision Threshold",
    "text": "Rate Misspecification Error Decision Threshold\n\nThe amount of error for a decision threshold is the difference in contour. In this example: \\(0.07 - 0.02 = 0.05\\)."
  },
  {
    "objectID": "slides/02_competing-events.html#what-is-commonly-taught",
    "href": "slides/02_competing-events.html#what-is-commonly-taught",
    "title": "Competing Risks",
    "section": "What Is Commonly Taught",
    "text": "What Is Commonly Taught\n\nConvert each rate to a probability for the time step using \\(p = 1-\\exp(-rt)\\).\nPlace the probabilities within a transition matrix \\(\\mathbf{P}\\).\nDiagonal elements of \\(\\mathbf{P}\\): 1 - (row sum of nondiagonal elements)."
  }
]