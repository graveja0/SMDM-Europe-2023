<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.272">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Graves, Shawn Garbett, Zilu Zhou, Jonathan Schildcrout, Josh Peterson">

<title>SMDM Europe 2023: Health Economics Modeling Workshop - Supplemental Appendix</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">SMDM Europe 2023: Health Economics Modeling Workshop</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">SMDM Europe 2023: Health Economics Modeling Workshop</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What They Didn’t Teach You About Decision Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../blog/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop Blog</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lectures/lec_welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome and Introductions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lectures/lec_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Structuring the Markov Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lectures/exercise_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Group Exercise - Populating a Markov Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../lectures/exercise_ANS_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Group Exercise Answer - Populating a Markov Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Case Studies</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Tools and Applications</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://mhorta.shinyapps.io/shinycea3/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workshop CEA Shiny Application</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://mhorta.shinyapps.io/gomp/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gompertz Mortality Parameters Fit to UN Life Table Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://dare.shinyapps.io/tree/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision Tree Drawing Tool</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://mermaid.live/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mermaid Live Editor (Facilitates easy model diagram drawing)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="http://magjac.com/graphviz-visual-editor//" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphviz Visual Editor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.youtube.com/playlist?list=PLIT7NqYN7YT0TypPdKdN4qTomBp2aqt_C" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov Modeling in R (YouTube Video Series)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://darth-git.github.io/darthpack/articles/darthpack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov Modeling in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../roster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instructors</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#markov-modeling-best-practices-code-and-examples" id="toc-markov-modeling-best-practices-code-and-examples" class="nav-link active" data-scroll-target="#markov-modeling-best-practices-code-and-examples">Markov Modeling: Best Practices, Code and Examples</a>
  <ul class="collapse">
  <li><a href="#rates-vs.-percentages" id="toc-rates-vs.-percentages" class="nav-link" data-scroll-target="#rates-vs.-percentages">Rates vs.&nbsp;Percentages</a></li>
  <li><a href="#competing-events" id="toc-competing-events" class="nav-link" data-scroll-target="#competing-events">Competing Events</a>
  <ul class="collapse">
  <li><a href="#can-i-work-backwards-from-transition-probabilities-an-example." id="toc-can-i-work-backwards-from-transition-probabilities-an-example." class="nav-link" data-scroll-target="#can-i-work-backwards-from-transition-probabilities-an-example.">Can I Work Backwards from Transition Probabilities? An Example.</a></li>
  </ul></li>
  <li><a href="#state-jumping" id="toc-state-jumping" class="nav-link" data-scroll-target="#state-jumping">State Jumping</a></li>
  <li><a href="#non-stationary-rates" id="toc-non-stationary-rates" class="nav-link" data-scroll-target="#non-stationary-rates">Non-stationary Rates</a></li>
  </ul></li>
  <li><a href="#tunnel-states" id="toc-tunnel-states" class="nav-link" data-scroll-target="#tunnel-states">Tunnel States</a></li>
  <li><a href="#rescaling-and-integration" id="toc-rescaling-and-integration" class="nav-link" data-scroll-target="#rescaling-and-integration">Rescaling and Integration</a></li>
  <li><a href="#from-soup-to-nuts-a-fully-executed-example" id="toc-from-soup-to-nuts-a-fully-executed-example" class="nav-link" data-scroll-target="#from-soup-to-nuts-a-fully-executed-example">From Soup to Nuts: A Fully-Executed Example</a>
  <ul class="collapse">
  <li><a href="#numerical-checkpoint" id="toc-numerical-checkpoint" class="nav-link" data-scroll-target="#numerical-checkpoint">Numerical Checkpoint</a>
  <ul class="collapse">
  <li><a href="#costs" id="toc-costs" class="nav-link" data-scroll-target="#costs">Costs</a></li>
  <li><a href="#quality-adjusted-life-years" id="toc-quality-adjusted-life-years" class="nav-link" data-scroll-target="#quality-adjusted-life-years">Quality-Adjusted Life Years</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="CHEMlogo_white.png" class="img-fluid"></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Supplemental Appendix</h1>
<p class="subtitle lead">Comparison of Decision Modeling Approaches for Health Technology and Policy Evaluation</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John Graves, Shawn Garbett, Zilu Zhou, Jonathan Schildcrout, Josh Peterson </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="markov-modeling-best-practices-code-and-examples" class="level1">
<h1>Markov Modeling: Best Practices, Code and Examples</h1>
<p>This section provides advice on best practices for embedding literature-based parameters into discrete-time Markov models so that the final transition probabilities accurately represent the underlying continuous time process.</p>
<section id="rates-vs.-percentages" class="level2">
<h2 class="anchored" data-anchor-id="rates-vs.-percentages">Rates vs.&nbsp;Percentages</h2>
<p>It is common to draw upon literature-based parameters when constructing a Markov model. A key first step is to assess the parameters of interest in a published study. For a given paper with published rates, thsi means determining whether they report a percentrage affected in a given time step, or continuous rates. While the units of both of these are essentially equivalent (by a factor of 100), the interpretation is different. It is a subtle but important difference.</p>
<p>For example, let’s assume that a stochastic event occurs to a group of individuals with a rate of 1/unit time. This follows an exponential distribution. We first create a sample of 20000 individuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="dv">20000</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="quarto-discovered-preview-image img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.011341</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7090352</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage in first time cycle</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x <span class="sc">&lt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">length</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.62495</code></pre>
</div>
</div>
<p>The mean is close to 1, but the percentage observed in the first time cycle is close to the theoretical 63.2%. This appears counter-intuitive but the long tail of the exponential distribution creates a situation where the continuous rate is not the observed percentage in a time cycle.</p>
<p>This leads to the widely-used rate-to-probability conversion formula:</p>
<p><span class="math display">\[p = 1 - e^{-r}\]</span> <span class="math display">\[r = -log(1-p)\]</span> where <span class="math inline">\(p\)</span> represents the probability in a unit of time and <span class="math inline">\(r\)</span> represents the continuous rate.</p>
<p>When constructing a Markov model, it is best to start with the continuous rate when aggregating from many sources and embed this continuous rate into a timestep—thus creating probability transitions for each time step.</p>
<p>To find the probability transition matrix of a timestep in Markov modeling from the continuous the following formula is used:</p>
<p><span class="math display">\[ T_{prob} = e^{R} \]</span></p>
<p>Where <span class="math inline">\(R\)</span> is the continuous rate matrix, and each diagonal is the negative sum of the rest of the row elements. <span class="math inline">\(T_{prob}\)</span> is the transition probability for a single time step, where each diagonal is 1 - the sum of the other row elements.</p>
<p>One could have rates that change at each time step and this would return the proper embedding of the rates allowing for them to compete.</p>
</section>
<section id="competing-events" class="level2">
<h2 class="anchored" data-anchor-id="competing-events">Competing Events</h2>
<p>What if a given source of data provides observed transition probabilities and these are exclusionary states, i.e., competing? How could one reverse these probabilities and embed other competing events into the model?</p>
<p>To do this, one must solve for the generator matrix of the transition probability matrix using eigenvalue decomposition. Note that this is not always possible, as it is trivial to construct a transition probability matrix that has no generator.</p>
<p>Consider the following, which builds on the example provided in the main text. We wish to approximate a continuous time process using a discrete-time Markov model with three distinct states: A (healthy), B (sick/intervention), and C (complication from intervention). Moreover, in continuous time, this process proceeds sequentially, i.e., A-&gt;B-&gt;C.</p>
<p>A (naively) specified model has transitions from A-&gt;B and from B-&gt;C specified as probabilities within the selected time step. As noted in the main text, this model cannot truly approximate continuous time process, as within a given time step there is a non-zero probability of transitioning from healthy to complication (i.e., A-&gt;C, with an implied sojourn through B). That is, during a timestep it is possible to transition from A-&gt;C.</p>
<p>By incorrectly specifying all transitions, it makes it impossible to find a proper generator—though eigenvalue decomposition can be used to get as close as possible. If negative rates of transition are found using eigenvalue decomposition, then probabilities inconsistent with continuous rates have been specified.</p>
<p>In mathematical terms, the generator matrix is the matrix logarithm of the transition probability matrix. A matrix has a logarithm <em>if and only if</em> if it is invertible.</p>
<p><span class="math display">\[ A = \log T_{prob} \]</span></p>
<p>The <span class="math inline">\(\log\)</span> can be found using spectral or eigenvalue decomposition. If <span class="math inline">\(V\)</span> is a matrix where equal column is an eigenvector of <span class="math inline">\(T_{prob}\)</span>, then,</p>
<p><span class="math display">\[A' = V^{-1} A V\]</span> <span class="math display">\[\log T_{prob} = V (\log A') V^{-1}\]</span></p>
<section id="can-i-work-backwards-from-transition-probabilities-an-example." class="level3">
<h3 class="anchored" data-anchor-id="can-i-work-backwards-from-transition-probabilities-an-example.">Can I Work Backwards from Transition Probabilities? An Example.</h3>
<p>As an example, we’ll consider a model from “Decision Modelling for Heath Economic Evaluation” by Briggs, Clatxon, and Sculpher. In Table 2.2, they define a transition probability matrix for HIV monotherapy that was derived from observed percent transitions in a patient cohort.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hiv_monotherapy_tp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.721</span>, <span class="fl">0.202</span>, <span class="fl">0.067</span>, <span class="fl">0.010</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fl">0.000</span>, <span class="fl">0.581</span>, <span class="fl">0.407</span>, <span class="fl">0.012</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fl">0.000</span>, <span class="fl">0.000</span>, <span class="fl">0.750</span>, <span class="fl">0.250</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fl">0.000</span>, <span class="fl">0.000</span>, <span class="fl">0.000</span>, <span class="fl">1.000</span>), </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>)))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>hiv_monotherapy_tp                                          </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      A     B     C     D
A 0.721 0.202 0.067 0.010
B 0.000 0.581 0.407 0.012
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>The bottom diagonal was corrected to be a Markov absorbing state by having 1 on the diagonal. For the purposes of example, we’ll assume we wish to add an additional state “E”, which has a continuous rate of 0.2 that competes with other transitions.</p>
<p>To accomplish this we must find the continuous generator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>V  <span class="ot">&lt;-</span> <span class="fu">eigen</span>(hiv_monotherapy_tp)<span class="sc">$</span>vectors</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>iV <span class="ot">&lt;-</span> <span class="fu">solve</span>(V)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Ap <span class="ot">&lt;-</span> iV <span class="sc">%*%</span> hiv_monotherapy_tp <span class="sc">%*%</span> V</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Ap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]          [,3]          [,4]
[1,]  1.000000e+00 -1.138759e-17  0.000000e+00  1.625347e-17
[2,]  1.724225e-16  7.500000e-01  0.000000e+00 -1.565421e-16
[3,] -1.054209e-15 -1.977467e-16  7.210000e-01  3.654408e-17
[4,] -6.257371e-17 -1.879313e-17 -5.963692e-18  5.810000e-01</code></pre>
</div>
</div>
<p>Due to the numeric probabilities not being exactly correct, the off-diagonal elements of <span class="math inline">\(A'\)</span> are not zero, but they are quite close. We will zero these off diagonal elements and assume that the non-zero elements are numerical error. Then continue by taking the log of the diagonal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lAp <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">log</span>(<span class="fu">diag</span>(Ap)), <span class="fu">nrow</span>(Ap), <span class="fu">ncol</span>(Ap))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>R  <span class="ot">&lt;-</span> V <span class="sc">%*%</span> lAp <span class="sc">%*%</span> iV</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>R </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]         [,3]        [,4]
[1,] -3.271161e-01  3.114961e-01  0.002439536  0.01318051
[2,]  2.558460e-18 -5.430045e-01  0.614888976 -0.07188445
[3,]  0.000000e+00  7.064112e-18 -0.287682072  0.28768207
[4,]  0.000000e+00  0.000000e+00  0.000000000  0.00000000</code></pre>
</div>
</div>
<p>An now we have the continuous time rate generator for the Markov Model. There is still some numerical error—for example the bottom row, has values very near to zero, and the diagonal is not exactly the negative sum of the rest of the row. We can clean this up by tweaking the numbers numerical towards their constraints.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>R[<span class="fu">abs</span>(R) <span class="sc">&lt;</span> <span class="fl">1e-6</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(R) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(R) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(R, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       A      B      C      D
A -0.327  0.311  0.002  0.013
B  0.000 -0.543  0.615 -0.072
C  0.000  0.000 -0.288  0.288
D  0.000  0.000  0.000  0.000</code></pre>
</div>
</div>
<p>Some numerical error is inevitable in this process and cannot be avoided. However, even cleaning up the small and obvious errors, the transition from B -&gt; D is impossible since it’s negative. Rates are relative to the occupancy of the source state, in this case B. Having a negative rate implies that B would have some transitions in which the dead come alive into B based upon the occupancy of B. Obviously, this is not possible. The problem now is how to adjust the model’s rates to be physically possible, while as faithful to the original data as possible. B is a sicker state, so it should have a higher death rate.</p>
<p>First, let’s double check it recapitulates the original rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expm</span>(R)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4 x 4 Matrix of class "dgeMatrix"
      A     B     C     D
A 0.721 0.202 0.067 0.010
B 0.000 0.581 0.407 0.012
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>Which exactly matches the original transition probability table given.</p>
<p>Next, lets’ assume that one has to pass into state C to die and the original data didn’t have frequent enough measurements to detect all the transitions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A more plausible death rate for 'A', 'B'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>R[<span class="st">'A'</span>, <span class="st">'D'</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>R[<span class="st">'B'</span>, <span class="st">'D'</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(R) <span class="ot">&lt;-</span> <span class="fu">diag</span>(R) <span class="sc">-</span> <span class="fu">rowSums</span>(R) <span class="co"># Keep it Markovian</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">expm</span>(R), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4 x 4 Matrix of class "dgeMatrix"
      A     B     C     D
A 0.731 0.197 0.066 0.007
B 0.000 0.541 0.393 0.066
C 0.000 0.000 0.750 0.250
D 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>The rate from A-&gt;D is within error of the original study. However, deaths from B are at a much higher rate. This is all under the assumption that one must pass through C to die, and the adjusted transitions reflect this.</p>
<p>Now one could add a competing event to to the model as a rate adding a new row column with it’s defined rates and compute the updated transition probability matrix.</p>
<p>These difficulties of working backward from probabilities unscore the importance of having the original estimates be rates that have been adjusted to be the non-competing rate (e.g., based on survival models).</p>
</section>
</section>
<section id="state-jumping" class="level2">
<h2 class="anchored" data-anchor-id="state-jumping">State Jumping</h2>
<p>The above examples also illustrate another difficulty: correctly summarizing costs and utilities in the presence of implied “jumpover” states. For example, we zeroed the rate of A-&gt;D, yet the final transition matrix contains that transition.</p>
<p>Assume that the transition B-&gt;C entailed a cost, given that some of the population goes A-&gt;B-&gt;C-&gt;D these transitions are hidden in the embedded transition matrix, yet a summary of the number of B-&gt;C transitions is needed for a time step. One can solve this by adding non-Markovian states or accumulator states to track these transitions.</p>
<p>The diagonal term of the transition intensity matrix is the negative sum of all <em>Markovian</em> states. Additional rows and columns can be added that violate the principal that total state occupancy cannot be created or destroyed, by simply leaving them out of the balancing term of the diagonal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>RwAcc <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rbind</span>(R, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>)), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(RwAcc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"AccBC"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(RwAcc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"AccBC"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>RwAcc[<span class="st">'B'</span>, <span class="st">'AccBC'</span>] <span class="ot">&lt;-</span> RwAcc[<span class="st">'B'</span>, <span class="st">'C'</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">expm</span>(RwAcc), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 x 5 Matrix of class "dgeMatrix"
          A     B     C     D AccBC
A     0.731 0.197 0.066 0.007 0.071
B     0.000 0.541 0.393 0.066 0.459
C     0.000 0.000 0.750 0.250 0.000
D     0.000 0.000 0.000 1.000 0.000
AccBC 0.000 0.000 0.000 0.000 1.000</code></pre>
</div>
</div>
<p>Note that once embedded into probabilities, there is a transition from A-&gt;AccBC which tracks how many transitions from A-&gt;B-&gt;C and B-&gt;C occur. The original rate specified was zero for A-&gt;AccBC, but due to jumping states this now has a non-zero probability and the accumulator is able to track this.</p>
<p>Idealy the original rate estimates would have assumed a structural model that was sensible and rates could be estimated to match the data. This is a statistical modeling problem outside the scope of this appendix.</p>
<p>For the sake of organization, it is recommended that the upper left matrix remain the original Markov and all the non-Markovian rows be to the bottom and right of the matrix.</p>
</section>
<section id="non-stationary-rates" class="level2">
<h2 class="anchored" data-anchor-id="non-stationary-rates">Non-stationary Rates</h2>
<p>Another problem that occurs is that of non-stationary rates. What if a rate is changing over an interval time step? How is this best modeled? A first order approach would be to simply take the mean of the rates at either time point. A higher order approach is to integrate the total risk exposure over the time interval.</p>
<p><span class="math display">\[r_{e} = \int_{t_1}^{t_2} r(t) dt\]</span> This computes the effective rate <span class="math inline">\(r_e\)</span> from a time varying rate, <span class="math inline">\(r(t)\)</span>.</p>
<p>For example, in our applications the probability of death from outside causes could be modeled based on mortality tables using a Gompertz distribution with a shape <span class="math inline">\(a\)</span> and rate <span class="math inline">\(b\)</span> parameter. The hazard function of a distribution is the continuous rate function. The hazard function can be derived from the probability density function (PDF) divided by 1 minus cumulative probability function (CDF). For the Gompertz this is,</p>
<p><span class="math display">\[h(t) = \frac{f(t)}{1-F(t)} = \frac{b e^{at} e^{-b/a(e^{at}-1)}}{e^{-b/a (e^{at}-1)}} = b e^{at}\]</span></p>
<p>From this the effective rate over a timestep of a discrete Markov simulation can be computed.</p>
<p><span class="math display">\[r_{e} = \int_{t_1}^{t_2} b e^{at} dt = \frac{b}{a} (e^{at_2} - e^{at_1})\]</span></p>
<p>While this exists as an anayltical result, in general it’s better to use the effective risk over a time interval as this leads to improved accuracy of a simulation.</p>
</section>
</section>
<section id="tunnel-states" class="level1">
<h1>Tunnel States</h1>
<p>Tunnel states by definition are non-Markovian. However, they cannot be treated as accumulators, i.e., defined before exponentiation. This is due to their rates being infinite. This requires that the transition matrix be modified directly after computation. Enter the rates as zero, then modify post matrix exponentiation. A full example is below in the section `Bringing it All Together’</p>
</section>
<section id="rescaling-and-integration" class="level1">
<h1>Rescaling and Integration</h1>
<p>It may be tempting to simply rescale the time scale to improve the accuracy of the Markov simulation (i.e., use a daily time step rather than monthly or yearly, as this reduces the likelihood that multiple competing events occur within a time step). While this is true in principle, without using the tools above for embedding rates it leads to higher numerical error and has the opposite of the intended effect. To rescale this is done at the matrix exponentiation stage of the matrix.</p>
<p><span class="math display">\[ T_{p} = e^{R t} \]</span></p>
<p>Where <span class="math inline">\(t\)</span> is the new time scaling factor. For example, if the rate matrix <span class="math inline">\(R\)</span> is in units of events per year and a monthly simulation is desired, <span class="math inline">\(t=\frac{1}{12}\)</span>, thus Monthly <span class="math inline">\(T_p = e^{R/12}\)</span>.</p>
<p>Another commonly-used method to improve accuracy when adding cost or utility over a simulation result is that of the half-cycle correction or the life table method. We recommend against using these corrections, as they are simply Newton’s trapezoidal method for integrating evenly spaced points.</p>
<p>The current state of the art in this area is the <em>alternate extended Simpson’s rule</em> which estimate higher order terms of rate of change of the function. In most health economic applications the overall change in curvature is acceptably smooth and this technique returns accurate results.</p>
<p>The <em>alternate extended Simpson’s rule</em> to integrate a curve is as follows:</p>
<p><span class="math display">\[ \int^b_a x(t) dt \approx \frac{h}{48}\left[ 17 x_0 + 59 x_1 + 43 x_2 + 49 x_3 + \sum_{i=4}^{n-4} x_i 49x_{n-3} + 43x_{n-2}+59x_{n-1}+17x_n  \right] \]</span></p>
<p>Where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> represent the time window of the simulation, <span class="math inline">\(x(t)\)</span> is the theoretical function that is being summed, <span class="math inline">\(h\)</span> is the width of the time step, and <span class="math inline">\(x_i\)</span> is the simulation result at time point <span class="math inline">\(i\)</span>.</p>
<p>This method requires at least 8 time points. If one’s simulation is shorter, there are shorter versions of Simpson’s rules with fewer higher order terms.</p>
<p>In general with accurate time step embedding of rates and Simpson’s rules, rescaling is not required. If one does rescaling, compare the existing time points from the bigger timestep to the smaller—they should line up exactly. If they don’t line up, then rescaling is not being done properly.</p>
</section>
<section id="from-soup-to-nuts-a-fully-executed-example" class="level1">
<h1>From Soup to Nuts: A Fully-Executed Example</h1>
<p>We conclude with a simple example that brings all of these techniques together.</p>
<p>We will assume there exists a state “H” healthy, A condition “A” and death from “A” and death from outside causes. An individual of our target population develops “A” at a rate of 0.1. Individuals with “A” die at a rate of 0.3. Secular death can occur from “H” or “A” with Gompertz distribution with a shape <span class="math inline">\(a=0.1\)</span> and rate <span class="math inline">\(b=1/1200\)</span>. “A” incurs a one time cost of $1000. Existing in state “A” has a disutilty of 0.2 for 2 years. We wish to simulate a 20-year time horizon.</p>
<p>SD &lt;- (H -&gt; A) -&gt; AD</p>
<p>First we define our effective death rate function for a given time step using the Gompertz hazard integration above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>rate_secular_death_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">h=</span><span class="dv">1</span>, <span class="at">a=</span><span class="fl">0.1</span>, <span class="at">b=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">1200</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  (b<span class="sc">/</span>a) <span class="sc">*</span> (<span class="fu">exp</span>(a<span class="sc">*</span>t) <span class="sc">-</span> <span class="fu">exp</span>(a<span class="sc">*</span>(t<span class="sc">-</span>h)))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we define our Markovian embeddable rate transition matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>markov_rate_matrices<span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(t, <span class="cf">function</span>(tt){</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    r.secular <span class="ot">&lt;-</span> <span class="fu">rate_secular_death_by_age</span>(tt<span class="sc">+</span><span class="dv">40</span>, h)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="fl">0.0</span>, r.secular,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.3</span>, r.secular,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow=</span><span class="dv">4</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">ncol=</span><span class="dv">4</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">byrow=</span><span class="cn">TRUE</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span>, <span class="st">"DS"</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span>, <span class="st">"DS"</span>)))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(x) <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">rowSums</span>(x)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We modify the matrix to include an accumluator ‘ACC’ for death from A ‘DA’ entry. Technically this wouldn’t be required as ‘DA’ is an absorbing state, but for the purposes of example it is included.</p>
<p>We will also create a T1 and T2 state for tracking tunnels and allow exit from due to external death. This requires us to have a recieving bucket for these external risks ‘N’ for NULL so as not to disturb the balance of the Markov.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>non_markov_rate_matrices <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  markov     <span class="ot">&lt;-</span> <span class="fu">markov_rate_matrices</span>(t, h)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  non_markov <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> t)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Expand matrix</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    non_markov[[i]] <span class="ot">&lt;-</span> <span class="fu">cbind</span>(markov[[i]],     <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">16</span>), <span class="at">nrow=</span><span class="dv">4</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    non_markov[[i]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(non_markov[[i]], <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">32</span>), <span class="at">nrow=</span><span class="dv">4</span>))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(non_markov, <span class="cf">function</span>(m){</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Put in State Names</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span> ,<span class="st">"DS"</span>, <span class="st">"ACC"</span>, <span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="st">"N"</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span> ,<span class="st">"DS"</span>, <span class="st">"ACC"</span>, <span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="st">"N"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define Accumulator</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"H"</span>, <span class="st">"ACC"</span>] <span class="ot">&lt;-</span> m[<span class="st">"H"</span>, <span class="st">"A"</span>] </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define Tunnel state entry</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"H"</span>, <span class="st">"T1"</span>]  <span class="ot">&lt;-</span> m[<span class="st">"H"</span>, <span class="st">"A"</span>]</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    m  <span class="co"># Note: Tunnel states are not fully defined at this point.</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we embed the non-Markovian matrices into the time step and finish the definition of the tunnel states in the probability space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>transition_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(t, <span class="at">h=</span><span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Embed the matrices into the timesteps</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  tp <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">non_markov_rate_matrices</span>(t, h), <span class="cf">function</span>(m) <span class="fu">expm</span>(m<span class="sc">*</span>h))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(tp, <span class="cf">function</span>(m)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># It is possible to exit tunnel to external risk of death</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"T1"</span>, <span class="st">"N"</span>]  <span class="ot">&lt;-</span> m[<span class="st">"A"</span>, <span class="st">"DA"</span>] <span class="sc">+</span> m[<span class="st">"A"</span>, <span class="st">"DS"</span>]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"T1"</span>, <span class="st">"T1"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Cannot remain in tunnel</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"T1"</span>, <span class="st">"T2"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>m[<span class="st">"T1"</span>, <span class="st">"N"</span>] <span class="co"># The tunnel is everything else </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># T2 is terminal state</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"T2"</span>, <span class="st">"T2"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    m[<span class="st">"T2"</span>, <span class="st">"N"</span>]  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: At this point, the "N" state could be stripped as it was</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       only required for the embedding, and serves no other purpose</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       at this point</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span>, <span class="st">"DS"</span>, <span class="st">"ACC"</span>, <span class="st">"T1"</span> ,<span class="st">"T2"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    m[states, states]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the simulation matrices are fully defined at each timestep, and it can be run versus a starting population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="at">H=</span><span class="dv">1</span>, <span class="at">A=</span><span class="dv">0</span>, <span class="at">DA=</span><span class="dv">0</span>, <span class="at">DS=</span><span class="dv">0</span>, <span class="at">ACC=</span><span class="dv">0</span>, <span class="at">T1=</span><span class="dv">0</span>, <span class="at">T2=</span><span class="dv">0</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>simulation <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">transition_prob</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>), <span class="cf">function</span>(tp) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;&lt;-</span> Y <span class="sc">%*%</span> tp</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>simulation <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">H=</span><span class="dv">1</span>, <span class="at">A=</span><span class="dv">0</span>, <span class="at">DA=</span><span class="dv">0</span>, <span class="at">DS=</span><span class="dv">0</span>, <span class="at">ACC=</span><span class="dv">0</span>, <span class="at">T1=</span><span class="dv">0</span>, <span class="at">T2=</span><span class="dv">0</span>), </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  simulation</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot the trajectories of the simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, simulation[,<span class="st">"H"</span>], <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">typ=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"ratio of total population"</span>, <span class="at">xlab=</span><span class="st">"Year"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, simulation[,<span class="st">"A"</span>],   <span class="at">col=</span><span class="st">"red"</span>,       <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, simulation[,<span class="st">"DA"</span>],  <span class="at">col=</span><span class="st">"blue"</span>,      <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, simulation[,<span class="st">"DS"</span>],  <span class="at">col=</span><span class="st">"darkgreen"</span>, <span class="at">lty=</span><span class="dv">4</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, simulation[,<span class="st">"ACC"</span>], <span class="at">col=</span><span class="st">"orange"</span>,    <span class="at">lty=</span><span class="dv">5</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"T1"</span>, <span class="st">"T2"</span>)]), <span class="at">col=</span><span class="st">"purple"</span>, <span class="at">lty=</span><span class="dv">6</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">5</span>, <span class="fl">1.0</span>, <span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span>, <span class="st">"DS"</span>, <span class="st">"ACC"</span>, <span class="st">"T"</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="st">"purple"</span>), <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="numerical-checkpoint" class="level2">
<h2 class="anchored" data-anchor-id="numerical-checkpoint">Numerical Checkpoint</h2>
<p>A good check at this point is to see if the simulation kept the total population consistent, i.e., neither created nor destroyed occupants of the Markov simulation. If the plot strays far from zero, then something is wrong in constructing the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">1</span><span class="sc">-</span><span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>, <span class="st">"DA"</span>, <span class="st">"DS"</span>)]), <span class="at">xlab=</span><span class="st">"time (years)"</span>, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"absolute error"</span>, <span class="at">main=</span><span class="st">"Total Population Numerical Error"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now with the simulation complete and passing a simple check, one can proceed to integrate costs and qualities.</p>
<p>First let’s define the alternate Simpson’s coefficient function for integration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Better accuracy that "life-table" aka trapezoidal method</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>alt_simp_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(i) <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">59</span>, <span class="dv">43</span>, <span class="dv">49</span>, <span class="fu">rep</span>(<span class="dv">48</span>, i<span class="dv">-8</span>), <span class="dv">49</span>, <span class="dv">43</span>, <span class="dv">59</span>, <span class="dv">17</span>) <span class="sc">/</span> <span class="dv">48</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>alt_simp      <span class="ot">&lt;-</span> <span class="cf">function</span>(x,h) h<span class="sc">*</span><span class="fu">sum</span>(<span class="fu">alt_simp_coef</span>(<span class="fu">length</span>(x)) <span class="sc">*</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="costs" class="level3">
<h3 class="anchored" data-anchor-id="costs">Costs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1000</span><span class="sc">*</span>simulation[<span class="dv">21</span>,<span class="st">"ACC"</span>] <span class="co"># The last point is the total</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ACC 
554.7587 </code></pre>
</div>
</div>
</section>
<section id="quality-adjusted-life-years" class="level3">
<h3 class="anchored" data-anchor-id="quality-adjusted-life-years">Quality-Adjusted Life Years</h3>
<p>Total possible life years:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alt_simp</span>(<span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>)]), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.943292</code></pre>
</div>
</div>
<p>Total Disutility of ‘A’ (via the tunnel states):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alt_simp</span>(<span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"T1"</span>, <span class="st">"T2"</span>)]), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9392552</code></pre>
</div>
</div>
<p>Final quality-adjusted life years:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alt_simp</span>(<span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"H"</span>, <span class="st">"A"</span>)]), <span class="dv">1</span>) <span class="sc">-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alt_simp</span>(<span class="fu">rowSums</span>(simulation[,<span class="fu">c</span>(<span class="st">"T1"</span>, <span class="st">"T2"</span>)]), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.004037</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>